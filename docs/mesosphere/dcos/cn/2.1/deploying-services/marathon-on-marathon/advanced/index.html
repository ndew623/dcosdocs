<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width" initial-scale="1" user-scalable="no"><title>带安全功能的自定义 Marathon - D2iQ Docs</title><meta name="description" content="使用高级非本地 Marathon 实例"><link rel="apple-touch-icon" sizes="180x180" href="/assets/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/favicon-16x16.png"><link rel="stylesheet" type="text/css" href="/dcosdocs/css/styles.css"><link rel="search" type="application/opensearchdescription+xml" href="/assets/opensearch.xml" title="Search"><link href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,500,500i,700,700i" rel="stylesheet"><script src="https://unpkg.com/feather-icons/dist/feather.min.js"></script><script>window.analytics||(window.analytics=[]),window.analytics.methods=["identify","track","trackLink","trackForm","trackClick","trackSubmit","page","pageview","ab","alias","ready","group","on","once","off"],window.analytics.factory=function(t){return function(){var a=Array.prototype.slice.call(arguments);return a.unshift(t),window.analytics.push(a),window.analytics}};for(var i=0;i<window.analytics.methods.length;i++){var method=window.analytics.methods[i];window.analytics[method]=window.analytics.factory(method)}window.analytics.load=function(t){var a=document.createElement("script");a.type="text/javascript",a.async=!0,a.src=("https:"===document.location.protocol?"https://":"http://")+"d2dq2ahtl5zl1z.cloudfront.net/analytics.js/v1/"+t+"/analytics.min.js";var n=document.getElementsByTagName("script")[0];n.parentNode.insertBefore(a,n)},window.analytics.SNIPPET_VERSION="2.0.8",
window.analytics.load("7sgtwqvuai");
window.analytics.page();</script><noscript><iframe src="//www.googletagmanager.com/ns.html?id=GTM-PBJ84KX" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript><script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src='//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
})(window,document,'script','dataLayer','GTM-PBJ84KX');</script></head><body><div class="layout"><header class="header"><a class="header__drawer"><i class="header__icon" data-feather="menu"></i></a><a class="header__logo" href="/"><img class="header__logo--mobile" src="/assets/D2iQ_Logotype_Color_Positive_Documentation.svg" alt="D2IQ"><img class="header__logo--desktop" src="/assets/D2iQ_Logotype_Color_Positive_Documentation.svg" alt="D2IQ"></a><div class="header__main"><div class="header__dropdown"><img class="header__dropdown-icon" src="/assets/D2IQ_Logotype_Color_Positive.png" alt="D2iQ"><strong>DC/OS文档</strong><i data-feather="chevron-down"></i></div><nav class="header__menu"><ul class="header__menu-list"><li class="header__menu-item"><a href="https://support.d2iq.com">Support</a></li></ul></nav></div><div class="chooser" id="spherer"><div class="chooser-current"><a class="chooser-title">Mesosphere</a><svg class="chooser-svg" id="spherer-svg"><path class="pointer" d="m 13,6 -5,5 -5,-5 z" fill="#858585"></path></svg></div><ul class="chooser-list" id="spherer-list"><li class="chooser-list-item"><a href="/mesosphere/dcos">DC/OS</a></li><li class="chooser-list-item"><a href="/dcosdocs/mesosphere/dcos/services">DC/OS Services</a></li></ul></div><div class="chooser" id="ks"><div class="chooser-current"><a class="chooser-title">DKP</a><svg class="chooser-svg" id="kspherer-svg"><path class="pointer" d="m 13,6 -5,5 -5,-5 z" fill="#858585"></path></svg></div><ul class="chooser-list" id="kspherer-list"><li class="chooser-list-item"><a href="/dkp/konvoy">Konvoy</a></li><li class="chooser-list-item"><a href="/dkp/kommander">Kommander</a></li><li class="chooser-list-item"><a href="/dkp/dispatch">Dispatch</a></li><li class="chooser-list-item"><a href="/dkp/kaptain">Kaptain</a></li></ul></div><div class="chooser" id="localizer"><div class="chooser-current"><a class="chooser-title">中文 (简体)</a><svg class="chooser-svg" id="localizer-svg"><path class="pointer" d="m 13,6 -5,5 -5,-5 z" fill="#858585"></path></svg></div><ul class="chooser-list" id="localizer-list"><li class="chooser-list-item"><a href="/dcosdocs/mesosphere/dcos/2.1/deploying-services/marathon-on-marathon/advanced">English</a></li></ul></div><section class="header__search" role="search"><form class="header__search-form" action="/search/"><input class="header__search-input" id="header-search-input" tabindex="1" type="text" name="q" placeholder="Search"><input type="hidden" name="hFR[scope][0]" value="DC/OS 2.1"><label class="header__search-label" for="header-search-input"><i class="header__icon" data-feather="search"></i></label></form></section></header><div class="header-dropdown"><ul class="header-dropdown__list"><li class="header-dropdown__top-item"><div>DKP</div></li><li class="header-dropdown__item"><a href="/dkp/konvoy">Konvoy</a></li><li class="header-dropdown__item"><a href="/dkp/kommander">Kommander</a></li><li class="header-dropdown__item"><a href="/dkp/dispatch">Dispatch</a></li><li class="header-dropdown__item"><a href="/dkp/kaptain">Kaptain</a></li><li class="header-dropdown__top-item"><div>Mesosphere</div></li><li class="header-dropdown__item header-dropdown__item--active"><a href="/mesosphere/dcos">DC/OS</a></li><li class="header-dropdown__item"><a href="/dcosdocs/mesosphere/dcos/services">DC/OS Services</a></li><li class="header-dropdown__item"><a href="https://support.d2iq.com">Support</a></li></ul></div><div class="layout__sidebar layout__drawer"><section class="sidebar"><header class="sidebar__header"><div class="sidebar__dropdown"><ul><li><a href="/dcosdocs/mesosphere/dcos/cn/2.1/deploying-services/marathon-on-marathon/advanced">Mesosphere DC/OS 2.1.0</a></li><li><a href="/dcosdocs/mesosphere/dcos/cn/2.0/deploying-services/marathon-on-marathon/advanced">Mesosphere DC/OS 2.0</a></li><li><a href="/dcosdocs/mesosphere/dcos/cn/1.13/deploying-services/marathon-on-marathon/advanced">Mesosphere DC/OS 1.13</a></li></ul><div class="toggle"><p><span class="title">DC/OS</span><span class="version"> 2.1</span></p><i data-feather="chevron-down"></i></div></div></header><nav class="sidebar_nav" role="navigation"><ul><li><a class="d0" href="/dcosdocs/mesosphere/dcos/cn/2.1/release-notes/"><i data-feather="chevron-right"></i>版本注释</a></li><li><a class="d0" href="/dcosdocs/mesosphere/dcos/cn/2.1/overview/"><i data-feather="chevron-right"></i>概述</a></li><li><a class="d0" href="/dcosdocs/mesosphere/dcos/cn/2.1/installing/"><i data-feather="chevron-right"></i>安装</a></li><li><a class="d0" href="/dcosdocs/mesosphere/dcos/cn/2.1/gui/"><i data-feather="chevron-right"></i>GUI</a></li><li><a class="d0" href="/dcosdocs/mesosphere/dcos/cn/2.1/cli/"><i data-feather="chevron-right"></i>CLI</a></li><li><a class="d0" href="/dcosdocs/mesosphere/dcos/cn/2.1/administering-clusters/"><i data-feather="chevron-right"></i>管理群集</a></li><li><a class="d0" href="/dcosdocs/mesosphere/dcos/cn/2.1/networking/"><i data-feather="chevron-right"></i>网络</a></li><li><a class="d0" href="/dcosdocs/mesosphere/dcos/cn/2.1/security/"><i data-feather="chevron-right"></i>安全</a></li><li><a class="d0" href="/dcosdocs/mesosphere/dcos/cn/2.1/storage/"><i data-feather="chevron-right"></i>存储</a></li><li><a class="d0" href="/dcosdocs/mesosphere/dcos/cn/2.1/metrics/"><i data-feather="chevron-right"></i>度量标准</a></li><li><a class="d0" href="/dcosdocs/mesosphere/dcos/cn/2.1/monitoring/"><i data-feather="chevron-right"></i>监控、日志记录和调试</a></li><li><a class="d0" href="/dcosdocs/mesosphere/dcos/cn/2.1/multi-tenancy/"><i data-feather="chevron-right"></i>DC/OS 群集的多租户</a></li><li><a class="d0" href="/dcosdocs/mesosphere/dcos/cn/2.1/hybrid-cloud/"><i data-feather="chevron-right"></i>混合云</a></li><li><a class="d0" href="/dcosdocs/mesosphere/dcos/cn/2.1/deploying-jobs/"><i data-feather="chevron-right"></i>部署作业</a></li><li class="active"><a class="d0" href="/dcosdocs/mesosphere/dcos/cn/2.1/deploying-services/"><i data-feather="chevron-right"></i>部署服务和 Pod</a></li><ul><li><a class="d1" href="/dcosdocs/mesosphere/dcos/cn/2.1/deploying-services/marathon-parameters/">Marathon 配置参考</a></li><li><a class="d1" href="/dcosdocs/mesosphere/dcos/cn/2.1/deploying-services/install/">安装服务</a></li><li><a class="d1" href="/dcosdocs/mesosphere/dcos/cn/2.1/deploying-services/task-handling/"><i data-feather="chevron-right"></i>任务处理</a></li><li><a class="d1" href="/dcosdocs/mesosphere/dcos/cn/2.1/deploying-services/creating-services/"><i data-feather="chevron-right"></i>创建服务</a></li><li><a class="d1" href="/dcosdocs/mesosphere/dcos/cn/2.1/deploying-services/config-universe-service/">配置服务</a></li><li><a class="d1" href="/dcosdocs/mesosphere/dcos/cn/2.1/deploying-services/marathon-constraints/">Marathon 布局约束</a></li><li><a class="d1" href="/dcosdocs/mesosphere/dcos/cn/2.1/deploying-services/scale-service/">扩展服务</a></li><li><a class="d1" href="/dcosdocs/mesosphere/dcos/cn/2.1/deploying-services/service-groups/">授权访问服务和组</a></li><li><a class="d1" href="/dcosdocs/mesosphere/dcos/cn/2.1/deploying-services/fault-domain-awareness/">故障域感知和容量扩展</a></li><li><a class="d1" href="/dcosdocs/mesosphere/dcos/cn/2.1/deploying-services/update-user-service/">更新用户创建的服务</a></li><li><a class="d1" href="/dcosdocs/mesosphere/dcos/cn/2.1/deploying-services/service-ports/">服务端口</a></li><li><a class="d1" href="/dcosdocs/mesosphere/dcos/cn/2.1/deploying-services/service-endpoints/">服务端点</a></li><li><a class="d1" href="/dcosdocs/mesosphere/dcos/cn/2.1/deploying-services/monitor-services/">监控服务</a></li><li><a class="d1" href="/dcosdocs/mesosphere/dcos/cn/2.1/deploying-services/private-docker-registry/">使用专用 Docker 注册表</a></li><li><a class="d1" href="/dcosdocs/mesosphere/dcos/cn/2.1/deploying-services/expose-service/">公开服务</a></li><li><a class="d1" href="/dcosdocs/mesosphere/dcos/cn/2.1/deploying-services/deployments/">部署</a></li><li><a class="d1" href="/dcosdocs/mesosphere/dcos/cn/2.1/deploying-services/uninstall/">卸载服务</a></li><li><a class="d1" href="/dcosdocs/mesosphere/dcos/cn/2.1/deploying-services/package-api/">包管理 API</a></li><li class="active"><a class="d1" href="/dcosdocs/mesosphere/dcos/cn/2.1/deploying-services/marathon-on-marathon/"><i data-feather="chevron-right"></i>使用自定义 Marathon</a></li><ul><li><a class="d2" href="/dcosdocs/mesosphere/dcos/cn/2.1/deploying-services/marathon-on-marathon/basic/">使用自定义 Marathon 实例部署服务</a></li><li class="active active-on"><a class="d2" href="/dcosdocs/mesosphere/dcos/cn/2.1/deploying-services/marathon-on-marathon/advanced/">带安全功能的自定义 Marathon</a></li></ul><li><a class="d1" href="/dcosdocs/mesosphere/dcos/cn/2.1/deploying-services/marathon-api/">Marathon  API</a></li><li><a class="d1" href="/dcosdocs/mesosphere/dcos/cn/2.1/deploying-services/containerizers/"><i data-feather="chevron-right"></i>使用容器化工具</a></li><li><a class="d1" href="/dcosdocs/mesosphere/dcos/cn/2.1/deploying-services/pods/"><i data-feather="chevron-right"></i>Pod</a></li><li><a class="d1" href="/dcosdocs/mesosphere/dcos/cn/2.1/deploying-services/multi-tenancy-primitives/">多租户原始文件</a></li><li><a class="d1" href="/dcosdocs/mesosphere/dcos/cn/2.1/deploying-services/gpu/">使用 GPU</a></li><li><a class="d1" href="/dcosdocs/mesosphere/dcos/cn/2.1/deploying-services/faq/">常见问题</a></li></ul><li><a class="d0" href="/dcosdocs/mesosphere/dcos/cn/2.1/tutorials/"><i data-feather="chevron-right"></i>教程</a></li><li><a class="d0" href="/dcosdocs/mesosphere/dcos/cn/2.1/api/"><i data-feather="chevron-right"></i>API 参考</a></li><li><a class="d0" href="/dcosdocs/mesosphere/dcos/cn/2.1/developing-services/"><i data-feather="chevron-right"></i>开发 DC/OS 服务</a></li></ul></nav><footer class="sidebar__footer"><div class="sidebar__footer-links"><a href="https://d2iq.com/terms/">Terms of Service</a><a href="https://d2iq.com/privacy/">Privacy Policy</a></div><a class="sidebar__footer-copyright" href="https://d2iq.com/">&copy; 2022 D2iQ, Inc. All rights reserved.</a></footer></section></div><div class="layout__content" role="main"><main class="content"><div class="content__container content__container--with-sections"><div class="content__header"><div class="content__header__row"><h1 class="content__header-title">带安全功能的自定义 Marathon</h1><p class="badge badge--content-header badge--enterprise">ENTERPRISE</p></div><h4 class="content__header-description">使用高级非本地 Marathon 实例</h4><div class="actions"><ul class="actions__list"><li class="actions__item"><button class="actions__link" onclick="javascript:window.print()"><i class="actions__icon" data-feather="printer"></i><span class="actions__text">Print</span></button></li><li class="actions__item"><a class="actions__link" href="https://github.com/mesosphere/dcos-docs-site/tree/main/pages/dcosdocs/mesosphere/dcos/cn/2.1/deploying-services/marathon-on-marathon/advanced/index.md" target="_blank"><i class="actions__icon" data-feather="github"></i><span class="actions__text">Contribute</span></a></li></ul></div></div><article class="content__article"><p>本专题描述了如何部署具有独立角色、保留、配额和安全功能的非本地 Marathon 实例  (Marathon on Marathon) 。高级非本地 Marathon 程序只能在您需要 <a href="/dcosdocs/mesosphere/dcos/cn/2.1/security/ent/secrets/">密钥</a> 或细粒度 ACL 时使用。否则，请使用 <a href="/dcosdocs/mesosphere/dcos/cn/2.1/deploying-services/marathon-on-marathon/basic/">基本程序</a>.</p>
<p>对于本程序，我们假设您已从支持团队成员获得了 Marathon 的企业版。如果您仍然需要企业工件，则需要首先通过 [Mesosphere 支持门户] 提交故障单。(https://support.mesosphere.com/s/). 企业工件作为 Docker 镜像文件提供，并包含 Marathon 以及 Marathon 插件，可启用 DC/OS Enterprise 功能 - 例如密钥和细分访问权限控制。</p>
<p><strong>前提条件：</strong></p>
<ul>
<li>DC/OS 和 DC/OS CLI <a href="/dcosdocs/mesosphere/dcos/cn/2.1/installing/">已安装</a>。</li>
<li><a href="/dcosdocs/mesosphere/dcos/cn/2.1/cli/enterprise-cli/#ent-cli-install">DC/OS Enterprise CLI 0.4.14 或更高版本</a>。</li>
<li>每个专用 DC/OS 代理可以通过网络访问的专用 Docker 注册表。可以遵循 <a href="/dcosdocs/mesosphere/dcos/cn/2.1/deploying-services/private-docker-registry/">以下</a> 关于如何在 Marathon 中设置，或使用其他选项的说明（如 <a href="https://hub.docker.com/">DockerHub</a>、<a href="https://aws.amazon.com/ecr/">Amazon EC2 容器注册表</a>和 <a href="https://quay.io/">Quay</a>).</li>
<li>自定义非本机 Marathon 镜像<a href="/dcosdocs/mesosphere/dcos/cn/2.1/deploying-services/private-docker-registry#tarball-instructions">部署在您的专用 Docker 注册表中</a>。通过 <a href="https://support.mesosphere.com">支持门户</a> 提交故障单以获取企业 Marathon 镜像文件。</li>
<li>您必须以超级用户身份登录。</li>
<li>对群集的 SSH 访问。</li>
</ul>
<p><a name="variables-in-example"></a></p>
<p><strong>此示例中的变量</strong></p>
<p>整个页面将指示您调用命令或执行使用特定于群集的值的操作。我们使用 <code>${VARIABLE}</code> 表示法引用这些特定于群集的值；请将以下变量替换为您的群集的合适值。</p>
<p>该表包含本页所用的所有变量：</p>
<table>
<thead>
<tr>
<th>变量</th>
<th>描述</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>${MESOS_ROLE}</code></td>
<td>新 Marathon 实例将使用的 <a href="https://mesos.apache.org/documentation/latest/roles/">Mesos 角色</a>的名称。该名称应该全部小写，并且是有效的 <a href="https://mesos.apache.org/documentation/latest/roles/#invalid-role-names">Mesos 角色名称</a>，例如 <code>&quot;marathon_ee&quot;</code>.</td>
</tr>
<tr>
<td><code>${SERVICE_ACCOUNT}</code></td>
<td>Marathon 用来和 DC/OS 中的其他服务进行通信的 <a href="/dcosdocs/mesosphere/dcos/cn/2.1/security/ent/service-auth/">服务帐户</a> 的名称。名称应仅包含字母、数字、<code>@</code>、<code>.</code>、<code>\</code>、<code>_</code> 和 <code>-</code>. 例如 <code>&quot;marathon_user_ee&quot;</code></td>
</tr>
<tr>
<td><code>${MARATHON_INSTANCE_NAME}</code></td>
<td>新 Marathon 实例的服务名称，由根 Marathon 实例启动。这应该是有效的 <a href="https://mesosphere.github.io/marathon/docs/application-basics.html">Marathon 服务名称</a>，例如 <code>&quot;mom_ee&quot;</code>.</td>
</tr>
<tr>
<td><code>${SERVICE_ACCOUNT_SECRET}</code></td>
<td><a href="/dcosdocs/mesosphere/dcos/cn/2.1/security/ent/secrets/">密钥存储库</a>中的密钥路径，用于保存 Marathon 将使用的私钥以及要在 DC/OS 上进行身份认证的 <code>${SERVICE_ACCOUNT}</code> 帐户。此名称 <strong>不得</strong>包含一个领导的 <code>/</code>. 有效示例： <code>&quot;marathon_user_ee_secret&quot;</code></td>
</tr>
<tr>
<td><code>${DOCKER_REGISTRY_SECRET}</code></td>
<td><a href="/dcosdocs/mesosphere/dcos/cn/2.1/security/ent/secrets/">密钥</a>的名称，用于保存从专用注册表中获取 Marathon Docker 镜像的凭据。此名称 <strong>不得</strong>包含一个领导的 <code>/</code>. 有效示例： <code>&quot;registry_secret&quot;</code>.</td>
</tr>
<tr>
<td><code>${PRIVATE_KEY}</code></td>
<td>PEM 格式化私钥文件的路径（在本地文件系统中，不确定是否存在），最好以 <code>.pem</code> 为后缀</td>
</tr>
<tr>
<td><code>${PUBLIC_KEY}</code></td>
<td>PEM 格式化公钥文件的路径（在本地文件系统中，不确定是否存在），最好以 <code>.pem</code> 为后缀</td>
</tr>
<tr>
<td><code>${MARATHON_IMAGE}</code></td>
<td>专用存储库中的 Marathon 镜像的名称**，例如，<code>private-repo/marathon-dcos-ee</code>。</td>
</tr>
<tr>
<td><code>${MARATHON_TAG}</code></td>
<td>要部署的 Marathon 版本的 Docker 镜像标记。例如，<code>v1.5.11_1.10.2</code> （0.11.0 或更高版本）。</td>
</tr>
</tbody>
</table>
<p>如果您使用的是 Mac OS 或 Linux 计算机，则可以在终端会话中预先定义上述大多数变量，只需将片段复制并粘贴到终端中即可：</p>
<pre><code class="language-bash">set -a
MESOS_ROLE=&quot;...&quot;
SERVICE_ACCOUNT=&quot;...&quot;
BEGIN_PORT=&quot;...&quot;
END_PORT=&quot;...&quot;
MARATHON_INSTANCE_NAME=&quot;...&quot;
SERVICE_ACCOUNT_SECRET=&quot;...&quot;
DOCKER_REGISTRY_SECRET=&quot;...&quot;
PRIVATE_KEY=&quot;...&quot;
PUBLIC_KEY=&quot;...&quot;
MARATHON_IMAGE=&quot;...&quot;
MARATHON_TAG=&quot;...&quot;
</code></pre>
<h1 id="1"><a class="content__anchor" href="#1" aria-hidden="true"><i data-feather="bookmark"></i></a>步骤 1：准备</h1>
<p>在以下步骤中，我们假设您已经：</p>
<ol>
<li>
<p>将 Marathon 企业镜像推送到您的专用注册表<a href="/dcosdocs/mesosphere/dcos/cn/2.1/deploying-services/private-docker-registry#tarball-instructions">（说明）</a>，名称为 <code>${MARATHON_IMAGE}:${MARATHON_TAG}</code>.</p>
</li>
<li>
<p>将您的专用 Docker 凭据存储在密钥存储库 <a href="/dcosdocs/mesosphere/dcos/cn/2.1/deploying-services/private-docker-registry/#referencing-private-docker-registry-credentials-in-the-secrets-store-enterprise">（说明）</a>中，名称为 <code>${DOCKER_REGISTRY_SECRET}</code>.</p>
 <p class="message--warning"><strong>警告：</strong>密钥的名称应该位于根路径（例如 <code>/some-secret-name</code>）中，或者以应用程序的名称为前缀（例如 <code>/${MARATHON_INSTANCE_NAME}/some-secret-name</code>). 如果不这样做，将使根 Marathon 无法读取密钥值，并且无法启动自定义 Marathon-on-Marathon 实例。</p>
</li>
</ol>
<h1 id="2-marathon"><a class="content__anchor" href="#2-marathon" aria-hidden="true"><i data-feather="bookmark"></i></a>步骤 2：创建 Marathon 服务帐户</h1>
<p>本步骤创建了 Marathon <a href="/dcosdocs/mesosphere/dcos/cn/2.1/security/ent/service-auth/">服务账户</a> Marathon 将使用此帐户对其余 DC/OS 组件进行身份认证。稍后授予此帐户的权限将定义允许 Marathon 执行的操作。</p>
<p>Marathon 服务账户可能是可选或必填项，具体取决于您的 <a href="/dcosdocs/mesosphere/dcos/cn/2.1/security/ent/#security-modes">安全模式</a></p>
<table>
<thead>
<tr>
<th>安全模式</th>
<th>Marathon 服务帐户</th>
</tr>
</thead>
<tbody>
<tr>
<td>宽容</td>
<td>可选</td>
</tr>
<tr>
<td>严格</td>
<td>必填</td>
</tr>
</tbody>
</table>
<ol>
<li>
<p>创建 2048 位 RSA 公私密钥对 (<code>${PRIVATE_KEY}</code> 和 <code>${PUBLIC_KEY}</code>) 并将值分别保存到当前目录中的单独文件中。</p>
<p>使用以下命令，我们创建一个公私密钥对。公钥将用于创建 Marathon 服务帐户。我们将私钥存储在 <a href="/dcosdocs/mesosphere/dcos/cn/2.1/security/ent/secrets/">密钥存储库</a> 然后将其传递至 Marathon，供其进行自我授权。</p>
<pre><code class="language-bash">dcos security org service-accounts keypair ${PRIVATE_KEY} ${PUBLIC_KEY}
</code></pre>
</li>
<li>
<p>使用我们生成的公钥（<code>${SERVICE_ACCOUNT}</code>）创建一个名为 <code>${PUBLIC_KEY}</code>). 的新服务帐户。</p>
<pre><code class="language-bash">dcos security org service-accounts create -p ${PUBLIC_KEY} -d &quot;Marathon-on-Marathon User&quot; ${SERVICE_ACCOUNT}
</code></pre>
</li>
</ol>
<h1 id="3"><a class="content__anchor" href="#3" aria-hidden="true"><i data-feather="bookmark"></i></a>步骤 3：创建服务帐户密钥</h1>
<p>在此步骤中，为 Marathon 服务帐户创建密钥，并存储在密钥存储库中。</p>
<p>创建的密钥 (<code>${SERVICE_ACCOUNT_SECRET}</code>) 将包含私钥 (<code>${PRIVATE_KEY}</code>) 和服务帐户名称 (<code>${SERVICE_ACCOUNT}</code>). Marathon 将使用此信息对 DC/OS 进行身份认证。</p>
<h2 class="tabs" id=""><a class="content__anchor" href="#" aria-hidden="true"><i data-feather="bookmark"></i></a></h2>
<h3 id="-2"><a class="content__anchor" href="#-2" aria-hidden="true"><i data-feather="bookmark"></i></a>宽容</h3>
<pre><code class="language-bash">dcos security secrets create-sa-secret ${PRIVATE_KEY} ${SERVICE_ACCOUNT} ${SERVICE_ACCOUNT_SECRET}
</code></pre>
<h3 id="-3"><a class="content__anchor" href="#-3" aria-hidden="true"><i data-feather="bookmark"></i></a>严格</h3>
<pre><code class="language-bash">dcos security secrets create-sa-secret --strict ${PRIVATE_KEY} ${SERVICE_ACCOUNT} ${SERVICE_ACCOUNT_SECRET}
</code></pre>
<h4 id="-4"><a class="content__anchor" href="#-4" aria-hidden="true"><i data-feather="bookmark"></i></a>建议</h4>
<ul>
<li>
<p>使用以下命令确保您的密钥已就绪：</p>
<pre><code class="language-bash">dcos security secrets list /
</code></pre>
</li>
<li>
<p>查看您的密钥，确保其包含正确的服务帐户 ID、私钥和 <code>login_endpoint</code> URL。如果是 <code>strict</code> 模式，应为 HTTPS，如果是 <code>permissive</code> 模式，则应为 HTTP。如果 URL 不正确，尝试 <a href="/dcosdocs/mesosphere/dcos/cn/2.1/cli/enterprise-cli/#ent-cli-upgrade">升级 DC/OS Enterprise CLI</a>，删除密钥，并重新创建。</p>
<p>您可以使用此命令查看内容（需要安装 <a href="https://stedolan.github.io/jq/download">jq 1.5 或更高版本</a></p>
<pre><code class="language-bash">dcos security secrets get ${SERVICE_ACCOUNT_SECRET} --json | jq -r .value | jq
</code></pre>
</li>
<li>
<p>从文件系统中删除私钥文件，防止不法之徒利用私钥通过 DC/OS 身份认证。</p>
</li>
</ul>
<h1 id="4"><a class="content__anchor" href="#4" aria-hidden="true"><i data-feather="bookmark"></i></a>步骤 4：分配权限（仅限严格模式）</h1>
<p>在此步骤中，权限被分配至 Marathon-on-Marathon 实例。在严格模式下需要权限，而在其他安全模式将其忽略即可。</p>
<table>
<thead>
<tr>
<th>安全模式</th>
<th>权限</th>
</tr>
</thead>
<tbody>
<tr>
<td>宽容</td>
<td>不可用</td>
</tr>
<tr>
<td>严格</td>
<td>必填</td>
</tr>
</tbody>
</table>
<p>所有 CLI 命令也可通过 [IAM API]执行。(/dcosdocs/mesosphere/dcos/cn/2.1/security/ent/iam-api/).</p>
<p>授予服务帐户 <code>${SERVICE_ACCOUNT}</code> 权限，以启动将作为 Linux 用户 <code>nobody</code>. 执行的 Mesos 任务。</p>
<p>要以不同 Linux 用户的身份执行任务，请将 <code>nobody</code> 替换为该用户的 Linux 用户名。例如，如需以 Linux 用户 <code>bob</code> 身份启动任务，请替换 <code>nobody</code> 为以下的 <code>bob</code></p>
<p>请注意，<code>nobody</code> 和 <code>root</code> 用户是默认出现在所有代理上的；如果指定自定义用户（例如，<code>bob</code>），则用户 <code>bob</code> 需要在可以执行这些任务的每个代理上手动创建（例如，使用 Linux <code>adduser</code> 或类似实用程序）。</p>
<pre><code class="language-bash">dcos security org users grant ${SERVICE_ACCOUNT} dcos:mesos:master:task:user:nobody create --description &quot;Tasks can execute as Linux user nobody&quot;
dcos security org users grant ${SERVICE_ACCOUNT} dcos:mesos:master:framework:role:${MESOS_ROLE} create --description &quot;Controls the ability of ${MESOS_ROLE} to register as a framework with the Mesos master&quot;
dcos security org users grant ${SERVICE_ACCOUNT} dcos:mesos:master:reservation:role:${MESOS_ROLE} create --description &quot;Controls the ability of ${MESOS_ROLE} to reserve resources&quot;
dcos security org users grant ${SERVICE_ACCOUNT} dcos:mesos:master:volume:role:${MESOS_ROLE} create --description &quot;Controls the ability of ${MESOS_ROLE} to access volumes&quot;
dcos security org users grant ${SERVICE_ACCOUNT} dcos:mesos:master:reservation:principal:${SERVICE_ACCOUNT} delete --description &quot;Controls the ability of ${SERVICE_ACCOUNT} to reserve resources&quot;
dcos security org users grant ${SERVICE_ACCOUNT} dcos:mesos:master:task:app_id:/ create --description &quot;Controls the ability to launch tasks&quot;
dcos security org users grant ${SERVICE_ACCOUNT} dcos:mesos:master:volume:principal:${SERVICE_ACCOUNT} delete --description &quot;Controls the ability of ${SERVICE_ACCOUNT} to access volumes&quot;
</code></pre>
<h1 class="tabs" id="5-marathon"><a class="content__anchor" href="#5-marathon" aria-hidden="true"><i data-feather="bookmark"></i></a>步骤 5：安装具有分配角色  的非本地 Marathon 实例</h1>
<p>在此步骤中，非本地 Marathon 实例安装在 DC/OS上，并分配了 Mesos 角色。</p>
<ol>
<li>
<p>创建一个自定义 JSON 配置，用于安装自定义非本机 Marathon 实例。JSON 文件内容因您的 [安全模式]而有所不同。(/dcosdocs/mesosphere/dcos/cn/2.1/security/ent/#security-modes).</p>
<p>确保使用正确的值替换 JSON 文件中的所有 <code>${VARIABLES}</code></p>
<p>或者，如果已在终端会话中导出变量（如 <a href="#variables-in-example">变量部分</a> 中所述），则可以使用以下命令自动将所有替代变量替换为其导出值。所得文件将保存为 <code>marathon-filled.json</code>:</p>
<pre><code class="language-bash">perl -p -e 's/\$\{(\w+)\}/(exists $ENV{$1}?$ENV{$1}:&quot;&lt;missing-variable-$1&gt;&quot;)/eg' &lt; marathon.json &gt; marathon-filled.json
</code></pre>
<h2 class="tabs" id="-5"><a class="content__anchor" href="#-5" aria-hidden="true"><i data-feather="bookmark"></i></a></h2>
<h3 id="-6"><a class="content__anchor" href="#-6" aria-hidden="true"><i data-feather="bookmark"></i></a>宽容</h3>
<p>如果在 <code>permissive</code> 安全模式下运行群集，请使用以下 JSON 模板。不要忘记<strong>替换</strong>符合 <code>${VARIABLES}</code> 格式的所有环境变量：</p>
<pre><code class="language-json">{
  &quot;id&quot;:&quot;/${MARATHON_INSTANCE_NAME}&quot;,
  &quot;cmd&quot;:&quot;cd $MESOS_SANDBOX &amp;&amp; LIBPROCESS_PORT=$PORT1 &amp;&amp; /marathon/bin/start --default_accepted_resource_roles \&quot;*,${MESOS_ROLE}\&quot; --enable_features \&quot;vips,task_killing,external_volumes,secrets,gpu_resources\&quot; --framework_name ${MARATHON_INSTANCE_NAME} --hostname $LIBPROCESS_IP --http_port $PORT0 --master zk://master.mesos:2181/mesos --max_instances_per_offer 1 --mesos_leader_ui_url /mesos --mesos_role ${MESOS_ROLE}  --zk zk://master.mesos:2181/universe/${MARATHON_INSTANCE_NAME} --mesos_user nobody --mesos_authentication --mesos_authentication_principal ${SERVICE_ACCOUNT}&quot;,
  &quot;user&quot;:&quot;nobody&quot;,
  &quot;cpus&quot;:2,
  &quot;mem&quot;:4096,
  &quot;disk&quot;:0,
  &quot;instances&quot;:1,
  &quot;constraints&quot;:[
     [
        &quot;hostname&quot;,
        &quot;UNIQUE&quot;
     ]
  ],
  &quot;container&quot;:{
     &quot;type&quot;: &quot;MESOS&quot;,
     &quot;docker&quot;:{
        &quot;image&quot;:&quot;${MARATHON_IMAGE}:${MARATHON_TAG}&quot;,
        &quot;pullConfig&quot;: {
            &quot;secret&quot;: &quot;docker-registry-credential&quot;
        }
     }
  },
  &quot;env&quot;:{
     &quot;JVM_OPTS&quot;:&quot;-Xms256m -Xmx2g&quot;,
     &quot;DCOS_STRICT_SECURITY_ENABLED&quot;:&quot;false&quot;,
     &quot;DCOS_SERVICE_ACCOUNT_CREDENTIAL&quot;:{
        &quot;secret&quot;:&quot;service-credential&quot;
     },
     &quot;MESOS_AUTHENTICATEE&quot;:&quot;com_mesosphere_dcos_ClassicRPCAuthenticatee&quot;,
     &quot;MESOS_MODULES&quot;:&quot;{\&quot;libraries\&quot;:[{\&quot;file\&quot;:\&quot;/opt/libmesos-bundle/lib/libdcos_security.so\&quot;,\&quot;modules\&quot;:[{\&quot;name\&quot;:\&quot;com_mesosphere_dcos_ClassicRPCAuthenticatee\&quot;}]}]}&quot;,
     &quot;MESOS_VERBOSE&quot;:&quot;true&quot;,
     &quot;GLOG_v&quot;:&quot;2&quot;,
     &quot;PLUGIN_ACS_URL&quot;:&quot;http://master.mesos&quot;,
     &quot;PLUGIN_AUTHN_MODE&quot;:&quot;dcos/jwt+anonymous&quot;,
     &quot;PLUGIN_FRAMEWORK_TYPE&quot;:&quot;marathon&quot;
  },
  &quot;healthChecks&quot;:[
     {
        &quot;path&quot;:&quot;/ping&quot;,
        &quot;protocol&quot;:&quot;HTTP&quot;,
        &quot;portIndex&quot;:0,
        &quot;gracePeriodSeconds&quot;:1800,
        &quot;intervalSeconds&quot;:10,
        &quot;timeoutSeconds&quot;:5,
        &quot;maxConsecutiveFailures&quot;:3,
        &quot;ignoreHttp1xx&quot;:false
     }
  ],
  &quot;secrets&quot;:{
     &quot;service-credential&quot;:{
        &quot;source&quot;:&quot;${SERVICE_ACCOUNT_SECRET}&quot;
     },
     &quot;docker-registry-credential&quot;: {
        &quot;source&quot;:&quot;${DOCKER_REGISTRY_SECRET}&quot;
     }
  },
  &quot;labels&quot;:{
     &quot;DCOS_SERVICE_NAME&quot;:&quot;${MARATHON_INSTANCE_NAME}&quot;,
     &quot;DCOS_SERVICE_PORT_INDEX&quot;:&quot;0&quot;,
     &quot;DCOS_SERVICE_SCHEME&quot;:&quot;http&quot;
  },
  &quot;portDefinitions&quot;:[
     {
        &quot;port&quot;:0,
        &quot;name&quot;:&quot;http&quot;
     },
     {
        &quot;port&quot;:0,
        &quot;name&quot;:&quot;libprocess&quot;
     }
  ]
}
</code></pre>
<h3 id="-7"><a class="content__anchor" href="#-7" aria-hidden="true"><i data-feather="bookmark"></i></a>严格</h3>
<p>如果在 <code>strict</code> 安全模式下运行群集，请使用以下 JSON 模板。不要忘记<strong>替换</strong>符合 <code>${VARIABLES}</code> 格式的所有环境变量：</p>
<pre><code class="language-json">{
  &quot;id&quot;:&quot;/${MARATHON_INSTANCE_NAME}&quot;,
  &quot;cmd&quot;:&quot;cd $MESOS_SANDBOX &amp;&amp; LIBPROCESS_PORT=$PORT1 &amp;&amp; /marathon/bin/start --default_accepted_resource_roles \&quot;*,${MESOS_ROLE}\&quot; --enable_features \&quot;vips,task_killing,external_volumes,secrets,gpu_resources\&quot; --framework_name ${MARATHON_INSTANCE_NAME} --hostname $LIBPROCESS_IP --http_port $PORT0 --master zk://master.mesos:2181/mesos --max_instances_per_offer 1 --mesos_leader_ui_url /mesos --mesos_role ${MESOS_ROLE}  --zk zk://master.mesos:2181/universe/${MARATHON_INSTANCE_NAME} --mesos_user nobody --mesos_authentication --mesos_authentication_principal ${SERVICE_ACCOUNT}&quot;,
  &quot;user&quot;:&quot;nobody&quot;,
  &quot;cpus&quot;:2,
  &quot;mem&quot;:4096,
  &quot;disk&quot;:0,
  &quot;instances&quot;:1,
  &quot;constraints&quot;:[
     [
        &quot;hostname&quot;,
        &quot;UNIQUE&quot;
     ]
  ],
  &quot;container&quot;:{
     &quot;type&quot;: &quot;MESOS&quot;,
     &quot;docker&quot;:{
        &quot;image&quot;:&quot;${MARATHON_IMAGE}:${MARATHON_TAG}&quot;,
        &quot;pullConfig&quot;: {
            &quot;secret&quot;: &quot;docker-registry-credential&quot;
        }
     }
  },
  &quot;env&quot;:{
     &quot;JVM_OPTS&quot;:&quot;-Xms256m -Xmx2g&quot;,
     &quot;DCOS_STRICT_SECURITY_ENABLED&quot;:&quot;true&quot;,
     &quot;DCOS_SERVICE_ACCOUNT_CREDENTIAL&quot;:{
        &quot;secret&quot;:&quot;service-credential&quot;
     },
     &quot;MESOS_AUTHENTICATEE&quot;:&quot;com_mesosphere_dcos_ClassicRPCAuthenticatee&quot;,
     &quot;MESOS_MODULES&quot;:&quot;{\&quot;libraries\&quot;:[{\&quot;file\&quot;:\&quot;/opt/libmesos-bundle/lib/libdcos_security.so\&quot;,\&quot;modules\&quot;:[{\&quot;name\&quot;:\&quot;com_mesosphere_dcos_ClassicRPCAuthenticatee\&quot;}]}]}&quot;,
     &quot;MESOS_VERBOSE&quot;:&quot;true&quot;,
     &quot;GLOG_v&quot;:&quot;2&quot;,
     &quot;PLUGIN_ACS_URL&quot;:&quot;https://master.mesos&quot;,
     &quot;PLUGIN_AUTHN_MODE&quot;:&quot;dcos/jwt&quot;,
     &quot;PLUGIN_FRAMEWORK_TYPE&quot;:&quot;marathon&quot;
  },
  &quot;healthChecks&quot;:[
     {
        &quot;path&quot;:&quot;/&quot;,
        &quot;protocol&quot;:&quot;HTTP&quot;,
        &quot;portIndex&quot;:0,
        &quot;gracePeriodSeconds&quot;:1800,
        &quot;intervalSeconds&quot;:10,
        &quot;timeoutSeconds&quot;:5,
        &quot;maxConsecutiveFailures&quot;:3,
        &quot;ignoreHttp1xx&quot;:false
     }
  ],
  &quot;secrets&quot;:{
     &quot;service-credential&quot;:{
        &quot;source&quot;:&quot;${SERVICE_ACCOUNT_SECRET}&quot;
     },
     &quot;docker-registry-credential&quot;: {
        &quot;source&quot;:&quot;${DOCKER_REGISTRY_SECRET}&quot;
     }
  },
  &quot;labels&quot;:{
     &quot;DCOS_SERVICE_NAME&quot;:&quot;${MARATHON_INSTANCE_NAME}&quot;,
     &quot;DCOS_SERVICE_PORT_INDEX&quot;:&quot;0&quot;,
     &quot;DCOS_SERVICE_SCHEME&quot;:&quot;http&quot;
  },
  &quot;portDefinitions&quot;:[
     {
        &quot;port&quot;:0,
        &quot;name&quot;:&quot;http&quot;
     },
     {
        &quot;port&quot;:0,
        &quot;name&quot;:&quot;libprocess&quot;
     }
  ]
}
</code></pre>
</li>
<li>
<p>部署 Marathon 实例，传递您在上一步中创建的 JSON 文件。</p>
<pre><code class="language-bash">dcos marathon app add marathon-filled.json
</code></pre>
</li>
</ol>
<h1 id="6-marathon"><a class="content__anchor" href="#6-marathon" aria-hidden="true"><i data-feather="bookmark"></i></a>步骤 6：授予用户对非本地 Marathon 的访问权限</h1>
<p>到目前为止，您的新 Marathon 实例只能由 DC/OS 超级用户访问。为了提供对常规用户的访问权限，您需要根据群集安全模式明确授予他们访问权限：</p>
<h2 class="tabs" id="-8"><a class="content__anchor" href="#-8" aria-hidden="true"><i data-feather="bookmark"></i></a></h2>
<h3 id="-9"><a class="content__anchor" href="#-9" aria-hidden="true"><i data-feather="bookmark"></i></a>宽容</h3>
<p>对于您要授予访问权限的每个 <code>${USER_ACCOUNT}</code>，是否在 <code>permissive</code> 安全模式下运行群集，取决于您要提供的权限类型：</p>
<ul>
<li>
<p>为在新创建的 Marathon 上运行的任何服务（或组）提供<strong>完全</strong>权限：</p>
<pre><code class="language-bash"># Access to the new Marathon service under `/service/&lt;name&gt;` URL
dcos security org users grant ${USER_ACCOUNT} dcos:adminrouter:service:${MARATHON_INSTANCE_NAME} full
dcos security org users grant ${USER_ACCOUNT} dcos:service:marathon:${MARATHON_INSTANCE_NAME}:services:/ full

# Access to the Mesos tasks and their sandbox
dcos security org users grant ${USER_ACCOUNT} dcos:adminrouter:ops:mesos full
dcos security org users grant ${USER_ACCOUNT} dcos:adminrouter:ops:slave full

# (Optionally) Access to the Marathon instance that runs on the root
# Marathon and can be controlled via the DC/OS UI
dcos security org users grant ${USER_ACCOUNT} dcos:adminrouter:service:marathon full
dcos security org users grant ${USER_ACCOUNT} dcos:service:marathon:marathon:services:/${MARATHON_INSTANCE_NAME} full
</code></pre>
</li>
<li>
<p>向在新创建的 Marathon 上运行且名为  的<strong>个体</strong>服务（或组）提供权限：<code>${CHILD_SERVICE_NAME}</code>:</p>
<pre><code class="language-bash"># Access to the new Marathon service under `/service/&lt;name&gt;` URL
dcos security org users grant ${USER_ACCOUNT} dcos:adminrouter:service:${MARATHON_INSTANCE_NAME} full
dcos security org users grant ${USER_ACCOUNT} dcos:service:marathon:${MARATHON_INSTANCE_NAME}:services:/${CHILD_SERVICE_NAME} full

# Access to the Mesos tasks and their sandbox
dcos security org users grant ${USER_ACCOUNT} dcos:adminrouter:ops:mesos full
dcos security org users grant ${USER_ACCOUNT} dcos:adminrouter:ops:slave full

# (Optionally) Access to the Marathon instance that runs on the root
# Marathon and can be controlled via the DC/OS UI
dcos security org users grant ${USER_ACCOUNT} dcos:adminrouter:service:marathon full
dcos security org users grant ${USER_ACCOUNT} dcos:service:marathon:marathon:services:/${MARATHON_INSTANCE_NAME} full
</code></pre>
</li>
</ul>
<h3 id="-10"><a class="content__anchor" href="#-10" aria-hidden="true"><i data-feather="bookmark"></i></a>严格</h3>
<p>对于您要授予访问权限的每个 <code>${USER_ACCOUNT}</code>，是否在 <code>strict</code> 安全模式下运行群集，取决于您要提供的权限类型：</p>
<ul>
<li>
<p>为在新创建的 Marathon 上运行的任何服务（或组）提供<strong>完全</strong>权限：</p>
<pre><code class="language-bash"># Access to the new Marathon service under `/service/&lt;name&gt;` URL
dcos security org users grant ${USER_ACCOUNT} dcos:adminrouter:service:${MARATHON_INSTANCE_NAME} full
dcos security org users grant ${USER_ACCOUNT} dcos:service:marathon:${MARATHON_INSTANCE_NAME}:services:/ full

# Access to the Mesos tasks and their sandbox
dcos security org users grant ${USER_ACCOUNT} dcos:adminrouter:ops:mesos full
dcos security org users grant ${USER_ACCOUNT} dcos:adminrouter:ops:slave full
dcos security org users grant ${USER_ACCOUNT} dcos:mesos:agent:executor:app_id:/ read
dcos security org users grant ${USER_ACCOUNT} dcos:mesos:agent:framework:role:${MESOS_ROLE} read
dcos security org users grant ${USER_ACCOUNT} dcos:mesos:agent:sandbox:app_id:/ read
dcos security org users grant ${USER_ACCOUNT} dcos:mesos:agent:task:app_id:/ read
dcos security org users grant ${USER_ACCOUNT} dcos:mesos:master:executor:app_id:/ read
dcos security org users grant ${USER_ACCOUNT} dcos:mesos:master:framework:role:${MESOS_ROLE} read
dcos security org users grant ${USER_ACCOUNT} dcos:mesos:master:task:app_id:/ read

# (Optionally) Access to the Marathon instance that runs on the root
# Marathon and can be controlled via the DC/OS UI
dcos security org users grant ${USER_ACCOUNT} dcos:adminrouter:service:marathon full
dcos security org users grant ${USER_ACCOUNT} dcos:service:marathon:marathon:services:/${MARATHON_INSTANCE_NAME} full
</code></pre>
</li>
<li>
<p>向在新创建的 Marathon 上运行且名为  的<strong>个体</strong>服务（或组）提供权限：<code>${CHILD_SERVICE_NAME}</code>:</p>
<pre><code class="language-bash"># Access to the new Marathon service under `/service/&lt;name&gt;` URL
dcos security org users grant ${USER_ACCOUNT} dcos:adminrouter:service:${MARATHON_INSTANCE_NAME} full
dcos security org users grant ${USER_ACCOUNT} dcos:service:marathon:${MARATHON_INSTANCE_NAME}:services:/${CHILD_SERVICE_NAME} full

# Access to the Mesos tasks and their sandbox
dcos security org users grant ${USER_ACCOUNT} dcos:adminrouter:ops:mesos full
dcos security org users grant ${USER_ACCOUNT} dcos:adminrouter:ops:slave full
dcos security org users grant ${USER_ACCOUNT} dcos:mesos:agent:executor:app_id:/${CHILD_SERVICE_NAME} read
dcos security org users grant ${USER_ACCOUNT} dcos:mesos:agent:framework:role:${MESOS_ROLE} read
dcos security org users grant ${USER_ACCOUNT} dcos:mesos:agent:sandbox:app_id:/${CHILD_SERVICE_NAME} read
dcos security org users grant ${USER_ACCOUNT} dcos:mesos:agent:task:app_id:/${CHILD_SERVICE_NAME} read
dcos security org users grant ${USER_ACCOUNT} dcos:mesos:master:executor:app_id:/${CHILD_SERVICE_NAME} read
dcos security org users grant ${USER_ACCOUNT} dcos:mesos:master:framework:role:${MESOS_ROLE} read
dcos security org users grant ${USER_ACCOUNT} dcos:mesos:master:task:app_id:/${CHILD_SERVICE_NAME} read

# (Optionally) Access to the Marathon instance that runs on the root
# Marathon and can be controlled via the DC/OS UI
dcos security org users grant ${USER_ACCOUNT} dcos:adminrouter:service:marathon full
dcos security org users grant ${USER_ACCOUNT} dcos:service:marathon:marathon:services:/${MARATHON_INSTANCE_NAME} full
</code></pre>
</li>
</ul>
<h1 id="7-marathon"><a class="content__anchor" href="#7-marathon" aria-hidden="true"><i data-feather="bookmark"></i></a>步骤 7：访问非本地 Marathon 实例</h1>
<p>在此步骤中，您以授权用户身份登录非本地 Marathon DC/OS 服务。</p>
<ol>
<li>
<p>启动非本地 Marathon 接口，位于：<code>http://&lt;master-public-ip&gt;/service/${SERVICE_ACCOUNT}/</code>.</p>
</li>
<li>
<p>输入您的用户名和密码，然后单击 <strong>登录</strong>。</p>
<p><img src="/dcosdocs/mesosphere/dcos/cn/2.1/img/LOGIN-EE-Modal_View-1_12.png" alt="Log in DC/OS"></p>
<p>图 4. 成功了！</p>
<p><img src="/dcosdocs/mesosphere/dcos/cn/2.1/img/mom-marathon-gui.png" alt="Marathon on Marathon"></p>
</li>
</ol>
<h1 id="-11"><a class="content__anchor" href="#-11" aria-hidden="true"><i data-feather="bookmark"></i></a>后续步骤</h1>
<ul>
<li>
<p>您可以使用以下命令将 DC/OS CLI 配置为与非本机 Marathon 实例进行交互：</p>
<pre><code class="language-sh">dcos config set marathon.url \
  $(dcos config show core.dcos_url)/service/${MARATHON_INSTANCE_NAME}
</code></pre>
<p>现在，任何未来 <code>dcos marathon ...</code> 命令将瞄准您的新 Marathon 实例。</p>
<p>要撤消此更改，请使用以下命令：</p>
<pre><code class="language-sh">dcos config unset marathon.url
</code></pre>
</li>
</ul>
<h1 id="-12"><a class="content__anchor" href="#-12" aria-hidden="true"><i data-feather="bookmark"></i></a>已知问题</h1>
<ul>
<li>
<p>启动 Docker 容器时，用户 <code>nobody</code> 可能没有足够的权限来成功运行。例如，无法作为用户 <code>nginx</code> 启动 <code>nobody</code> Docker 容器，因为 <code>nobody</code> 没有 <code>/var/log</code> 所需的 <code>nginx</code> 的写入权限。</p>
</li>
<li>
<p>用户 <code>nobody</code> 在不同的系统上具有不同的 UID（在 coreos 上为 99，在 ubuntu 上为 65534）。根据代理的分布情况，您可能需要修改容器镜像以使 UID 匹配！使用用户  时也是如此。<code>bob</code>.</p>
</li>
<li>
<p>使用自定义用户（例如，<code>bob</code>）时，用户必须存在于代理中，若是使用容器，则必须存在于容器内。</p>
</li>
<li>
<p>使用新用户（例如，<code>bob</code>）时，请记住授予 Marathon 服务帐户以此用户身份运行任务的权限。</p>
</li>
</ul>
</article></div><aside class="content__sections"><div class="content__sections-list-container"><ul class="content__sections-list"><li class="content__sections-item content__sections-item--h1"><a href="#1">步骤 1：准备</a></li><li class="content__sections-item content__sections-item--h1"><a href="#2-marathon">步骤 2：创建 Marathon 服务帐户</a></li><li class="content__sections-item content__sections-item--h1"><a href="#3">步骤 3：创建服务帐户密钥</a></li><li class="content__sections-item content__sections-item--h2"><a href="#"></a></li><li class="content__sections-item content__sections-item--h1"><a href="#4">步骤 4：分配权限（仅限严格模式）</a></li><li class="content__sections-item content__sections-item--h1"><a href="#5-marathon">步骤 5：安装具有分配角色  的非本地 Marathon 实例</a></li><li class="content__sections-item content__sections-item--h2"><a href="#-5"></a></li><li class="content__sections-item content__sections-item--h1"><a href="#6-marathon">步骤 6：授予用户对非本地 Marathon 的访问权限</a></li><li class="content__sections-item content__sections-item--h2"><a href="#-8"></a></li><li class="content__sections-item content__sections-item--h1"><a href="#7-marathon">步骤 7：访问非本地 Marathon 实例</a></li><li class="content__sections-item content__sections-item--h1"><a href="#-11">后续步骤</a></li><li class="content__sections-item content__sections-item--h1"><a href="#-12">已知问题</a></li></ul></div></aside></main></div></div><script src="/assets/js/jquery-3.2.1.js"></script><script src="/assets/js/clipboard.js"></script><script src="/assets/js/prism.js"></script><script src="/js/main.js"></script></body></html>