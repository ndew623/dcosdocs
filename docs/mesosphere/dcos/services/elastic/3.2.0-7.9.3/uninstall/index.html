<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width" initial-scale="1" user-scalable="no"><title>Uninstall - D2iQ Docs</title><meta name="description" content="Uninstalling DC/OS Elastic"><link rel="apple-touch-icon" sizes="180x180" href="/assets/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/favicon-16x16.png"><link rel="stylesheet" type="text/css" href="/dcosdocs/css/styles.css"><link rel="search" type="application/opensearchdescription+xml" href="/assets/opensearch.xml" title="Search"><link href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,500,500i,700,700i" rel="stylesheet"><script src="https://unpkg.com/feather-icons/dist/feather.min.js"></script><script>window.analytics||(window.analytics=[]),window.analytics.methods=["identify","track","trackLink","trackForm","trackClick","trackSubmit","page","pageview","ab","alias","ready","group","on","once","off"],window.analytics.factory=function(t){return function(){var a=Array.prototype.slice.call(arguments);return a.unshift(t),window.analytics.push(a),window.analytics}};for(var i=0;i<window.analytics.methods.length;i++){var method=window.analytics.methods[i];window.analytics[method]=window.analytics.factory(method)}window.analytics.load=function(t){var a=document.createElement("script");a.type="text/javascript",a.async=!0,a.src=("https:"===document.location.protocol?"https://":"http://")+"d2dq2ahtl5zl1z.cloudfront.net/analytics.js/v1/"+t+"/analytics.min.js";var n=document.getElementsByTagName("script")[0];n.parentNode.insertBefore(a,n)},window.analytics.SNIPPET_VERSION="2.0.8",
window.analytics.load("7sgtwqvuai");
window.analytics.page();</script><noscript><iframe src="//www.googletagmanager.com/ns.html?id=GTM-PBJ84KX" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript><script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src='//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
})(window,document,'script','dataLayer','GTM-PBJ84KX');</script></head><body><div class="layout"><header class="header"><a class="header__drawer"><i class="header__icon" data-feather="menu"></i></a><a class="header__logo" href="/"><img class="header__logo--mobile" src="/assets/D2iQ_Logotype_Color_Positive_Documentation.svg" alt="D2IQ"><img class="header__logo--desktop" src="/assets/D2iQ_Logotype_Color_Positive_Documentation.svg" alt="D2IQ"></a><div class="header__main"><div class="header__dropdown"><img class="header__dropdown-icon" src="/assets/D2IQ_Logotype_Color_Positive.png" alt="D2iQ"><strong>Elastic Documentation</strong><i data-feather="chevron-down"></i></div><nav class="header__menu"><ul class="header__menu-list"><li class="header__menu-item"><a href="https://support.d2iq.com">Support</a></li></ul></nav></div><div class="chooser" id="spherer"><div class="chooser-current"><a class="chooser-title">Mesosphere</a><svg class="chooser-svg" id="spherer-svg"><path class="pointer" d="m 13,6 -5,5 -5,-5 z" fill="#858585"></path></svg></div><ul class="chooser-list" id="spherer-list"><li class="chooser-list-item"><a href="/mesosphere/dcos">DC/OS</a></li><li class="chooser-list-item"><a href="/dcosdocs/mesosphere/dcos/services">DC/OS Services</a></li></ul></div><div class="chooser" id="ks"><div class="chooser-current"><a class="chooser-title">DKP</a><svg class="chooser-svg" id="kspherer-svg"><path class="pointer" d="m 13,6 -5,5 -5,-5 z" fill="#858585"></path></svg></div><ul class="chooser-list" id="kspherer-list"><li class="chooser-list-item"><a href="/dkp/konvoy">Konvoy</a></li><li class="chooser-list-item"><a href="/dkp/kommander">Kommander</a></li><li class="chooser-list-item"><a href="/dkp/dispatch">Dispatch</a></li><li class="chooser-list-item"><a href="/dkp/kaptain">Kaptain</a></li></ul></div><div class="chooser" id="localizer"><div class="chooser-current"><a class="chooser-title">English</a><svg class="chooser-svg" id="localizer-svg"><path class="pointer" d="m 13,6 -5,5 -5,-5 z" fill="#858585"></path></svg></div><ul class="chooser-list" id="localizer-list"><li class="chooser-list-item"><a href="/dcosdocs/mesosphere/dcos/cn/services">中文 (简体)</a></li></ul></div><section class="header__search" role="search"><form class="header__search-form" action="/search/"><input class="header__search-input" id="header-search-input" tabindex="1" type="text" name="q" placeholder="Search"><input type="hidden" name="hFR[scope][0]" value="DC/OS Services"><label class="header__search-label" for="header-search-input"><i class="header__icon" data-feather="search"></i></label></form></section></header><div class="header-dropdown"><ul class="header-dropdown__list"><li class="header-dropdown__top-item"><div>DKP</div></li><li class="header-dropdown__item"><a href="/dkp/konvoy">Konvoy</a></li><li class="header-dropdown__item"><a href="/dkp/kommander">Kommander</a></li><li class="header-dropdown__item"><a href="/dkp/dispatch">Dispatch</a></li><li class="header-dropdown__item"><a href="/dkp/kaptain">Kaptain</a></li><li class="header-dropdown__top-item"><div>Mesosphere</div></li><li class="header-dropdown__item header-dropdown__item--active"><a href="/mesosphere/dcos">DC/OS</a></li><li class="header-dropdown__item header-dropdown__item--active"><a href="/dcosdocs/mesosphere/dcos/services">DC/OS Services</a></li><li class="header-dropdown__item"><a href="https://support.d2iq.com">Support</a></li></ul></div><div class="layout__sidebar layout__drawer"><section class="sidebar"><header class="sidebar__header"><div class="sidebar__dropdown"><ul><li><a href="/dcosdocs/mesosphere/dcos/services/elastic/3.2.0-7.9.3/uninstall">Elastic 3.2.0-7.9.3</a></li><li><a href="/dcosdocs/mesosphere/dcos/services/elastic/3.1.2-7.6.0/uninstall">Elastic 3.1.2-7.6.0</a></li><li><a href="/dcosdocs/mesosphere/dcos/services/elastic/2.7.0-6.8.1/uninstall">Elastic 2.7.0-6.8.1</a></li></ul><div class="toggle"><p><span class="title">Elastic</span><span class="version"> 3.2.0-7.9.3</span></p><i data-feather="chevron-down"></i></div></div></header><nav class="sidebar_nav" role="navigation"><ul><li><a class="d0" href="/dcosdocs/mesosphere/dcos/services/elastic/3.2.0-7.9.3/release-notes/">Release Notes</a></li><li><a class="d0" href="/dcosdocs/mesosphere/dcos/services/elastic/3.2.0-7.9.3/getting-started/">Getting Started</a></li><li><a class="d0" href="/dcosdocs/mesosphere/dcos/services/elastic/3.2.0-7.9.3/configuration/">Configuration</a></li><li><a class="d0" href="/dcosdocs/mesosphere/dcos/services/elastic/3.2.0-7.9.3/operations/"><i data-feather="chevron-right"></i>Operations</a></li><li><a class="d0" href="/dcosdocs/mesosphere/dcos/services/elastic/3.2.0-7.9.3/updates/">Updates</a></li><li><a class="d0" href="/dcosdocs/mesosphere/dcos/services/elastic/3.2.0-7.9.3/security/">Security</a></li><li class="active active-on"><a class="d0" href="/dcosdocs/mesosphere/dcos/services/elastic/3.2.0-7.9.3/uninstall/">Uninstall</a></li><li><a class="d0" href="/dcosdocs/mesosphere/dcos/services/elastic/3.2.0-7.9.3/troubleshooting/">Troubleshooting</a></li><li><a class="d0" href="/dcosdocs/mesosphere/dcos/services/elastic/3.2.0-7.9.3/advanced/">Advanced</a></li><li><a class="d0" href="/dcosdocs/mesosphere/dcos/services/elastic/3.2.0-7.9.3/api-reference/">API Reference</a></li><li><a class="d0" href="/dcosdocs/mesosphere/dcos/services/elastic/3.2.0-7.9.3/limitations/">Limitations</a></li><li><a class="d0" href="/dcosdocs/mesosphere/dcos/services/elastic/3.2.0-7.9.3/support-policy/">Support Policy</a></li><li><a class="d0" href="/dcosdocs/mesosphere/dcos/services/elastic/3.2.0-7.9.3/how-to-guides/"><i data-feather="chevron-right"></i>How-To Guides</a></li></ul></nav><footer class="sidebar__footer"><div class="sidebar__footer-links"><a href="https://d2iq.com/terms/">Terms of Service</a><a href="https://d2iq.com/privacy/">Privacy Policy</a></div><a class="sidebar__footer-copyright" href="https://d2iq.com/">&copy; 2021 D2iQ, Inc. All rights reserved.</a></footer></section></div><div class="layout__content" role="main"><main class="content"><div class="content__container content__container--with-sections"><div class="content__header"><div class="content__header__row"><h1 class="content__header-title">Uninstall</h1></div><h4 class="content__header-description">Uninstalling DC/OS Elastic</h4><div class="actions"><ul class="actions__list"><li class="actions__item"><button class="actions__link" onclick="javascript:window.print()"><i class="actions__icon" data-feather="printer"></i><span class="actions__text">Print</span></button></li><li class="actions__item"><a class="actions__link" href="https://github.com/mesosphere/dcos-docs-site/tree/main/pages/dcosdocs/mesosphere/dcos/services/elastic/3.2.0-7.9.3/uninstall/index.md" target="_blank"><i class="actions__icon" data-feather="github"></i><span class="actions__text">Contribute</span></a></li><li class="actions__item"><a class="actions__link" href="https://jira.d2iq.com/secure/CreateIssueDetails!init.jspa?pid=14105&amp;issuetype=1&amp;summary=Feedback+for+Uninstall&amp;description=Source:%20https://docs.d2iq.com/dcosdocs/mesosphere/dcos/services/elastic/3.2.0-7.9.3/uninstall&amp;labels=documentation&amp;labels=needs_triage&amp;components=19804&amp;priority=3&amp;customfield_12300=44" target="_blank"><i class="actions__icon" data-feather="message-square"></i><span class="actions__text">Feedback</span></a></li></ul></div></div><article class="content__article"><h2 id="dcos-110-or-later-and-package-200-x-or-later"><a class="content__anchor" href="#dcos-110-or-later-and-package-200-x-or-later" aria-hidden="true"><i data-feather="bookmark"></i></a>DC/OS 1.10 or later, and package 2.0.0-x or later</h2>
<p>If you are using DC/OS 1.10 or later and the installed service has a version later than 2.0.0-x, then uninstalling the service is simple.</p>
<p>From the DC/OS CLI, enter</p>
<pre><code>dcos package uninstall --app-id=&lt;service-name&gt; elastic
</code></pre>
<h3 id="uninstall-process"><a class="content__anchor" href="#uninstall-process" aria-hidden="true"><i data-feather="bookmark"></i></a>Uninstall process</h3>
<p class="message--warning"><strong>WARNING: </strong>Once the uninstall operation has begun, it cannot be cancelled because doing so can leave the service in an uncertain, half-destroyed state. Any data stored in reserved disk resources will be irretrievably lost.</p>
<p>Uninstalling the service consists of the following steps:</p>
<ol>
<li>The service scheduler is relaunched with the environment variable <code>SDK_UNINSTALL</code> set to “true”. This puts the service into an uninstall mode.</li>
<li>The service scheduler performs the uninstall with the following actions:
<ul>
<li>All running tasks for the service are terminated.</li>
<li>All reserved resources are unreserved by the scheduler.</li>
<li>Once all known resources have been unreserved, the scheduler’s persistent state is deleted.</li>
</ul>
</li>
<li>The cluster automatically removes the scheduler task once it advertises the completion of the uninstall process.</li>
</ol>
<h2 id="debugging-an-uninstall"><a class="content__anchor" href="#debugging-an-uninstall" aria-hidden="true"><i data-feather="bookmark"></i></a>Debugging an uninstall</h2>
<p>There are certain situations under which the automated uninstall process cannot complete without manual intervention.</p>
<h3 id="zombie-service-scheduler"><a class="content__anchor" href="#zombie-service-scheduler" aria-hidden="true"><i data-feather="bookmark"></i></a><a name="zombie-service-scheduler"></a>Zombie service scheduler</h3>
<p>If the service scheduler reports in its <code>stdout</code> that the uninstall is complete, but the scheduler is not removed from the system, you can safely delete it via Marathon.</p>
<h3 id="missing-dcos-agent"><a class="content__anchor" href="#missing-dcos-agent" aria-hidden="true"><i data-feather="bookmark"></i></a>Missing DC/OS agent</h3>
<p>The service will not complete the uninstall if it is not able to unreserve all the resources it has previously reserved. A common cause of this is a DC/OS agent for which the service had reserved resources, which is no longer part of the DC/OS cluster.</p>
<ul>
<li>
<p>If the agent is only temporarily gone due to maintenance, the service will unreserve the resources when the agent returns to the cluster.</p>
</li>
<li>
<p>If the agent has been permanently removed, then the uninstall will hang indefinitely. The easiest way to prevent this, is to perform <code>pod replace</code> on any pod deployed to the lost agent before initiating the uninstall.</p>
</li>
<li>
<p>If the missing agent is only discovered after the uninstall is initiated, then the following process can be used to allow the uninstall to complete.</p>
</li>
</ul>
<p>First determine what resources the service is waiting on.</p>
<ul>
<li>CLI: <code>dcos elastic --name=elastic plan show deploy</code> (after running <code>dcos package install --cli elastic</code> if needed)</li>
<li>HTTP: <code>https://yourcluster.com/service/elastic/v1/plans/deploy</code></li>
</ul>
<pre><code class="language-bash">dcos elastic --name=elastic plan show deploy
deploy (IN_PROGRESS)
├─ kill-tasks (COMPLETE)
│  ├─ kill-task-node-0-server__1a4114bc-48bb-47f6-be99-1b5ca6d55c4e (COMPLETE)
│  ├─ kill-task-node-1-server__0c42118e-04fd-40e1-b49d-0d3f71d2d243 (COMPLETE)
│  └─ kill-task-node-2-server__e00cad38-f27f-4332-b1df-5118ca480d50 (COMPLETE)
├─ unreserve-resources (IN_PROGRESS)
│  ├─ unreserve-f41351a2-b478-4e13-a94c-705f530989ef (COMPLETE)
│  ├─ unreserve-48f64612-8427-4cde-86f4-4edeb9efff37 (COMPLETE)
│  ├─ unreserve-402d51f5-6014-4ca3-bd13-324dae62b888 (PENDING)
│  ├─ unreserve-cb95e869-277f-48b9-954f-08c0d7a26bcf (PENDING)
│  ├─ unreserve-cbd748d0-df7b-4d01-b0b7-6acf915d8f98 (COMPLETE)
│  ├─ unreserve-00ed63d6-427c-4492-9713-772390cc5241 (COMPLETE)
│  ├─ unreserve-5dd56b1d-4522-4bbd-88b5-de9fa0f181f2 (PENDING)
│  └─ unreserve-c9915f07-f446-4e14-a6b4-12c8dd2f914b (COMPLETE)
└─ deregister-service (PENDING)
   └─ deregister (PENDING)
</code></pre>
<p>As we can see above, some of the resources to unreserve are stuck in a <code>PENDING</code> state. We can force them into a <code>COMPLETE</code> state, and thereby allow the scheduler to finish the uninstall operation. This may be done using either of the following methods:</p>
<ul>
<li>CLI: <code>dcos elastic --name=elastic plan show deploy</code></li>
<li>HTTP: <code>https://yourcluster.com/service/elastic/v1/plans/deploy/forceComplete?phase=unreserve-resources&amp;step=unreserve-&lt;UUID&gt;</code></li>
</ul>
<pre><code class="language-bash">dcos elastic --name=elastic plan force-complete deploy unreserve-resources unreserve-402d51f5-6014-4ca3-bd13-324dae62b888
dcos elastic --name=elastic plan force-complete deploy unreserve-resources unreserve-cb95e869-277f-48b9-954f-08c0d7a26bcf
dcos elastic --name=elastic plan force-complete deploy unreserve-resources unreserve-5dd56b1d-4522-4bbd-88b5-de9fa0f181f2
</code></pre>
<p>At this point the scheduler should show a <code>COMPLETE</code> state for these steps in the plan, allowing it to proceed normally with the uninstall operation:</p>
<pre><code>dcos elastic --name=elastic plan show deploy
deploy (IN_PROGRESS)
├─ kill-tasks (COMPLETE)
│  ├─ kill-task-node-0-server__1a4114bc-48bb-47f6-be99-1b5ca6d55c4e (COMPLETE)
│  ├─ kill-task-node-1-server__0c42118e-04fd-40e1-b49d-0d3f71d2d243 (COMPLETE)
│  └─ kill-task-node-2-server__e00cad38-f27f-4332-b1df-5118ca480d50 (COMPLETE)
├─ unreserve-resources (COMPLETE)
│  ├─ unreserve-f41351a2-b478-4e13-a94c-705f530989ef (COMPLETE)
│  ├─ unreserve-48f64612-8427-4cde-86f4-4edeb9efff37 (COMPLETE)
│  ├─ unreserve-402d51f5-6014-4ca3-bd13-324dae62b888 (COMPLETE)
│  ├─ unreserve-cb95e869-277f-48b9-954f-08c0d7a26bcf (COMPLETE)
│  ├─ unreserve-cbd748d0-df7b-4d01-b0b7-6acf915d8f98 (COMPLETE)
│  ├─ unreserve-00ed63d6-427c-4492-9713-772390cc5241 (COMPLETE)
│  ├─ unreserve-5dd56b1d-4522-4bbd-88b5-de9fa0f181f2 (COMPLETE)
│  └─ unreserve-c9915f07-f446-4e14-a6b4-12c8dd2f914b (COMPLETE)
└─ deregister-service (PENDING)
   └─ deregister (PENDING)
</code></pre>
<p class="message--note"><strong>NOTE: </strong>As it may take the operator some time to complete these actions, the service scheduler may be left in a zombie state after the uninstall is complete.
See the "Zombie service scheduler" section above for instructions on how to correct this.</p>
<h4 id="manual-uninstall"><a class="content__anchor" href="#manual-uninstall" aria-hidden="true"><i data-feather="bookmark"></i></a>Manual uninstall</h4>
<p>If it is not possible to recover in other ways, then the service can be manually uninstalled.</p>
<ul>
<li>Delete the uninstalling scheduler from Marathon.</li>
<li>Unregister the service from Mesos using its UUID as follows:<pre><code class="language-bash">dcos service --inactive | grep elastic
elastic     False     3    3.3  6240.0  15768.0  &lt;UUID&gt;

dcos service shutdown &lt;UUID&gt;
</code></pre>
</li>
<li>Run <code>janitor.py</code> to clean up the remaining reserved resources, as described in the DC/OS 1.9 instructions below.</li>
</ul>
<h2 id="dcos-19-and-earlier-or-packages-earlier-than-200-x"><a class="content__anchor" href="#dcos-19-and-earlier-or-packages-earlier-than-200-x" aria-hidden="true"><i data-feather="bookmark"></i></a>DC/OS 1.9 and earlier, or packages earlier than 2.0.0-x</h2>
<p>If you are running DC/OS 1.9 or earlier, or a version of the Elastic service that is earlier than 2.0.0-x, follow these steps:</p>
<ol>
<li>Stop the service. From the DC/OS CLI, enter <code>dcos package uninstall --app-id=&lt;service-name&gt; elastic</code>.</li>
<li>Clean up remaining reserved resources with the framework cleaner script, <code>janitor.py</code>.</li>
</ol>
<pre><code class="language-bash">MY_SERVICE_NAME=&lt;service-name&gt;
dcos package uninstall --app-id=$MY_SERVICE_NAME elastic`.
dcos node ssh --master-proxy --leader &quot;docker run mesosphere/janitor /janitor.py \
    -r $MY_SERVICE_NAME-role \
    -p $MY_SERVICE_NAME-principal \
    -z dcos-service-$MY_SERVICE_NAME&quot;
</code></pre>
<p>If you use a strict-mode clusters should also include either of the following credentials as <code>janitor.py</code> arguments:</p>
<ul>
<li><code>-a &lt;token&gt;</code>: Token to be used for authentication, such as the one printed by running <code>dcos config show core.dcos_acs_token</code> in the DC/OS CLI</li>
<li><code>-u &lt;username&gt; -p &lt;password&gt;</code>: Username/password for a user which may be used to clean up the resources in question.</li>
</ul>
<p>See <a href="/dcosdocs/mesosphere/dcos/latest/deploying-services/uninstall/#framework-cleaner">DC/OS documentation</a> for more information about the framework cleaner script.</p>
</article></div><aside class="content__sections"><div class="content__sections-list-container"><ul class="content__sections-list"><li class="content__sections-item content__sections-item--h2"><a href="#dcos-110-or-later-and-package-200-x-or-later">DC/OS 1.10 or later, and package 2.0.0-x or later</a></li><li class="content__sections-item content__sections-item--h2"><a href="#debugging-an-uninstall">Debugging an uninstall</a></li><li class="content__sections-item content__sections-item--h2"><a href="#dcos-19-and-earlier-or-packages-earlier-than-200-x">DC/OS 1.9 and earlier, or packages earlier than 2.0.0-x</a></li></ul></div></aside></main></div></div><script src="/assets/js/jquery-3.2.1.js"></script><script src="/assets/js/clipboard.js"></script><script src="/assets/js/prism.js"></script><script src="/js/main.js"></script></body></html>