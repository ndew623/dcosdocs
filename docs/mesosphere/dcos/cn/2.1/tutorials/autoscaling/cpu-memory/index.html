<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width" initial-scale="1" user-scalable="no"><title>教程 - 使用 CPU 和内存的自动扩展 Marathon 服务 - D2iQ Docs</title><meta name="description" content="使用 CPU 和内存自动扩展 Marathon 服务"><link rel="apple-touch-icon" sizes="180x180" href="/dcosdocs/assets/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/dcosdocs/assets/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/dcosdocs/assets/favicon-16x16.png"><link rel="stylesheet" type="text/css" href="/dcosdocs/css/styles.css"><link rel="search" type="application/opensearchdescription+xml" href="/dcosdocs/assets/opensearch.xml" title="Search"><link href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,500,500i,700,700i" rel="stylesheet"><script src="https://unpkg.com/feather-icons/dist/feather.min.js"></script><script>window.analytics||(window.analytics=[]),window.analytics.methods=["identify","track","trackLink","trackForm","trackClick","trackSubmit","page","pageview","ab","alias","ready","group","on","once","off"],window.analytics.factory=function(t){return function(){var a=Array.prototype.slice.call(arguments);return a.unshift(t),window.analytics.push(a),window.analytics}};for(var i=0;i<window.analytics.methods.length;i++){var method=window.analytics.methods[i];window.analytics[method]=window.analytics.factory(method)}window.analytics.load=function(t){var a=document.createElement("script");a.type="text/javascript",a.async=!0,a.src=("https:"===document.location.protocol?"https://":"http://")+"d2dq2ahtl5zl1z.cloudfront.net/analytics.js/v1/"+t+"/analytics.min.js";var n=document.getElementsByTagName("script")[0];n.parentNode.insertBefore(a,n)},window.analytics.SNIPPET_VERSION="2.0.8",
window.analytics.load("7sgtwqvuai");
window.analytics.page();</script><noscript><iframe src="//www.googletagmanager.com/ns.html?id=GTM-PBJ84KX" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript><script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src='//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
})(window,document,'script','dataLayer','GTM-PBJ84KX');</script></head><body><div class="layout"><header class="header"><a class="header__drawer"><i class="header__icon" data-feather="menu"></i></a><a class="header__logo" href="/"><img class="header__logo--mobile" src="/dcosdocs/assets/D2iQ_Logotype_Color_Positive_Documentation.svg" alt="D2IQ"><img class="header__logo--desktop" src="/dcosdocs/assets/D2iQ_Logotype_Color_Positive_Documentation.svg" alt="D2IQ"></a><div class="header__main"><div class="header__dropdown"><img class="header__dropdown-icon" src="/dcosdocs/assets/D2IQ_Logotype_Color_Positive.png" alt="D2iQ"><strong>DC/OS文档</strong><i data-feather="chevron-down"></i></div><nav class="header__menu"><ul class="header__menu-list"><li class="header__menu-item"><a href="https://support.d2iq.com">Support</a></li></ul></nav></div><div class="chooser" id="spherer"><div class="chooser-current"><a class="chooser-title">Mesosphere</a><svg class="chooser-svg" id="spherer-svg"><path class="pointer" d="m 13,6 -5,5 -5,-5 z" fill="#858585"></path></svg></div><ul class="chooser-list" id="spherer-list"><li class="chooser-list-item"><a href="/mesosphere/dcos">DC/OS</a></li><li class="chooser-list-item"><a href="/dcosdocs/mesosphere/dcos/services">DC/OS Services</a></li></ul></div><div class="chooser" id="ks"><div class="chooser-current"><a class="chooser-title">DKP</a><svg class="chooser-svg" id="kspherer-svg"><path class="pointer" d="m 13,6 -5,5 -5,-5 z" fill="#858585"></path></svg></div><ul class="chooser-list" id="kspherer-list"><li class="chooser-list-item"><a href="/dkp/konvoy">Konvoy</a></li><li class="chooser-list-item"><a href="/dkp/kommander">Kommander</a></li><li class="chooser-list-item"><a href="/dkp/dispatch">Dispatch</a></li><li class="chooser-list-item"><a href="/dkp/kaptain">Kaptain</a></li></ul></div><div class="chooser" id="localizer"><div class="chooser-current"><a class="chooser-title">中文 (简体)</a><svg class="chooser-svg" id="localizer-svg"><path class="pointer" d="m 13,6 -5,5 -5,-5 z" fill="#858585"></path></svg></div><ul class="chooser-list" id="localizer-list"><li class="chooser-list-item"><a href="/dcosdocs/mesosphere/dcos/2.1/tutorials/autoscaling/cpu-memory">English</a></li></ul></div><section class="header__search" role="search"><form class="header__search-form" action="/search/"><input class="header__search-input" id="header-search-input" tabindex="1" type="text" name="q" placeholder="Search"><input type="hidden" name="hFR[scope][0]" value="DC/OS 2.1"><label class="header__search-label" for="header-search-input"><i class="header__icon" data-feather="search"></i></label></form></section></header><div class="header-dropdown"><ul class="header-dropdown__list"><li class="header-dropdown__top-item"><div>DKP</div></li><li class="header-dropdown__item"><a href="/dkp/konvoy">Konvoy</a></li><li class="header-dropdown__item"><a href="/dkp/kommander">Kommander</a></li><li class="header-dropdown__item"><a href="/dkp/dispatch">Dispatch</a></li><li class="header-dropdown__item"><a href="/dkp/kaptain">Kaptain</a></li><li class="header-dropdown__top-item"><div>Mesosphere</div></li><li class="header-dropdown__item header-dropdown__item--active"><a href="/mesosphere/dcos">DC/OS</a></li><li class="header-dropdown__item"><a href="/dcosdocs/mesosphere/dcos/services">DC/OS Services</a></li><li class="header-dropdown__item"><a href="https://support.d2iq.com">Support</a></li></ul></div><div class="layout__sidebar layout__drawer"><section class="sidebar"><header class="sidebar__header"><div class="sidebar__dropdown"><ul><li><a href="/dcosdocs/mesosphere/dcos/cn/2.1/tutorials/autoscaling/cpu-memory">Mesosphere DC/OS 2.1.0</a></li><li><a href="/dcosdocs/mesosphere/dcos/cn/2.0/tutorials/autoscaling/cpu-memory">Mesosphere DC/OS 2.0</a></li><li><a href="/dcosdocs/mesosphere/dcos/cn/1.13/tutorials/autoscaling/cpu-memory">Mesosphere DC/OS 1.13</a></li></ul><div class="toggle"><p><span class="title">DC/OS</span><span class="version"> 2.1</span></p><i data-feather="chevron-down"></i></div></div></header><nav class="sidebar_nav" role="navigation"><ul><li><a class="d0" href="/dcosdocs/mesosphere/dcos/cn/2.1/release-notes/"><i data-feather="chevron-right"></i>版本注释</a></li><li><a class="d0" href="/dcosdocs/mesosphere/dcos/cn/2.1/overview/"><i data-feather="chevron-right"></i>概述</a></li><li><a class="d0" href="/dcosdocs/mesosphere/dcos/cn/2.1/installing/"><i data-feather="chevron-right"></i>安装</a></li><li><a class="d0" href="/dcosdocs/mesosphere/dcos/cn/2.1/gui/"><i data-feather="chevron-right"></i>GUI</a></li><li><a class="d0" href="/dcosdocs/mesosphere/dcos/cn/2.1/cli/"><i data-feather="chevron-right"></i>CLI</a></li><li><a class="d0" href="/dcosdocs/mesosphere/dcos/cn/2.1/administering-clusters/"><i data-feather="chevron-right"></i>管理群集</a></li><li><a class="d0" href="/dcosdocs/mesosphere/dcos/cn/2.1/networking/"><i data-feather="chevron-right"></i>网络</a></li><li><a class="d0" href="/dcosdocs/mesosphere/dcos/cn/2.1/security/"><i data-feather="chevron-right"></i>安全</a></li><li><a class="d0" href="/dcosdocs/mesosphere/dcos/cn/2.1/storage/"><i data-feather="chevron-right"></i>存储</a></li><li><a class="d0" href="/dcosdocs/mesosphere/dcos/cn/2.1/metrics/"><i data-feather="chevron-right"></i>度量标准</a></li><li><a class="d0" href="/dcosdocs/mesosphere/dcos/cn/2.1/monitoring/"><i data-feather="chevron-right"></i>监控、日志记录和调试</a></li><li><a class="d0" href="/dcosdocs/mesosphere/dcos/cn/2.1/multi-tenancy/"><i data-feather="chevron-right"></i>DC/OS 群集的多租户</a></li><li><a class="d0" href="/dcosdocs/mesosphere/dcos/cn/2.1/hybrid-cloud/"><i data-feather="chevron-right"></i>混合云</a></li><li><a class="d0" href="/dcosdocs/mesosphere/dcos/cn/2.1/deploying-jobs/"><i data-feather="chevron-right"></i>部署作业</a></li><li><a class="d0" href="/dcosdocs/mesosphere/dcos/cn/2.1/deploying-services/"><i data-feather="chevron-right"></i>部署服务和 Pod</a></li><li class="active"><a class="d0" href="/dcosdocs/mesosphere/dcos/cn/2.1/tutorials/"><i data-feather="chevron-right"></i>教程</a></li><ul><li><a class="d1" href="/dcosdocs/mesosphere/dcos/cn/2.1/tutorials/dcos-101/"><i data-feather="chevron-right"></i>DC/OS 101</a></li><li><a class="d1" href="/dcosdocs/mesosphere/dcos/cn/2.1/tutorials/create-service/">创建和运行服务</a></li><li><a class="d1" href="/dcosdocs/mesosphere/dcos/cn/2.1/tutorials/stateful-services/">在 DC/OS 上运行有状态服务</a></li><li class="active"><a class="d1" href="/dcosdocs/mesosphere/dcos/cn/2.1/tutorials/autoscaling/"><i data-feather="chevron-right"></i>使用 Marathon 自动扩展</a></li><ul><li class="active active-on"><a class="d2" href="/dcosdocs/mesosphere/dcos/cn/2.1/tutorials/autoscaling/cpu-memory/">使用 CPU 和内存自动扩展 Marathon 服务</a></li><li><a class="d2" href="/dcosdocs/mesosphere/dcos/cn/2.1/tutorials/autoscaling/requests-second/">了解自动扩展</a></li><li><a class="d2" href="/dcosdocs/mesosphere/dcos/cn/2.1/tutorials/autoscaling/microscaling-queue/">Microscaling</a></li></ul><li><a class="d1" href="/dcosdocs/mesosphere/dcos/cn/2.1/tutorials/iot_pipeline/">部署负载均衡数据管道</a></li><li><a class="d1" href="/dcosdocs/mesosphere/dcos/cn/2.1/tutorials/deploy-on-marathon/">使用 Jenkins 部署 Marathon 应用程序</a></li><li><a class="d1" href="/dcosdocs/mesosphere/dcos/cn/2.1/tutorials/task-labels/">标记任务和作业</a></li><li><a class="d1" href="/dcosdocs/mesosphere/dcos/cn/2.1/tutorials/dcos-debug/"><i data-feather="chevron-right"></i>调试 DC/OS 上的应用程序</a></li></ul><li><a class="d0" href="/dcosdocs/mesosphere/dcos/cn/2.1/api/"><i data-feather="chevron-right"></i>API 参考</a></li><li><a class="d0" href="/dcosdocs/mesosphere/dcos/cn/2.1/developing-services/"><i data-feather="chevron-right"></i>开发 DC/OS 服务</a></li></ul></nav><footer class="sidebar__footer"><div class="sidebar__footer-links"><a href="https://d2iq.com/terms/">Terms of Service</a><a href="https://d2iq.com/privacy/">Privacy Policy</a></div><a class="sidebar__footer-copyright" href="https://d2iq.com/">&copy; 2021 D2iQ, Inc. All rights reserved.</a></footer></section></div><div class="layout__content" role="main"><main class="content"><div class="content__container content__container--with-sections"><div class="content__header"><div class="content__header__row"><h1 class="content__header-title">教程 - 使用 CPU 和内存的自动扩展 Marathon 服务</h1></div><h4 class="content__header-description">使用 CPU 和内存自动扩展 Marathon 服务</h4><div class="actions"><ul class="actions__list"><li class="actions__item"><button class="actions__link" onclick="javascript:window.print()"><i class="actions__icon" data-feather="printer"></i><span class="actions__text">Print</span></button></li><li class="actions__item"><a class="actions__link" href="https://github.com/mesosphere/dcos-docs-site/tree/main/pages/dcosdocs/mesosphere/dcos/cn/2.1/tutorials/autoscaling/cpu-memory/index.md" target="_blank"><i class="actions__icon" data-feather="github"></i><span class="actions__text">Contribute</span></a></li><li class="actions__item"><a class="actions__link" href="https://jira.d2iq.com/secure/CreateIssueDetails!init.jspa?pid=14105&amp;issuetype=1&amp;summary=Feedback+for+教程+-+使用+CPU+和内存的自动扩展+Marathon+服务&amp;description=Source:%20https://docs.d2iq.com/dcosdocs/mesosphere/dcos/cn/2.1/tutorials/autoscaling/cpu-memory&amp;labels=documentation&amp;labels=needs_triage&amp;components=19804&amp;priority=3&amp;customfield_12300=44" target="_blank"><i class="actions__icon" data-feather="message-square"></i><span class="actions__text">Feedback</span></a></li></ul></div></div><article class="content__article"><!-- This source repo for this topic is https://github.com/dcos/dcos-docs -->
<!-- This disclaimer should be included at the beginning of each page of a tutorial. -->
<p class="message--important"><strong>IMPORTANT: </strong>Tutorials are intended to give you hands-on experience working with a limited set of DC/OS features with no implied or explicit warranty of any kind. None of the information provided--including sample scripts, commands, or applications--is officially supported by Mesosphere. You should not use this information in a production environment without independent testing and validation.</p>
<p>您可以使用 Python 服务 <code>marathon-autoscaler.py</code> 根据 Mesos 报告的利用率指标自动扩展您的 Marathon 应用程序。您可以从 DC/OS 群集中运行此服务。<code>marathon-autoscaler.py</code> 旨在演示在 DC/OS 上运行服务时可能出现的情况。</p>
<p><code>marathon-autoscaler.py</code> 将定期监控组成指定 Marathon 服务的所有任务的总 CPU 和内存利用率。达到阈值时，<code>marathon-autoscaler.py</code> 将增加您 Marathon 服务的任务数量。</p>
<p><strong>前提条件</strong></p>
<ul>
<li><a href="/dcosdocs/mesosphere/dcos/2.1/installing/">正在运行的 DC/OS 群集</a>。</li>
<li>您希望自动扩展的在 Marathon 上运行的服务。</li>
<li>Python 3</li>
<li>Git：
<ul>
<li>** macOS：** 从 [Git 下载](http://git-scm.com/download/mac）获取安装程序。</li>
<li><strong>Unix/Linux：</strong> 请参阅这些 <a href="https://git-scm.com/book/en/v2/Getting-Started-Installing-Git">安装说明</a>。</li>
</ul>
</li>
</ul>
<h1 id="marathon-autoscale"><a class="content__anchor" href="#marathon-autoscale" aria-hidden="true"><i data-feather="bookmark"></i></a>在节点上安装 Marathon Autoscale 应用程序</h1>
<p>通过 SSH 连接到您将运行 <code>marathon-autoscaler.py</code> 并安装它的系统。</p>
<ol>
<li>
<p>SSH 到您要运行的节点<code>marathon-autoscaler.py</code>，其中节点 ID（<code>&lt;mesos-id&gt;</code>）是您要运行该应用程序的节点。</p>
<pre><code class="language-bash">dcos node ssh --master-proxy --mesos-id=&lt;mesos-id&gt;
</code></pre>
<p><strong>提示：</strong> 运行 <code>dcos node</code> 以获取可用的节点 ID。</p>
</li>
<li>
<p>将 <a href="https://github.com/mesosphere/marathon-autoscale">autoscale Github r存储库</a> 克隆到您的节点。</p>
<pre><code class="language-bash">git clone https://github.com/mesosphere/marathon-autoscale.git
</code></pre>
</li>
</ol>
<h1 id="autoscale"><a class="content__anchor" href="#autoscale" aria-hidden="true"><i data-feather="bookmark"></i></a>运行 Autoscale 应用程序</h1>
<ol>
<li>
<p>导航至 <code>marathon-autoscale</code> 存储库：</p>
<pre><code class="language-bash">cd marathon-autoscale
</code></pre>
</li>
<li>
<p>输入此命令以运行应用程序：</p>
<pre><code class="language-bash">python marathon-autoscaler.py
</code></pre>
<p>系统将提示您查看以下参数：</p>
<pre><code class="language-bash"># Fully qualified domain name or IP of the Marathon host (without http://).
Enter the DNS hostname or IP of your Marathon Instance : ip-**-*-*-***
# The name of the Marathon app to autoscale (without &quot;/&quot;).
Enter the Marathon Application Name to Configure Autoscale for from the Marathon UI : testing
# The percentage of average memory utilization across all tasks for the target Marathon app before scaleout is triggered.
Enter the Max percent of Mem Usage averaged across all Application Instances to trigger Autoscale (ie. 80) : 5
# The average CPU time across all tasks for the target Marathon app before scaleout is triggered.
Enter the Max percent of CPU Usage averaged across all Application Instances to trigger Autoscale (ie. 80) : 5
# 'or' or 'and' determines whether both CPU and memory must be triggered or just one or the other.
Enter which metric(s) to trigger Autoscale ('and', 'or') : or
# The number by which current instances will be multiplied. This determines how many instances to add during scaleout.
Enter Autoscale multiplier for triggered Autoscale (ie 1.5) : 2
# The ceiling for the number of instances to stop scaling out EVEN if thresholds are crossed.
Enter the Max instances that should ever exist for this application (ie. 20) : 10
</code></pre>
</li>
</ol>
<p>欲了解更多信息，请参阅 <a href="https://github.com/mesosphere/marathon-autoscale">Marathon-Autoscale GitHub</a> 存储库。</p>
</article></div><aside class="content__sections"><div class="content__sections-list-container"><ul class="content__sections-list"><li class="content__sections-item content__sections-item--h1"><a href="#marathon-autoscale">在节点上安装 Marathon Autoscale 应用程序</a></li><li class="content__sections-item content__sections-item--h1"><a href="#autoscale">运行 Autoscale 应用程序</a></li></ul></div></aside></main></div></div><script src="/dcosdocs/assets/js/jquery-3.2.1.js"></script><script src="/dcosdocs/assets/js/clipboard.js"></script><script src="/dcosdocs/assets/js/prism.js"></script><script src="/js/main.js"></script></body></html>