<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width" initial-scale="1" user-scalable="no"><title>Tutorial - Microscaling based on queue length - D2iQ Docs</title><meta name="description" content="Understanding microscaling"><link rel="apple-touch-icon" sizes="180x180" href="/assets/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/favicon-16x16.png"><link rel="stylesheet" type="text/css" href="/css/styles.css"><link rel="search" type="application/opensearchdescription+xml" href="/assets/opensearch.xml" title="Search"><link href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,500,500i,700,700i" rel="stylesheet"><script src="https://unpkg.com/feather-icons/dist/feather.min.js"></script><script>window.analytics||(window.analytics=[]),window.analytics.methods=["identify","track","trackLink","trackForm","trackClick","trackSubmit","page","pageview","ab","alias","ready","group","on","once","off"],window.analytics.factory=function(t){return function(){var a=Array.prototype.slice.call(arguments);return a.unshift(t),window.analytics.push(a),window.analytics}};for(var i=0;i<window.analytics.methods.length;i++){var method=window.analytics.methods[i];window.analytics[method]=window.analytics.factory(method)}window.analytics.load=function(t){var a=document.createElement("script");a.type="text/javascript",a.async=!0,a.src=("https:"===document.location.protocol?"https://":"http://")+"d2dq2ahtl5zl1z.cloudfront.net/analytics.js/v1/"+t+"/analytics.min.js";var n=document.getElementsByTagName("script")[0];n.parentNode.insertBefore(a,n)},window.analytics.SNIPPET_VERSION="2.0.8",
window.analytics.load("7sgtwqvuai");
window.analytics.page();</script><noscript><iframe src="//www.googletagmanager.com/ns.html?id=GTM-PBJ84KX" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript><script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src='//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
})(window,document,'script','dataLayer','GTM-PBJ84KX');</script></head><body><div class="layout"><header class="header"><a class="header__drawer"><i class="header__icon" data-feather="menu"></i></a><a class="header__logo" href="/"><img class="header__logo--mobile" src="/assets/D2iQ_Logotype_Color_Positive_Documentation.svg" alt="D2IQ"><img class="header__logo--desktop" src="/assets/D2iQ_Logotype_Color_Positive_Documentation.svg" alt="D2IQ"></a><div class="header__main"><div class="header__dropdown"><img class="header__dropdown-icon" src="/assets/D2IQ_Logotype_Color_Positive.png" alt="D2iQ"><strong>DC/OS Documentation</strong><i data-feather="chevron-down"></i></div><nav class="header__menu"><ul class="header__menu-list"><li class="header__menu-item"><a href="/mesosphere/dcos">DC/OS</a></li><li class="header__menu-item"><a href="/mesosphere/dcos/services">Services</a></li><li class="header__menu-item"><a href="https://support.d2iq.com">Support</a></li></ul></nav></div><div class="chooser" id="localizer"><div class="chooser-current"><a class="chooser-title">English</a><svg class="chooser-svg" id="localizer-svg"><path class="pointer" d="m 13,6 -5,5 -5,-5 z" fill="#858585"></path></svg></div><ul class="chooser-list" id="localizer-list"><li class="chooser-list-item"><a href="/mesosphere/dcos/cn/1.13/tutorials/autoscaling/microscaling-queue">中文 (简体)</a></li></ul></div><section class="header__search" role="search"><form class="header__search-form" action="/search/"><input class="header__search-input" id="header-search-input" tabindex="1" type="text" name="q" placeholder="Search"><input type="hidden" name="hFR[scope][0]" value="DC/OS 1.13"><label class="header__search-label" for="header-search-input"><i class="header__icon" data-feather="search"></i></label></form></section></header><div class="header-dropdown"><ul class="header-dropdown__list"><li class="header-dropdown__top-item"><div>DKP</div></li><li class="header-dropdown__item"><a href="/dkp/konvoy">Konvoy</a></li><li class="header-dropdown__item"><a href="/dkp/kommander">Kommander</a></li><li class="header-dropdown__item"><a href="/dkp/dispatch">Dispatch</a></li><li class="header-dropdown__item"><a href="/dkp/kaptain">Kaptain</a></li><li class="header-dropdown__top-item"><div>Mesosphere</div></li><li class="header-dropdown__item header-dropdown__item--active"><a href="/mesosphere/dcos">DC/OS</a></li><li class="header-dropdown__item"><a href="/mesosphere/dcos/services">DC/OS Services</a></li><li class="header-dropdown__item"><a href="https://support.d2iq.com">Support</a></li></ul></div><div class="layout__sidebar layout__drawer"><section class="sidebar"><header class="sidebar__header"><div class="sidebar__dropdown"><ul><li><a href="/mesosphere/dcos/2.2/tutorials/autoscaling/microscaling-queue">Mesosphere DC/OS 2.2.0</a></li><li><a href="/mesosphere/dcos/2.1/tutorials/autoscaling/microscaling-queue">Mesosphere DC/OS 2.1.0</a></li><li><a href="/mesosphere/dcos/2.0/tutorials/autoscaling/microscaling-queue">Mesosphere DC/OS 2.0</a></li><li><a href="/mesosphere/dcos/1.13/tutorials/autoscaling/microscaling-queue">Mesosphere DC/OS 1.13</a></li></ul><div class="toggle"><p><span class="title">DC/OS</span><span class="version"> 1.13</span></p><i data-feather="chevron-down"></i></div></div></header><nav class="sidebar_nav" role="navigation"><ul><li><a class="d0" href="/mesosphere/dcos/1.13/release-notes/"><i data-feather="chevron-right"></i>Release Notes</a></li><li><a class="d0" href="/mesosphere/dcos/1.13/overview/"><i data-feather="chevron-right"></i>Overview</a></li><li><a class="d0" href="/mesosphere/dcos/1.13/installing/"><i data-feather="chevron-right"></i>Installing</a></li><li><a class="d0" href="/mesosphere/dcos/1.13/gui/"><i data-feather="chevron-right"></i>GUI</a></li><li><a class="d0" href="/mesosphere/dcos/1.13/cli/"><i data-feather="chevron-right"></i>CLI</a></li><li><a class="d0" href="/mesosphere/dcos/1.13/administering-clusters/"><i data-feather="chevron-right"></i>Administering Clusters</a></li><li><a class="d0" href="/mesosphere/dcos/1.13/networking/"><i data-feather="chevron-right"></i>Networking</a></li><li><a class="d0" href="/mesosphere/dcos/1.13/security/"><i data-feather="chevron-right"></i>Security</a></li><li><a class="d0" href="/mesosphere/dcos/1.13/storage/"><i data-feather="chevron-right"></i>Storage</a></li><li><a class="d0" href="/mesosphere/dcos/1.13/metrics/"><i data-feather="chevron-right"></i>Metrics</a></li><li><a class="d0" href="/mesosphere/dcos/1.13/monitoring/"><i data-feather="chevron-right"></i>Monitoring, Logging, and Debugging</a></li><li><a class="d0" href="/mesosphere/dcos/1.13/hybrid-cloud/"><i data-feather="chevron-right"></i>Hybrid Cloud</a></li><li><a class="d0" href="/mesosphere/dcos/1.13/deploying-jobs/"><i data-feather="chevron-right"></i>Deploying Jobs</a></li><li><a class="d0" href="/mesosphere/dcos/1.13/deploying-services/"><i data-feather="chevron-right"></i>Deploying Services and Pods</a></li><li class="active"><a class="d0" href="/mesosphere/dcos/1.13/tutorials/"><i data-feather="chevron-right"></i>Tutorials</a></li><ul><li><a class="d1" href="/mesosphere/dcos/1.13/tutorials/dcos-101/"><i data-feather="chevron-right"></i>Introducing DC/OS</a></li><li><a class="d1" href="/mesosphere/dcos/1.13/tutorials/stateful-services/">Running stateful services on DC/OS</a></li><li class="active"><a class="d1" href="/mesosphere/dcos/1.13/tutorials/autoscaling/"><i data-feather="chevron-right"></i>Autoscaling with Marathon</a></li><ul><li><a class="d2" href="/mesosphere/dcos/1.13/tutorials/autoscaling/cpu-memory/">Autoscaling Marathon services using CPU and memory</a></li><li><a class="d2" href="/mesosphere/dcos/1.13/tutorials/autoscaling/requests-second/">Understanding Autoscaling</a></li><li class="active active-on"><a class="d2" href="/mesosphere/dcos/1.13/tutorials/autoscaling/microscaling-queue/">Microscaling</a></li></ul><li><a class="d1" href="/mesosphere/dcos/1.13/tutorials/iot_pipeline/">Deploying a load-balanced data pipeline</a></li><li><a class="d1" href="/mesosphere/dcos/1.13/tutorials/deploy-on-marathon/">Deploying Marathon apps with Jenkins</a></li><li><a class="d1" href="/mesosphere/dcos/1.13/tutorials/task-labels/">Labeling tasks and jobs</a></li><li><a class="d1" href="/mesosphere/dcos/1.13/tutorials/dcos-debug/"><i data-feather="chevron-right"></i>Debugging applications on DC/OS</a></li></ul><li><a class="d0" href="/mesosphere/dcos/1.13/api/"><i data-feather="chevron-right"></i>API Reference</a></li><li><a class="d0" href="/mesosphere/dcos/1.13/developing-services/"><i data-feather="chevron-right"></i>Developing DC/OS Services</a></li></ul></nav><footer class="sidebar__footer"><div class="sidebar__footer-links"><a href="https://d2iq.com/terms/">Terms of Service</a><a href="https://d2iq.com/privacy/">Privacy Policy</a></div><a class="sidebar__footer-copyright" href="https://d2iq.com/">&copy; 2022 D2iQ, Inc. All rights reserved.</a></footer></section></div><div class="layout__content" role="main"><main class="content"><div class="content__container content__container--with-sections"><div class="content__header"><div class="content__header__row"><h1 class="content__header-title">Tutorial - Microscaling based on queue length</h1></div><h4 class="content__header-description">Understanding microscaling</h4><div class="actions"><ul class="actions__list"><li class="actions__item"><button class="actions__link" onclick="javascript:window.print()"><i class="actions__icon" data-feather="printer"></i><span class="actions__text">Print</span></button></li><li class="actions__item"><a class="actions__link" href="https://github.com/mesosphere/dcos-docs-site/tree/main/pages/mesosphere/dcos/1.13/tutorials/autoscaling/microscaling-queue/index.md" target="_blank"><i class="actions__icon" data-feather="github"></i><span class="actions__text">Contribute</span></a></li></ul></div></div><article class="content__article"><!-- This disclaimer should be included at the beginning of each page of a tutorial. -->
<p class="message--important"><strong>IMPORTANT: </strong>Tutorials are intended to give you hands-on experience working with a limited set of DC/OS features with no implied or explicit warranty of any kind. None of the information provided--including sample scripts, commands, or applications--is officially supported by Mesosphere. You should not use this information in a production environment without independent testing and validation.</p>
<p>This tutorial walks you through setting up a microscaling demonstration from <a href="http://microscaling.com">Microscaling Systems</a> on a DC/OS cluster.</p>
<p><a href="http://microscaling.com">Microscaling</a> adjusts the balance of tasks running within your compute cluster.
This allows your infrastructure to automatically reallocate resources from lower to higher priority tasks, reacting within seconds to a change in demand.
Microscaling monitors whether the higher priority task is meeting a performance target. In this tutorial, the performance target is maintaining the length of a configured queue value. The higher priority task is scaled up when the target is not met,
and down when it is exceeded. The lower priority tasks can use the spare resources.</p>
<p><strong>Time Estimate</strong>:</p>
<p>If you already have the <a href="#prerequisites">prerequisites</a> setup, you’ll have the microscaling demo running in around 10-15 minutes.</p>
<p><strong>Scope</strong>:</p>
<p>In this tutorial, microscaling adjusts the balance between two tasks - one high priority and one background - based on the number of items in  an Azure Storage Queue.</p>
<p><img src="/mesosphere/dcos/1.13/img/microscaling-queue.png" alt="microscaling-queue.png"></p>
<p>Figure 1. - Microscaling queue</p>
<p>The demo creates four Marathon apps that run as Docker containers.</p>
<ul>
<li><strong>Producer</strong> instances add items to the queue. The more producers there are, the faster the queue fills up. We start 3 producers on startup and you can scale these manually using the Marathon UI.</li>
<li><strong>Consumer</strong> instances remove items from the queue and are scaled by the Microscaling Engine.</li>
<li><strong>Remainder</strong> is a background task. Any spare capacity is used for this background task. You can change the Docker image to use your own using the Marathon UI.</li>
<li><strong>Microscaling</strong> is the engine that monitors the queue length, and scales the Consumer and Remainder tasks. It also sends data to our Microscaling-in-a-Box site so you can see what’s happening.</li>
</ul>
<h1 id="prerequisites"><a class="content__anchor" href="#prerequisites" aria-hidden="true"><i data-feather="bookmark"></i></a><a name="prerequisites"></a>Prerequisites</h1>
<ul>
<li>A <a href="http://azure.microsoft.com">Microsoft Azure</a> account. Your DC/OS cluster can be running anywhere (it doesn’t have to be running on Azure)
but the demo uses an Azure Storage Queue. If you don’t already have an account you can get a <a href="https://azure.microsoft.com/en-us/pricing/free-trial/">free trial</a>.</li>
<li>A <a href="/mesosphere/dcos/1.13/installing/">running DC/OS cluster</a>. If you don’t already have one, you can follow these <a href="https://azure.microsoft.com/en-us/documentation/articles/container-service-deployment/">instructions for setting up a DC/OS cluster on Azure</a>.</li>
<li>The Marathon API address. If you set up an SSH tunnel on port 80 to your Marathon master node, you can access the Marathon API at <code>http://localhost/marathon</code>.</li>
<li><a href="https://www.ruby-lang.org/en/documentation/installation/">Ruby</a> on your local machine to run the demo scripts.</li>
</ul>
<h1 id="set-up-an-azure-storage-account"><a class="content__anchor" href="#set-up-an-azure-storage-account" aria-hidden="true"><i data-feather="bookmark"></i></a>Set up an Azure Storage Account</h1>
<ul>
<li>Sign in to the <a href="http://portal.azure.com">Azure Portal</a>.</li>
<li>Navigate to New -&gt; Data + Storage -&gt; Storage Account.</li>
<li>Create a storage account with the following settings:</li>
</ul>
<p><img src="/mesosphere/dcos/1.13/img/microscaling-azure-storage.png" alt="microscaling-azure-storage.png"></p>
<ul>
<li><strong>Name</strong> - this must be globally unique across all Azure Storage Accounts. Make a note of this - you will use this as the environment variable <code>AZURE_STORAGE_ACCOUNT_NAME</code> later.</li>
<li><strong>Replication</strong> - choose Locally-redundant storage for the queue.</li>
<li><strong>Resource Group</strong> - create a new resource group for the queue.</li>
</ul>
<p>After the storage account has been created, navigate to Settings -&gt; Access Keys and make a note of your access key. You’ll use this as the environment variable <code>AZURE_STORAGE_ACCOUNT_KEY</code> later.</p>
<h1 id="set-up-microscaling-in-a-box"><a class="content__anchor" href="#set-up-microscaling-in-a-box" aria-hidden="true"><i data-feather="bookmark"></i></a>Set up Microscaling-in-a-box</h1>
<ul>
<li>Go to the <a href="http://app.microscaling.com">Microscaling-in-a-box</a> site and sign up for an account if you don’t have one already.</li>
<li>In Step 1, pick the Mesos/Marathon option</li>
</ul>
<p><img src="/mesosphere/dcos/1.13/img/microscaling-step-1.png" alt="microscaling-step-1.png"></p>
<ul>
<li>Skip through steps 2 &amp; 3 to use the default values.</li>
<li>Navigate to the step 4 (Run) page and find your user ID and the default value for the queue we’ll be using in the demo. You will use these as the values for environment variables <code>MSS_USER_ID</code> and <code>AZURE_STORAGE_QUEUE_NAME</code> later.</li>
</ul>
<p><img src="/mesosphere/dcos/1.13/img/microscaling-step-4.png" alt="microscaling-step-4.png"></p>
<p>Figure 4. User ID and queue name</p>
<h1 id="get-the-microscaling-scripts"><a class="content__anchor" href="#get-the-microscaling-scripts" aria-hidden="true"><i data-feather="bookmark"></i></a>Get the microscaling scripts</h1>
<p>We have prepared some scripts to configure and start the four apps in Marathon. Go to a terminal on your local machine and get these scripts with the following command.</p>
<pre><code class="language-bash">git clone http://github.com/microscaling/queue-demo
</code></pre>
<p>Move into the queue-demo directory.</p>
<pre><code class="language-bash">cd queue-demo
</code></pre>
<h1 id="run-the-microscaling-install-script"><a class="content__anchor" href="#run-the-microscaling-install-script" aria-hidden="true"><i data-feather="bookmark"></i></a>Run the microscaling install script</h1>
<p>Set up the following environment variables</p>
<pre><code class="language-bash">export AZURE_STORAGE_ACCOUNT_NAME=&lt;storage account name&gt;
export AZURE_STORAGE_ACCOUNT_KEY=&lt;storage account key&gt;
export AZURE_STORAGE_QUEUE_NAME=&lt;queue name&gt;
export MSS_USER_ID=&lt;user ID&gt;
export MSS_MARATHON_API=http://localhost/marathon
</code></pre>
<p>You’re now ready to run the demo:</p>
<pre><code class="language-bash">./marathon-install
</code></pre>
<p>This script starts all four tasks. You can view these in the DC/OS web interface.</p>
<p>After Marathon has launched the apps, the results will start to appear in the Microscaling-in-a-Box UI. You’ll see the Microscaling Engine scaling the consumer and remainder containers to maintain the target queue length.</p>
<p><img src="/mesosphere/dcos/1.13/img/microscaling-chart-ui.png" alt="microscaling-chart-ui.png"></p>
<p>You can use the DC/OS web interface to scale the number of Producer tasks up or down and see how Microscaling reacts to keep the queue length under control.</p>
<h1 id="cleanup"><a class="content__anchor" href="#cleanup" aria-hidden="true"><i data-feather="bookmark"></i></a>Cleanup</h1>
<h2 id="uninstall-the-marathon-apps"><a class="content__anchor" href="#uninstall-the-marathon-apps" aria-hidden="true"><i data-feather="bookmark"></i></a>Uninstall the Marathon Apps</h2>
<p>You can use the <code>marathon-uninstall</code> command to remove the demo apps from your cluster. (This command requires the <code>MSS_MARATHON_API</code> environment variable to be set as above.)</p>
<pre><code class="language-bash">./marathon-uninstall
</code></pre>
<h2 id="delete-the-azure-resources"><a class="content__anchor" href="#delete-the-azure-resources" aria-hidden="true"><i data-feather="bookmark"></i></a>Delete the Azure Resources</h2>
<p>After you’ve finished with the demo you should delete the Azure resources so that you don’t get charged.</p>
<ul>
<li>Sign in to the <a href="http://portal.azure.com">Azure Portal</a>.</li>
<li>Select Resource Groups from the left hand menu.</li>
<li>Find and delete the Resource Group you created for the Azure Queue.</li>
<li>If you created an ACS cluster for this demo, delete the Resource Group for that, too.</li>
</ul>
<h1 id="next-steps"><a class="content__anchor" href="#next-steps" aria-hidden="true"><i data-feather="bookmark"></i></a>Next Steps</h1>
<ul>
<li>Try modifying some of the configuration settings in Step 3 of Microscaling-in-a-Box before you run the demo. You’ll need to stop the tasks (manually or by running <code>./marathon-uninstall</code>) and restart them again with <code>./marathon-install</code> to pick up configuration changes.</li>
<li>See the settings for each of the Marathon apps in JSON files contained within the <code>marathon-apps</code> directory.</li>
<li>Here’s the <a href="http://github.com/microscaling/microscaling">microscaling engine code</a>.</li>
<li>Find more information about microscaling on the <a href="http://microscaling.com">Microscaling Systems website</a>.</li>
</ul>
</article></div><aside class="content__sections"><div class="content__sections-list-container"><ul class="content__sections-list"><li class="content__sections-item content__sections-item--h1"><a href="#prerequisites">Prerequisites</a></li><li class="content__sections-item content__sections-item--h1"><a href="#set-up-an-azure-storage-account">Set up an Azure Storage Account</a></li><li class="content__sections-item content__sections-item--h1"><a href="#set-up-microscaling-in-a-box">Set up Microscaling-in-a-box</a></li><li class="content__sections-item content__sections-item--h1"><a href="#get-the-microscaling-scripts">Get the microscaling scripts</a></li><li class="content__sections-item content__sections-item--h1"><a href="#run-the-microscaling-install-script">Run the microscaling install script</a></li><li class="content__sections-item content__sections-item--h1"><a href="#cleanup">Cleanup</a></li><li class="content__sections-item content__sections-item--h2"><a href="#uninstall-the-marathon-apps">Uninstall the Marathon Apps</a></li><li class="content__sections-item content__sections-item--h2"><a href="#delete-the-azure-resources">Delete the Azure Resources</a></li><li class="content__sections-item content__sections-item--h1"><a href="#next-steps">Next Steps</a></li></ul></div></aside></main></div></div><script src="/assets/js/jquery-3.2.1.js"></script><script src="/assets/js/clipboard.js"></script><script src="/assets/js/prism.js"></script><script src="/js/main.js"></script></body></html>