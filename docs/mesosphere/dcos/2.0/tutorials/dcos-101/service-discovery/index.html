<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width" initial-scale="1" user-scalable="no"><title>Tutorial - Connecting Apps/Service Discovery - D2iQ Docs</title><meta name="description" content="Part 4 of the DC/OS 101 tutorial"><link rel="apple-touch-icon" sizes="180x180" href="/dcosdocs/assets/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/dcosdocs/assets/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/dcosdocs/assets/favicon-16x16.png"><link rel="stylesheet" type="text/css" href="/dcosdocs/css/styles.css"><link rel="search" type="application/opensearchdescription+xml" href="/dcosdocs/assets/opensearch.xml" title="Search"><link href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,500,500i,700,700i" rel="stylesheet"><script src="https://unpkg.com/feather-icons/dist/feather.min.js"></script><script>window.analytics||(window.analytics=[]),window.analytics.methods=["identify","track","trackLink","trackForm","trackClick","trackSubmit","page","pageview","ab","alias","ready","group","on","once","off"],window.analytics.factory=function(t){return function(){var a=Array.prototype.slice.call(arguments);return a.unshift(t),window.analytics.push(a),window.analytics}};for(var i=0;i<window.analytics.methods.length;i++){var method=window.analytics.methods[i];window.analytics[method]=window.analytics.factory(method)}window.analytics.load=function(t){var a=document.createElement("script");a.type="text/javascript",a.async=!0,a.src=("https:"===document.location.protocol?"https://":"http://")+"d2dq2ahtl5zl1z.cloudfront.net/analytics.js/v1/"+t+"/analytics.min.js";var n=document.getElementsByTagName("script")[0];n.parentNode.insertBefore(a,n)},window.analytics.SNIPPET_VERSION="2.0.8",
window.analytics.load("7sgtwqvuai");
window.analytics.page();</script><noscript><iframe src="//www.googletagmanager.com/ns.html?id=GTM-PBJ84KX" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript><script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src='//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
})(window,document,'script','dataLayer','GTM-PBJ84KX');</script></head><body><div class="layout"><header class="header"><a class="header__drawer"><i class="header__icon" data-feather="menu"></i></a><a class="header__logo" href="/"><img class="header__logo--mobile" src="/dcosdocs/assets/D2iQ_Logotype_Color_Positive_Documentation.svg" alt="D2IQ"><img class="header__logo--desktop" src="/dcosdocs/assets/D2iQ_Logotype_Color_Positive_Documentation.svg" alt="D2IQ"></a><div class="header__main"><div class="header__dropdown"><img class="header__dropdown-icon" src="/dcosdocs/assets/D2IQ_Logotype_Color_Positive.png" alt="D2iQ"><strong>DC/OS Documentation</strong><i data-feather="chevron-down"></i></div><nav class="header__menu"><ul class="header__menu-list"><li class="header__menu-item"><a href="/mesosphere/dcos">DC/OS</a></li><li class="header__menu-item"><a href="/dcosdocs/mesosphere/dcos/services">Services</a></li><li class="header__menu-item"><a href="https://support.d2iq.com">Support</a></li></ul></nav></div><div class="chooser" id="localizer"><div class="chooser-current"><a class="chooser-title">English</a><svg class="chooser-svg" id="localizer-svg"><path class="pointer" d="m 13,6 -5,5 -5,-5 z" fill="#858585"></path></svg></div><ul class="chooser-list" id="localizer-list"><li class="chooser-list-item"><a href="/dcosdocs/mesosphere/dcos/cn/2.0/tutorials/dcos-101/service-discovery">中文 (简体)</a></li></ul></div><section class="header__search" role="search"><form class="header__search-form" action="/search/"><input class="header__search-input" id="header-search-input" tabindex="1" type="text" name="q" placeholder="Search"><input type="hidden" name="hFR[scope][0]" value="DC/OS 2.0"><label class="header__search-label" for="header-search-input"><i class="header__icon" data-feather="search"></i></label></form></section></header><div class="header-dropdown"><ul class="header-dropdown__list"><li class="header-dropdown__top-item"><div>DKP</div></li><li class="header-dropdown__item"><a href="/dkp/konvoy">Konvoy</a></li><li class="header-dropdown__item"><a href="/dkp/kommander">Kommander</a></li><li class="header-dropdown__item"><a href="/dkp/dispatch">Dispatch</a></li><li class="header-dropdown__item"><a href="/dkp/kaptain">Kaptain</a></li><li class="header-dropdown__top-item"><div>Mesosphere</div></li><li class="header-dropdown__item header-dropdown__item--active"><a href="/mesosphere/dcos">DC/OS</a></li><li class="header-dropdown__item"><a href="/dcosdocs/mesosphere/dcos/services">DC/OS Services</a></li><li class="header-dropdown__item"><a href="https://support.d2iq.com">Support</a></li></ul></div><div class="layout__sidebar layout__drawer"><section class="sidebar"><header class="sidebar__header"><div class="sidebar__dropdown"><ul><li><a href="/dcosdocs/mesosphere/dcos/2.2/tutorials/dcos-101/service-discovery">Mesosphere DC/OS 2.2.0</a></li><li><a href="/dcosdocs/mesosphere/dcos/2.1/tutorials/dcos-101/service-discovery">Mesosphere DC/OS 2.1.0</a></li><li><a href="/dcosdocs/mesosphere/dcos/2.0/tutorials/dcos-101/service-discovery">Mesosphere DC/OS 2.0</a></li><li><a href="/dcosdocs/mesosphere/dcos/1.13/tutorials/dcos-101/service-discovery">Mesosphere DC/OS 1.13</a></li></ul><div class="toggle"><p><span class="title">DC/OS</span><span class="version"> 2.0</span></p><i data-feather="chevron-down"></i></div></div></header><nav class="sidebar_nav" role="navigation"><ul><li><a class="d0" href="/dcosdocs/mesosphere/dcos/2.0/release-notes/"><i data-feather="chevron-right"></i>Release Notes</a></li><li><a class="d0" href="/dcosdocs/mesosphere/dcos/2.0/overview/"><i data-feather="chevron-right"></i>Overview</a></li><li><a class="d0" href="/dcosdocs/mesosphere/dcos/2.0/installing/"><i data-feather="chevron-right"></i>Installing</a></li><li><a class="d0" href="/dcosdocs/mesosphere/dcos/2.0/gui/"><i data-feather="chevron-right"></i>GUI</a></li><li><a class="d0" href="/dcosdocs/mesosphere/dcos/2.0/cli/"><i data-feather="chevron-right"></i>CLI</a></li><li><a class="d0" href="/dcosdocs/mesosphere/dcos/2.0/administering-clusters/"><i data-feather="chevron-right"></i>Administering Clusters</a></li><li><a class="d0" href="/dcosdocs/mesosphere/dcos/2.0/networking/"><i data-feather="chevron-right"></i>Networking</a></li><li><a class="d0" href="/dcosdocs/mesosphere/dcos/2.0/security/"><i data-feather="chevron-right"></i>Security</a></li><li><a class="d0" href="/dcosdocs/mesosphere/dcos/2.0/storage/"><i data-feather="chevron-right"></i>Storage</a></li><li><a class="d0" href="/dcosdocs/mesosphere/dcos/2.0/metrics/"><i data-feather="chevron-right"></i>Metrics</a></li><li><a class="d0" href="/dcosdocs/mesosphere/dcos/2.0/monitoring/"><i data-feather="chevron-right"></i>Monitoring, Logging, and Debugging</a></li><li><a class="d0" href="/dcosdocs/mesosphere/dcos/2.0/multi-tenancy/"><i data-feather="chevron-right"></i>Multi-Tenancy for DC/OS Clusters</a></li><li><a class="d0" href="/dcosdocs/mesosphere/dcos/2.0/hybrid-cloud/"><i data-feather="chevron-right"></i>Hybrid Cloud</a></li><li><a class="d0" href="/dcosdocs/mesosphere/dcos/2.0/deploying-jobs/"><i data-feather="chevron-right"></i>Deploying Jobs</a></li><li><a class="d0" href="/dcosdocs/mesosphere/dcos/2.0/deploying-services/"><i data-feather="chevron-right"></i>Deploying Services and Pods</a></li><li class="active"><a class="d0" href="/dcosdocs/mesosphere/dcos/2.0/tutorials/"><i data-feather="chevron-right"></i>Tutorials</a></li><ul><li class="active"><a class="d1" href="/dcosdocs/mesosphere/dcos/2.0/tutorials/dcos-101/"><i data-feather="chevron-right"></i>DC/OS 101</a></li><ul><li><a class="d2" href="/dcosdocs/mesosphere/dcos/2.0/tutorials/dcos-101/cli/">First Steps</a></li><li><a class="d2" href="/dcosdocs/mesosphere/dcos/2.0/tutorials/dcos-101/redis-package/">Installing the First Package</a></li><li><a class="d2" href="/dcosdocs/mesosphere/dcos/2.0/tutorials/dcos-101/app1/">Deploying First Application</a></li><li class="active active-on"><a class="d2" href="/dcosdocs/mesosphere/dcos/2.0/tutorials/dcos-101/service-discovery/">Service Discovery</a></li><li><a class="d2" href="/dcosdocs/mesosphere/dcos/2.0/tutorials/dcos-101/app2/">Native Applications</a></li><li><a class="d2" href="/dcosdocs/mesosphere/dcos/2.0/tutorials/dcos-101/marathon-lb/">Exposing Apps Publicly</a></li><li><a class="d2" href="/dcosdocs/mesosphere/dcos/2.0/tutorials/dcos-101/resources/">Understanding Resources</a></li><li><a class="d2" href="/dcosdocs/mesosphere/dcos/2.0/tutorials/dcos-101/loadbalancing/">Load-Balancing</a></li></ul><li><a class="d1" href="/dcosdocs/mesosphere/dcos/2.0/tutorials/create-service/">Creating and Running a Service</a></li><li><a class="d1" href="/dcosdocs/mesosphere/dcos/2.0/tutorials/stateful-services/">Running Stateful Services on DC/OS</a></li><li><a class="d1" href="/dcosdocs/mesosphere/dcos/2.0/tutorials/autoscaling/"><i data-feather="chevron-right"></i>Autoscaling with Marathon</a></li><li><a class="d1" href="/dcosdocs/mesosphere/dcos/2.0/tutorials/iot_pipeline/">Deploying a Load-Balanced Data Pipeline</a></li><li><a class="d1" href="/dcosdocs/mesosphere/dcos/2.0/tutorials/deploy-on-marathon/">Deploying Marathon Apps with Jenkins</a></li><li><a class="d1" href="/dcosdocs/mesosphere/dcos/2.0/tutorials/task-labels/">Labeling Tasks and Jobs</a></li><li><a class="d1" href="/dcosdocs/mesosphere/dcos/2.0/tutorials/dcos-debug/"><i data-feather="chevron-right"></i>Debugging Applications on DC/OS</a></li></ul><li><a class="d0" href="/dcosdocs/mesosphere/dcos/2.0/api/"><i data-feather="chevron-right"></i>API Reference</a></li><li><a class="d0" href="/dcosdocs/mesosphere/dcos/2.0/developing-services/"><i data-feather="chevron-right"></i>Developing DC/OS Services</a></li></ul></nav><footer class="sidebar__footer"><div class="sidebar__footer-links"><a href="https://d2iq.com/terms/">Terms of Service</a><a href="https://d2iq.com/privacy/">Privacy Policy</a></div><a class="sidebar__footer-copyright" href="https://d2iq.com/">&copy; 2022 D2iQ, Inc. All rights reserved.</a></footer></section></div><div class="layout__content" role="main"><main class="content"><div class="content__container content__container--with-sections"><div class="content__header"><div class="content__header__row"><h1 class="content__header-title">Tutorial - Connecting Apps/Service Discovery</h1></div><h4 class="content__header-description">Part 4 of the DC/OS 101 tutorial</h4><div class="actions"><ul class="actions__list"><li class="actions__item"><button class="actions__link" onclick="javascript:window.print()"><i class="actions__icon" data-feather="printer"></i><span class="actions__text">Print</span></button></li><li class="actions__item"><a class="actions__link" href="https://github.com/mesosphere/dcos-docs-site/tree/main/pages/dcosdocs/mesosphere/dcos/2.0/tutorials/dcos-101/service-discovery/index.md" target="_blank"><i class="actions__icon" data-feather="github"></i><span class="actions__text">Contribute</span></a></li></ul></div></div><article class="content__article"><!-- This disclaimer should be included at the beginning of each page of a tutorial. -->
<p class="message--important"><strong>IMPORTANT: </strong>Tutorials are intended to give you hands-on experience working with a limited set of DC/OS features with no implied or explicit warranty of any kind. None of the information provided--including sample scripts, commands, or applications--is officially supported by Mesosphere. You should not use this information in a production environment without independent testing and validation.</p>
<p>Welcome to part 4 of the DC/OS 101 Tutorial</p>
<h1 id="prerequisites"><a class="content__anchor" href="#prerequisites" aria-hidden="true"><i data-feather="bookmark"></i></a>Prerequisites</h1>
<ul>
<li>A <a href="/dcosdocs/mesosphere/dcos/2.0/tutorials/dcos-101/cli/">running DC/OS cluster</a> with <a href="/dcosdocs/mesosphere/dcos/2.0/tutorials/dcos-101/cli/">the DC/OS CLI installed</a>.</li>
<li><a href="/dcosdocs/mesosphere/dcos/2.0/tutorials/dcos-101/app1/">app1</a> deployed and running in your cluster.</li>
</ul>
<h1 id="objective"><a class="content__anchor" href="#objective" aria-hidden="true"><i data-feather="bookmark"></i></a>Objective</h1>
<p>Your <a href="https://raw.githubusercontent.com/joerg84/dcos-101/master/app1/app1.py">app</a> in the previous part of this tutorial used <code>redis.marathon.l4lb.thisdcos.directory</code> as the address for connecting to Redis, with port 6379. As Redis might be running on any agent in the cluster, and potentially on different ports, how does this address resolve to the actual running Redis instance?</p>
<p>In this section, you will learn about DC/OS service discovery by exploring the different options available for apps in DC/OS.</p>
<h1 id="service-discovery"><a class="content__anchor" href="#service-discovery" aria-hidden="true"><i data-feather="bookmark"></i></a>Service Discovery</h1>
<p><a href="/dcosdocs/mesosphere/dcos/2.0/networking/">Service discovery</a> enables addressing of applications independently of where they are running in the cluster, which is particularly useful in cases where applications may fail and be restarted on a different host.</p>
<p>DC/OS provides two options for service discovery:</p>
<ol>
<li>Mesos-DNS</li>
<li>Named Virtual IPs.</li>
</ol>
<p>SSH into the Mesos master node in your cluster to see how these different service discovery methods work:</p>
<p><code>dcos node ssh --master-proxy --leader</code></p>
<h1 id="mesos-dns"><a class="content__anchor" href="#mesos-dns" aria-hidden="true"><i data-feather="bookmark"></i></a>Mesos-DNS</h1>
<p><a href="/dcosdocs/mesosphere/dcos/2.0/networking/DNS/mesos-dns/">Mesos-DNS</a> assigns DNS entries for every task, which are resolvable from any node in the cluster. The naming pattern for these entries is  <em>task.scheduler.mesos</em></p>
<p>The default scheduler for jobs is <a href="/dcosdocs/mesosphere/dcos/2.0/overview/architecture/components/#marathon">Marathon</a>, so the Mesos-DNS name for your Redis service is <em>redis.marathon.mesos</em>.</p>
<p>Let’s use the <a href="https://linux.die.net/man/1/dig">dig</a> command to retrieve the address record (also called the A record). Dig is a command line utility to query DNS servers. When used without argument, it will use the system-wide configured DNS servers to query against, which in a DC/OS cluster is configured to point at Mesos-DNS:</p>
<p><code>dig redis.marathon.mesos</code></p>
<p>The answer should be similar to this response:</p>
<pre><code class="language-text">;; ANSWER SECTION:
redis.marathon.mesos. 60  IN  A 10.0.0.43
</code></pre>
<p>The response tells us that there is an instance of the <code>redis.marathon.mesos</code> service at 10.0.0.43.</p>
<p>The A record only contains IP address information about the host. To connect to the service, you also need to know the port. In order to achieve this, Mesos-DNS also assigns a Service, or SRV, record for each Marathon app, containing the port number.</p>
<p>Use the following dig command to access the SRV record:</p>
<p><code>dig srv _redis._tcp.marathon.mesos</code></p>
<p>The answer should look similar to this response:</p>
<pre><code>;; ANSWER SECTION:
_redis._tcp.marathon.mesos. 60  IN  SRV 0 0 30585 redis-1y1hj-s1.marathon.mesos.

;; ADDITIONAL SECTION:
redis-1y1hj-s1.marathon.mesos. 60 IN  A 10.0.0.43
</code></pre>
<p>This output tells you that your Redis service is running on <code>10.0.0.43:30585</code></p>
<h1 id="named-virtual-ips"><a class="content__anchor" href="#named-virtual-ips" aria-hidden="true"><i data-feather="bookmark"></i></a>Named Virtual IPs</h1>
<ul>
<li><a href="/dcosdocs/mesosphere/dcos/2.0/networking/load-balancing-vips/">Named VIPs</a> allow you to assign name/port pairs to your apps, which means you can give your apps meaningful names with a predictable port. They also provide built-in load balancing when using multiple instances of an application.
For example, you can assign a named VIP to your Redis service by adding the following to the package definition:</li>
</ul>
<pre><code class="language-text">&quot;VIP_0&quot;: &quot;/redis:6379&quot;
</code></pre>
<p>The full name is then generated using the following schema:
<em>vip-name.scheduler.l4lb.thisdcos.directory:vip-port</em>.</p>
<p>As we can see from the example <a href="https://raw.githubusercontent.com/joerg84/dcos-101/master/app1/app1.py">application</a>, this is the mechanism used by the Redis package, and so you can access the Redis service from within the cluster at <code>redis.marathon.l4lb.thisdcos.directory:6379</code>.</p>
<h1 id="outcome"><a class="content__anchor" href="#outcome" aria-hidden="true"><i data-feather="bookmark"></i></a>Outcome</h1>
<p>You know how to use service discovery to connect to your application from within your DC/OS cluster, and have learned about the two mechanisms for service discovery available in DC/OS.</p>
<h1 id="deep-dive"><a class="content__anchor" href="#deep-dive" aria-hidden="true"><i data-feather="bookmark"></i></a>Deep Dive</h1>
<p>What are the differences between <a href="#mesos-dns">Mesos-DNS</a> and <a href="#named-vips">Named VIPs</a>?</p>
<h2 id="mesos-dns-2"><a class="content__anchor" href="#mesos-dns-2" aria-hidden="true"><i data-feather="bookmark"></i></a>Mesos-DNS</h2>
<p>Mesos-DNS is a simple solution to finding applications inside the cluster. While DNS is supported by many applications, Mesos-DNS has the following drawbacks:</p>
<ul>
<li>DNS caching: Applications sometimes cache DNS entries for efficiency and therefore might not have updated address information (e.g., after a task failure).</li>
<li>You need to use SRV DNS records to retrieve information about the allocated ports. While applications commonly understand DNS A records, not all applications support SRV records.</li>
</ul>
<h2 id="named-vips"><a class="content__anchor" href="#named-vips" aria-hidden="true"><i data-feather="bookmark"></i></a>Named VIPs</h2>
<p>Named VIPs load balance the IP address/port pair using an intelligent algorithm to ensure optimal routing of the traffic in relation to the original requestor, and also provide a local caching layer for high perfornance. They also allow you to give your apps meaningful names and select a specific port. Because of these advantages over Mesos-DNS, we suggest using Named VIPs as the default service discovery method in DC/OS.</p>
</article></div><aside class="content__sections"><div class="content__sections-list-container"><ul class="content__sections-list"><li class="content__sections-item content__sections-item--h1"><a href="#prerequisites">Prerequisites</a></li><li class="content__sections-item content__sections-item--h1"><a href="#objective">Objective</a></li><li class="content__sections-item content__sections-item--h1"><a href="#service-discovery">Service Discovery</a></li><li class="content__sections-item content__sections-item--h1"><a href="#mesos-dns">Mesos-DNS</a></li><li class="content__sections-item content__sections-item--h1"><a href="#named-virtual-ips">Named Virtual IPs</a></li><li class="content__sections-item content__sections-item--h1"><a href="#outcome">Outcome</a></li><li class="content__sections-item content__sections-item--h1"><a href="#deep-dive">Deep Dive</a></li><li class="content__sections-item content__sections-item--h2"><a href="#mesos-dns-2">Mesos-DNS</a></li><li class="content__sections-item content__sections-item--h2"><a href="#named-vips">Named VIPs</a></li></ul></div></aside></main></div></div><script src="/dcosdocs/assets/js/jquery-3.2.1.js"></script><script src="/dcosdocs/assets/js/clipboard.js"></script><script src="/dcosdocs/assets/js/prism.js"></script><script src="/js/main.js"></script></body></html>