<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width" initial-scale="1" user-scalable="no"><title>Reference information - D2iQ Docs</title><meta name="description" content="Marathon-LB endpoints, command-line reference, and configuration templates and labels"><link rel="apple-touch-icon" sizes="180x180" href="/assets/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/favicon-16x16.png"><link rel="stylesheet" type="text/css" href="/dcosdocs/css/styles.css"><link rel="search" type="application/opensearchdescription+xml" href="/assets/opensearch.xml" title="Search"><link href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,500,500i,700,700i" rel="stylesheet"><script src="https://unpkg.com/feather-icons/dist/feather.min.js"></script><script>window.analytics||(window.analytics=[]),window.analytics.methods=["identify","track","trackLink","trackForm","trackClick","trackSubmit","page","pageview","ab","alias","ready","group","on","once","off"],window.analytics.factory=function(t){return function(){var a=Array.prototype.slice.call(arguments);return a.unshift(t),window.analytics.push(a),window.analytics}};for(var i=0;i<window.analytics.methods.length;i++){var method=window.analytics.methods[i];window.analytics[method]=window.analytics.factory(method)}window.analytics.load=function(t){var a=document.createElement("script");a.type="text/javascript",a.async=!0,a.src=("https:"===document.location.protocol?"https://":"http://")+"d2dq2ahtl5zl1z.cloudfront.net/analytics.js/v1/"+t+"/analytics.min.js";var n=document.getElementsByTagName("script")[0];n.parentNode.insertBefore(a,n)},window.analytics.SNIPPET_VERSION="2.0.8",
window.analytics.load("7sgtwqvuai");
window.analytics.page();</script><noscript><iframe src="//www.googletagmanager.com/ns.html?id=GTM-PBJ84KX" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript><script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src='//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
})(window,document,'script','dataLayer','GTM-PBJ84KX');</script></head><body><div class="layout"><header class="header"><a class="header__drawer"><i class="header__icon" data-feather="menu"></i></a><a class="header__logo" href="/"><img class="header__logo--mobile" src="/assets/D2iQ_Logotype_Color_Positive_Documentation.svg" alt="D2IQ"><img class="header__logo--desktop" src="/assets/D2iQ_Logotype_Color_Positive_Documentation.svg" alt="D2IQ"></a><div class="header__main"><div class="header__dropdown"><img class="header__dropdown-icon" src="/assets/D2IQ_Logotype_Color_Positive.png" alt="D2iQ"><strong>Marathon Lb Documentation</strong><i data-feather="chevron-down"></i></div><nav class="header__menu"><ul class="header__menu-list"><li class="header__menu-item"><a href="https://support.d2iq.com">Support</a></li></ul></nav></div><div class="chooser" id="localizer"><div class="chooser-current"><a class="chooser-title">English</a><svg class="chooser-svg" id="localizer-svg"><path class="pointer" d="m 13,6 -5,5 -5,-5 z" fill="#858585"></path></svg></div><ul class="chooser-list" id="localizer-list"><li class="chooser-list-item"><a href="/dcosdocs/mesosphere/dcos/cn/services">中文 (简体)</a></li></ul></div><section class="header__search" role="search"><form class="header__search-form" action="/search/"><input class="header__search-input" id="header-search-input" tabindex="1" type="text" name="q" placeholder="Search"><input type="hidden" name="hFR[scope][0]" value="DC/OS Services"><label class="header__search-label" for="header-search-input"><i class="header__icon" data-feather="search"></i></label></form></section></header><div class="header-dropdown"><ul class="header-dropdown__list"><li class="header-dropdown__top-item"><div>DKP</div></li><li class="header-dropdown__item"><a href="/dkp/konvoy">Konvoy</a></li><li class="header-dropdown__item"><a href="/dkp/kommander">Kommander</a></li><li class="header-dropdown__item"><a href="/dkp/dispatch">Dispatch</a></li><li class="header-dropdown__item"><a href="/dkp/kaptain">Kaptain</a></li><li class="header-dropdown__top-item"><div>Mesosphere</div></li><li class="header-dropdown__item header-dropdown__item--active"><a href="/mesosphere/dcos">DC/OS</a></li><li class="header-dropdown__item header-dropdown__item--active"><a href="/dcosdocs/mesosphere/dcos/services">DC/OS Services</a></li><li class="header-dropdown__item"><a href="https://support.d2iq.com">Support</a></li></ul></div><div class="layout__sidebar layout__drawer"><section class="sidebar"><header class="sidebar__header"><div class="sidebar__dropdown"><ul><li><a href="/dcosdocs/mesosphere/dcos/services/marathon-lb/1.14/mlb-reference">Marathon-LB 1.14.x</a></li><li><a href="/dcosdocs/mesosphere/dcos/services/marathon-lb/1.15/mlb-reference">Marathon-LB 1.15.x</a></li><li><a href="/dcosdocs/mesosphere/dcos/services/marathon-lb/1.13/mlb-reference">Marathon-LB 1.13.x</a></li></ul><div class="toggle"><p><span class="title">Marathon Lb</span><span class="version"> 1.13</span></p><i data-feather="chevron-down"></i></div></div></header><nav class="sidebar_nav" role="navigation"><ul><li><a class="d0" href="/dcosdocs/mesosphere/dcos/services/marathon-lb/1.13/release-notes/">Release notes</a></li><li><a class="d0" href="/dcosdocs/mesosphere/dcos/services/marathon-lb/1.13/mlb-install/">Installing Marathon-LB</a></li><li><a class="d0" href="/dcosdocs/mesosphere/dcos/services/marathon-lb/1.13/mlb-overview/">Marathon-LB overview</a></li><li><a class="d0" href="/dcosdocs/mesosphere/dcos/services/marathon-lb/1.13/mlb-configuration/">Working with templates and app labels</a></li><li><a class="d0" href="/dcosdocs/mesosphere/dcos/services/marathon-lb/1.13/mlb-basic-tutorial/">Tutorial - Basic external load balancing</a></li><li><a class="d0" href="/dcosdocs/mesosphere/dcos/services/marathon-lb/1.13/mlb-advanced-tutorial/">Tutorial - Internal and external load balancing</a></li><li><a class="d0" href="/dcosdocs/mesosphere/dcos/services/marathon-lb/1.13/mlb-scaling-tutorial/">Tutorial - Scaling apps using Marathon-LB statistics</a></li><li><a class="d0" href="/dcosdocs/mesosphere/dcos/services/marathon-lb/1.13/mlb-troubleshooting/">Troubleshooting Marathon-LB</a></li><li class="active active-on"><a class="d0" href="/dcosdocs/mesosphere/dcos/services/marathon-lb/1.13/mlb-reference/">Reference information</a></li></ul></nav><footer class="sidebar__footer"><div class="sidebar__footer-links"><a href="https://d2iq.com/terms/">Terms of Service</a><a href="https://d2iq.com/privacy/">Privacy Policy</a></div><a class="sidebar__footer-copyright" href="https://d2iq.com/">&copy; 2022 D2iQ, Inc. All rights reserved.</a></footer></section></div><div class="layout__content" role="main"><main class="content"><div class="content__container content__container--with-sections"><div class="content__header"><div class="content__header__row"><h1 class="content__header-title">Reference information</h1></div><h4 class="content__header-description">Marathon-LB endpoints, command-line reference, and configuration templates and labels</h4><div class="actions"><ul class="actions__list"><li class="actions__item"><button class="actions__link" onclick="javascript:window.print()"><i class="actions__icon" data-feather="printer"></i><span class="actions__text">Print</span></button></li><li class="actions__item"><a class="actions__link" href="https://github.com/mesosphere/dcos-docs-site/tree/main/pages/dcosdocs/mesosphere/dcos/services/marathon-lb/1.13/mlb-reference/index.md" target="_blank"><i class="actions__icon" data-feather="github"></i><span class="actions__text">Contribute</span></a></li></ul></div></div><article class="content__article"><!-- This source repo for this topic is https://github.com/dcos/dcos-docs -->
<h1 id="marathon-lb-haproxy-endpoints"><a class="content__anchor" href="#marathon-lb-haproxy-endpoints" aria-hidden="true"><i data-feather="bookmark"></i></a>Marathon-LB HAProxy endpoints</h1>
<p>Marathon-LB automatically generates configuration information for the HAProxy program, then reloads and restarts HAProxy, as needed. Marathon-LB generates the HAProxy configuration based on application data available from the Marathon API. It can also subscribe to the <a href="https://mesosphere.github.io/marathon/docs/event-bus.html">Marathon Event Bus</a> for real-time updates.</p>
<p>When an application starts, stops, relocates, or has any change in health status, Marathon-LB automatically regenerates the HAProxy configuration and reloads HAProxy.</p>
<p>Marathon-LB exposes the following endpoints on port <code>9090</code> by default.</p>
<table>
<thead>
<tr>
<th style="text-align:left"><b>Endpoint</b></th>
<th style="text-align:left"><b>Description</b></th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left"><code>public-node:9090/haproxy?stats</code></td>
<td style="text-align:left">The <strong>Statistics</strong> endpoint produces an HTML page that provides statistical information about the current HAProxy instance and its load balancing activity. You can view the statistics from this endpoint in your browser.</td>
</tr>
<tr>
<td style="text-align:left"><code>public-node:9090/haproxy?stats;csv</code></td>
<td style="text-align:left">The <strong>Statistics CSV</strong> endpoint provides statistical information about the current HAProxy instance and load balancing activity as comma-separated values (CSV). In CSV format, the information can be consumed by other tools. For example, this endpoint produces the results used in the <code>zdd.py</code> script.</td>
</tr>
<tr>
<td style="text-align:left"><code>public-node:9090/_haproxy_health_check</code></td>
<td style="text-align:left">The <strong>Health check</strong> endpoint returns 200 OK if HAProxy is healthy.</td>
</tr>
<tr>
<td style="text-align:left"><code>public-node:9090/_haproxy_getconfig</code></td>
<td style="text-align:left">The <strong>Configuration</strong> endpoint returns the HAProxy configuration file as it was when HAProxy was started. Implemented in <code>getconfig.lua</code>.</td>
</tr>
<tr>
<td style="text-align:left"><code>public-node:9090/_haproxy_getvhostmap</code></td>
<td style="text-align:left">The <strong>Virtual-host-to-backend</strong> endpoint returns the HAProxy virtual host to backend map if the <code>--haproxy-map</code> flag is enabled. If you are not using the <code>--haproxy-map</code> option, the endpoint returns an empty string. Implemented in <code>getmaps.lua</code>.</td>
</tr>
<tr>
<td style="text-align:left"><code>public-node:9090/_haproxy_getappmap</code></td>
<td style="text-align:left">The <strong>App-ID-to-backend</strong> endpoint returns the HAProxy application identifier to backend map. Like <code>_haproxy_getvhostmap</code>, this endpoint requires you to enable the <code>--haproxy-map</code> option and returns an empty string otherwise. Also implemented in <code>getmaps.lua</code>.</td>
</tr>
<tr>
<td style="text-align:left"><code>public-node:9090/_haproxy_getpids</code></td>
<td style="text-align:left">The <strong>Process identifiers</strong> endpoint returns the PIDs for all HAProxy instances within the current process namespace. The endpoint literally returns the output of $(<code>pidof haproxy</code>). Implemented in <code>getpids.lua</code>. This endpoint is also used by the <code>zdd.py</code> script to determine if connections have finished draining during a deployment.</td>
</tr>
<tr>
<td style="text-align:left"><code>public-node:9090/_mlb_signal/hup</code></td>
<td style="text-align:left">The <strong>Reload configuration</strong> endpoint sends a SIGHUP signal to the <code>marathon-lb</code> process, causing it to fetch the running apps from Marathon and reload the <code>HAProxy</code> configuration as though an event was received from Marathon.</td>
</tr>
<tr>
<td style="text-align:left"><code>public-node:9090/_mlb_signal/usr1</code></td>
<td style="text-align:left">The <strong>Restart configuration</strong> endpoint sends a <code>SIGUSR1</code> signal to the <code>marathon-lb</code> process, causing it to restart the <code>HAProxy</code> load balancer with the existing configuration, without checking Marathon for changes.</td>
</tr>
</tbody>
</table>
<p class="message--note"><strong>NOTE: </strong>The <code>/_mlb_signal/hup</code> and <code>/_mlb_signal/usr1</code> endpoints do not function if Marathon-LB is running in <code>poll</code> mode. With the <code>poll</code> argument, Marathon-LB exits after each poll, so there is no running <code>marathon_lb.py</code> process to be signaled.</p>
<h1 id="marathon-lb-command-reference"><a class="content__anchor" href="#marathon-lb-command-reference" aria-hidden="true"><i data-feather="bookmark"></i></a>Marathon-LB command reference</h1>
<p>Marathon-LB manages operations for the <code>HAProxy</code> program to provide high availability for applications running on high-volume websites. Marathon-LB relies on the <code>marathon_lb.py</code> script to perform the following key tasks:</p>
<ul>
<li>
<p>Connects to the Marathon API to retrieve information about all running apps.</p>
</li>
<li>
<p>Generates and validates the Marathon-LB <code>HAProxy</code> configuration file settings.</p>
</li>
<li>
<p>Reloads the <code>HAProxy</code> program.</p>
  <p>
  <img src="/dcosdocs/mesosphere/dcos/services/img/simple-mlb-haproxy.png" alt="Marathon-LB works with HAProxy configuration settings to provide load balancing">
  </p>
</li>
</ul>
<p>By default, Marathon-LB binds to the service port of every application and sends incoming requests to the application instances. Services are exposed on their service port as defined in their Marathon app definition. Furthermore, apps are only exposed on the load balancers that have the same load balancer <code>group</code> setting. The <code>group</code> setting is defined globally or in the app definition file by specifying the <code>HAPROXY_GROUP</code> label for individual applications.</p>
<h2 id="invoking-marathon-lb-directly"><a class="content__anchor" href="#invoking-marathon-lb-directly" aria-hidden="true"><i data-feather="bookmark"></i></a>Invoking marathon-lb directly</h2>
<p>In most cases, the <code>marathon_lb.py</code> script runs in the background. However, you can also run the script directly from the command-line. For example, you can generate the <code>HAProxy</code> configuration information from Marathon by running the <code>marathon_lb.py</code> script for <code>localhost:8080</code> with the following command:</p>
<pre><code>./marathon_lb.py --marathon http://localhost:8080 --group external --strict-mode --health-check
</code></pre>
<h2 id="specifying-credentials-when-running-marathon-lb"><a class="content__anchor" href="#specifying-credentials-when-running-marathon-lb" aria-hidden="true"><i data-feather="bookmark"></i></a>Specifying credentials when running marathon-lb</h2>
<p>If Marathon requires authentication, you can include a user name and password using the <code>--auth-credentials</code> configuration option. For example:</p>
<pre><code>./marathon_lb.py --marathon http://localhost:8080 --auth-credentials=admin:password
</code></pre>
<p>You can also provide credentials from the VAULT if you define the following environment variables before running Marathon-LB:</p>
<ul>
<li><code>VAULT_TOKEN</code></li>
<li><code>VAULT_HOST</code></li>
<li><code>VAULT_PORT</code></li>
<li><code>VAULT_PATH</code></li>
</ul>
<p>If you set these environment variables, you should set the <code>VAULT_PATH</code> to the root path where your user account and password are located.</p>
<h2 id="skipping-configuration-validation"><a class="content__anchor" href="#skipping-configuration-validation" aria-hidden="true"><i data-feather="bookmark"></i></a>Skipping configuration validation</h2>
<p>Running the <code>marathon-lb.py</code> script refreshes the <code>haproxy.cfg</code> configuration file. If there are any changes to the configuration file, the script automatically reloads the <code>HAProxy</code> program with the changes. You can skip the configuration file validation process if you don’t have <code>HAProxy</code> installed or if you are running <code>HAProxy</code> on Docker containers.</p>
<p>To skip validation of configuration settings, run the following command:</p>
<pre><code>./marathon_lb.py --marathon http://localhost:8080 --group external --skip-validation
</code></pre>
<h2 id="viewing-complete-usage-information"><a class="content__anchor" href="#viewing-complete-usage-information" aria-hidden="true"><i data-feather="bookmark"></i></a>Viewing complete usage information</h2>
<p>If you run the <code>marathon-lb.py</code> script directly from the command line, you can specify additional functionality such as sticky sessions, HTTP to HTTPS redirection, SSL offloading, virtual host support, and the configuration templates to use.</p>
<p>To get the full command reference, run the following command:</p>
<pre><code>./marathon_lb.py --help
</code></pre>
<h2 id="running-docker-commands-for-marathon-lb"><a class="content__anchor" href="#running-docker-commands-for-marathon-lb" aria-hidden="true"><i data-feather="bookmark"></i></a>Running Docker commands for Marathon-LB</h2>
<p>Marathon supports both Universal Container Runtime (using <code>cgroups</code>) and Docker containers and images. You can run Marathon-LB using a command similar to the following for Docker images:</p>
<pre><code>docker run -e PORTS=$portnumber --net=host mesosphere/marathon-lb ...
</code></pre>
<p>This command uses the <code>-e</code> option to set the <code>PORTS</code> environment variable. The port number is required to allow the <code>HAProxy</code> program bind to this port. The <code>-net</code> option enables the command to connect a container to a specified network.</p>
<p>For example, to expose load-balanced applications from a Docker image on port 9090, you might run the following command:</p>
<pre><code>docker run -e PORTS=9090 mesosphere/marathon-lb sse [other arguments]
</code></pre>
<h3 id="using-server-sent-events-sse"><a class="content__anchor" href="#using-server-sent-events-sse" aria-hidden="true"><i data-feather="bookmark"></i></a>Using server-sent events (sse)</h3>
<p>If you specify the <code>sse</code> option, the Marathon-LB script connects to the Marathon events endpoint to get notified about state changes.
You can use a command similar to the following to capture server-sent events (<code>sse</code>).</p>
<pre><code>docker run mesosphere/marathon-lb sse [other arguments]
</code></pre>
<h3 id="determining-the-current-status-for-marathon-lb-instances"><a class="content__anchor" href="#determining-the-current-status-for-marathon-lb-instances" aria-hidden="true"><i data-feather="bookmark"></i></a>Determining the current status for Marathon-LB instances</h3>
<p>If you can’t use the HTTP callbacks, you can run a command similar to the following to poll the scheduler state periodically:</p>
<pre><code>docker run mesosphere/marathon-lb poll [other args]
</code></pre>
<p>You can also use environment variables to set other configuration options for Marathon-LB. For example, you can set the <code>POLL_INTERVAL</code> environment variable to change the poll interval from its default of 60 seconds.</p>
<h2 id="usage-and-command-arguments"><a class="content__anchor" href="#usage-and-command-arguments" aria-hidden="true"><i data-feather="bookmark"></i></a>Usage and command arguments</h2>
<p>You can run the Marathon load balancer script (<code>marathon_lb.py</code>) directly from the command-line in a shell terminal or programmatically. The script accepts the following command-line options and arguments.</p>
<h3 id="usage"><a class="content__anchor" href="#usage" aria-hidden="true"><i data-feather="bookmark"></i></a>Usage</h3>
<pre>
marathon_lb.py [-h] [--longhelp] [--marathon MARATHON [MARATHON ...]]
                      [--haproxy-config HAPROXY_CONFIG] [--group GROUP]
                      [--command COMMAND]
                      [--max-reload-retries MAX_RELOAD_RETRIES]
                      [--reload-interval RELOAD_INTERVAL] [--strict-mode]
                      [--sse] [--archive-versions ARCHIVE_VERSIONS]
                      [--health-check]
                      [--lru-cache-capacity LRU_CACHE_CAPACITY]
                      [--haproxy-map] [--dont-bind-http-https]
                      [--group-https-by-vhost] [--ssl-certs SSL_CERTS]
                      [--skip-validation] [--dry]
                      [--min-serv-port-ip-per-task MIN_SERV_PORT_IP_PER_TASK]
                      [--max-serv-port-ip-per-task MAX_SERV_PORT_IP_PER_TASK]
                      [--syslog-socket SYSLOG_SOCKET]
                      [--log-format LOG_FORMAT] [--log-level LOG_LEVEL]
                      [--marathon-auth-credential-file MARATHON_AUTH_CREDENTIAL_FILE]
                      [--auth-credentials AUTH_CREDENTIALS]
                      [--dcos-auth-credentials DCOS_AUTH_CREDENTIALS]
                      [--marathon-ca-cert MARATHON_CA_CERT]
</pre>
<h3 id="required-arguments"><a class="content__anchor" href="#required-arguments" aria-hidden="true"><i data-feather="bookmark"></i></a>Required arguments</h3>
<table class="table">
  <tr>
    <th style="font-weight:bold">Argument</th>
    <th style="font-weight:bold">Description</th>
  </tr>
  <tr>
    <td><span style="background-color: #f2f2f2">-m, --marathon MARATHON [MARATHON ...]</span></td>
    <td>Specifies one or more Marathon endpoints. This argument specifies the location of the Marathon containers for Marathon-LB to use. The default endpoint is <span style="background-color: #f2f2f2">http://master.mesos:8080</span>. For example, you can use this argument to specify two Marathon instances like this: <span style="background-color: #f2f2f2">-m http://marathon1:8080 http://marathon2:8080</span>.</td>
  </tr>
  <tr>
    <td><span style="background-color: #f2f2f2">--group GROUP</span></td>
    <td>Generates configuration information only for the apps with the specified group names. Use `*` to match all groups, including groups without a group name specified. The default is an empty string.</td>
  </tr>
</table>
<h3 id="optional-arguments"><a class="content__anchor" href="#optional-arguments" aria-hidden="true"><i data-feather="bookmark"></i></a>Optional arguments</h3>
<table class="table">
  <tr>
    <th style="font-weight:bold">Argument</th>
    <th style="font-weight:bold">Description</th>
  </tr>
  <tr>
    <td><span style="background-color: #f2f2f2">-h, --help</span></td>
    <td>Show this help message and exit.</td>
  </tr>
  <tr>
    <td><span style="background-color: #f2f2f2">--longhelp</span></td>
    <td>Print out configuration details. The default is false.</td>
  </tr>
  <tr>
    <td><span style="background-color: #f2f2f2">--haproxy-config HAPROXY_CONFIG</span></td>
    <td>Specifies the location of the `haproxy` configuration file. The default is <span style="background-color: #f2f2f2">/etc/haproxy/haproxy.cfg</span></td>.
  </tr>
  <tr>
    <td><span style="background-color: #f2f2f2">--command COMMAND, -c COMMAND</span></td>
    <td>If set, run this command to reload haproxy. The default is none.</td>
  </tr>
  <tr>
    <td><span style="background-color: #f2f2f2">--max-reload-retries MAX_RELOAD_RETRIES</span></td>
    <td>Specifies the maximum number if reload retries before failure. Reloads happen every <span style="background-color: #f2f2f2">--reload-interval</span> seconds. Set to 0 to disable reloading attempts or -1 for infinite retries. The default is 10.</td>
  </tr>
  <tr>
    <td><span style="background-color: #f2f2f2">--reload-interval RELOAD_INTERVAL</span></td>
    <td>Waits the specified number of seconds between reload retries. The default is 10.</td>
  </tr>
  <tr>
    <td><span style="background-color: #f2f2f2">--strict-mode</span></td>
    <td>Enables backends to be advertised only if <span style="background-color: #f2f2f2">HAPROXY_{n}_ENABLED=true</span>. Strict mode might be enabled by default in a future release. The default is false.</td>
  </tr>
   <tr>
    <td><span style="background-color: #f2f2f2">--sse, -s</span></td>
    <td>Uses server-sent events. The default is false.</td>
  </tr>
  <tr>
    <td><span style="background-color: #f2f2f2">--archive-versions ARCHIVE_VERSIONS</span></td>
    <td>Specifies the number of configuration versions to archive. The default is 5.</td>
  </tr>
  <tr>
    <td><span style="background-color: #f2f2f2">--health-check, -H</span></td>
    <td>Determines Marathon's health check status before adding the app instance into the backend pool. The default is false.</td>
  </tr>
  <tr>
    <td><span style="background-color: #f2f2f2">--lru-cache-capacity LRU_CACHE_CAPACITY</span></td>
    <td>Specifies the LRU cache size (in number of items). This argument should be at least as large as the number of tasks exposed to marathon-lb. The default is 1000.</td>
  </tr>
  <tr>
    <td><span style="background-color: #f2f2f2">--haproxy-map</span></td>
    <td>Uses HAProxy maps for domain name to backend mapping. The default is false.</td>
  </tr>
  <tr>
    <td><span style="background-color: #f2f2f2">--dont-bind-http-https</span></td>
    <td>Prevents binding to HTTP and HTTPS frontends. The default is false.</td>
  </tr>
  <tr>
    <td><span style="background-color: #f2f2f2">--group-https-by-vhost</span></td>
    <td>Groups https frontends by virtual host. The default is false.</td>
  </tr>
  <tr>
    <td><span style="background-color: #f2f2f2">--ssl-certs SSL_CERTS</span></td>
    <td>Lists SSL certificates separated by commas for frontend <span style="background-color: #f2f2f2">marathon_https_in</span>. The default is <span style="background-color: #f2f2f2">/etc/ssl/cert.pem</span>. For example: <span style="background-color: #f2f2f2">/etc/ssl/site1.co.pem,/etc/ssl/site2.co.pem</span></td>
  </tr>
  <tr>
    <td><span style="background-color: #f2f2f2">--skip-validation</span></td>
    <td>Skips haproxy configuration file validation. The default is false.</td>
  </tr> 
  <tr>
    <td><span style="background-color: #f2f2f2">--dry, -d</span></td>
    <td>Only prints configuration information to the console. The default is false.</td>
  </tr> 
  <tr>
    <td><span style="background-color: #f2f2f2">--min-serv-port-ip-per-task MIN_SERV_PORT_IP_PER_TASK</span></td>
    <td>Specifies the minimum port number to use when auto-assigning service ports for IP-per-task applications. The default is 10050.</td>
  </tr> 
  <tr>
    <td><span style="background-color: #f2f2f2">--max-serv-port-ip-per-task MAX_SERV_PORT_IP_PER_TASK</span></td>
    <td>Specifies the maximum port number to use when auto-assigning service ports for IP-per-task applications. The default is 10100.</td>
  </tr> 
  <tr>
    <td><span style="background-color: #f2f2f2">--syslog-socket SYSLOG_SOCKET</span></td>
    <td>Specifies the socket to write syslog messages to. Use <span style="background-color: #f2f2f2">/dev/null</span> to disable logging to <span style="background-color: #f2f2f2">syslog</span>. The default is <span style="background-color: #f2f2f2">/dev/log</span>.</td>
  </tr> 
  <tr>
    <td><span style="background-color: #f2f2f2">-log-format LOG_FORMAT</span></td>
    <td>Sets the log message format. The default is <span style="background-color: #f2f2f2">%(asctime)-15s %(name)s: %(message)s</span>.</td>
  </tr> 
  <tr>
    <td><span style="background-color: #f2f2f2">--log-level LOG_LEVEL</span></td>
    <td>Sets the log level, The default is DEBUG.</td>
  </tr> 
  <tr>
    <td><span style="background-color: #f2f2f2">--marathon-auth-credential-file MARATHON_AUTH_CREDENTIAL_FILE</span></td>
    <td>Specifies the path to file containing a user name and password for the Marathon HTTP API in the format of <span style="background-color: #f2f2f2">user:pass</span>. The default is none.</td>
  </tr> 
  <tr>
    <td><span style="background-color: #f2f2f2">--auth-credentials AUTH_CREDENTIALS</span></td>
    <td>Specifies the user name and password for the Marathon HTTP API in the format of <span style="background-color: #f2f2f2">user:pass</span>. The default is none.</td>
  </tr> 
  <tr>
    <td><span style="background-color: #f2f2f2">--dcos-auth-credentials DCOS_AUTH_CREDENTIALS</span></td>
    <td>Specifies the DC/OS service account credentials. The default is none.</td>
  </tr> 
  <tr>
    <td><span style="background-color: #f2f2f2">--dcos-auth-credentials DCOS_AUTH_CREDENTIALS</span></td>
    <td>Specifies the DC/OS service account credentials. The default is none.</td>
  </tr> 
  <tr>
    <td><span style="background-color: #f2f2f2">--marathon-ca-cert MARATHON_CA_CERT</span></td>
    <td>Specifies the CA certificate for Marathon HTTPS connections. The default is none.</td>
  </tr> 
</table>
<h1 id="template-and-label-reference"><a class="content__anchor" href="#template-and-label-reference" aria-hidden="true"><i data-feather="bookmark"></i></a>Template and label reference</h1>
<p>The following is a list of the available <code>HAProxy</code> configuration <strong>templates</strong>. Some templates are global-only (such as <code>HAPROXY_HEAD</code>), but most can be specified on a per service port basis as <strong>app labels</strong> to override the global settings.</p>
<p>The templates and app labels that can be set per-service-port include an index identifier {n} in the template or label name. The index identifier corresponds to the service port index, beginning at 0, to which the app label applies. For example, you could specify <code>HAPROXY_0_BACKEND_HEAD</code> to override the global template <code>HAPROXY_BACKUP_HEAD</code> for the first port of a given application.</p>
<h2 id="backend-template-settings"><a class="content__anchor" href="#backend-template-settings" aria-hidden="true"><i data-feather="bookmark"></i></a>Backend template settings</h2>
<p>Use the following template and app labels to configure backend settings for the load balancer.</p>
<table class="table" style="table-layout: fixed">
<colgroup>
    <col span="1" width="45px">
    <col span="1" width="80px">
</colgroup>
<tr>
<th style="font-weight:bold">Template name</th>
<th style="font-weight:bold">Description and examples</th>
</tr>
<tbody valign="top">
<tr>
<td><code>HAPROXY_BACKEND_HEAD</code></td><td>Defines the type of load balancing and the connection mode for a backend. The default load balancing type (algorithm) is <code>roundrobin</code>. The default connection mode is <code>tcp</code>.
<p>The valid values for the load balancing type include:</p>
<ul>
<li><code>roundrobin</code> - Each server is used in turns, according to their weights.
This algorithm is dynamic and ensures processing time remains equally distributed.</li>
<li><code>static-rr</code> - Each server is used in turns, according to their weights.
This algorithm is as similar to roundrobin except that it is static.</li>
<li><code>leastconn</code> - The server with the least number of connections receives the next connection request.
Round-robin selection is performed within groups of servers that have the same load to ensure that all servers are used. This algorithm is recommended when long sessions, such as LDAP or SQL sessions are expected, is not appropriate for protocols using short sessions such as HTTP.</li>
<li><code>source</code> - The source IP address is hashed and divided by the total weight of the running servers to designate which server should receive the request.
This algorithm ensures that the same client IP address always reaches the same server as long as no server goes down or up. If the hash result changes because the number of running servers has changed, clients  are directed to a different server. This algorithm is generally used with TCP mode or for clients that refuse session cookies.</li>
<li><code>uri</code> - This algorithm hashes either the left part of the URI (before the question mark) or the whole URI (if the “whole” parameter is present) and divides the hash value by the total weight of the running servers.
The result designates which server receives the request.</li>
</ul>
<p>You can set the connection mode to <code>tcp</code>, <code>http</code>, or <code>health</code>.</p>
<p>The default template for <code>HAPROXY_BACKEND_HEAD</code> is:
<code>backend {backend}
balance {balance}
mode {mode}
</code></p>
<p>You can override this template using the following app label for the first port (<code>0</code>) of a given app:
<code>“HAPROXY_0_BACKEND_HEAD”: “\nbackend {backend}\n  balance {balance}\n  mode {mode}\n”</code></td></tr></p>
<tr><td><code>HAPROXY_BACKEND_HSTS<br>_OPTIONS</code></td><td>Specifies the backend options to use where the <code>HAPROXY_{n}_USE_HSTS</code> app label that enables the HSTS response header for HTTP clients is set to true. 
<p>The default template for <code>HAPROXY_BACKEND_HSTS_OPTIONS</code> is:
<code>rspadd Strict-Transport-Security:\ max-age=15768000</code></p>
<p>You can override this template using the following app label for the first port (<code>0</code>) of a given app:
<code>“HAPROXY_0_BACKEND_HSTS_OPTIONS”: &quot; rspadd Strict-Transport-Security:\ max-age=15768000\n&quot;</code></p>
</td></tr>
<tr><td><code>HAPROXY_BACKEND_HTTP<br>_HEALTHCHECK_OPTIONS</code></td><td>Sets HTTP health check options, such as the health check timeout interval and consecutive failures allowed. 
<p>The valid options for the first health check or the first health check for a given service are exposed as follows:</p>
<ul>
<li>healthCheckPortIndex</li>
<li>healthCheckPort</li>
<li>healthCheckProtocol</li>
<li>healthCheckPath</li>
<li>healthCheckTimeoutSeconds</li>
<li>healthCheckIntervalSeconds</li>
<li>healthCheckGracePeriodSeconds</li>
<li>healthCheckMaxConsecutiveFailures</li>
<li>healthCheckFalls (healthCheckMaxConsecutiveFailures + 1)</li>
<li>healthCheckPortOptions (port {healthCheckPort})</li>
</ul>
<p>The default template for <code>HAPROXY_BACKEND_HTTP_HEALTHCHECK_OPTIONS</code> is:
<code>option  httpchk GET {healthCheckPath
timeout check {healthCheckTimeoutSeconds}s</code></p>
<p>You can override this template using the following app label for the first port (<code>0</code>) of a given app:
<code style="word-break: break-word;">“HAPROXY_0_BACKEND_HTTP_HEALTHCHECK_OPTIONS”: &quot;  option  httpchk GET {healthCheckPath}\n  timeout check {healthCheckTimeoutSeconds}s\n&quot;</code></td></tr></p>
<tr><td><code>HAPROXY_BACKEND_HTTP<br>_OPTIONS</code></td><td>Sets HTTP headers, for example, X-Forwarded-For and X-Forwarded-Proto. 
<p>The default template for <code>HAPROXY_BACKEND_HTTP_OPTIONS</code> is:
<code>option forwardfor
http-request set-header X-Forwarded-Port %[dst_port]
http-request add-header X-Forwarded-Proto https if { ssl_fc }</code></p>
<p>You can override this template using the following app label for the first port (<code>0</code>) of a given app:
<code>“HAPROXY_0_BACKEND_HTTP_OPTIONS”: &quot;  option forwardfor\n  http-request set-header X-Forwarded-Port %[dst_port]\n  http-request add-header X-Forwarded-Proto https if { ssl_fc }\n&quot;</code></td></tr></p>
<tr><td><code>HAPROXY_BACKEND_REDIRECT<br>_HTTP_TO_HTTPS</code></td><td>Redirects backends if the HAPROXY_{n}_REDIRECT_TO_HTTPS label is set to true. 
<p>The default template for <code>HAPROXY_BACKEND_REDIRECT_HTTP_TO_HTTPS</code> is:
<code>redirect scheme https code 301 if !{{ ssl_fc }} host_{cleanedUpHostname}</code></p>
<p>You can override this template with the following app label for the first port (<code>0</code>) of a given app:
<code>HAPROXY_0_BACKEND_REDIRECT_HTTP_TO_HTTPS&quot;: &quot; redirect scheme https code 301 if !{{ ssl_fc }} host_{cleanedUpHostname}\n&quot;</code></td></tr></p>
<tr><td><code>HAPROXY_BACKEND_REDIRECT<br>_HTTP_TO_HTTPS_WITH_PATH</code></td><td>Redirects backends if the `HAPROXY_{n}_REDIRECT_TO_HTTPS_WITH_PATH` label is set to true, but includes a path. 
<p>The default template for <code style="word-break: break-word;">HAPROXY_BACKEND_REDIRECT_HTTP_TO_HTTPS_WITH_PATH</code> is:
<code>redirect scheme https code 301 if !{{ ssl_fc }} host_{cleanedUpHostname} path_{backend}</code></p>
<p>You can override this template with the following app label for the first port (<code>0</code>) of a given app:
<code style="word-break: break-word;">“HAPROXY_0_BACKEND_REDIRECT_HTTP_TO_HTTPS_WITH_PATH”: &quot; redirect scheme https code 301 if !{{ ssl_fc }} host_{cleanedUpHostname} path_{backend}\n&quot;</code></p>
</td></tr>
<tr><td><code>HAPROXY_BACKEND_SERVER<br>_HTTP_HEALTHCHECK_OPTIONS </code></td><td>Sets HTTP health check options, such as the health check timeout interval, for a single server. 
<p>The valid options for the first health check or the first health check for a given service are exposed as follows:</p>
<ul>
<li>healthCheckPortIndex</li>
<li>healthCheckPort</li>
<li>healthCheckProtocol</li>
<li>healthCheckPath</li>
<li>healthCheckTimeoutSeconds</li>
<li>healthCheckIntervalSeconds</li>
<li>healthCheckGracePeriodSeconds</li>
<li>healthCheckMaxConsecutiveFailures</li>
<li>healthCheckFalls (healthCheckMaxConsecutiveFailures + 1)</li>
<li>healthCheckPortOptions (port {healthCheckPort})</li>
</ul>
<p>The default template for <code>HAPROXY_BACKEND_SERVER_HTTP_HEALTHCHECK_OPTIONS</code> is:
<code> check inter {healthCheckIntervalSeconds}s fall {healthCheckFalls}{healthCheckPortOptions}</code></p>
<p>You can override this template with the following app label for the first port (<code>0</code>) of a given app:
<code>“HAPROXY_0_BACKEND_SERVER_HTTP_HEALTHCHECK_OPTIONS”: &quot;  check inter {healthCheckIntervalSeconds}s fall {healthCheckFalls}{healthCheckPortOptions}\n&quot;</code></td></tr></p>
<tr><td><code>HAPROXY_BACKEND_SERVER<br>_OPTIONS </code></td><td>Specifies the options for each server added to a backend. 
<p>The default template for HAPROXY_BACKEND_SERVER_OPTIONS is:
<code> server {serverName} {host_ipv4}:{port}{cookieOptions}{healthCheckOptions}{otherOptions}</code></p>
<p>You can override this template with the following app label for the first port (<code>0</code>) of a given app:
<code>“HAPROXY_0_BACKEND_SERVER_OPTIONS”: &quot;  server {serverName} {host_ipv4}:{port}{cookieOptions}{healthCheckOptions}{otherOptions}\n&quot;</code></td></tr></p>
<tr><td><code>HAPROXY_BACKEND_SERVER<br>_TCP_HEALTHCHECK<br>_OPTIONS </code></td><td>Sets TCP health check options, such as the health check timeout interval, for a single server.
<p>The valid options for the first health check or the first health check for a given service are exposed as follows:</p>
<ul>
<li>healthCheckPortIndex</li>
<li>healthCheckPort</li>
<li>healthCheckProtocol</li>
<li>healthCheckTimeoutSeconds</li>
<li>healthCheckIntervalSeconds</li>
<li>healthCheckGracePeriodSeconds</li>
<li>healthCheckMaxConsecutiveFailures</li>
<li>healthCheckFalls (healthCheckMaxConsecutiveFailures + 1)</li>
<li>healthCheckPortOptions (port {healthCheckPort})</li>
</ul>
<p>The default template for <code>HAPROXY_BACKEND_SERVER_TCP_HEALTHCHECK_OPTIONS</code> is:
<code>check inter {healthCheckIntervalSeconds}s fall {healthCheckFalls}{healthCheckPortOptions}</code></p>
<p>You can override this template with the following app label for the first port (<code>0</code>) of a given app:
<code>“HAPROXY_0_BACKEND_SERVER_TCP_HEALTHCHECK_OPTIONS”: &quot;  check inter {healthCheckIntervalSeconds}s fall {healthCheckFalls}{healthCheckPortOptions}\n&quot;</code></td></tr></p>
<tr><td><code>HAPROXY_BACKEND_STICKY_OPTIONS </code></td><td>Sets a cookie for services where HAPROXY_{n}_STICKY is true.
<p>The default template for <code>HAPROXY_BACKEND_STICKY_OPTIONS</code> is:
<code> cookie mesosphere_server_id insert indirect nocache</code></p>
<p>You can override this template with the following app label for the first port (<code>0</code>) of a given app:
<code>“HAPROXY_0_BACKEND_STICKY_OPTIONS”: &quot;  cookie mesosphere_server_id insert indirect nocache\n&quot;</code></td></tr></p>
<tr><td><code>HAPROXY_BACKEND_TCP<br>_HEALTHCHECK_OPTIONS </code></td><td>Sets TCP health check options,such as the timeout check. 
<p>The valid options for the first health check or the first health check for a given service are exposed as follows:</p>
<ul>
<li>healthCheckPortIndex</li>
<li>healthCheckPort</li>
<li>healthCheckProtocol</li>
<li>healthCheckTimeoutSeconds</li>
<li>healthCheckIntervalSeconds</li>
<li>healthCheckGracePeriodSeconds</li>
<li>healthCheckMaxConsecutiveFailures</li>
<li>healthCheckFalls (healthCheckMaxConsecutiveFailures + 1)</li>
<li>healthCheckPortOptions (port {healthCheckPort})</li>
</ul>
<p>The default template for <code>HAPROXY_BACKEND_TCP_HEALTHCHECK_OPTIONS</code> is an empty string.</p>
<p>The following example sets a timeout check:
<code> timeout check {healthCheckTimeoutSeconds}s</code></p>
<p>You can override this template with the following app label for the first port (<code>0</code>) of a given app:
<code>“HAPROXY_0_BACKEND_TCP_HEALTHCHECK_OPTIONS”: “”</code></td></tr></p>
<tr><td><code>HAPROXY_HTTPS_GROUPED<br>_VHOST_BACKEND_HEAD </code></td><td>Defines the HTTPS backend for vhost. 
<p>You must enable the <code>group-https-by-vhost</code> option to use this setting. This template is a global template that cannot be modified by service port or per application.</p>
<p>The default template for <code>HAPROXY_HTTPS_GROUPED_VHOST_BACKEND_HEAD</code> is:
<code>backend {name}
server loopback-for-tls abns@{name} send-proxy-v2</code></td></tr></p>
<tr><td><code>HAPROXY_HTTP_BACKEND<br>_ACL_ALLOW_DENY </code></td><td>Denies access for all IP addresses (or IP ranges) that are not explicitly allowed to access the HTTP backend. Use this template with HAPROXY_HTTP_BACKEND_NETWORK_ALLOWED_ACL. This template is a global template that cannot be modified by service port or per application. 
<p>The default template for <code>HAPROXY_HTTP_BACKEND_ACL_ALLOW_DENY</code> is:
<code> http-request allow if network_allowed
http-request deny</code></td></tr></p>
<tr><td><code>HAPROXY_HTTP_BACKEND<br>_NETWORK_ALLOWED_ACL </code></td><td>Specifies the IP addresses (or IP  ranges) that have access to the HTTP backend. This template is a global template that cannot be modified by service port or per application. 
<p>The default template for <code>HAPROXY_HTTP_BACKEND_NETWORK_ALLOWED_ACL</code> is:
<code>acl network_allowed src {network_allowed}</code></p>
<p>You can override this template with the following app label for the first port (<code>0</code>) of a given app:
<code>“HAPROXY_0_HTTP_BACKEND_NETWORK_ALLOWED_ACL”: &quot;  acl network_allowed src {network_allowed}\n&quot;</code></td></tr></p>
<tr><td><code>HAPROXY_HTTP_BACKEND<br>_PROXYPASS_GLUE</code></td><td>Specifies the backend glue for HAPROXY_{n}_HTTP_BACKEND_PROXYPASS_PATH. 
<p>The default template for <code>HAPROXY_HTTP_BACKEND_PROXYPASS_GLUE</code> is:
<code>http-request set-header Host {hostname}
reqirep  “^([^ :]<em>)\ {proxypath}/?(.</em>)” “\1\ /\2” </code></p>
<p>You can override this template with the following app label for the first port (<code>0</code>)of a given app:
<code>“HAPROXY_0_HTTP_BACKEND_PROXYPASS_GLUE”: &quot;  http-request set-header Host {hostname}\n  reqirep  “^([^ :]<em>)\ {proxypath}/?(.</em>)” “\1\ /\2”\n&quot;</code></td></tr></p>
<tr><td><code>HAPROXY_HTTP_BACKEND_REDIR </code></td><td>Sets the path to which you want to redirect the root of the domain. 
<p>The default template for <code>HAPROXY_HTTP_BACKEND_REDIR</code> is:
<code>acl is_root path -i /
acl is_domain hdr(host) -i {hostname}
redirect code 301 location {redirpath} if is_domain is_root</code></p>
<p>You can override this template with the following app label for the first port (<code>0</code>) of a given app:
<code>“HAPROXY_0_HTTP_BACKEND_REDIR”: &quot;  acl is_root path -i /\n  acl is_domain hdr(host) -i {hostname}\n  redirect code 301 location {redirpath} if is_domain is_root\n&quot;</code></td></tr></p>
<tr><td><code>HAPROXY_HTTP_BACKEND<br>_REVPROXY_GLUE </code></td><td>Specifies the backend glue for HAPROXY_{n}_HTTP_BACKEND_REVPROXY_PATH. 
<p>The default template for <code>HAPROXY_HTTP_BACKEND_REVPROXY_GLUE</code> is:
<code>acl hdr_location res.hdr(Location) -m found
rspirep “^Location: (https?://{hostname}(:[0-9]+)?)?(/.*)” “Location:   {rootpath} if hdr_location”</code></p>
<p>You can override this template with the following app label for the first port (<code>0</code>)of a given app:
<code>“HAPROXY_0_HTTP_BACKEND_REVPROXY_GLUE”: &quot;  acl hdr_location res.hdr(Location) -m found\n  rspirep “^Location: (https?://{hostname}(:[0-9]+)?)?(/.*)” “Location:   {rootpath} if hdr_location”\n&quot;</code></td></tr></p>
<tr><td><code>HAPROXY_TCP_BACKEND<br>_ACL_ALLOW_DENY </code></td><td>Denies access for all IP addresses (or IP address ranges) that are not explicitly allowed to access the TCP backend. This global template cannot be overridden by service port or application. 
<p>The default template for <code>HAPROXY_TCP_BACKEND_ACL_ALLOW_DENY</code> is:
<code>tcp-request content accept if network_allowed
tcp-request content reject</code></td></tr></p>
<tr><td><code>HAPROXY_TCP_BACKEND<br>_NETWORK_ALLOWED_ACL </code></td><td>Specifies the IP addresses (or IP address ranges) that have been granted access to the TCP backend. 
<p>The default template for <code>HAPROXY_TCP_BACKEND_NETWORK_ALLOWED_ACL</code> is:
<code>acl network_allowed src {network_allowed}</code></p>
<p>You can override this template with the following app label for the first port (<code>0</code>) of a given app:
<code>“HAPROXY_0_TCP_BACKEND_NETWORK_ALLOWED_ACL”: &quot;  acl network_allowed src {network_allowed}\n&quot;</code></td></tr></p>
</tbody>
</table>
<h2 id="frontend-template-settings"><a class="content__anchor" href="#frontend-template-settings" aria-hidden="true"><i data-feather="bookmark"></i></a>Frontend template settings</h2>
<p>Use the following template and app labels to configure frontend settings for the load balancer.</p>
<table class="table" style="table-layout: fixed">
<colgroup>
    <col span="1" width="45px">
    <col span="1" width="80px">
</colgroup>
<tr>
<th style="font-weight:bold">Template name</th>
<th style="font-weight:bold">Description and examples</th>
</tr>
<tbody valign="top">
<tr><td><code>HAPROXY_FRONTEND_BACKEND_GLUE </code></td><td>Glues the backend to the frontend. 
<p>The default template for <code>HAPROXY_FRONTEND_BACKEND_GLUE</code> is:
<code> use_backend {backend}</code></p>
<p>You can override this template with the following app label for the first port (<code>0</code>) of a given app:
<code>“HAPROXY_0_FRONTEND_BACKEND_GLUE”: &quot;  use_backend {backend}\n&quot;</code></td></tr></p>
<tr><td><code>HAPROXY_FRONTEND_HEAD </code></td><td>Defines the address and port to bind to for this frontend. 
<p>The default template for <code>HAPROXY_FRONTEND_HEAD</code> is:
<code>frontend {backend}
bind {bindAddr}:{servicePort}{sslCert}{bindOptions}
mode {mode}</code></p>
<p>You can override this template with the following app label for the first port (<code>0</code>) of a given app:
<code>“HAPROXY_0_FRONTEND_HEAD”: “\nfrontend {backend}\n  bind {bindAddr}:{servicePort}{sslCert}{bindOptions}\n  mode {mode}\n”</code></td></tr></p>
<tr><td><code>HAPROXY_HTTPS_FRONTEND<br>_ACL </code></td><td>Specifies the ACL that performs the SNI based hostname matching for the HAPROXY_HTTPS_FRONTEND_HEAD template. 
<p>The default template for <code>HAPROXY_HTTPS_FRONTEND_ACL</code> is:
<code>use_backend {backend} if {{ ssl_fc_sni {hostname} }}</code></p>
<p>You can override this template with the following app label for the first port (<code>0</code>) of a given app:
<code>“HAPROXY_0_HTTPS_FRONTEND_ACL”: &quot;  use_backend {backend} if {{ ssl_fc_sni {hostname} }}\n&quot;</code></td></tr></p>
<tr><td><code>HAPROXY_HTTPS_FRONTEND<br>_ACL_ONLY_WITH_PATH </code></td><td>Defines the access control list (ACL) frontend that matches a particular host name with a path. This template is similar to HTTP_FRONTEND_ACL_ONLY_WITH_PATH, but is only applicable for HTTPS requests.
<p>The default template for <code>HAPROXY_HTTPS_FRONTEND_ACL_ONLY_WITH_PATH</code> is:
<code>acl path_{backend} path_beg {path}</code></p>
<p>You can override this template with the following app label for the first port (<code>0</code>) of a given app:
<code>“HAPROXY_0_HTTPS_FRONTEND_ACL_ONLY_WITH_PATH”: &quot;  acl path_{backend} path_beg {path}\n&quot;</code></td></tr></p>
<tr><td><code>HAPROXY_HTTPS_FRONTEND<br>_ACL_WITH_AUTH </code></td><td>Specifies the access control list (ACL) that glues a backend to the corresponding virtual host of the HAPROXY_HTTPS_FRONTEND_HEAD through HTTP Basic authentication. 
<p>The default template for <code>HAPROXY_HTTPS_FRONTEND_ACL_WITH_AUTH</code> is:
<code> acl auth_{cleanedUpHostname} http_auth(user_{backend})
http-request auth realm “{realm}” if {{ ssl_fc_sni {hostname} }} !auth_{cleanedUpHostname}
use_backend {backend} if {{ ssl_fc_sni {hostname} }}</code></p>
<p>You can override this template with the following app label for the first port (<code>0</code>) of a given app:
<code>“HAPROXY_0_HTTPS_FRONTEND_ACL_WITH_AUTH”: &quot;  acl auth_{cleanedUpHostname} http_auth(user_{backend})\n  http-request auth realm “{realm}” if {{ ssl_fc_sni {hostname} }} !auth_{cleanedUpHostname}\n  use_backend {backend} if {{ ssl_fc_sni {hostname} }}\n&quot;</code></td></tr></p>
<tr><td><code>HAPROXY_HTTPS_FRONTEND<br>_ACL_WITH_AUTH<br>_AND_PATH</td><td>Specifies the ACL that glues a backend to the corresponding virtual host with path of the HAPROXY_HTTPS_FRONTEND_HEAD through HTTP Basic authentication. 
<p>The default template for <code>HAPROXY_HTTPS_FRONTEND_ACL_WITH_AUTH_AND_PATH</code> is:
<code> acl auth_{cleanedUpHostname} http_auth(user_{backend})
http-request auth realm “{realm}” if {{ ssl_fc_sni {hostname} }} path_{backend} !auth_{cleanedUpHostname}
use_backend {backend} if {{ ssl_fc_sni {hostname} }} path_{backend}</code></p>
<p>You can override this template with the following app label for the first port (<code>0</code>) of a given app:
<code>“HAPROXY_0_HTTPS_FRONTEND_ACL_WITH_AUTH_AND_PATH”: &quot;  acl auth_{cleanedUpHostname} http_auth(user_{backend})\n  http-request auth realm “{realm}” if {{ ssl_fc_sni {hostname} }} path_{backend} !auth_{cleanedUpHostname}\n  use_backend {backend} if {{ ssl_fc_sni {hostname} }} path_{backend}\n&quot;</code></td></tr></p>
<tr><td><code>HAPROXY_HTTPS_FRONTEND<br>_ACL_WITH_PATH </code></td><td>Specifies the ACL that performs the SNI based hostname matching with path for the HAPROXY_HTTPS_FRONTEND_HEAD template. 
<p>The default template for <code>HAPROXY_HTTPS_FRONTEND_ACL_WITH_PATH</code> is:
<code> use_backend {backend} if {{ ssl_fc_sni {hostname} }} path_{backend}</code></p>
<p>You can override this template with the following app label for the first port (<code>0</code>) of a given app:
<code>“HAPROXY_0_HTTPS_FRONTEND_ACL_WITH_PATH”: &quot;  use_backend {backend} if {{ ssl_fc_sni {hostname} }} path_{backend}\n&quot;</code></td></tr></p>
<tr><td><code>HAPROXY_HTTPS_FRONTEND<br>_AUTH_ACL_ONLY </code></td><td>Specifies the HTTP authentication ACL for the corresponding virtual host. 
<p>The default template for <code>HAPROXY_HTTPS_FRONTEND_AUTH_ACL_ONLY</code> is:
<code> acl auth_{cleanedUpHostname} http_auth(user_{backend})<code></p>
<p>You can override this template with the following app label for the first port (<code>0</code>) of a given app:
<code>“HAPROXY_0_HTTPS_FRONTEND_AUTH_ACL_ONLY”: &quot;  acl auth_{cleanedUpHostname} http_auth(user_{backend})\n&quot;</code></td></tr></p>
<tr><td><code>HAPROXY_HTTPS_FRONTEND<br>_AUTH_REQUEST_ONLY </code></td><td>Specifies the HTTP authentication request forthe corresponding virtual host. 
<p>The default template for <code>HAPROXY_HTTPS_FRONTEND_AUTH_REQUEST_ONLY</code> is:
<code> http-request auth realm “{realm}” if {{ ssl_fc_sni {hostname} }} !auth_{cleanedUpHostname}</code></p>
<p>You can override this template with the following app label for the first port (<code>0</code>) of a given app:
<code>“HAPROXY_0_HTTPS_FRONTEND_AUTH_REQUEST_ONLY”: &quot;  http-request auth realm “{realm}” if {{ ssl_fc_sni {hostname} }} !auth_{cleanedUpHostname}\n&quot;</code></td></tr></p>
<tr><td><code>HAPROXY_HTTPS_FRONTEND_HEAD </code></td><td>Specifies an HTTPS frontend for encrypted connections that binds to port *:443 by default and gathers all virtual hosts as defined by the HAPROXY_{n}_VHOST label. This template is a global template that cannot be modified by service port or per application.
<p>You must modify this template setting if you want to include your SSL certificate. The default template for <code>HAPROXY_HTTPS_FRONTEND_HEAD</code> is:
<code>frontend marathon_https_in
bind *:443 ssl {sslCerts}
mode http</code></td></tr></p>
<tr><td><code>HAPROXY_HTTPS_FRONTEND<br>_ROUTING_ONLY_WITH<br>_PATH_AND_AUTH </code></td><td>Works in combination with HAPROXY_HTTP_FRONTEND_ACL_ONLY_WITH_PATH to glue ACL names to the appropriate backend. 
The default template for `HAPROXY_HTTPS_FRONTEND_ROUTING_ONLY_WITH_PATH_AND_AUTH` is:
<code> http-request auth realm "{realm}" if host_{cleanedUpHostname} path_{backend} !auth_{cleanedUpHostname}
  use_backend {backend} if host_{cleanedUpHostname} path_{backend}</code>
<p>You can override this template with the following app label for the first port (<code>0</code>) of a given app:
<code>“HAPROXY_0_HTTPS_FRONTEND_ROUTING_ONLY_WITH_PATH_AND_AUTH”: &quot;  http-request auth realm “{realm}” if host_{cleanedUpHostname} path_{backend} !auth_{cleanedUpHostname}\n  use_backend {backend} if host_{cleanedUpHostname} path_{backend}\n&quot;</code></td></tr></p>
<tr><td><code>HAPROXY_HTTPS_GROUPED<br>_FRONTEND_HEAD </code></td><td>Defines the HTTPS frontend for encrypted connections that binds to port *:443 by default and gathers all virtual hosts as defined by the HAPROXY_{n}_VHOST label. This template is useful for adding client certificates per domain. 
<p>You must enable the <code>group-https-by-vhost</code> option to use this setting. This template is a global template that cannot be modified by service port or per application.</p>
<p>The default template for <code>HAPROXY_HTTPS_GROUPED_FRONTEND_HEAD</code> is:
<code>frontend marathon_https_in
bind *:443
mode tcp
tcp-request inspect-delay 5s
tcp-request content accept if { req_ssl_hello_type 1 }</code></td></tr></p>
<tr><td><code>HAPROXY_HTTPS_GROUPED<br>_VHOST_FRONTEND_ACL </code></td><td>Specifies a route rule HTTPS entrypoint. 
<p>You must enable the <code>group-https-by-vhost</code> option to use this setting. This template is a global template that cannot be modified by service port or per application.</p>
<p>The default template for <code>HAPROXY_HTTPS_GROUPED_VHOST_FRONTEND_ACL</code> is:
<code> use_backend {backend} if {{ req_ssl_sni -i {host} }}</code></td></tr></p>
<tr><td><code>HAPROXY_HTTPS_GROUPED<br>_VHOST_FRONTEND_HEAD </code></td><td>Specifies the HTTPS frontend for the virtual host. 
<p>You must enable the <code>group-https-by-vhost</code> option to use this setting. This template is a global template that cannot be modified by service port or per application. The default template for <code>HAPROXY_HTTPS_GROUPED_VHOST_FRONTEND_HEAD</code> is:
<code>frontend {name}
mode http
bind abns@{name} accept-proxy ssl {sslCerts}{bindOpts}</code></td></tr></p>
<tr><td><code>HAPROXY_HTTP_FRONTEND_ACL </code></td><td>Specifies the access control list (ACL) that glues a backend to the corresponding virtual host of the HAPROXY_HTTP_FRONTEND_HEAD. 
<p>The default template for <code>HAPROXY_HTTP_FRONTEND_AC</code>L` is:
<code> acl host_{cleanedUpHostname} hdr(host) -i {hostname}
use_backend {backend} if host_{cleanedUpHostname}</code></p>
<p>You can override this template with the following app label for the first port (<code>0</code>) of a given app:
<code>“HAPROXY_0_HTTP_FRONTEND_ACL”: &quot;  acl host_{cleanedUpHostname} hdr(host) -i {hostname}\n  use_backend {backend} if host_{cleanedUpHostname}\n&quot;</code></td></tr></p>
<tr><td><code>HAPROXY_HTTP_FRONTEND<br>_ACL_ONLY </code></td><td>Defines the access control list (ACL) that matches a particular host name. Unlike HAPROXY_HTTP_FRONTEND_ACL, this template only includes the ACL portion. It does not glue the access control list (ACL) to the backend. You should only use this template if you have multiple virtual hosts routing to the same backend. 
<p>The default template for <code>HAPROXY_HTTP_FRONTEND_ACL_ONLY</code> is:
<code> acl host_{cleanedUpHostname} hdr(host) -i {hostname}</code></p>
<p>You can override this template with the following app label for the first port (<code>0</code>) of a given app:
<code>“HAPROXY_0_HTTP_FRONTEND_ACL_ONLY”: &quot;  acl host_{cleanedUpHostname} hdr(host) -i {hostname}\n&quot;</code></td></tr></p>
<tr><td><code>HAPROXY_HTTP_FRONTEND<br>_ACL_ONLY_WITH_PATH </code></td><td>Defines the access control list (ACL) that matches a particular host name with a path. Unlike HAPROXY_HTTP_FRONTEND_ACL_WITH_PATH, this template only includes the ACL portion. It does not glue the access control list (ACL) to the backend. You should only use this template if you have multiple virtual hosts routing to the same backend. 
<p>The default template for <code>HAPROXY_HTTP_FRONTEND_ACL_ONLY_WITH_PATH</code> is:
<code> acl path_{backend} path_beg {path} </code></p>
<p>You can override this template with the following app label for the first port (<code>0</code>) of a given app:
<code>“HAPROXY_0_HTTP_FRONTEND_ACL_ONLY_WITH_PATH”: &quot; acl path_{backend} path_beg {path}\n&quot;</code></td></tr></p>
<tr><td><code>HAPROXY_HTTP_FRONTEND<br>_ACL_ONLY_WITH<br>_PATH_AND_AUTH </code></td><td>Defines the access control list (ACL) that matches a particular host name with a path and authentication method. Unlike HAPROXY_HTTP_FRONTEND_ACL_WITH_PATH, this template only includes the ACL portion. It does not glue the access control list (ACL) to the backend. You should only use this template if you have multiple virtual hosts routing to the same backend. 
<p>The default template for <code>HAPROXY_HTTP_FRONTEND_ACL_ONLY_WITH_PATH_AND_AUTH</code> is:
<code>acl path_{backend} path_beg {path}
acl auth_{cleanedUpHostname} http_auth(user_{backend})</code></p>
<p>You can override this template with the following app label for the first port (<code>0</code>) of a given app:
<code>“HAPROXY_0_HTTP_FRONTEND_ACL_ONLY_WITH_PATH_AND_AUTH”: &quot;  acl path_{backend} path_beg {path}\n  acl auth_{cleanedUpHostname} http_auth(user_{backend})\n&quot;</code></td></tr></p>
<tr><td><code>HAPROXY_HTTP_FRONTEND<br>_ACL_WITH_AUTH </code></td><td>Specifies the access control list (ACL) that glues a backend to the corresponding virtual host specified by the HAPROXY_HTTP_FRONTEND_HEAD setting through HTTP Basic authentication. 
<p>The default template for <code>HAPROXY_HTTP_FRONTEND_ACL_WITH_AUTH</code> is:
<code>
acl host_{cleanedUpHostname} hdr(host) -i {hostname}
acl auth_{cleanedUpHostname} http_auth(user_{backend})
http-request auth realm “{realm}” if host_{cleanedUpHostname} !auth_{cleanedUpHostname}
use_backend {backend} if host_{cleanedUpHostname}<code></p>
<p>You can override this template with the following app label for the first port (<code>0</code>) of a given app:
<code>“HAPROXY_0_HTTP_FRONTEND_ACL_WITH_AUTH”: &quot;  acl host_{cleanedUpHostname} hdr(host) -i {hostname}\n  acl auth_{cleanedUpHostname} http_auth(user_{backend})\n  http-request auth realm “{realm}” if host_{cleanedUpHostname} !auth_{cleanedUpHostname}\n  use_backend {backend} if host_{cleanedUpHostname}\n&quot;</code></td></tr></p>
<tr><td><code>HAPROXY_HTTP_FRONTEND<br>_ACL_WITH_AUTH<br>_AND_PATH </code></td><td>Specifies the access control list (ACL) that glues a backend to the corresponding virtual host with the path specified by the HAPROXY_HTTP_FRONTEND_HEAD setting through HTTP Basic authentication. 
<p>The default template for <code>HAPROXY_HTTP_FRONTEND_ACL_WITH_AUTH_AND_PATH</code> is:
<code>
acl host_{cleanedUpHostname} hdr(host) -i {hostname}
acl auth_{cleanedUpHostname} http_auth(user_{backend})
acl path_{backend} path_beg {path}
http-request auth realm “{realm}” if host_{cleanedUpHostname} path_{backend} !auth_{cleanedUpHostname}
use_backend {backend} if host_{cleanedUpHostname} path_{backend}</code></p>
<p>You can override this template with the following app label for the first port (<code>0</code>) of a given app:
<code>“HAPROXY_0_HTTP_FRONTEND_ACL_WITH_AUTH_AND_PATH”: &quot;  acl host_{cleanedUpHostname} hdr(host) -i {hostname}\n  acl auth_{cleanedUpHostname} http_auth(user_{backend})\n  acl path_{backend} path_beg {path}\n  http-request auth realm “{realm}” if host_{cleanedUpHostname} path_{backend} !auth_{cleanedUpHostname}\n  use_backend {backend} if host_{cleanedUpHostname} path_{backend}\n&quot;</code></td></tr></p>
<tr><td><code>HAPROXY_HTTP_FRONTEND<br>_ACL_WITH_PATH </code></td><td>Specifies the access control list (ACL) that glues a backend to the corresponding virtual host with the path specified by the HAPROXY_HTTP_FRONTEND_HEAD setting. 
<p>The default template for <code>HAPROXY_HTTP_FRONTEND_ACL_WITH_PATH</code> is:
<code>acl host_{cleanedUpHostname} hdr(host) -i {hostname}
acl path_{backend} path_beg {path}
use_backend {backend} if host_{cleanedUpHostname} path_{backend}</code></p>
<p>You can override this template with the following app label for the first port (<code>0</code>) of a given app:
<code>“HAPROXY_0_HTTP_FRONTEND_ACL_WITH_PATH”: &quot;  acl host_{cleanedUpHostname} hdr(host) -i {hostname}\n  acl path_{backend} path_beg {path}\n  use_backend {backend} if host_{cleanedUpHostname} path_{backend}\n&quot;</code></td></tr></p>
<tr><td><code>HAPROXY_HTTP_FRONTEND<br>_APPID_ACL </code></td><td>Specifies the access control list (ACL) that glues a backend to the corresponding app specified by the HAPROXY_HTTP_FRONTEND_APPID_HEAD setting. 
<p>The default template for <code>HAPROXY_HTTP_FRONTEND_APPID_ACL</code> is:
<code>acl app_{cleanedUpAppId} hdr(x-marathon-app-id) -i {appId}
use_backend {backend} if app_{cleanedUpAppId}</code></p>
<p>You can override this template with the following app label for the first port (<code>0</code>) of a given app:
<code>“HAPROXY_0_HTTP_FRONTEND_APPID_ACL”: &quot;  acl app_{cleanedUpAppId} hdr(x-marathon-app-id) -i {appId}\n  use_backend {backend} if app_{cleanedUpAppId}\n&quot;</code></td></tr></p>
<tr><td><code>HAPROXY_HTTP_FRONTEND<br>_APPID_HEAD </code></td><td>Specifies the HTTP frontend that binds to port *:9091 by default and gathers all apps in HTTP mode. To use this frontend to forward to your app, configure the app with HAPROXY_0_MODE=http then you can access it via a call to the :9091 with the header "X-Marathon-App-Id" set to the Marathon AppId. Note multiple HTTP ports being exposed by the same marathon app are not supported. Only the first HTTP port is available using this frontend. 
<p>This template is a global template that cannot be modified by service port or per application.</p>
<p>The default template for <code>HAPROXY_HTTP_FRONTEND_APPID_HEAD</code> is:
<code>frontend marathon_http_appid_in
bind *:9091
mode http</code></td></tr></p>
<tr><td><code>HAPROXY_HTTP_FRONTEND_HEAD </code></td><td>Specifies the HTTP frontend that binds to port *:80 by default and gathers all virtual hosts as defined by the HAPROXY_{n}_VHOST label. This template is a global template that cannot be modified by service port or per application. 
<p>The default template for <code>HAPROXY_HTTP_FRONTEND_HEAD</code> is:
<code>frontend marathon_http_in
bind *:80
mode http</code></td></tr></p>
<tr><td><code>HAPROXY_HTTP_FRONTEND<br>_ROUTING_ONLY </code></td><td>Works in combination with the HAPROXY_HTTP_FRONTEND_ACL_ONLY setting to map access control list (ACL) names to their appropriate backends. 
<p>The default template for <code>HAPROXY_HTTP_FRONTEND_ROUTING_ONLY</code> is:
<code> use_backend {backend} if host_{cleanedUpHostname}</code></p>
<p>You can override this template with the following app label for the first port (<code>0</code>) of a given app:
<code>“HAPROXY_0_HTTP_FRONTEND_ROUTING_ONLY”: &quot;  use_backend {backend} if host_{cleanedUpHostname}\n&quot;</code></td></tr></p>
<tr><td><code>HAPROXY_HTTP_FRONTEND<br>_ROUTING_ONLY_WITH_AUT </code></td><td>Works in combination with the HAPROXY_HTTP_FRONTEND_ACL_ONLY setting to map the access control list name to the appropriate backend and to add HTTP Basic authentication. 
<p>The default template for <code>HAPROXY_HTTP_FRONTEND_ROUTING_ONLY_WITH_AUTH</code> is:
<code>acl auth_{cleanedUpHostname} http_auth(user_{backend})
http-request auth realm “{realm}” if host_{cleanedUpHostname} !auth_{cleanedUpHostname}
use_backend {backend} if host_{cleanedUpHostname}</code></p>
<p>You can override this template with the following app label for the first port (<code>0</code>) of a given app:
<code>“HAPROXY_0_HTTP_FRONTEND_ROUTING_ONLY_WITH_AUTH”: &quot;  acl auth_{cleanedUpHostname} http_auth(user_{backend})\n  http-request auth realm “{realm}” if host_{cleanedUpHostname} !auth_{cleanedUpHostname}\n  use_backend {backend} if host_{cleanedUpHostname}\n&quot;</code></td></tr></p>
<tr><td><code>HAPROXY_HTTP_FRONTEND<br>_ROUTING_ONLY_WITH_PATH</code></td><td>Works in combination with the HAPROXY_HTTP_FRONTEND_ACL_ONLY_WITH_PATH setting to map access control list (ACL) names to the appropriate backend. 
<p>The default template for <code>HAPROXY_HTTP_FRONTEND_ROUTING_ONLY_WITH_PATH</code> is:
<code>use_backend {backend} if host_{cleanedUpHostname} path_{backend}</code></p>
<p>You can override this template with the following app label for the first port (<code>0</code>) of a given app:
<code>“HAPROXY_0_HTTP_FRONTEND_ROUTING_ONLY_WITH_PATH”: &quot;  use_backend {backend} if host_{cleanedUpHostname} path_{backend}\n&quot;</code></td></tr></p>
<tr><td><code>HAPROXY_HTTP_FRONTEND<br>_ROUTING_ONLY_WITH<br>_PATH_AND_AUTH </code></td><td>Works in combination with the HAPROXY_HTTP_FRONTEND_ACL_ONLY_WITH_PATH setting to map access control list names to the appropriate backend. 
<p>The default template for <code>HAPROXY_HTTP_FRONTEND_ROUTING_ONLY_WITH_PATH_AND_AUTH</code> is:
<code>http-request auth realm “{realm}” if host_{cleanedUpHostname} path_{backend} !auth_{cleanedUpHostname}
use_backend {backend} if host_{cleanedUpHostname} path_{backend}</code></p>
<p>You can override this template with the following app label for the first port (<code>0</code>) of a given app:
<code>“HAPROXY_0_HTTP_FRONTEND_ROUTING_ONLY_WITH_PATH_AND_AUTH”: &quot;  http-request auth realm “{realm}” if host_{cleanedUpHostname} path_{backend} !auth_{cleanedUpHostname}\n  use_backend {backend} if host_{cleanedUpHostname} path_{backend}\n&quot;</code></td></tr></p>
<tr><td><code>HAPROXY_MAP_HTTPS<br>_FRONTEND_ACL </code></td><td>Specifies the access control list (ACL) that performs the SNI-based host name matching for the HAPROXY_HTTPS_FRONTEND_HEAD template using HAProxy maps. 
<p>The default template for <code>HAPROXY_MAP_HTTPS_FRONTEND_ACL</code> is:
<code>use_backend %[ssl_fc_sni,lower,map({haproxy_dir}/domain2backend.map)</code></p>
<p>You can override this template with the following app label for the first port (<code>0</code>) of a given app:
<code>“HAPROXY_0_MAP_HTTPS_FRONTEND_ACL”: &quot;  use_backend %[ssl_fc_sni,lower,map({haproxy_dir}/domain2backend.map)]\n&quot;</code></td></tr></p>
<tr><td><code>HAPROXY_MAP_HTTP<br>_FRONTEND_ACL </code></td><td>Specifies the access control list (ACL) that glues a backend to the corresponding virtual host specified by the HAPROXY_HTTP_FRONTEND_HEAD setting using HAProxy maps. 
<p>The default template for <code>HAPROXY_MAP_HTTP_FRONTEND_ACL</code> is:
<code style="word-break: break-word;">use_backend %[req.hdr(host),lower,regsub(:.*$,),map({haproxy_dir}/domain2backend.map)</code></p>
<p>You can override this template with the following app label for the first port (<code>0</code>) of a given app:
<code style="word-break: break-word;">“HAPROXY_0_MAP_HTTP_FRONTEND_ACL”: &quot;  use_backend %[req.hdr(host),lower,regsub(:.*$,),map({haproxy_dir}/domain2backend.map)]\n&quot;</code></td></tr></p>
<tr><td><code>HAPROXY_MAP_HTTP<br>_FRONTEND_ACL_ONLY </code></td><td> Defines the access control list (ACL) that matches a particular host name, You should only use this template if you have multiple virtual hosts routing to the same backend in the HAProxy map. 
<p>The default template for <code>HAPROXY_MAP_HTTP_FRONTEND_ACL_ONLY</code> is:
<code style="word-break: break-word;">use_backend %[req.hdr(host),lower,regsub(:.*$,),map({haproxy_dir}/domain2backend.map)</code></p>
<p>You can override this template with the following app label for the first port (<code>0</code>) of a given app:
<code style="word-break: break-word;">“HAPROXY_0_MAP_HTTP_FRONTEND_ACL_ONLY”: &quot;  use_backend %[req.hdr(host),lower,regsub(:.*$,),map({haproxy_dir}/domain2backend.map)]\n&quot;</code></td></tr></p>
<tr><td><code>HAPROXY_MAP_HTTP<br>_FRONTEND_APPID_ACL </code></td><td>Specifies the access control list (ACL) that glues a backend to the corresponding app specified by the HAPROXY_HTTP_FRONTEND_APPID_HEAD setting using HAProxy maps. 
<p>The default template for <code>HAPROXY_MAP_HTTP_FRONTEND_APPID_ACL</code> is:
<code>use_backend %[req.hdr(x-marathon-app-id),lower,map({haproxy_dir}/app2backend.map)</code></p>
<p>You can override this template with the following app label for the first port (<code>0</code>) of a given app:
<code>“HAPROXY_0_MAP_HTTP_FRONTEND_APPID_ACL”: &quot;  use_backend %[req.hdr(x-marathon-app-id),lower,map({haproxy_dir}/app2backend.map)]\n&quot;</code></p>
</td></tr>
</tbody>
</table>
<h2 id="user-authentication-list-setting"><a class="content__anchor" href="#user-authentication-list-setting" aria-hidden="true"><i data-feather="bookmark"></i></a>User authentication list setting</h2>
<p>Use the following template and app label to configure basic user name and password settings for the load balancer.</p>
<table class="table" style="table-layout: fixed">
<colgroup>
    <col span="1" width="45px">
    <col span="1" width="80px">
</colgroup>
<tr>
<th style="font-weight:bold">Template name</th>
<th style="font-weight:bold">Description and examples</th>
</tr>
<tbody valign="top">
<tr><td><code>HAPROXY_USERLIST_HEAD </code></td><td>Specifies the user list for HTTP Basic authentication. 
<p>The default template for <code>HAPROXY_USERLIST_HEAD</code> is:
<code>userlist user_{backend}
user {user} password {passwd}</code></p>
<p>You can override this template with the following app label for the first port (<code>0</code>) of a given app:
<code>“HAPROXY_0_USERLIST_HEAD”: “\nuserlist user_{backend}\n  user {user} password {passwd}\n”</code></td></tr></p>
</tbody>
</table>
<h2 id="global-header-settings"><a class="content__anchor" href="#global-header-settings" aria-hidden="true"><i data-feather="bookmark"></i></a>Global header settings</h2>
<p>Use the following template to configure default header settings for the load balancer.</p>
<table class="table" style="table-layout: fixed">
<colgroup>
    <col span="1" width="45px">
    <col span="1" width="80px">
</colgroup>
<tr>
<th style="font-weight:bold">Template name</th>
<th style="font-weight:bold">Description and examples</th>
</tr>
<tbody valign="top">
<tr><td><code>HAPROXY_HEAD </code></td><td>Specifies header information for the HAProxy configuration file. This template contains global settings and defaults. This template cannot be overridden by service port or application-based settings.
<p>The default template for <code>HAPROXY_HEAD</code> is:</p>
<pre>
global
  log /dev/log local0
  log /dev/log local1 notice
  spread-checks 5
  max-spread-checks 15000
  maxconn 50000
  tune.ssl.default-dh-param 2048
  ssl-default-bind-ciphers ECDHE-ECDSA-AES128-GCM-SHA256:ECDHE-RSA-AES128-GCM-SHA256:ECDHE-ECDSA-AES256-GCM-SHA384:ECDHE-RSA-AES256-GCM-SHA384:DHE-RSA-AES128-GCM-SHA256:DHE-RSA-AES256-GCM-SHA384:ECDHE-ECDSA-AES128-SHA256:ECDHE-RSA-AES128-SHA256:ECDHE-ECDSA-AES256-SHA384:ECDHE-RSA-AES256-SHA384:DHE-RSA-AES128-SHA256:DHE-RSA-AES256-SHA256:AES128-GCM-SHA256:AES256-GCM-SHA384:AES128-SHA256:AES256-SHA256:!aNULL:!MD5:!DSS
  ssl-default-bind-options no-sslv3 no-tlsv10 no-tls-tickets
  ssl-default-server-ciphers ECDHE-ECDSA-AES128-GCM-SHA256:ECDHE-RSA-AES128-GCM-SHA256:ECDHE-ECDSA-AES256-GCM-SHA384:ECDHE-RSA-AES256-GCM-SHA384:DHE-RSA-AES128-GCM-SHA256:DHE-RSA-AES256-GCM-SHA384:ECDHE-ECDSA-AES128-SHA256:ECDHE-RSA-AES128-SHA256:ECDHE-ECDSA-AES256-SHA384:ECDHE-RSA-AES256-SHA384:DHE-RSA-AES128-SHA256:DHE-RSA-AES256-SHA256:AES128-GCM-SHA256:AES256-GCM-SHA384:AES128-SHA256:AES256-SHA256:!aNULL:!MD5:!DSS
  ssl-default-server-options no-sslv3 no-tlsv10 no-tls-tickets
  stats socket /var/run/haproxy/socket expose-fd listeners
  server-state-file global
  server-state-base /var/state/haproxy/
  lua-load /marathon-lb/getpids.lua
  lua-load /marathon-lb/getconfig.lua
  lua-load /marathon-lb/getmaps.lua
  lua-load /marathon-lb/signalmlb.lua
defaults
  load-server-state-from-file global
  log               global
  retries                   3
  backlog               10000
  maxconn               10000
  timeout connect          3s
  timeout client          30s
  timeout server          30s
  timeout tunnel        3600s
  timeout http-keep-alive  1s
  timeout http-request    15s
  timeout queue           30s
  timeout tarpit          60s
  option            dontlognull
  option            http-server-close
  option            redispatch
listen stats
  bind 0.0.0.0:9090
  balance
  mode http
  stats enable
  monitor-uri /_haproxy_health_check
  acl getpid path /_haproxy_getpids
  http-request use-service lua.getpids if getpid
  acl getvhostmap path /_haproxy_getvhostmap
  http-request use-service lua.getvhostmap if getvhostmap
  acl getappmap path /_haproxy_getappmap
  http-request use-service lua.getappmap if getappmap
  acl getconfig path /_haproxy_getconfig
  http-request use-service lua.getconfig if getconfig

  acl signalmlbhup path /_mlb_signal/hup
  http-request use-service lua.signalmlbhup if signalmlbhup
  acl signalmlbusr1 path /_mlb_signal/usr1
  http-request use-service lua.signalmlbusr1 if signalmlbusr1
  </pre>
  </td></tr>
</tbody>
</table>
<h2 id="additional-application-labels"><a class="content__anchor" href="#additional-application-labels" aria-hidden="true"><i data-feather="bookmark"></i></a>Additional application labels</h2>
<p>You can use the following labels to configure additional application settings.</p>
<table>
  <colgroup>
    <col span="1" width="20px">
    <col span="1" width="60px">
  </colgroup>
  <tr>
    <th style="font-weight:bold">Label name</th>
    <th style="font-weight:bold">Description and examples</th>
  </tr>
  <tbody valign="top">
    <tr>
    <td><code>HAPROXY_{n}_AUTH</code></td>
    <td>Specifies the HTTP authentication method to use for the application on the given service port index. 
<p>For example, you can use this label to specify the realm name for Basic authentication:</p>
  <code>
    HAPROXY_0_AUTH = realm:username:encryptedpassword
  </code>
<p>For details on configuring authentication methods, see <a href="https://github.com/mesosphere/marathon-lb/wiki/HTTP-Basic-Auth">HTTP Basic authentication</a></td></p>
  </tr>
  <tr><td><code>HAPROXY_{n}_BACKEND_<br>HEALTHCHECK_PORT_<br>INDEX</code></td>
  <td>Sets the index of the port to use as the dedicated port for the backend health checks associated with a given service port. By default, the index for the backend health check is the same as the index used for the service port.
<p>For example, if an app exposes two ports–<code>9000</code> and <code>9001</code>–you can specify one port for application activity, and one port for for receiving health check information:</p>
<p><code>portMappings&quot;: [
{ “containerPort”: 9000, “hostPort”: 0, “servicePort”: 0, “protocol”: “tcp” },
{ “containerPort”: 9001, “hostPort”: 0, “servicePort”: 0, “protocol”: “tcp” }
</code></p>
<p>You can then specify that you want to use port 9001 to perform the backend health checks:</p>
  <code>
  HAPROXY_0_BACKEND_HEALTHCHECK_PORT_INDEX=1
  </code> </td>
</tr>
<tr><td><code>HAPROXY_{n}_BACKEND<br>_NETWORK_ALLOWED_ACL</code></td> 
<td>Sets the IP addresses (or IP address ranges) that have been granted access to the backend.  
<p>For example, you could set the following app label to restrict access to the specified IP addresses <code>10.1.40.0/24</code> and <code>10.1.55.43</code>:</p>
<code>
HAPROXY_0_BACKEND_NETWORK_ALLOWED_ACL = '10.1.40.0/24 10.1.55.43'
</code>
<p>By default, every IP address is allowed.</p>
</td>
</tr>
<tr><td><code>HAPROXY_{n}_BACKEND_<br>WEIGHT</code></td>
<td>Specifies the order in which to enforce permissions if there are multiple backends sharing the access control lists for virtual hosts and paths. For example, if you are using a virtual host and have path access control lists that are shared by multiple backends, the order of the ACLs affects how permissions are granted for the application. 
<p>With <code>HAPROXY_{n}_BACKEND_WEIGHT</code>, you can change the order used to evaluated the ACLs by specifying a weight. The ACLs for the backends are then applied from largest to smallest weight.</p>
<p>If you don’t specify a value, the default weight of zero (0) is used. By default, any backends that use <code>HAPROXY_{n}_PATH</code> will have a weight of 1.</p>
<p><code>HAPROXY_0_BACKEND_WEIGHT = 1</code></p>
</td>
</tr>
<tr><td><code>HAPROXY_{n}_BALANCE</code></td>
<td>Sets the load balancing algorithm to be used in a backend. The default is `roundrobin`. 
<p>For example:</p>
<code>
HAPROXY_0_BALANCE = 'leastconn'
</code></td>
</tr>
<tr><td><code>HAPROXY_{n}_BIND_ADDR</code></td>
<td>Binds the load balancer to the specific address for the service. 
<p>For example:</p>
<code>
HAPROXY _0_BIND_ADDR = '10.0.0.42'
</code>
</td>
</tr>
<tr><td><code>HAPROXY_{n}_BIND_<br>OPTIONS</code></td><td>Sets additional bind options.
<p>For example:</p>
<code>
HAPROXY_0_BIND_OPTIONS = 'ciphers AES128+EECDH:AES128+EDH force-tlsv12 no-sslv3 no-tlsv10'
</code></td>
</tr>
<tr><td><code>HAPROXY_DEPLOYMENT<br>_ALT_PORT</code></td>
<td>Specifies an alternate service port to be used during a blue/green deployment.</td>
</tr>
<tr><td><code>HAPROXY_DEPLOYMENT<br>_COLOUR</code></td>
<td>Specifies the color to use for blue/green deployment. This label is used if you run the `bluegreen_deploy.py` script to determine the state of a deployment. You generally do not need to modify this label setting unless you implement your own deployment orchestrator.</td>
</tr>
<tr><td><code>HAPROXY_DEPLOYMENT<br>_GROUP</code></td>
<td>Specifies the deployment group to which this app belongs.</td>
</tr>
<tr><td><code>HAPROXY_DEPLOYMENT<br>_STARTED_AT</code></td>
<td>Specifies the time at which a deployment started. You generally do not need to modify this unless you implement your own deployment orchestrator.</td></tr>
<tr><td><code>HAPROXY_DEPLOYMENT_<br>TARGET_INSTANCES</code></td>
<td>Specifies the target number of app instances to seek during deployment. You generally do not need to modify this unless you implement your own deployment orchestrator.</td>
</tr>
<tr><td><code>HAPROXY_{n}_ENABLED</code></td>
<td>Enables this backend. By default, all backends are enabled. To disable backends by default, specify the `--strict-mode` option. 
<p>For example:</p>
<p><code>HAPROXY_0_ENABLED = true</code></td></p>
</tr>
<tr><td><code>HAPROXY_{n}_GROUP</code></td>
<td>Specifies the HAProxy group per service. This app label enables you to use a different HAProxy group per service port. This label setting overrides `HAPROXY_GROUP` for the particular service. If you have both external and internal services running on same set of instances on different ports, you can use this setting to add them to different HAProxy configurations. 
<p>For example:</p>
<code> 
HAPROXY_0_GROUP = 'external'
HAPROXY_1_GROUP = 'internal'
</code>
<p>If you run <code>marathon_lb</code> with the <code>--group</code> external option, the command adds the service on <code>HAPROXY_0_PORT</code> (or the first service port if <code>HAPROXY_0_HOST</code> is not configured) to the HAProxy configuration.</p>
<p>Similarly, if you run <code>marathon-lb</code> with the <code>--group</code> internal, the command adds the service on <code>HAPROXY_1_PORT</code> to the HAProxy configuration. If the HAProxy configuration includes a combination of <code>HAPROXY_GROUP</code> and <code>HAPROXY_{n}_GROUP</code> settings, the more specific definition takes precedence.</p>
<p>For example, you might have a load balancing configuration where a service running on <code>HAPROXY_0_PORT</code> is associated with just the ‘external’ HAProxy group and not the ‘internal’ HAProxy group.</p>
<code>
HAPROXY_0_GROUP = 'external' 
HAPROXY_GROUP = 'internal'
</code>
<p>In this example, there is no group setting defined for the second service. With this configuration, <code>marathon-lb</code> falls back to using the default <code>HAPROXY_GROUP</code>, which is then associated with the <code>internal</code> HAPorxy group. Load balancers with the group set to ‘*’ collect all groups.</td></p>
</tr>
<tr><td><code>HAPROXY_{n}_HTTP_<br>BACKEND_PROXYPASS_<br>PATH</code></td>
<td>Sets the location to use for mapping local server URLs to remote servers + URL.
<p>For example:</p>
<p><code>HAPROXY_0_HTTP_BACKEND_PROXYPASS_PATH = ‘/path/to/redirect’</code></td></p>
</tr>
<tr><td><code>HAPROXY_{n}_HTTP_<br>BACKEND_REVPROXY_PATH</code></td>
<td>Sets the URL in HTTP response headers sent from a reverse proxied server. This label only updates the Location, Content-Location, and URL fields. 
<p>For example:</p>
<p><code>HAPROXY_0_HTTP_BACKEND_REVPROXY_PATH = ‘/my/content’</code></td></p>
</tr>
<tr><td><code>HAPROXY_{n}_MODE</code></td>
<td>Sets the connection mode to either TCP or HTTP. The default is TCP. 
<p>The following exceptions apply:
If you don’t specify the <code>HAPROXY_{n}_VHOST</code> label and have not set <code>HAPROXY_{n}_MODE</code>, the mode is set to <code>http</code>.</p>
<p>If you have configured a health check for the given port and the protocol field is set to one of ‘HTTP’, ‘HTTPS’, ‘MESOS_HTTP’, ‘MESOS_HTTPS’, the mode is overridden to ‘http’, regardless of the value of the <code>HAPROXY_{n}_MODE</code> label. For example:</p>
<code>
HAPROXY_0_MODE = 'http'
</code></td>
</tr>
<tr><td><code>HAPROXY_{n}_PATH</code></td>
<td>Specifies the HTTP path to match, starting at the beginning. You can specify multiple paths separated by spaces. The syntax matches that of the `path_beg` configuration option used in other templates and labels. 
<p>To use the path routing, you must also define a virtual host.</p>
<p>If you have multiple backends which share virtual hosts or paths, you can manually specify the order of the backend ACLs with the <code>HAPROXY_{n}_BACKEND_WEIGHT</code> setting. For HAProxy, the use_backend directive is evaluated in the order it appears in the configuration.</p>
<p>For example:<br>
<code>
HAPROXY_0_PATH = '/v2/api/derp’
HAPROXY_0_PATH = ‘-i /multiple /paths’
</code></td></p>
</tr>
<tr><td><code>HAPROXY_{n}_PORT</code></td>
<td>Binds to the specified port number for the service. This setting overrides the servicePort which has to be unique. For example:
<code>
HAPROXY_0_PORT = 80
</code></td>
</tr>
<tr><td><code>HAPROXY_{n}_REDIRECT_<br>TO_HTTPS</code></td>
<td>Redirects HTTP traffic to HTTPS. Requires at least one virtual host be set. For example:
<code> 
HAPROXY_0_REDIRECT_TO_HTTPS = true
</code></td>
</tr>
<tr><td><code>HAPROXY_{n}_SSL_CERT</code></td>
<td>Enables the given SSL certificate for TLS/SSL traffic. 
For example:
<code> 
HAPROXY_0_SSL_CERT = '/etc/ssl/cert.pem'
</code></td>
</tr>
<tr><td><code>HAPROXY_{n}_STICKY</code></td>
<td>Enables sticky request routing for the service. For example:
<p><code>HAPROXY_0_STICKY = true
</code></td></p>
</tr>
<tr><td><code>HAPROXY_{n}_USE_HSTS</code></td>
<td>Enables the HSTS response header for the HTTP clients that support it. For example:
<p><code>HAPROXY_0_USE_HSTS = true</code></td></p>
</tr>
<tr><td><code>HAPROXY_{n}_VHOST</code></td>
<td>Specifies the Marathon HTTP virtual host proxy host name(s) to gather. 
<p>If you have multiple backends that share the same virtual host names or paths, you might need to manually specify the appropriate order to use for the backend access control lists using the <code>HAPROXY_{n}_BACKEND_WEIGHT</code> setting. The HAProxy <code>use_backend</code> directive is evaluated in the order it appears in the configuration.</p>
<p>For example:</p>
<code>
HAPROXY_0_VHOST = 'marathon.mesosphere.com'<br>
HAPROXY_0_VHOST = 'marathon.mesosphere.com,marathon'
</code>
</td></tr>
</tbody>
</table>
</article></div><aside class="content__sections"><div class="content__sections-list-container"><ul class="content__sections-list"><li class="content__sections-item content__sections-item--h1"><a href="#marathon-lb-haproxy-endpoints">Marathon-LB HAProxy endpoints</a></li><li class="content__sections-item content__sections-item--h1"><a href="#marathon-lb-command-reference">Marathon-LB command reference</a></li><li class="content__sections-item content__sections-item--h2"><a href="#invoking-marathon-lb-directly">Invoking marathon-lb directly</a></li><li class="content__sections-item content__sections-item--h2"><a href="#specifying-credentials-when-running-marathon-lb">Specifying credentials when running marathon-lb</a></li><li class="content__sections-item content__sections-item--h2"><a href="#skipping-configuration-validation">Skipping configuration validation</a></li><li class="content__sections-item content__sections-item--h2"><a href="#viewing-complete-usage-information">Viewing complete usage information</a></li><li class="content__sections-item content__sections-item--h2"><a href="#running-docker-commands-for-marathon-lb">Running Docker commands for Marathon-LB</a></li><li class="content__sections-item content__sections-item--h2"><a href="#usage-and-command-arguments">Usage and command arguments</a></li><li class="content__sections-item content__sections-item--h1"><a href="#template-and-label-reference">Template and label reference</a></li><li class="content__sections-item content__sections-item--h2"><a href="#backend-template-settings">Backend template settings</a></li><li class="content__sections-item content__sections-item--h2"><a href="#frontend-template-settings">Frontend template settings</a></li><li class="content__sections-item content__sections-item--h2"><a href="#user-authentication-list-setting">User authentication list setting</a></li><li class="content__sections-item content__sections-item--h2"><a href="#global-header-settings">Global header settings</a></li><li class="content__sections-item content__sections-item--h2"><a href="#additional-application-labels">Additional application labels</a></li></ul></div></aside></main></div></div><script src="/assets/js/jquery-3.2.1.js"></script><script src="/assets/js/clipboard.js"></script><script src="/assets/js/prism.js"></script><script src="/js/main.js"></script></body></html>