<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width" initial-scale="1" user-scalable="no"><title>Configuration - D2iQ Docs</title><meta name="description" content="Configuring Couchbase for production and development"><link rel="apple-touch-icon" sizes="180x180" href="/assets/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/favicon-16x16.png"><link rel="stylesheet" type="text/css" href="/css/styles.css"><link rel="search" type="application/opensearchdescription+xml" href="/assets/opensearch.xml" title="Search"><link href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,500,500i,700,700i" rel="stylesheet"><script src="https://unpkg.com/feather-icons/dist/feather.min.js"></script><script>window.analytics||(window.analytics=[]),window.analytics.methods=["identify","track","trackLink","trackForm","trackClick","trackSubmit","page","pageview","ab","alias","ready","group","on","once","off"],window.analytics.factory=function(t){return function(){var a=Array.prototype.slice.call(arguments);return a.unshift(t),window.analytics.push(a),window.analytics}};for(var i=0;i<window.analytics.methods.length;i++){var method=window.analytics.methods[i];window.analytics[method]=window.analytics.factory(method)}window.analytics.load=function(t){var a=document.createElement("script");a.type="text/javascript",a.async=!0,a.src=("https:"===document.location.protocol?"https://":"http://")+"d2dq2ahtl5zl1z.cloudfront.net/analytics.js/v1/"+t+"/analytics.min.js";var n=document.getElementsByTagName("script")[0];n.parentNode.insertBefore(a,n)},window.analytics.SNIPPET_VERSION="2.0.8",
window.analytics.load("7sgtwqvuai");
window.analytics.page();</script><noscript><iframe src="//www.googletagmanager.com/ns.html?id=GTM-PBJ84KX" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript><script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src='//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
})(window,document,'script','dataLayer','GTM-PBJ84KX');</script></head><body><div class="layout"><header class="header"><a class="header__drawer"><i class="header__icon" data-feather="menu"></i></a><a class="header__logo" href="/"><img class="header__logo--mobile" src="/assets/D2iQ_Logotype_Color_Positive_Documentation.svg" alt="D2IQ"><img class="header__logo--desktop" src="/assets/D2iQ_Logotype_Color_Positive_Documentation.svg" alt="D2IQ"></a><div class="header__main"><div class="header__dropdown"><img class="header__dropdown-icon" src="/assets/D2IQ_Logotype_Color_Positive.png" alt="D2iQ"><strong>Couchbase Documentation</strong><i data-feather="chevron-down"></i></div><nav class="header__menu"><ul class="header__menu-list"><li class="header__menu-item"><a href="https://support.d2iq.com">Support</a></li></ul></nav></div><div class="chooser" id="spherer"><div class="chooser-current"><a class="chooser-title">Mesosphere</a><svg class="chooser-svg" id="spherer-svg"><path class="pointer" d="m 13,6 -5,5 -5,-5 z" fill="#858585"></path></svg></div><ul class="chooser-list" id="spherer-list"><li class="chooser-list-item"><a href="/mesosphere/dcos">DC/OS</a></li><li class="chooser-list-item"><a href="/dcosdocs/mesosphere/dcos/services">DC/OS Services</a></li></ul></div><div class="chooser" id="ks"><div class="chooser-current"><a class="chooser-title">DKP</a><svg class="chooser-svg" id="kspherer-svg"><path class="pointer" d="m 13,6 -5,5 -5,-5 z" fill="#858585"></path></svg></div><ul class="chooser-list" id="kspherer-list"><li class="chooser-list-item"><a href="/dkp/konvoy">Konvoy</a></li><li class="chooser-list-item"><a href="/dkp/kommander">Kommander</a></li><li class="chooser-list-item"><a href="/dkp/dispatch">Dispatch</a></li><li class="chooser-list-item"><a href="/dkp/kaptain">Kaptain</a></li></ul></div><div class="chooser" id="localizer"><div class="chooser-current"><a class="chooser-title">English</a><svg class="chooser-svg" id="localizer-svg"><path class="pointer" d="m 13,6 -5,5 -5,-5 z" fill="#858585"></path></svg></div><ul class="chooser-list" id="localizer-list"><li class="chooser-list-item"><a href="/dcosdocs/mesosphere/dcos/cn/services">中文 (简体)</a></li></ul></div><section class="header__search" role="search"><form class="header__search-form" action="/search/"><input class="header__search-input" id="header-search-input" tabindex="1" type="text" name="q" placeholder="Search"><input type="hidden" name="hFR[scope][0]" value="DC/OS Services"><label class="header__search-label" for="header-search-input"><i class="header__icon" data-feather="search"></i></label></form></section></header><div class="header-dropdown"><ul class="header-dropdown__list"><li class="header-dropdown__top-item"><div>DKP</div></li><li class="header-dropdown__item"><a href="/dkp/konvoy">Konvoy</a></li><li class="header-dropdown__item"><a href="/dkp/kommander">Kommander</a></li><li class="header-dropdown__item"><a href="/dkp/dispatch">Dispatch</a></li><li class="header-dropdown__item"><a href="/dkp/kaptain">Kaptain</a></li><li class="header-dropdown__top-item"><div>Mesosphere</div></li><li class="header-dropdown__item header-dropdown__item--active"><a href="/mesosphere/dcos">DC/OS</a></li><li class="header-dropdown__item header-dropdown__item--active"><a href="/dcosdocs/mesosphere/dcos/services">DC/OS Services</a></li><li class="header-dropdown__item"><a href="https://support.d2iq.com">Support</a></li></ul></div><div class="layout__sidebar layout__drawer"><section class="sidebar"><header class="sidebar__header"><div class="sidebar__dropdown"><ul><li><a href="/dcosdocs/mesosphere/dcos/services/couchbase/1.0.1-6.0.0/configuration">Couchbase 1.0.1-6.0.0</a></li><li><a href="/dcosdocs/mesosphere/dcos/services/couchbase/1.0.0-6.0.0/configuration">Couchbase 1.0.0-6.0.0</a></li><li><a href="/dcosdocs/mesosphere/dcos/services/couchbase/0.3.0-5.5.3/configuration">Couchbase 0.3.0-5.5.3</a></li><li><a href="/dcosdocs/mesosphere/dcos/services/couchbase/0.2.0-5.5.0/configuration">Couchbase 0.2.0-5.5.0</a></li></ul><div class="toggle"><p><span class="title">Couchbase</span><span class="version"> 0.2.0-5.5.0</span></p><i data-feather="chevron-down"></i></div></div></header><nav class="sidebar_nav" role="navigation"><ul><li><a class="d0" href="/dcosdocs/mesosphere/dcos/services/couchbase/0.2.0-5.5.0/getting-started/">Getting Started</a></li><li class="active active-on"><a class="d0" href="/dcosdocs/mesosphere/dcos/services/couchbase/0.2.0-5.5.0/configuration/">Configuration</a></li><li><a class="d0" href="/dcosdocs/mesosphere/dcos/services/couchbase/0.2.0-5.5.0/operations/">Operations</a></li><li><a class="d0" href="/dcosdocs/mesosphere/dcos/services/couchbase/0.2.0-5.5.0/security/">Security</a></li><li><a class="d0" href="/dcosdocs/mesosphere/dcos/services/couchbase/0.2.0-5.5.0/uninstall/">Uninstall</a></li><li><a class="d0" href="/dcosdocs/mesosphere/dcos/services/couchbase/0.2.0-5.5.0/troubleshooting/">Troubleshooting</a></li><li><a class="d0" href="/dcosdocs/mesosphere/dcos/services/couchbase/0.2.0-5.5.0/limitations/">Limitations</a></li><li><a class="d0" href="/dcosdocs/mesosphere/dcos/services/couchbase/0.2.0-5.5.0/supported-versions/">Supported Versions</a></li><li><a class="d0" href="/dcosdocs/mesosphere/dcos/services/couchbase/0.2.0-5.5.0/release-notes/">Release Notes</a></li></ul></nav><footer class="sidebar__footer"><div class="sidebar__footer-links"><a href="https://d2iq.com/terms/">Terms of Service</a><a href="https://d2iq.com/privacy/">Privacy Policy</a></div><a class="sidebar__footer-copyright" href="https://d2iq.com/">&copy; 2022 D2iQ, Inc. All rights reserved.</a></footer></section></div><div class="layout__content" role="main"><main class="content"><div class="content__container content__container--with-sections"><div class="content__header"><div class="content__header__row"><h1 class="content__header-title">Configuration</h1></div><h4 class="content__header-description">Configuring Couchbase for production and development</h4><div class="actions"><ul class="actions__list"><li class="actions__item"><button class="actions__link" onclick="javascript:window.print()"><i class="actions__icon" data-feather="printer"></i><span class="actions__text">Print</span></button></li><li class="actions__item"><a class="actions__link" href="https://github.com/mesosphere/dcos-docs-site/tree/main/pages/dcosdocs/mesosphere/dcos/services/couchbase/0.2.0-5.5.0/configuration/index.md" target="_blank"><i class="actions__icon" data-feather="github"></i><span class="actions__text">Contribute</span></a></li></ul></div></div><article class="content__article"><!-- This file is usually found in the Configuration section. -->
<p>The default DC/OS Couchbase installation provides reasonable defaults for trying out the service, but may not be sufficient for production use. You may require a different configuration depending on the context of the deployment.</p>
<h2 id="installing-with-custom-configuration"><a class="content__anchor" href="#installing-with-custom-configuration" aria-hidden="true"><i data-feather="bookmark"></i></a>Installing with Custom Configuration</h2>
<p>The following are some examples of how to customize the installation of your Couchbase instance.</p>
<p>In each case, you would create a new Couchbase instance using the custom configuration as follows:</p>
<pre><code class="language-bash">dcos package install couchbase --options=sample-couchbase.json
</code></pre>
<p>We recommend that you store your custom configuration in source control.</p>
<h3 id="installing-multiple-instances"><a class="content__anchor" href="#installing-multiple-instances" aria-hidden="true"><i data-feather="bookmark"></i></a>Installing multiple instances</h3>
<p>By default, the Couchbase service is installed with a service name of <code>couchbase</code>. You may specify a different name using a custom service configuration as follows:</p>
<pre><code class="language-json">{
  &quot;service&quot;: {
    &quot;name&quot;: &quot;couchbase-other&quot;
  }
}
</code></pre>
<p>When the above JSON configuration is passed to the <code>package install couchbase</code> command via the <code>--options</code> argument, the new service will use the name specified in that JSON configuration:</p>
<pre><code class="language-bash">dcos package install couchbase --options=couchbase-other.json
</code></pre>
<p>Multiple instances of Couchbase may be installed into your DC/OS cluster by customizing the name of each instance. For example, you might have one instance of Couchbase named <code>couchbase-staging</code> and another named <code>couchbase-prod</code>, each with its own custom configuration.</p>
<p>After specifying a custom name for your instance, it can be reached using <code>dcos couchbase</code> CLI commands or directly over HTTP as described <a href="#addressing-named-instances">below</a>.</p>
<p class="message--warning"><strong>WARNING: </strong>The service name <strong>cannot</strong> be changed after initial install. Changing the service name would require installing a new instance of the service against the new name, then copying over any data as necessary to the new instance.</p>
<h3 id="installing-into-folders"><a class="content__anchor" href="#installing-into-folders" aria-hidden="true"><i data-feather="bookmark"></i></a>Installing into folders</h3>
<p>In DC/OS 1.10 and later, services may be installed into folders by specifying a slash-delimited service name. For example:</p>
<pre><code class="language-json">{
  &quot;service&quot;: {
    &quot;name&quot;: &quot;/foldered/path/to/couchbase&quot;
  }
}
</code></pre>
<p>The above example will install the service under a path of <code>foldered</code> =&gt; <code>path</code> =&gt; <code>to</code> =&gt; <code>couchbase</code>. It can then be reached using <code>dcos couchbase</code> CLI commands or directly over HTTP as described <a href="#addressing-named-instances">below</a>.</p>
<p class="message--warning"><strong>WARNING: </strong>The service folder location <strong>cannot</strong> be changed after initial install. Changing the folder location would require installing a new instance of the service against the new name, then copying over any data as necessary to the new instance.</p>
<h3 id="addressing-named-instances"><a class="content__anchor" href="#addressing-named-instances" aria-hidden="true"><i data-feather="bookmark"></i></a>Addressing named instances</h3>
<p>After you’ve installed the service under a custom name or under a folder, it may be accessed from all <code>dcos couchbase</code> CLI commands using the <code>--name</code> argument. By default, the <code>--name</code> value defaults to the name of the package, or <code>couchbase</code>.</p>
<p>For example, if you had an instance named <code>couchbase-dev</code>, the following command would invoke a <code>pod list</code> command against it:</p>
<pre><code class="language-bash">dcos couchbase --name=couchbase-dev pod list
</code></pre>
<p>The same query would be over HTTP as follows:</p>
<pre><code class="language-bash">curl -H &quot;Authorization:token=$auth_token&quot; &lt;dcos_url&gt;/service/couchbase-dev/v1/pod
</code></pre>
<p>Likewise, if you had an instance in a folder like <code>/foldered/path/to/couchbase</code>, the following command would invoke a <code>pod list</code> command against it:</p>
<pre><code class="language-bash">dcos couchbase --name=/foldered/path/to/couchbase pod list
</code></pre>
<p>Similarly, it could be queried directly over HTTP as follows:</p>
<pre><code class="language-bash">curl -H &quot;Authorization:token=$auth_token&quot; &lt;dcos_url&gt;/service/foldered/path/to/couchbase-dev/v1/pod
</code></pre>
<p>You may add a <code>-v</code> (verbose) argument to any <code>dcos couchbase</code> command to see the underlying HTTP queries that are being made. This can be a useful tool to see where the CLI is getting its information. In practice, <code>dcos couchbase</code> commands are a thin wrapper around an HTTP interface provided by the DC/OS Couchbase Service itself.</p>
<h3 id="integration-with-dcos-access-controls"><a class="content__anchor" href="#integration-with-dcos-access-controls" aria-hidden="true"><i data-feather="bookmark"></i></a>Integration with DC/OS access controls</h3>
<p>In Enterprise DC/OS, DC/OS access controls can be used to restrict access to your service. To give a non-superuser complete access to a service, grant them the following list of permissions:</p>
<pre><code>dcos:adminrouter:service:marathon full
dcos:service:marathon:marathon:&lt;service-name&gt; full
dcos:service:adminrouter:&lt;service-name&gt; full
dcos:adminrouter:ops:mesos full
dcos:adminrouter:ops:slave full
</code></pre>
<p>Where <code>&lt;service-name&gt;</code> is your full service name, including the folder if it is installed in one.</p>
<h2 id="service-settings"><a class="content__anchor" href="#service-settings" aria-hidden="true"><i data-feather="bookmark"></i></a>Service Settings</h2>
<h3 id="placement-constraints"><a class="content__anchor" href="#placement-constraints" aria-hidden="true"><i data-feather="bookmark"></i></a>Placement Constraints</h3>
<p>Placement constraints allow you to customize where a service is deployed in the DC/OS cluster. Placement constraints  use the <a href="http://mesosphere.github.io/marathon/docs/constraints.html">Marathon operators</a> syntax. For example, <code>[[&quot;hostname&quot;, &quot;UNIQUE&quot;]]</code> ensures that at most one pod instance is deployed per agent.</p>
<p>A common task is to specify a list of whitelisted systems to deploy to. To achieve this, use the following syntax for the placement constraint:</p>
<pre><code>[[&quot;hostname&quot;, &quot;LIKE&quot;, &quot;10.0.0.159|10.0.1.202|10.0.3.3&quot;]]
</code></pre>
<p class="message--important"><strong>IMPORTANT: </strong>Be sure to include excess capacity in such a scenario so that if one of the whitelisted systems goes down, there is still enough capacity to repair your service.</p>
<h4 id="updating-placement-constraints"><a class="content__anchor" href="#updating-placement-constraints" aria-hidden="true"><i data-feather="bookmark"></i></a>Updating Placement Constraints</h4>
<p>Clusters change, and as such so will your placement constraints. However, already running service pods will <strong>not</strong> be affected by changes in placement constraints. This is because altering a placement constraint might invalidate the current placement of a running pod, and the pod will not be relocated automatically as doing so is a destructive action. We recommend using the following procedure to update the placement constraints of a pod:</p>
<ul>
<li>Update the placement constraint definition in the service.</li>
<li>For each affected pod, one at a time, perform a <code>pod replace</code>. This will (destructively) move the pod to be in accordance with the new placement constraints.</li>
</ul>
<h3 id="zones-enterprise"><a class="content__anchor" href="#zones-enterprise" aria-hidden="true"><i data-feather="bookmark"></i></a>Zones <span class="badge badge--shortcode badge--large badge--block badge--enterprise">Enterprise</span></h3>
<p><strong>Requires:</strong> DC/OS 1.11 Enterprise or later.</p>
<p>Placement constraints can be applied to DC/OS zones by referring to the <code>@zone</code> key. For example, one could spread pods across a minimum of three different zones by including this constraint:</p>
<pre><code>[[&quot;@zone&quot;, &quot;GROUP_BY&quot;, &quot;3&quot;]]
</code></pre>
<p>For the @zone constraint to be applied correctly, DC/OS must have <a href="/dcosdocs/mesosphere/dcos/2.0/deploying-services/fault-domain-awareness/">Fault Domain Awareness</a> enabled and configured.</p>
<p class="message--warning"><strong>WARNING: </strong>A service installed without a zone constraint cannot be updated to have one, and a service installed with a zone constraint may not have it removed.</p>
<h3 id="virtual-networks"><a class="content__anchor" href="#virtual-networks" aria-hidden="true"><i data-feather="bookmark"></i></a>Virtual networks</h3>
<p>DC/OS Couchbase supports deployment on <a href="/dcosdocs/mesosphere/dcos/latest/networking/SDN/dcos-overlay/">virtual networks</a> on DC/OS (including the <code>dcos</code> overlay network), allowing each container (task) to have its own IP address and not use port resources on the agent machines. This can be specified by passing the following configuration during installation:</p>
<pre><code class="language-json">{
  &quot;service&quot;: {
    &quot;virtual_network_enabled&quot;: true
  }
}
</code></pre>
<p class="message--note"><strong>NOTE: </strong>Once the service is deployed on a virtual network, it cannot be updated to use the host network.</p>
<h3 id="user"><a class="content__anchor" href="#user" aria-hidden="true"><i data-feather="bookmark"></i></a>User</h3>
<p>By default, all pods’ containers will be started as system user “nobody”. If your system configured for using over system user (for instance, you may have externally mounted persistent volumes with root’s permissions), you can define the user by defining a custom value for the service’s property “user”, for example:</p>
<pre><code class="language-json">{
  &quot;service&quot;: {
    &quot;properties&quot;: {
      &quot;user&quot;: &quot;root&quot;
    }
  }
}
</code></pre>
<h2 id="configuring-for-production"><a class="content__anchor" href="#configuring-for-production" aria-hidden="true"><i data-feather="bookmark"></i></a>Configuring for Production</h2>
<p>In a production deployment, each Couchbase Server service type (<code>data</code>, <code>index</code>, <code>query</code>, <code>full text search</code>, <code>eventing</code>, and <code>analytics</code>) runs in its own container. In the respective service type configuration sections, you select the count you want. The following sample shows 2 data, 1 index, 1 query, 1 fts, 1 eventing, and 1 analytics service in the DC/OS dashboard and the Couchbase dashboard.</p>
<p><a href="/dcosdocs/mesosphere/dcos/services/couchbase/0.2.0-5.5.0/img/couch_prod_conf_1.png"><img src="/dcosdocs/mesosphere/dcos/services/couchbase/0.2.0-5.5.0/img/couch_prod_conf_1.png" alt="Couchbase Install"/></a></p>
<p>Figure 1. Sample configuration in DC/OS dashboard</p>
<p><a href="/dcosdocs/mesosphere/dcos/services/couchbase/0.2.0-5.5.0/img/couch_prod_conf_2.png"><img src="/dcosdocs/mesosphere/dcos/services/couchbase/0.2.0-5.5.0/img/couch_prod_conf_2.png" alt="Couchbase Install"/></a></p>
<p>Figure 2. Sample configuration in Couchbase dashboard</p>
<p>Since all Couchbase service nodes require the same ports, in the Figure 2, you must have a DC/OS cluster with 7 private agents. Higher density can be achieved by using virtual networking where each container get its own IP. In combination with placement constraints, you can then also co-locate services on the same DC/OS agent, as fits your specific needs.</p>
<h2 id="configuring-for-development"><a class="content__anchor" href="#configuring-for-development" aria-hidden="true"><i data-feather="bookmark"></i></a>Configuring for Development</h2>
<p>In a development deployment, data nodes have all Couchbase Server service types (<code>data</code>, <code>index</code>, <code>query</code>, <code>full text search</code>, <code>eventing</code>, and <code>analytics</code>).</p>
<p>In the Data Service configuration section, check the <code>all services enabled</code> box:</p>
<pre><code>[&lt;img src=&quot;/dcosdocs/mesosphere/dcos/services/couchbase/0.2.0-5.5.0/img/couch_dev_conf_1.png&quot; alt=&quot;Couchbase Install&quot;/&gt;](/dcosdocs/mesosphere/dcos/services/couchbase/0.2.0-5.5.0/img/couch_dev_conf_1.png)

Figure 3. Enabling all services
</code></pre>
<p>The following images show the deployment of two data nodes that have all the Couchbase service types.</p>
<p><a href="/dcosdocs/mesosphere/dcos/services/couchbase/0.2.0-5.5.0/img/couch_dev_conf_2.png"><img src="/dcosdocs/mesosphere/dcos/services/couchbase/0.2.0-5.5.0/img/couch_dev_conf_2.png" alt="Couchbase Install"/></a></p>
<p>Figure 4. Data node configuration shown on DC/OS dashboard</p>
<p><a href="/dcosdocs/mesosphere/dcos/services/couchbase/0.2.0-5.5.0/img/couch_dev_conf_3.png"><img src="/dcosdocs/mesosphere/dcos/services/couchbase/0.2.0-5.5.0/img/couch_dev_conf_3.png" alt="Couchbase Install"/></a></p>
<p>Figure 5. Data node configuration shown on Couchbase dashboard</p>
</article></div><aside class="content__sections"><div class="content__sections-list-container"><ul class="content__sections-list"><li class="content__sections-item content__sections-item--h2"><a href="#installing-with-custom-configuration">Installing with Custom Configuration</a></li><li class="content__sections-item content__sections-item--h2"><a href="#service-settings">Service Settings</a></li><li class="content__sections-item content__sections-item--h2"><a href="#configuring-for-production">Configuring for Production</a></li><li class="content__sections-item content__sections-item--h2"><a href="#configuring-for-development">Configuring for Development</a></li></ul></div></aside></main></div></div><script src="/assets/js/jquery-3.2.1.js"></script><script src="/assets/js/clipboard.js"></script><script src="/assets/js/prism.js"></script><script src="/js/main.js"></script></body></html>