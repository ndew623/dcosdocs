<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width" initial-scale="1" user-scalable="no"><title>Fault Domain Awareness and Capacity Extension - D2iQ Docs</title><meta name="description" content="Understanding fault domains"><link rel="apple-touch-icon" sizes="180x180" href="/assets/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/favicon-16x16.png"><link rel="stylesheet" type="text/css" href="/dcosdocs/css/styles.css"><link rel="search" type="application/opensearchdescription+xml" href="/assets/opensearch.xml" title="Search"><link href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,500,500i,700,700i" rel="stylesheet"><script src="https://unpkg.com/feather-icons/dist/feather.min.js"></script><script>window.analytics||(window.analytics=[]),window.analytics.methods=["identify","track","trackLink","trackForm","trackClick","trackSubmit","page","pageview","ab","alias","ready","group","on","once","off"],window.analytics.factory=function(t){return function(){var a=Array.prototype.slice.call(arguments);return a.unshift(t),window.analytics.push(a),window.analytics}};for(var i=0;i<window.analytics.methods.length;i++){var method=window.analytics.methods[i];window.analytics[method]=window.analytics.factory(method)}window.analytics.load=function(t){var a=document.createElement("script");a.type="text/javascript",a.async=!0,a.src=("https:"===document.location.protocol?"https://":"http://")+"d2dq2ahtl5zl1z.cloudfront.net/analytics.js/v1/"+t+"/analytics.min.js";var n=document.getElementsByTagName("script")[0];n.parentNode.insertBefore(a,n)},window.analytics.SNIPPET_VERSION="2.0.8",
window.analytics.load("7sgtwqvuai");
window.analytics.page();</script><noscript><iframe src="//www.googletagmanager.com/ns.html?id=GTM-PBJ84KX" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript><script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src='//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
})(window,document,'script','dataLayer','GTM-PBJ84KX');</script></head><body><div class="layout"><header class="header"><a class="header__drawer"><i class="header__icon" data-feather="menu"></i></a><a class="header__logo" href="/"><img class="header__logo--mobile" src="/assets/D2iQ_Logotype_Color_Positive_Documentation.svg" alt="D2IQ"><img class="header__logo--desktop" src="/assets/D2iQ_Logotype_Color_Positive_Documentation.svg" alt="D2IQ"></a><div class="header__main"><div class="header__dropdown"><img class="header__dropdown-icon" src="/assets/D2IQ_Logotype_Color_Positive.png" alt="D2iQ"><strong>DC/OS Documentation</strong><i data-feather="chevron-down"></i></div><nav class="header__menu"><ul class="header__menu-list"><li class="header__menu-item"><a href="/mesosphere/dcos">DC/OS</a></li><li class="header__menu-item"><a href="/dcosdocs/mesosphere/dcos/services">Services</a></li><li class="header__menu-item"><a href="https://support.d2iq.com">Support</a></li></ul></nav></div><div class="chooser" id="localizer"><div class="chooser-current"><a class="chooser-title">English</a><svg class="chooser-svg" id="localizer-svg"><path class="pointer" d="m 13,6 -5,5 -5,-5 z" fill="#858585"></path></svg></div><ul class="chooser-list" id="localizer-list"><li class="chooser-list-item"><a href="/dcosdocs/mesosphere/dcos/cn/1.13/deploying-services/fault-domain-awareness">中文 (简体)</a></li></ul></div><section class="header__search" role="search"><form class="header__search-form" action="/search/"><input class="header__search-input" id="header-search-input" tabindex="1" type="text" name="q" placeholder="Search"><input type="hidden" name="hFR[scope][0]" value="DC/OS 1.13"><label class="header__search-label" for="header-search-input"><i class="header__icon" data-feather="search"></i></label></form></section></header><div class="header-dropdown"><ul class="header-dropdown__list"><li class="header-dropdown__top-item"><div>DKP</div></li><li class="header-dropdown__item"><a href="/dkp/konvoy">Konvoy</a></li><li class="header-dropdown__item"><a href="/dkp/kommander">Kommander</a></li><li class="header-dropdown__item"><a href="/dkp/dispatch">Dispatch</a></li><li class="header-dropdown__item"><a href="/dkp/kaptain">Kaptain</a></li><li class="header-dropdown__top-item"><div>Mesosphere</div></li><li class="header-dropdown__item header-dropdown__item--active"><a href="/mesosphere/dcos">DC/OS</a></li><li class="header-dropdown__item"><a href="/dcosdocs/mesosphere/dcos/services">DC/OS Services</a></li><li class="header-dropdown__item"><a href="https://support.d2iq.com">Support</a></li></ul></div><div class="layout__sidebar layout__drawer"><section class="sidebar"><header class="sidebar__header"><div class="sidebar__dropdown"><ul><li><a href="/dcosdocs/mesosphere/dcos/2.2/deploying-services/fault-domain-awareness">Mesosphere DC/OS 2.2.0</a></li><li><a href="/dcosdocs/mesosphere/dcos/2.1/deploying-services/fault-domain-awareness">Mesosphere DC/OS 2.1.0</a></li><li><a href="/dcosdocs/mesosphere/dcos/2.0/deploying-services/fault-domain-awareness">Mesosphere DC/OS 2.0</a></li><li><a href="/dcosdocs/mesosphere/dcos/1.13/deploying-services/fault-domain-awareness">Mesosphere DC/OS 1.13</a></li></ul><div class="toggle"><p><span class="title">DC/OS</span><span class="version"> 1.13</span></p><i data-feather="chevron-down"></i></div></div></header><nav class="sidebar_nav" role="navigation"><ul><li><a class="d0" href="/dcosdocs/mesosphere/dcos/1.13/release-notes/"><i data-feather="chevron-right"></i>Release Notes</a></li><li><a class="d0" href="/dcosdocs/mesosphere/dcos/1.13/overview/"><i data-feather="chevron-right"></i>Overview</a></li><li><a class="d0" href="/dcosdocs/mesosphere/dcos/1.13/installing/"><i data-feather="chevron-right"></i>Installing</a></li><li><a class="d0" href="/dcosdocs/mesosphere/dcos/1.13/gui/"><i data-feather="chevron-right"></i>GUI</a></li><li><a class="d0" href="/dcosdocs/mesosphere/dcos/1.13/cli/"><i data-feather="chevron-right"></i>CLI</a></li><li><a class="d0" href="/dcosdocs/mesosphere/dcos/1.13/administering-clusters/"><i data-feather="chevron-right"></i>Administering Clusters</a></li><li><a class="d0" href="/dcosdocs/mesosphere/dcos/1.13/networking/"><i data-feather="chevron-right"></i>Networking</a></li><li><a class="d0" href="/dcosdocs/mesosphere/dcos/1.13/security/"><i data-feather="chevron-right"></i>Security</a></li><li><a class="d0" href="/dcosdocs/mesosphere/dcos/1.13/storage/"><i data-feather="chevron-right"></i>Storage</a></li><li><a class="d0" href="/dcosdocs/mesosphere/dcos/1.13/metrics/"><i data-feather="chevron-right"></i>Metrics</a></li><li><a class="d0" href="/dcosdocs/mesosphere/dcos/1.13/monitoring/"><i data-feather="chevron-right"></i>Monitoring, Logging, and Debugging</a></li><li><a class="d0" href="/dcosdocs/mesosphere/dcos/1.13/hybrid-cloud/"><i data-feather="chevron-right"></i>Hybrid Cloud</a></li><li><a class="d0" href="/dcosdocs/mesosphere/dcos/1.13/deploying-jobs/"><i data-feather="chevron-right"></i>Deploying Jobs</a></li><li class="active"><a class="d0" href="/dcosdocs/mesosphere/dcos/1.13/deploying-services/"><i data-feather="chevron-right"></i>Deploying Services and Pods</a></li><ul><li><a class="d1" href="/dcosdocs/mesosphere/dcos/1.13/deploying-services/install/">Installing Services</a></li><li><a class="d1" href="/dcosdocs/mesosphere/dcos/1.13/deploying-services/marathon-parameters/">Marathon Configuration Reference</a></li><li><a class="d1" href="/dcosdocs/mesosphere/dcos/1.13/deploying-services/creating-services/"><i data-feather="chevron-right"></i>Creating Services</a></li><li><a class="d1" href="/dcosdocs/mesosphere/dcos/1.13/deploying-services/task-handling/"><i data-feather="chevron-right"></i>Task Handling</a></li><li><a class="d1" href="/dcosdocs/mesosphere/dcos/1.13/deploying-services/config-universe-service/">Configuring Services</a></li><li class="active active-on"><a class="d1" href="/dcosdocs/mesosphere/dcos/1.13/deploying-services/fault-domain-awareness/">Fault Domain Awareness and Capacity Extension</a></li><li><a class="d1" href="/dcosdocs/mesosphere/dcos/1.13/deploying-services/service-groups/">Granting Access to Services and Groups</a></li><li><a class="d1" href="/dcosdocs/mesosphere/dcos/1.13/deploying-services/marathon-constraints/">Marathon Placement Constraints</a></li><li><a class="d1" href="/dcosdocs/mesosphere/dcos/1.13/deploying-services/monitor-services/">Monitoring Services</a></li><li><a class="d1" href="/dcosdocs/mesosphere/dcos/1.13/deploying-services/scale-service/">Scaling a Service</a></li><li><a class="d1" href="/dcosdocs/mesosphere/dcos/1.13/deploying-services/service-endpoints/">Service Endpoints</a></li><li><a class="d1" href="/dcosdocs/mesosphere/dcos/1.13/deploying-services/service-ports/">Service Ports</a></li><li><a class="d1" href="/dcosdocs/mesosphere/dcos/1.13/deploying-services/update-user-service/">Updating a User-Created Service</a></li><li><a class="d1" href="/dcosdocs/mesosphere/dcos/1.13/deploying-services/private-docker-registry/">Using a Private Docker Registry</a></li><li><a class="d1" href="/dcosdocs/mesosphere/dcos/1.13/deploying-services/deployments/">Deployments</a></li><li><a class="d1" href="/dcosdocs/mesosphere/dcos/1.13/deploying-services/expose-service/">Exposing a Service</a></li><li><a class="d1" href="/dcosdocs/mesosphere/dcos/1.13/deploying-services/uninstall/">Uninstalling Services</a></li><li><a class="d1" href="/dcosdocs/mesosphere/dcos/1.13/deploying-services/package-api/">Package Management API</a></li><li><a class="d1" href="/dcosdocs/mesosphere/dcos/1.13/deploying-services/marathon-on-marathon/"><i data-feather="chevron-right"></i>Using Custom Marathon</a></li><li><a class="d1" href="/dcosdocs/mesosphere/dcos/1.13/deploying-services/marathon-api/">Marathon API</a></li><li><a class="d1" href="/dcosdocs/mesosphere/dcos/1.13/deploying-services/containerizers/"><i data-feather="chevron-right"></i>Using Containerizers</a></li><li><a class="d1" href="/dcosdocs/mesosphere/dcos/1.13/deploying-services/pods/"><i data-feather="chevron-right"></i>Pods</a></li><li><a class="d1" href="/dcosdocs/mesosphere/dcos/1.13/deploying-services/multi-tenancy-primitives/">Multi-Tenancy Primitives</a></li><li><a class="d1" href="/dcosdocs/mesosphere/dcos/1.13/deploying-services/gpu/">Using GPUs</a></li><li><a class="d1" href="/dcosdocs/mesosphere/dcos/1.13/deploying-services/faq/">Frequently Asked Questions</a></li></ul><li><a class="d0" href="/dcosdocs/mesosphere/dcos/1.13/tutorials/"><i data-feather="chevron-right"></i>Tutorials</a></li><li><a class="d0" href="/dcosdocs/mesosphere/dcos/1.13/api/"><i data-feather="chevron-right"></i>API Reference</a></li><li><a class="d0" href="/dcosdocs/mesosphere/dcos/1.13/developing-services/"><i data-feather="chevron-right"></i>Developing DC/OS Services</a></li></ul></nav><footer class="sidebar__footer"><div class="sidebar__footer-links"><a href="https://d2iq.com/terms/">Terms of Service</a><a href="https://d2iq.com/privacy/">Privacy Policy</a></div><a class="sidebar__footer-copyright" href="https://d2iq.com/">&copy; 2022 D2iQ, Inc. All rights reserved.</a></footer></section></div><div class="layout__content" role="main"><main class="content"><div class="content__container content__container--with-sections"><div class="content__header"><div class="content__header__row"><h1 class="content__header-title">Fault Domain Awareness and Capacity Extension</h1><p class="badge badge--content-header badge--enterprise">ENTERPRISE</p></div><h4 class="content__header-description">Understanding fault domains</h4><div class="actions"><ul class="actions__list"><li class="actions__item"><button class="actions__link" onclick="javascript:window.print()"><i class="actions__icon" data-feather="printer"></i><span class="actions__text">Print</span></button></li><li class="actions__item"><a class="actions__link" href="https://github.com/mesosphere/dcos-docs-site/tree/main/pages/dcosdocs/mesosphere/dcos/1.13/deploying-services/fault-domain-awareness/index.md" target="_blank"><i class="actions__icon" data-feather="github"></i><span class="actions__text">Contribute</span></a></li></ul></div></div><article class="content__article"><p>A fault domain is a section of a network, for example, a rack in a datacenter or an entire datacenter, that is vulnerable to damage if a critical device or system fails. All instances within a fault domain share similar failure and latency characteristics. Instances in the same fault domain are all affected by failure events within the domain. Placing instances in more than one fault domain reduces the risk that a failure will affect all instances.</p>
<p>DC/OS now supports fault domain awareness. Use fault domain awareness to make your services highly available and to allow for increased capacity when needed. DC/OS currently supports Mesos’ 2-level hierarchical fault domains: zone and region.</p>
<h1 id="zone-fault-domains"><a class="content__anchor" href="#zone-fault-domains" aria-hidden="true"><i data-feather="bookmark"></i></a>Zone fault domains</h1>
<p>Zone fault domains offer a moderate degree of fault isolation because they share the same region. However, network latency between zones in the same region is moderately low (typically &lt; 10ms). For on-premise deployments, a zone would be a physical data center rack. For public cloud deployments, a zone would be the “availability zone” concept provided by most cloud providers. If your goal is high availability, and/or your services are latency-sensitive, place your instances in a one region and balance them across zones.</p>
<h1 id="region-fault-domains"><a class="content__anchor" href="#region-fault-domains" aria-hidden="true"><i data-feather="bookmark"></i></a>Region fault domains</h1>
<p>Region fault domains offer the most fault isolation, though inter-region network latency is high. For on-premise deployments, a region might be a data center. For public cloud deployments, most cloud providers expose a “region” concept. You can deploy your instances in a specific region based on the available capacity.</p>
<h2 id="local-and-remote-regions"><a class="content__anchor" href="#local-and-remote-regions" aria-hidden="true"><i data-feather="bookmark"></i></a>Local and remote regions</h2>
<ul>
<li>The <strong>local region</strong> is the region running the Mesos master nodes.</li>
<li>A <strong>remote region</strong> contains only Mesos agent nodes. There is usually high latency between a remote region and the local region.</li>
</ul>
<h1 id="installation"><a class="content__anchor" href="#installation" aria-hidden="true"><i data-feather="bookmark"></i></a>Installation</h1>
<p>Consider the future needs of the services in your cluster. You must define regions and zones at install time, though you can add or remove nodes from regions and zones after installation. If you need to update fault domain detect script, you must re-install DC/OS.</p>
<p>Mesos master nodes must be in the same region because otherwise the latency between them will be too high. They should, however, be spread across zones for fault tolerance.</p>
<p>You must have less than 100ms latency between regions.</p>
<ol>
<li>
<p>Create a fault domain detect script to run on each node to detect the node’s fault domain (Enterprise only). During installation, the output of this script is passed to Mesos.</p>
<p>We recommend the format for the script output be:</p>
<pre><code class="language-json">{
    &quot;fault_domain&quot;: {
        &quot;region&quot;: {
            &quot;name&quot;: &quot;&lt;region-name&gt;&quot;
        },
        &quot;zone&quot;: {
            &quot;name&quot;: &quot;&lt;zone-name&gt;&quot;
        }
    }
}
</code></pre>
<p>We provide <a href="https://github.com/dcos/dcos/tree/master/gen/fault-domain-detect">fault domain detect scripts for AWS, GCP and Azure nodes</a>. For a cluster that has aws nodes and azure nodes you would combine the two into one script. You can use these as a model for creating a fault domain detect script for an on premises cluster.</p>
 <p class="message--important"> <strong>IMPORTANT:</strong> This script will not work if you use proxies in your environment. If you use a proxy, modifications will be required.</p>
</li>
<li>
<p>Add this script to the <code>genconf</code> folder of your bootstrap node. <a href="/dcosdocs/mesosphere/dcos/1.13/installing/production/deploying-dcos/installation/#create-a-fault-domain-detection-script">More information</a>.</p>
</li>
<li>
<p><a href="/dcosdocs/mesosphere/dcos/1.13/installing/production/deploying-dcos/installation/">Install DC/OS</a>.</p>
</li>
<li>
<p>Test your installation. From the DC/OS CLI, enter <code>dcos node</code>. You should see output similar to the following, where the region and zone of each node is listed:</p>
<pre><code class="language-bash">HOSTNAME        IP                         ID                    TYPE               REGION      ZONE
10.0.3.188   10.0.3.188  a2ea1578-22ee-430e-aeb8-82ee1b74d88a-S1  agent            us-east-1  us-east-1a
10.0.7.224   10.0.7.224  a2ea1578-22ee-430e-aeb8-82ee1b74d88a-S0  agent            us-east-1  us-east-1b
master.mesos.  10.0.5.41                     N/A                    master              N/A         N/A
master.mesos.  10.0.6.95                     N/A                    master           us-east-1  us-east-1b
master.mesos.  10.0.7.111    a2ea1578-22ee-430e-aeb8-82ee1b74d88a   master (leader)  us-east-1  us-east-1c
</code></pre>
</li>
</ol>
<p>Alternatively, click the <strong>Nodes</strong> tab in the DC/OS GUI. The Nodes table will show region and zone columns for each agent.</p>
<h2 id="marathon-services-and-pods"><a class="content__anchor" href="#marathon-services-and-pods" aria-hidden="true"><i data-feather="bookmark"></i></a>Marathon services and pods</h2>
<p>In your Marathon service or pod definition, you can use <a href="/dcosdocs/mesosphere/dcos/1.13/deploying-services/marathon-constraints/">placement constraints</a> to:</p>
<ul>
<li>
<p>Specify a region and zone for your service or pod, so that all instances will be scheduled only in that region and zone.</p>
</li>
<li>
<p>Specify a region without a specific zone, so that all instances of a given service or pod will be scheduled in that region (but not necessarily in the same zone).</p>
</li>
</ul>
<h2 id="placement-constraint-guidelines"><a class="content__anchor" href="#placement-constraint-guidelines" aria-hidden="true"><i data-feather="bookmark"></i></a>Placement constraint guidelines</h2>
<ul>
<li>
<p>If no region is specified in your service or pod definition, instances are only scheduled for the local region because of high latency between the local and remote region. No instances will ever be scheduled for an agent outside of the local region unless you explicitly specify that they should be launched in a remote region.</p>
</li>
<li>
<p>If you specify a region without a specific zone, instances are scheduled on any agent in the given region.</p>
</li>
<li>
<p>If you specify both region and zone, instances are scheduled on any agent in the given region and zone, and not in any other region or zone.</p>
</li>
<li>
<p>If you specify a hostname <code>UNIQUE</code> constraint, that constraint is also honored in remote regions.</p>
</li>
</ul>
<h2 id="examples"><a class="content__anchor" href="#examples" aria-hidden="true"><i data-feather="bookmark"></i></a>Examples</h2>
<p>Suppose you have a Mesos cluster that spans 3 regions: <code>aws-us-east1</code>, <code>aws-us-east2</code>, and <code>local</code>. Each region has zones <code>a</code>,<code>b</code>,<code>c</code>,<code>d</code>.</p>
<h3 id="specify-only-a-remote-region"><a class="content__anchor" href="#specify-only-a-remote-region" aria-hidden="true"><i data-feather="bookmark"></i></a>Specify only a remote region</h3>
<pre><code class="language-json">{
  &quot;instances&quot;: 5,
  &quot;constraints&quot;: [
    [&quot;@region&quot;, &quot;IS&quot;, &quot;aws-us-east1&quot;]
  ]
}
</code></pre>
<ul>
<li>No instance will launch in the local region.</li>
<li>All of the 5 instances will be launched in the <code>aws-us-east1</code> region.</li>
</ul>
<h3 id="balanced-placement-for-a-single-region"><a class="content__anchor" href="#balanced-placement-for-a-single-region" aria-hidden="true"><i data-feather="bookmark"></i></a>Balanced placement for a single region</h3>
<pre><code class="language-json">{
   ...
  &quot;instances&quot;: 6,
  &quot;constraints&quot;: [
    [&quot;@region&quot;, &quot;IS&quot;, &quot;aws-us-east1&quot;],
    [&quot;@zone&quot;, &quot;GROUP_BY&quot;, &quot;4&quot;]
  ]
}
</code></pre>
<ul>
<li>Instances will all be launched in the <code>aws-us-east1</code> region and evenly divided between <code>aws-us-east1</code>‘s zones <code>a</code>,<code>b</code>,<code>c</code>,<code>d</code>.</li>
</ul>
<h3 id="increase-cluster-capacity"><a class="content__anchor" href="#increase-cluster-capacity" aria-hidden="true"><i data-feather="bookmark"></i></a>Increase Cluster Capacity</h3>
<p>To increase capacity, <a href="/dcosdocs/mesosphere/dcos/1.13/administering-clusters/add-a-node/">add new nodess</a> to a remote region or regions of your cluster, and then update your services to launch instances in that region or those regions appropriately.</p>
<p class="message--important"><strong>IMPORTANT: </strong>You cannot configure your service to run in more than one region.</p>
</article></div><aside class="content__sections"><div class="content__sections-list-container"><ul class="content__sections-list"><li class="content__sections-item content__sections-item--h1"><a href="#zone-fault-domains">Zone fault domains</a></li><li class="content__sections-item content__sections-item--h1"><a href="#region-fault-domains">Region fault domains</a></li><li class="content__sections-item content__sections-item--h2"><a href="#local-and-remote-regions">Local and remote regions</a></li><li class="content__sections-item content__sections-item--h1"><a href="#installation">Installation</a></li><li class="content__sections-item content__sections-item--h2"><a href="#marathon-services-and-pods">Marathon services and pods</a></li><li class="content__sections-item content__sections-item--h2"><a href="#placement-constraint-guidelines">Placement constraint guidelines</a></li><li class="content__sections-item content__sections-item--h2"><a href="#examples">Examples</a></li></ul></div></aside></main></div></div><script src="/assets/js/jquery-3.2.1.js"></script><script src="/assets/js/clipboard.js"></script><script src="/assets/js/prism.js"></script><script src="/js/main.js"></script></body></html>