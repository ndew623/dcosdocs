<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width" initial-scale="1" user-scalable="no"><title>Configuration - D2iQ Docs</title><meta name="description" content="Configuration options for Elastic"><link rel="apple-touch-icon" sizes="180x180" href="/assets/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/favicon-16x16.png"><link rel="stylesheet" type="text/css" href="/dcosdocs/css/styles.css"><link rel="search" type="application/opensearchdescription+xml" href="/assets/opensearch.xml" title="Search"><link href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,500,500i,700,700i" rel="stylesheet"><script src="https://unpkg.com/feather-icons/dist/feather.min.js"></script><script>window.analytics||(window.analytics=[]),window.analytics.methods=["identify","track","trackLink","trackForm","trackClick","trackSubmit","page","pageview","ab","alias","ready","group","on","once","off"],window.analytics.factory=function(t){return function(){var a=Array.prototype.slice.call(arguments);return a.unshift(t),window.analytics.push(a),window.analytics}};for(var i=0;i<window.analytics.methods.length;i++){var method=window.analytics.methods[i];window.analytics[method]=window.analytics.factory(method)}window.analytics.load=function(t){var a=document.createElement("script");a.type="text/javascript",a.async=!0,a.src=("https:"===document.location.protocol?"https://":"http://")+"d2dq2ahtl5zl1z.cloudfront.net/analytics.js/v1/"+t+"/analytics.min.js";var n=document.getElementsByTagName("script")[0];n.parentNode.insertBefore(a,n)},window.analytics.SNIPPET_VERSION="2.0.8",
window.analytics.load("7sgtwqvuai");
window.analytics.page();</script><noscript><iframe src="//www.googletagmanager.com/ns.html?id=GTM-PBJ84KX" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript><script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src='//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
})(window,document,'script','dataLayer','GTM-PBJ84KX');</script></head><body><div class="layout"><header class="header"><a class="header__drawer"><i class="header__icon" data-feather="menu"></i></a><a class="header__logo" href="/"><img class="header__logo--mobile" src="/assets/D2iQ_Logotype_Color_Positive_Documentation.svg" alt="D2IQ"><img class="header__logo--desktop" src="/assets/D2iQ_Logotype_Color_Positive_Documentation.svg" alt="D2IQ"></a><div class="header__main"><div class="header__dropdown"><img class="header__dropdown-icon" src="/assets/D2IQ_Logotype_Color_Positive.png" alt="D2iQ"><strong>Elastic Documentation</strong><i data-feather="chevron-down"></i></div><nav class="header__menu"><ul class="header__menu-list"><li class="header__menu-item"><a href="https://support.d2iq.com">Support</a></li></ul></nav></div><div class="chooser" id="spherer"><div class="chooser-current"><a class="chooser-title">Mesosphere</a><svg class="chooser-svg" id="spherer-svg"><path class="pointer" d="m 13,6 -5,5 -5,-5 z" fill="#858585"></path></svg></div><ul class="chooser-list" id="spherer-list"><li class="chooser-list-item"><a href="/mesosphere/dcos">DC/OS</a></li><li class="chooser-list-item"><a href="/dcosdocs/mesosphere/dcos/services">DC/OS Services</a></li></ul></div><div class="chooser" id="ks"><div class="chooser-current"><a class="chooser-title">DKP</a><svg class="chooser-svg" id="kspherer-svg"><path class="pointer" d="m 13,6 -5,5 -5,-5 z" fill="#858585"></path></svg></div><ul class="chooser-list" id="kspherer-list"><li class="chooser-list-item"><a href="/dkp/konvoy">Konvoy</a></li><li class="chooser-list-item"><a href="/dkp/konvoy/partner-solutions">Partner Solutions</a></li><li class="chooser-list-item"><a href="/dkp/kommander">Kommander</a></li><li class="chooser-list-item"><a href="/dkp/dispatch">Dispatch</a></li><li class="chooser-list-item"><a href="/dkp/kaptain">Kaptain</a></li></ul></div><div class="chooser" id="localizer"><div class="chooser-current"><a class="chooser-title">English</a><svg class="chooser-svg" id="localizer-svg"><path class="pointer" d="m 13,6 -5,5 -5,-5 z" fill="#858585"></path></svg></div><ul class="chooser-list" id="localizer-list"><li class="chooser-list-item"><a href="/dcosdocs/mesosphere/dcos/cn/services">中文 (简体)</a></li></ul></div><section class="header__search" role="search"><form class="header__search-form" action="/search/"><input class="header__search-input" id="header-search-input" tabindex="1" type="text" name="q" placeholder="Search"><input type="hidden" name="hFR[scope][0]" value="DC/OS Services"><label class="header__search-label" for="header-search-input"><i class="header__icon" data-feather="search"></i></label></form></section></header><div class="header-dropdown"><ul class="header-dropdown__list"><li class="header-dropdown__top-item"><div>DKP</div></li><li class="header-dropdown__item"><a href="/dkp/konvoy">Konvoy</a></li><li class="header-dropdown__item"><a href="/dkp/konvoy/partner-solutions">Partner Solutions</a></li><li class="header-dropdown__item"><a href="/dkp/kommander">Kommander</a></li><li class="header-dropdown__item"><a href="/dkp/dispatch">Dispatch</a></li><li class="header-dropdown__item"><a href="/dkp/kaptain">Kaptain</a></li><li class="header-dropdown__top-item"><div>Mesosphere</div></li><li class="header-dropdown__item header-dropdown__item--active"><a href="/mesosphere/dcos">DC/OS</a></li><li class="header-dropdown__item header-dropdown__item--active"><a href="/dcosdocs/mesosphere/dcos/services">DC/OS Services</a></li><li class="header-dropdown__item"><a href="https://support.d2iq.com">Support</a></li></ul></div><div class="layout__sidebar layout__drawer"><section class="sidebar"><header class="sidebar__header"><div class="sidebar__dropdown"><ul><li><a href="/dcosdocs/mesosphere/dcos/services/elastic/3.2.0-7.9.3/configuration">Elastic 3.2.0-7.9.3</a></li><li><a href="/dcosdocs/mesosphere/dcos/services/elastic/3.1.2-7.6.0/configuration">Elastic 3.1.2-7.6.0</a></li><li><a href="/dcosdocs/mesosphere/dcos/services/elastic/2.7.0-6.8.1/configuration">Elastic 2.7.0-6.8.1</a></li></ul><div class="toggle"><p><span class="title">Elastic</span><span class="version"> 3.2.0-7.9.3</span></p><i data-feather="chevron-down"></i></div></div></header><nav class="sidebar_nav" role="navigation"><ul><li><a class="d0" href="/dcosdocs/mesosphere/dcos/services/elastic/3.2.0-7.9.3/release-notes/">Release Notes</a></li><li><a class="d0" href="/dcosdocs/mesosphere/dcos/services/elastic/3.2.0-7.9.3/getting-started/">Getting Started</a></li><li class="active active-on"><a class="d0" href="/dcosdocs/mesosphere/dcos/services/elastic/3.2.0-7.9.3/configuration/">Configuration</a></li><li><a class="d0" href="/dcosdocs/mesosphere/dcos/services/elastic/3.2.0-7.9.3/operations/"><i data-feather="chevron-right"></i>Operations</a></li><li><a class="d0" href="/dcosdocs/mesosphere/dcos/services/elastic/3.2.0-7.9.3/updates/">Updates</a></li><li><a class="d0" href="/dcosdocs/mesosphere/dcos/services/elastic/3.2.0-7.9.3/security/">Security</a></li><li><a class="d0" href="/dcosdocs/mesosphere/dcos/services/elastic/3.2.0-7.9.3/uninstall/">Uninstall</a></li><li><a class="d0" href="/dcosdocs/mesosphere/dcos/services/elastic/3.2.0-7.9.3/troubleshooting/">Troubleshooting</a></li><li><a class="d0" href="/dcosdocs/mesosphere/dcos/services/elastic/3.2.0-7.9.3/advanced/">Advanced</a></li><li><a class="d0" href="/dcosdocs/mesosphere/dcos/services/elastic/3.2.0-7.9.3/api-reference/">API Reference</a></li><li><a class="d0" href="/dcosdocs/mesosphere/dcos/services/elastic/3.2.0-7.9.3/limitations/">Limitations</a></li><li><a class="d0" href="/dcosdocs/mesosphere/dcos/services/elastic/3.2.0-7.9.3/support-policy/">Support Policy</a></li><li><a class="d0" href="/dcosdocs/mesosphere/dcos/services/elastic/3.2.0-7.9.3/how-to-guides/"><i data-feather="chevron-right"></i>How-To Guides</a></li></ul></nav><footer class="sidebar__footer"><div class="sidebar__footer-links"><a href="https://d2iq.com/terms/">Terms of Service</a><a href="https://d2iq.com/privacy/">Privacy Policy</a></div><a class="sidebar__footer-copyright" href="https://d2iq.com/">&copy; 2021 D2iQ, Inc. All rights reserved.</a></footer></section></div><div class="layout__content" role="main"><main class="content"><div class="content__container content__container--with-sections"><div class="content__header"><div class="content__header__row"><h1 class="content__header-title">Configuration</h1></div><h4 class="content__header-description">Configuration options for Elastic</h4><div class="actions"><ul class="actions__list"><li class="actions__item"><button class="actions__link" onclick="javascript:window.print()"><i class="actions__icon" data-feather="printer"></i><span class="actions__text">Print</span></button></li><li class="actions__item"><a class="actions__link" href="https://github.com/mesosphere/dcos-docs-site/tree/main/pages/dcosdocs/mesosphere/dcos/services/elastic/3.2.0-7.9.3/configuration/index.md" target="_blank"><i class="actions__icon" data-feather="github"></i><span class="actions__text">Contribute</span></a></li><li class="actions__item"><a class="actions__link" href="https://jira.d2iq.com/secure/CreateIssueDetails!init.jspa?pid=14105&amp;issuetype=1&amp;summary=Feedback+for+Configuration&amp;description=Source:%20https://docs.d2iq.com/dcosdocs/mesosphere/dcos/services/elastic/3.2.0-7.9.3/configuration&amp;labels=documentation&amp;labels=needs_triage&amp;components=19804&amp;priority=3&amp;customfield_12300=44" target="_blank"><i class="actions__icon" data-feather="message-square"></i><span class="actions__text">Feedback</span></a></li></ul></div></div><article class="content__article"><!-- This file is usually found in the Configuration section. -->
<p>The default DC/OS Elastic installation provides reasonable defaults for trying out the service, but may not be sufficient for production use. You may require a different configuration depending on the context of the deployment.</p>
<h2 id="installing-with-custom-configuration"><a class="content__anchor" href="#installing-with-custom-configuration" aria-hidden="true"><i data-feather="bookmark"></i></a>Installing with Custom Configuration</h2>
<p>The following are some examples of how to customize the installation of your Elastic instance.</p>
<p>In each case, you would create a new Elastic instance using the custom configuration as follows:</p>
<pre><code class="language-bash">dcos package install elastic --options=sample-elastic.json
</code></pre>
<p>We recommend that you store your custom configuration in source control.</p>
<h3 id="installing-multiple-instances"><a class="content__anchor" href="#installing-multiple-instances" aria-hidden="true"><i data-feather="bookmark"></i></a>Installing multiple instances</h3>
<p>By default, the Elastic service is installed with a service name of <code>elastic</code>. You may specify a different name using a custom service configuration as follows:</p>
<pre><code class="language-json">{
  &quot;service&quot;: {
    &quot;name&quot;: &quot;elastic-other&quot;
  }
}
</code></pre>
<p>When the above JSON configuration is passed to the <code>package install elastic</code> command via the <code>--options</code> argument, the new service will use the name specified in that JSON configuration:</p>
<pre><code class="language-bash">dcos package install elastic --options=elastic-other.json
</code></pre>
<p>Multiple instances of Elastic may be installed into your DC/OS cluster by customizing the name of each instance. For example, you might have one instance of Elastic named <code>elastic-staging</code> and another named <code>elastic-prod</code>, each with its own custom configuration.</p>
<p>After specifying a custom name for your instance, it can be reached using <code>dcos elastic</code> CLI commands or directly over HTTP as described <a href="#addressing-named-instances">below</a>.</p>
<p class="message--warning"><strong>WARNING: </strong>The service name <strong>cannot</strong> be changed after initial install. Changing the service name would require installing a new instance of the service against the new name, then copying over any data as necessary to the new instance.</p>
<h3 id="installing-into-folders"><a class="content__anchor" href="#installing-into-folders" aria-hidden="true"><i data-feather="bookmark"></i></a>Installing into folders</h3>
<p>In DC/OS 1.10 and later, services may be installed into folders by specifying a slash-delimited service name. For example:</p>
<pre><code class="language-json">{
  &quot;service&quot;: {
    &quot;name&quot;: &quot;/foldered/path/to/elastic&quot;
  }
}
</code></pre>
<p>The above example will install the service under a path of <code>foldered</code> =&gt; <code>path</code> =&gt; <code>to</code> =&gt; <code>elastic</code>. It can then be reached using <code>dcos elastic</code> CLI commands or directly over HTTP as described <a href="#addressing-named-instances">below</a>.</p>
<p class="message--warning"><strong>WARNING: </strong>The service folder location <strong>cannot</strong> be changed after initial install. Changing the folder location would require installing a new instance of the service against the new name, then copying over any data as necessary to the new instance.</p>
<h3 id="addressing-named-instances"><a class="content__anchor" href="#addressing-named-instances" aria-hidden="true"><i data-feather="bookmark"></i></a>Addressing named instances</h3>
<p>After you’ve installed the service under a custom name or under a folder, it may be accessed from all <code>dcos elastic</code> CLI commands using the <code>--name</code> argument. By default, the <code>--name</code> value defaults to the name of the package, or <code>elastic</code>.</p>
<p>For example, if you had an instance named <code>elastic-dev</code>, the following command would invoke a <code>pod list</code> command against it:</p>
<pre><code class="language-bash">dcos elastic --name=elastic-dev pod list
</code></pre>
<p>The same query would be over HTTP as follows:</p>
<pre><code class="language-bash">curl -H &quot;Authorization:token=$auth_token&quot; &lt;dcos_url&gt;/service/elastic-dev/v1/pod
</code></pre>
<p>Likewise, if you had an instance in a folder like <code>/foldered/path/to/elastic</code>, the following command would invoke a <code>pod list</code> command against it:</p>
<pre><code class="language-bash">dcos elastic --name=/foldered/path/to/elastic pod list
</code></pre>
<p>Similarly, it could be queried directly over HTTP as follows:</p>
<pre><code class="language-bash">curl -H &quot;Authorization:token=$auth_token&quot; &lt;dcos_url&gt;/service/foldered/path/to/elastic-dev/v1/pod
</code></pre>
<p>You may add a <code>-v</code> (verbose) argument to any <code>dcos elastic</code> command to see the underlying HTTP queries that are being made. This can be a useful tool to see where the CLI is getting its information. In practice, <code>dcos elastic</code> commands are a thin wrapper around an HTTP interface provided by the DC/OS Elastic Service itself.</p>
<h3 id="integration-with-dcos-access-controls"><a class="content__anchor" href="#integration-with-dcos-access-controls" aria-hidden="true"><i data-feather="bookmark"></i></a>Integration with DC/OS access controls</h3>
<p>In Enterprise DC/OS, DC/OS access controls can be used to restrict access to your service. To give a non-superuser complete access to a service, grant them the following list of permissions:</p>
<pre><code>dcos:adminrouter:service:marathon full
dcos:service:marathon:marathon:&lt;service-name&gt; full
dcos:service:adminrouter:&lt;service-name&gt; full
dcos:adminrouter:ops:mesos full
dcos:adminrouter:ops:slave full
</code></pre>
<p>Where <code>&lt;service-name&gt;</code> is your full service name, including the folder if it is installed in one.</p>
<h2 id="service-settings"><a class="content__anchor" href="#service-settings" aria-hidden="true"><i data-feather="bookmark"></i></a>Service Settings</h2>
<h3 id="placement-constraints"><a class="content__anchor" href="#placement-constraints" aria-hidden="true"><i data-feather="bookmark"></i></a>Placement Constraints</h3>
<p>Placement constraints allow you to customize where a service is deployed in the DC/OS cluster. Placement constraints  use the <a href="http://mesosphere.github.io/marathon/docs/constraints.html">Marathon operators</a> syntax. For example, <code>[[&quot;hostname&quot;, &quot;UNIQUE&quot;]]</code> ensures that at most one pod instance is deployed per agent.</p>
<p>A common task is to specify a list of whitelisted systems to deploy to. To achieve this, use the following syntax for the placement constraint:</p>
<pre><code>[[&quot;hostname&quot;, &quot;LIKE&quot;, &quot;10.0.0.159|10.0.1.202|10.0.3.3&quot;]]
</code></pre>
<p class="message--important"><strong>IMPORTANT: </strong>Be sure to include excess capacity in such a scenario so that if one of the whitelisted systems goes down, there is still enough capacity to repair your service.</p>
<h4 id="updating-placement-constraints"><a class="content__anchor" href="#updating-placement-constraints" aria-hidden="true"><i data-feather="bookmark"></i></a>Updating Placement Constraints</h4>
<p>Clusters change, and as such so will your placement constraints. However, already running service pods will <strong>not</strong> be affected by changes in placement constraints. This is because altering a placement constraint might invalidate the current placement of a running pod, and the pod will not be relocated automatically as doing so is a destructive action. We recommend using the following procedure to update the placement constraints of a pod:</p>
<ul>
<li>Update the placement constraint definition in the service.</li>
<li>For each affected pod, one at a time, perform a <code>pod replace</code>. This will (destructively) move the pod to be in accordance with the new placement constraints.</li>
</ul>
<h3 id="zones-enterprise"><a class="content__anchor" href="#zones-enterprise" aria-hidden="true"><i data-feather="bookmark"></i></a>Zones <span class="badge badge--shortcode badge--large badge--block badge--enterprise">Enterprise</span></h3>
<p><strong>Requires:</strong> DC/OS 1.11 Enterprise or later.</p>
<p>Placement constraints can be applied to DC/OS zones by referring to the <code>@zone</code> key. For example, one could spread pods across a minimum of three different zones by including this constraint:</p>
<pre><code>[[&quot;@zone&quot;, &quot;GROUP_BY&quot;, &quot;3&quot;]]
</code></pre>
<p>For the @zone constraint to be applied correctly, DC/OS must have <a href="/dcosdocs/mesosphere/dcos/2.0/deploying-services/fault-domain-awareness/">Fault Domain Awareness</a> enabled and configured.</p>
<p class="message--warning"><strong>WARNING: </strong>A service installed without a zone constraint cannot be updated to have one, and a service installed with a zone constraint may not have it removed.</p>
<h3 id="virtual-networks"><a class="content__anchor" href="#virtual-networks" aria-hidden="true"><i data-feather="bookmark"></i></a>Virtual networks</h3>
<p>DC/OS Elastic supports deployment on <a href="/dcosdocs/mesosphere/dcos/latest/networking/SDN/dcos-overlay/">virtual networks</a> on DC/OS (including the <code>dcos</code> overlay network), allowing each container (task) to have its own IP address and not use port resources on the agent machines. This can be specified by passing the following configuration during installation:</p>
<pre><code class="language-json">{
  &quot;service&quot;: {
    &quot;virtual_network_enabled&quot;: true
  }
}
</code></pre>
<p class="message--note"><strong>NOTE: </strong>Once the service is deployed on a virtual network, it cannot be updated to use the host network.</p>
<h3 id="user"><a class="content__anchor" href="#user" aria-hidden="true"><i data-feather="bookmark"></i></a>User</h3>
<p>By default, all pods’ containers will be started as system user “nobody”. If your system configured for using over system user (for instance, you may have externally mounted persistent volumes with root’s permissions), you can define the user by defining a custom value for the service’s property “user”, for example:</p>
<pre><code class="language-json">{
  &quot;service&quot;: {
    &quot;properties&quot;: {
      &quot;user&quot;: &quot;root&quot;
    }
  }
}
</code></pre>
<h3 id="regions"><a class="content__anchor" href="#regions" aria-hidden="true"><i data-feather="bookmark"></i></a>Regions</h3>
<p>The service parameter <code>region</code> can be used to deploy the service in an alternate region. By default the service is deployed in the “local” region, which is the region the DC/OS masters are running in. To install a service in a specific reason, include in its options:</p>
<pre><code class="language-json">{
  &quot;service&quot;: {
    &quot;region&quot;: &quot;&lt;region&gt;&quot;
  }
}
</code></pre>
<p class="message--warning"><strong>WARNING: </strong>A service may not be moved between regions.</p>
<h2 id="configuration-guidelines"><a class="content__anchor" href="#configuration-guidelines" aria-hidden="true"><i data-feather="bookmark"></i></a>Configuration Guidelines</h2>
<ul>
<li>Service name: This should be unique for each instance of the service that is running. It is also used as your cluster name.</li>
<li>Service user: This should be a non-root user who already exists on each agent. The default user is <code>nobody</code>.</li>
<li>X-Pack is installed by default and comes with a 30-day trial license.</li>
<li>Health check credentials: If you have X-Pack Security enabled, the health check will use the credentials specified in the configuration for authorization. We recommend that you create a specific <code>Elastic</code> user/password for this with minimal capabilities rather than using the default superuser <code>elastic</code>.</li>
<li>Plugins: You can specify other plugins via a comma-separated list of plugin names (such as, “analysis-icu”) or plugin URIs.</li>
<li>CPU/RAM/Disk/Heap: These will be specific to your DC/OS cluster and your Elasticsearch use cases. Please refer to Elastic’s guidelines for configuration.</li>
<li>Node counts: At least one data node is required for the cluster to operate at all. You do not need to use a coordinator node. Learn about Elasticsearch node types <a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/modules-node.html">here</a>. There is no maximum for node counts.</li>
<li>Master transport port: You can pick whichever port works for your DC/OS cluster. The default is 9300. If you want multiple master nodes from different clusters on the same host, specify different master HTTP and transport ports for each cluster. If you want to ensure a particular distribution of nodes of one task type (such as master nodes spread across multiple racks, data nodes on one class of machines), specify this via the Marathon placement constraint.</li>
<li>Serial vs Parallel deployment. By default, the DC/OS Elastic Service tells DC/OS to install everything in parallel. You can change this to serial in order to have each node installed one at a time.</li>
<li>Serial vs Parallel update. By default, the DC/OS Elastic Service tells DC/OS to update everything serially. You can change this to parallel in order to have each node updated at the same time. This is required, for instance, when you turn X-Pack Security on or off.</li>
<li>A custom YAML file can be appended to <code>elasticsearch.yml</code> on each node.</li>
</ul>
<h3 id="immutable-settings"><a class="content__anchor" href="#immutable-settings" aria-hidden="true"><i data-feather="bookmark"></i></a>Immutable Settings</h3>
<p>At cluster creation time via Elastic package UI or JSON options file (via CLI), the following settings cannot be changed after installation:</p>
<ul>
<li>Service name (aka cluster name). Can be hyphenated, but not underscored.</li>
<li>Master transport port</li>
<li>Disk sizes/types</li>
</ul>
<h3 id="modifiable-settings"><a class="content__anchor" href="#modifiable-settings" aria-hidden="true"><i data-feather="bookmark"></i></a>Modifiable Settings</h3>
<ul>
<li>Plugins</li>
<li>CPU</li>
<li>Memory</li>
<li>JVM Heap (do not exceed one-half available node RAM)</li>
<li>Node count (up, not down)</li>
<li>Health check credentials</li>
<li>X-Pack Security enabled/disabled</li>
<li>Deployment/Upgrade strategy (serial/parallel). Note that serial deployment does not yet wait for the cluster to reach green before proceeding to the next node. This is a known limitation.</li>
<li>Custom <code>elasticsearch.yml</code></li>
</ul>
<p>Any other modifiable settings are covered by the various Elasticsearch APIs (cluster settings, index settings, templates, aliases, scripts). It is possible that some of the more common cluster settings will get exposed in future versions of the DC/OS Elastic Service.</p>
<h2 id="x-pack-security"><a class="content__anchor" href="#x-pack-security" aria-hidden="true"><i data-feather="bookmark"></i></a>X-Pack Security</h2>
<p><a href="https://www.elastic.co/guide/en/elasticsearch/reference/7.9/setup-xpack.html">X-Pack</a> is an Elastic Stack extension that provides security, alerting, monitoring, reporting, machine learning, and many other capabilities. By default, when you install Elasticsearch, X-Pack is installed.</p>
<p>You must set the update strategy to <code>parallel</code> when you toggle X-Pack Security in order to force a full cluster restart. Afterwards, you should set the update strategy back to <code>serial</code> for future updates.</p>
<p>You can toggle this setting at any time. This gives you the option of launching an Elastic cluster without X-Pack Security and then later enabling it. Or, you can run a cluster with X-Pack Security enabled and, if at the end of the 30-day trial period you do not wish to purchase a license, you can disable it without losing access to your data.</p>
<h3 id="license-expiration"><a class="content__anchor" href="#license-expiration" aria-hidden="true"><i data-feather="bookmark"></i></a>License Expiration</h3>
<p>If you let your license expire, remember these two important points:</p>
<ul>
<li>Your data is still there.</li>
<li>All data operations (read and write) continue to work.</li>
</ul>
<p><a href="https://www.elastic.co/what-is/elasticsearch-graph">Graph</a>, <a href="https://www.elastic.co/what-is/elasticsearch-machine-learning">Machine Learning</a>, <a href="https://www.elastic.co/what-is/elasticsearch-alerting">Alerting and Notification</a>, <a href="https://www.elastic.co/what-is/elasticsearch-monitoring">Monitoring</a>, and <a href="https://www.elastic.co/what-is/elastic-stack-security">Security</a> features all operate with reduced functionality when the license expires.</p>
<p>Click <a href="https://www.elastic.co/guide/en/x-pack/current/license-expiration.html">here</a> to learn more about how X-Pack license expiration is handled.</p>
<h2 id="topology"><a class="content__anchor" href="#topology" aria-hidden="true"><i data-feather="bookmark"></i></a>Topology</h2>
<p>Each task in the cluster performs one and only one of the following roles: master, data, ingest, coordinator.</p>
<p>The default placement strategy specifies that no two nodes of any type are distributed to the same agent. You can specify further <a href="http://mesosphere.github.io/marathon/docs/constraints.html">Marathon placement constraints</a> for each node type. For example, you can specify that ingest nodes are deployed on a rack with high-CPU servers.</p>
<p><img src="../img/private-nodes-by-agent.png" alt="agent"></p>
<p>Figure 1 - Private nodes displayed by agent</p>
<p><img src="../img/private-node-by-vip.png" alt="vip"></p>
<p>Figure 2 - Private nodes displayed by VIP</p>
<p>No matter how big or small the cluster is, there will always be exactly 3 master-only nodes with <code>minimum_master_nodes = 2</code>.</p>
<h3 id="default-topology"><a class="content__anchor" href="#default-topology" aria-hidden="true"><i data-feather="bookmark"></i></a>Default Topology</h3>
<p>These are the minimum resources to run on 3 agents:</p>
<ul>
<li>3 master-only nodes</li>
<li>2 data-only nodes</li>
<li>1 coordinator-only node</li>
<li>0 ingest-only node</li>
</ul>
<p>The master/data/ingest/coordinator nodes are set up to only perform their one role. That is, master nodes do not store data, and ingest nodes do not store cluster states.</p>
<h3 id="minimal-topology"><a class="content__anchor" href="#minimal-topology" aria-hidden="true"><i data-feather="bookmark"></i></a>Minimal Topology</h3>
<p>You can set up a minimal development/staging cluster without ingest nodes, or coordinator nodes. You will still get 3 master nodes placed on 3 separate hosts. If you do not care about replication, you can even use just 1 data node.</p>
<p>Note that the default monitoring behavior is to try to write to an ingest node every few seconds. Without an ingest node, you will see frequent warnings in your master node error logs. While they can be ignored, you can turn them off by disabling X-Pack monitoring in your cluster, like this:</p>
<pre><code class="language-bash">curl -XPUT -u elastic:changeme master.&lt;service-dns&gt;.l4lb.thisdcos.directory:9200/_cluster/settings -d '{
    &quot;persistent&quot; : {
        &quot;xpack.monitoring.collection.interval&quot; : -1
    }
}'
</code></pre>
<h2 id="zonerack-aware-placement-and-replication"><a class="content__anchor" href="#zonerack-aware-placement-and-replication" aria-hidden="true"><i data-feather="bookmark"></i></a>Zone/Rack-Aware Placement and Replication</h2>
<p>Elastic’s “rack”-based fault domain support is automatically enabled when specifying a placement constraint that uses the <code>@zone</code> key. For example, you could spread Elastic nodes across a minimum of three different zones/racks by specifying the constraint <code>[[&quot;@zone&quot;, &quot;GROUP_BY&quot;, &quot;3&quot;]]</code>. When a placement constraint specifying <code>@zone</code> is used, Elastic nodes will be automatically configured with <code>rack</code>s that match the names of the zones. If no placement constraint referencing <code>@ zone</code> is configured, all nodes will be configured with a default rack of <code>rack1</code>.</p>
<p>In addition to placing the tasks on different zones/racks, the zone/rack information will be included in the Elastic’s node.attr.zone attrribute and cluster.routing.allocation.awareness.attributes is set to “zone”. This enables Elastic to ensure data is replicated between zones/racks and not to two nodes in the same zone/rack.</p>
<h2 id="custom-elasticsearch-yaml"><a class="content__anchor" href="#custom-elasticsearch-yaml" aria-hidden="true"><i data-feather="bookmark"></i></a>Custom Elasticsearch YAML</h2>
<p>Many Elasticsearch options are exposed via the package configuration in <code>config.json</code>, but there may be times when you need to add something custom to the <code>elasticsearch.yml</code> file. For instance, if you have written a custom plugin that requires special configuration, you must specify this block of YAML for the Elastic service to use.</p>
<p>Add your custom YAML when installing or updating the Elastic service. In the DC/OS UI, click <strong>Configure</strong>. In the left navigation bar, click <code>elasticsearch</code> and find the field for specifying a custom Elasticsearch YAML. You must base64 encode your block of YAML and enter this string into the field.</p>
<p>You can do this base64 encoding as part of your automated workflow, or you can do it manually with an <a href="https://www.base64encode.org">online converter</a>.</p>
<p class="message--note"><strong>NOTE: </strong>You must only specify configuration options that are not already exposed in <code>config.json</code>.</p>
<h2 id="using-volume-profiles"><a class="content__anchor" href="#using-volume-profiles" aria-hidden="true"><i data-feather="bookmark"></i></a>Using Volume Profiles</h2>
<p>Volume profiles are used to classify volumes. For example, users can group SSDs into a “fast” profile and group HDDs into a “slow” profile.</p>
<p class="message--note"><strong>NOTE: </strong>Volume profiles are immutable and therefore cannot contain references to specific devices, nodes, or other ephemeral identifiers.</p>
<p><a href="https://docs.d2iq.com/dcosdocs/mesosphere/dcos/services/storage/1.0.0/">DC/OS Storage Service (DSS)</a> is a service that manages volumes, volume profiles, volume providers, and storage devices in a DC/OS cluster.</p>
<p>Once the DC/OS cluster is running and volume profiles are created, you can deploy Elasticsearch with the following configuration:</p>
<pre><code class="language-bash">cat &gt; elastic-options.json &lt;&lt;EOF
{
	&quot;master_nodes&quot;: {
		&quot;volume_profile&quot;: &quot;elastic&quot;,
		&quot;disk_type&quot;: &quot;MOUNT&quot;
	},
	&quot;data_nodes&quot;: {
		&quot;volume_profile&quot;: &quot;elastic&quot;,
		&quot;disk_type&quot;: &quot;MOUNT&quot;
	},
	&quot;ingest_nodes&quot;: {
		&quot;volume_profile&quot;: &quot;elastic&quot;,
		&quot;disk_type&quot;: &quot;MOUNT&quot;
	},
	&quot;coordinator_nodes&quot;: {
		&quot;volume_profile&quot;: &quot;elastic&quot;,
		&quot;disk_type&quot;: &quot;MOUNT&quot;
	}
}
EOF
</code></pre>
<pre><code class="language-bash">dcos package install elastic --options=elastic-options.json
</code></pre>
<p class="message--note"><strong>NOTE: </strong>Elasticsearch will be configured to look for <code>MOUNT</code> volumes with the <code>elastic</code> profile.</p>
<p>Once the Elasticsearch service finishes deploying, its tasks will be running with the specified volume profiles.</p>
<pre><code class="language-bash">dcos elastic update status
deploy (serial strategy) (COMPLETE)
├─ master-update (serial strategy) (COMPLETE)
│  ├─ master-0:[node] (COMPLETE)
│  ├─ master-1:[node] (COMPLETE)
│  └─ master-2:[node] (COMPLETE)
├─ data-update (serial strategy) (COMPLETE)
│  ├─ data-0:[node] (COMPLETE)
│  └─ data-1:[node] (COMPLETE)
├─ ingest-update (serial strategy) (COMPLETE)
└─ coordinator-update (serial strategy) (COMPLETE)
   └─ coordinator-0:[node] (COMPLETE)
</code></pre>
<h2 id="using-external-volumes"><a class="content__anchor" href="#using-external-volumes" aria-hidden="true"><i data-feather="bookmark"></i></a>Using external volumes</h2>
<p>You can specify external volume configuration in your Elastic definition.</p>
<p>By default name of external volume constructed as:</p>
<ul>
<li><code>&lt;service-name&gt;_&lt;pod-type&gt;-&lt;pod-index&gt;</code> - for Portworx volume provider</li>
<li><code>&lt;service-name&gt;_&lt;pod-type&gt;_&lt;pod-index&gt;</code> - for other external volume providers</li>
</ul>
<p>You can specify custom volume name for certain node types. Volume name will be constructed as:</p>
<ul>
<li><code>&lt;volume-name&gt;-&lt;pod-index&gt;</code> - for Portworx volume provider</li>
<li><code>&lt;volume-name&gt;_&lt;pod-index&gt;</code> - for other external volume providers</li>
</ul>
<p><code>&lt;service-name&gt;</code> - sanitized service path with slashes <code>/</code> replaced by double underscore <code>__</code></p>
<p><code>&lt;pod-type&gt;</code> - pod type</p>
<p><code>&lt;pod-index&gt;</code> - pod index</p>
<p>Example Elastic deployment with external volume confiugration:</p>
<pre><code class="language-bash">cat &gt; elastic-options.json &lt;&lt;EOF
{
    &quot;service&quot; : { 
        name&quot;: &quot;/foo/bar/elastic&quot;
    },
	&quot;master_nodes&quot;: {
       &quot;external_volume&quot;: {
          &quot;enabled&quot;: True,
          &quot;driver_options&quot;: &quot;size=50&quot;,
          &quot;volume_name&quot;: &quot;MasterNodeVolume&quot;,
          &quot;driver_name&quot;: &quot;pxd&quot;
        },
	},
	&quot;data_nodes&quot;: {
       &quot;external_volume&quot;: {
          &quot;enabled&quot;: True,
          &quot;driver_options&quot;: &quot;size=50&quot;,
          &quot;volume_name&quot;: &quot;&quot;,
          &quot;driver_name&quot;: &quot;pxd&quot;
        },
	},
	&quot;coordinator_nodes&quot;: {
       &quot;external_volume&quot;: {
          &quot;enabled&quot;: True,
          &quot;driver_options&quot;: &quot;size=50&quot;,
          &quot;volume_name&quot;: &quot;&quot;,
          &quot;driver_name&quot;: &quot;pxd&quot;
        },
	}
}
EOF
</code></pre>
<p>For this example external volumes will be created with the following names:</p>
<ul>
<li><code>foo__bar__elastic-coordinator-0</code></li>
<li><code>foo__bar__elastic-data-0</code></li>
<li><code>foo__bar__elastic-data-1</code></li>
<li><code>MasterNodeVolume-0</code></li>
<li><code>MasterNodeVolume-1</code></li>
<li><code>MasterNodeVolume-2</code></li>
</ul>
<h2 id="elasticsearch-metrics"><a class="content__anchor" href="#elasticsearch-metrics" aria-hidden="true"><i data-feather="bookmark"></i></a>Elasticsearch Metrics</h2>
<p>Elasticsearch Prometheus Exporter collects Metrics for Prometheus. Preconfigured <code>alert-rules</code> and/or <code>grafana-dashboards</code> are stored in  <code>dcos/grafana-dashboards</code> and/or <code>dcos/prometheus-alert-rules</code> repositories. Otherwise, you can use your own dashboards/alert files and point to them in <code>dcos-monitoring</code> configuration.</p>
<h2 id="grafana-dashboards"><a class="content__anchor" href="#grafana-dashboards" aria-hidden="true"><i data-feather="bookmark"></i></a>Grafana Dashboards</h2>
<p><strong>dcos-monitoring</strong> configuration:</p>
<pre><code class="language-json">{
  &quot;grafana&quot;: {
    &quot;dashboard_config_repository&quot;: {
      &quot;url&quot;: &quot;https://github.com/dcos/grafana-dashboards&quot;,
      &quot;path&quot;: &quot;dashboards/elasticsearch&quot;,
      &quot;reference_name&quot;: &quot;&quot;,
      &quot;credentials&quot;: {
        &quot;username_secret&quot;: &quot;&quot;,
        &quot;password_secret&quot;: &quot;&quot;,
        &quot;deploy_key_secret&quot;: &quot;&quot;
      }
    }
  }
}
</code></pre>
<p><strong>dashboard_config_repository.path</strong> contains files:</p>
<ul>
<li><code>elasticsearch.json</code></li>
</ul>
<h2 id="prometheus-alerts"><a class="content__anchor" href="#prometheus-alerts" aria-hidden="true"><i data-feather="bookmark"></i></a>Prometheus Alerts</h2>
<p><strong>dcos-monitoring</strong> configuration:</p>
<pre><code class="language-json">{
  &quot;prometheus&quot;: {
    &quot;alert_rules_repository&quot;: {
      &quot;url&quot;: &quot;https://github.com/dcos/prometheus-alert-rules&quot;,
      &quot;path&quot;: &quot;rules/elasticsearch&quot;,
      &quot;reference_name&quot;: &quot;&quot;,
      &quot;credentials&quot;: {
        &quot;username_secret&quot;: &quot;&quot;,
        &quot;password_secret&quot;: &quot;&quot;,
        &quot;deploy_key_secret&quot;: &quot;&quot;
      }
    }
  }
}
</code></pre>
<p><strong>alert_rules_repository.path</strong> contains the files:</p>
<ul>
<li><code>elasticsearch.rules</code></li>
<li><code>elasticsearch.yml</code></li>
</ul>
<h2 id="kibana"><a class="content__anchor" href="#kibana" aria-hidden="true"><i data-feather="bookmark"></i></a>Kibana</h2>
<p><a href="https://www.elastic.co/products/kibana">Kibana</a> is an open source data visualization plugin for Elasticsearch that lets you visualize your Elasticsearch data and navigate the Elastic Stack. You can install Kibana like any other DC/OS package via the <strong>Catalog</strong> tab of the DC/OS UI or via the DC/OS CLI with:</p>
<pre><code class="language-bash">dcos package install kibana
</code></pre>
<p>This will install Kibana using the default name “kibana”. The service name can be configured via the <code>service.name</code> option. Check the configuration guidelines below for more details.</p>
<pre><code class="language-bash">dcos package install kibana --options=kibana.json
</code></pre>
<h3 id="accessing-the-kibana-ui"><a class="content__anchor" href="#accessing-the-kibana-ui" aria-hidden="true"><i data-feather="bookmark"></i></a>Accessing the Kibana UI</h3>
<h4 id="make-sure-that-kibana-is-up-and-running"><a class="content__anchor" href="#make-sure-that-kibana-is-up-and-running" aria-hidden="true"><i data-feather="bookmark"></i></a>Make sure that Kibana is up and running</h4>
<p>Services usually take a moment to finish being installed and ready to use. You can check if your Kibana service is ready with the following command:</p>
<pre><code class="language-bash">dcos marathon app show kibana | jq -r '.tasksHealthy'
</code></pre>
<p>If it outputs a <code>1</code> it means Kibana is up and running. A <code>0</code> means that it is still probably being installed.</p>
<p>Another good indication that Kibana is ready is when the following line appears in the in the <code>stdout</code> log for the Kibana task.</p>
<pre><code>{&quot;type&quot;:&quot;log&quot;,&quot;@timestamp&quot;:&quot;2016-12-08T22:37:46Z&quot;,&quot;tags&quot;:[&quot;listening&quot;,&quot;info&quot;],&quot;pid&quot;:12263,&quot;message&quot;:&quot;Server running at http://0.0.0.0:5601&quot;}
</code></pre>
<h4 id="kibana-without-x-pack-security-enabled"><a class="content__anchor" href="#kibana-without-x-pack-security-enabled" aria-hidden="true"><i data-feather="bookmark"></i></a>Kibana without X-Pack Security enabled</h4>
<p>If Kibana was installed without X-Pack Security enabled, you should be able to access it through the default DC/OS UI Service link (<code>https://&lt;cluster-url&gt;/service/&lt;kibana-service-name&gt;</code>).</p>
<h4 id="kibana-with-x-pack-security-enabled"><a class="content__anchor" href="#kibana-with-x-pack-security-enabled" aria-hidden="true"><i data-feather="bookmark"></i></a>Kibana with X-Pack Security enabled</h4>
<p>Due to a known <a href="/dcosdocs/mesosphere/dcos/services/elastic/3.2.0-7.9.3/limitations#kibana-service-url-does-not-work-on-dcos-111">limitation</a>, if you installed Kibana with X-Pack Security enabled, you will not be able to access it through the default DC/OS 1.11 UI Service link. In this case you must <a href="/dcosdocs/mesosphere/dcos/services/elastic/3.2.0-7.9.3/how-to-guides#expose-kibana-using-edgelb">expose Kibana using EdgeLB</a>.</p>
<h3 id="configuration-guidelines-2"><a class="content__anchor" href="#configuration-guidelines-2" aria-hidden="true"><i data-feather="bookmark"></i></a>Configuration Guidelines</h3>
<ul>
<li>Service name (<code>service.name</code>): This must be unique for each instance of the service that is running. The default is <code>kibana</code>.</li>
<li>Service user (<code>service.user</code>): This must be a non-root user that already exists on each agent. The default user is <code>nobody</code>.</li>
<li>If you have X-Pack Security enabled in Elastic (<code>elasticsearch.xpack_security_enabled: true</code>), you must also have it enabled in Kibana (<code>kibana.elasticsearch_xpack_security_enabled: true</code>).</li>
<li>Elasticsearch credentials (<code>kibana.user</code> and <code>kibana.password</code>): If you have X-Pack Security enabled, Kibana will use these credentials for authorized requests to Elasticsearch. The default user is <code>kibana</code>, and the password must be configured through the service options.</li>
<li>Elasticsearch URL: This is a required configuration parameter. The default value <code>http://coordinator.&lt;elastic-service-name&gt;.l4lb.thisdcos.directory:9200</code> corresponds to the named VIP that exists when the Elastic package is launched with its own default configuration.</li>
</ul>
<h3 id="configuring-kibana"><a class="content__anchor" href="#configuring-kibana" aria-hidden="true"><i data-feather="bookmark"></i></a>Configuring Kibana</h3>
<p>You can customize the Kibana installation in a variety of ways by specifying a JSON options file. For example, here is a sample JSON options file that:</p>
<ul>
<li>Sets the service name to <code>another-kibana</code></li>
<li>Sets the password for Kibana requests to an Elasticsearch cluster configured with authentication</li>
<li>Configures Kibana to <a href="https://www.elastic.co/guide/en/kibana/current/configuring-tls.html">communicate with Elasticsearch via TLS</a></li>
<li>Turns on X-Pack Security, so that Kibana works against an Elasticsearch similarly configured</li>
</ul>
<p><code>another_kibana.json</code></p>
<pre><code class="language-json">{
    &quot;service&quot;: {
        &quot;name&quot;: &quot;another-kibana&quot;
    },
    &quot;kibana&quot;: {
        &quot;password&quot;: &quot;0cb46ab2d7790f30ceb32bd3d43fff35&quot;,
        &quot;elasticsearch_tls&quot;: true,
        &quot;elasticsearch_url&quot;: &quot;https://coordinator.elastic.l4lb.thisdcos.directory:9200&quot;,
        &quot;elasticsearch_xpack_security_enabled&quot;: true
    }
}
</code></pre>
<p>The following command installs Kibana using a JSON options file:</p>
<pre><code class="language-bash">dcos package install kibana --options=another_kibana.json
</code></pre>
<p>To see a list of all possible options, run the following command to show the configuration <a href="http://json-schema.org/learn/getting-started-step-by-step.html">schema</a>:</p>
<pre><code class="language-bash">dcos package describe kibana |  jq -r '.package.config'
</code></pre>
<h2 id="custom-kibana-yaml"><a class="content__anchor" href="#custom-kibana-yaml" aria-hidden="true"><i data-feather="bookmark"></i></a>Custom Kibana YAML</h2>
<p>Many Kibana options are exposed via the package configuration in <code>config.json</code>, but there may be times when you need to add something custom to the <code>kibana.yml</code> file. For instance, if you have written a custom plugin that requires special configuration, you must specify this block of YAML for the Elastic service to use.</p>
<p>Add your custom YAML when installing or updating the Elastic service. In the DC/OS UI, click <strong>Configure</strong>. In the left navigation bar, click <code>kibana</code> and find the field for specifying custom Kibana YAML. You must base64 encode your block of YAML and enter this string into the field.</p>
<p>You can do this base64 encoding as part of your automated workflow, or you can do it manually with an <a href="https://www.base64encode.org">online converter</a>.</p>
<p class="message--note"><strong>NOTE: </strong>You must only specify configuration options that are not already exposed in <code>config.json</code>.</p>
</article></div><aside class="content__sections"><div class="content__sections-list-container"><ul class="content__sections-list"><li class="content__sections-item content__sections-item--h2"><a href="#installing-with-custom-configuration">Installing with Custom Configuration</a></li><li class="content__sections-item content__sections-item--h2"><a href="#service-settings">Service Settings</a></li><li class="content__sections-item content__sections-item--h2"><a href="#configuration-guidelines">Configuration Guidelines</a></li><li class="content__sections-item content__sections-item--h2"><a href="#x-pack-security">X-Pack Security</a></li><li class="content__sections-item content__sections-item--h2"><a href="#topology">Topology</a></li><li class="content__sections-item content__sections-item--h2"><a href="#zonerack-aware-placement-and-replication">Zone/Rack-Aware Placement and Replication</a></li><li class="content__sections-item content__sections-item--h2"><a href="#custom-elasticsearch-yaml">Custom Elasticsearch YAML</a></li><li class="content__sections-item content__sections-item--h2"><a href="#using-volume-profiles">Using Volume Profiles</a></li><li class="content__sections-item content__sections-item--h2"><a href="#using-external-volumes">Using external volumes</a></li><li class="content__sections-item content__sections-item--h2"><a href="#elasticsearch-metrics">Elasticsearch Metrics</a></li><li class="content__sections-item content__sections-item--h2"><a href="#grafana-dashboards">Grafana Dashboards</a></li><li class="content__sections-item content__sections-item--h2"><a href="#prometheus-alerts">Prometheus Alerts</a></li><li class="content__sections-item content__sections-item--h2"><a href="#kibana">Kibana</a></li><li class="content__sections-item content__sections-item--h2"><a href="#custom-kibana-yaml">Custom Kibana YAML</a></li></ul></div></aside></main></div></div><script src="/assets/js/jquery-3.2.1.js"></script><script src="/assets/js/clipboard.js"></script><script src="/assets/js/prism.js"></script><script src="/js/main.js"></script></body></html>