<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width" initial-scale="1" user-scalable="no"><title>Authentication and Authorization - D2iQ Docs</title><meta name="description" content="Authentication and authorization modes for DC/OS Kubernetes"><link rel="apple-touch-icon" sizes="180x180" href="/dcosdocs/assets/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/dcosdocs/assets/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/dcosdocs/assets/favicon-16x16.png"><link rel="stylesheet" type="text/css" href="/dcosdocs/css/styles.css"><link rel="search" type="application/opensearchdescription+xml" href="/dcosdocs/assets/opensearch.xml" title="Search"><link href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,500,500i,700,700i" rel="stylesheet"><script src="https://unpkg.com/feather-icons/dist/feather.min.js"></script><script>window.analytics||(window.analytics=[]),window.analytics.methods=["identify","track","trackLink","trackForm","trackClick","trackSubmit","page","pageview","ab","alias","ready","group","on","once","off"],window.analytics.factory=function(t){return function(){var a=Array.prototype.slice.call(arguments);return a.unshift(t),window.analytics.push(a),window.analytics}};for(var i=0;i<window.analytics.methods.length;i++){var method=window.analytics.methods[i];window.analytics[method]=window.analytics.factory(method)}window.analytics.load=function(t){var a=document.createElement("script");a.type="text/javascript",a.async=!0,a.src=("https:"===document.location.protocol?"https://":"http://")+"d2dq2ahtl5zl1z.cloudfront.net/analytics.js/v1/"+t+"/analytics.min.js";var n=document.getElementsByTagName("script")[0];n.parentNode.insertBefore(a,n)},window.analytics.SNIPPET_VERSION="2.0.8",
window.analytics.load("7sgtwqvuai");
window.analytics.page();</script><noscript><iframe src="//www.googletagmanager.com/ns.html?id=GTM-PBJ84KX" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript><script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src='//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
})(window,document,'script','dataLayer','GTM-PBJ84KX');</script></head><body><div class="layout"><header class="header"><a class="header__drawer"><i class="header__icon" data-feather="menu"></i></a><a class="header__logo" href="/"><img class="header__logo--mobile" src="/dcosdocs/assets/D2iQ_Logotype_Color_Positive_Documentation.svg" alt="D2IQ"><img class="header__logo--desktop" src="/dcosdocs/assets/D2iQ_Logotype_Color_Positive_Documentation.svg" alt="D2IQ"></a><div class="header__main"><div class="header__dropdown"><img class="header__dropdown-icon" src="/dcosdocs/assets/D2IQ_Logotype_Color_Positive.png" alt="D2iQ"><strong>Kubernetes Documentation</strong><i data-feather="chevron-down"></i></div><nav class="header__menu"><ul class="header__menu-list"><li class="header__menu-item"><a href="https://support.d2iq.com">Support</a></li></ul></nav></div><div class="chooser" id="localizer"><div class="chooser-current"><a class="chooser-title">English</a><svg class="chooser-svg" id="localizer-svg"><path class="pointer" d="m 13,6 -5,5 -5,-5 z" fill="#858585"></path></svg></div><ul class="chooser-list" id="localizer-list"><li class="chooser-list-item"><a href="/dcosdocs/mesosphere/dcos/cn/services/kubernetes">中文 (简体)</a></li></ul></div><section class="header__search" role="search"><form class="header__search-form" action="/search/"><input class="header__search-input" id="header-search-input" tabindex="1" type="text" name="q" placeholder="Search"><input type="hidden" name="hFR[scope][0]" value="DC/OS Services"><label class="header__search-label" for="header-search-input"><i class="header__icon" data-feather="search"></i></label></form></section></header><div class="header-dropdown"><ul class="header-dropdown__list"><li class="header-dropdown__top-item"><div>DKP</div></li><li class="header-dropdown__item"><a href="/dkp/konvoy">Konvoy</a></li><li class="header-dropdown__item"><a href="/dkp/kommander">Kommander</a></li><li class="header-dropdown__item"><a href="/dkp/dispatch">Dispatch</a></li><li class="header-dropdown__item"><a href="/dkp/kaptain">Kaptain</a></li><li class="header-dropdown__top-item"><div>Mesosphere</div></li><li class="header-dropdown__item header-dropdown__item--active"><a href="/mesosphere/dcos">DC/OS</a></li><li class="header-dropdown__item header-dropdown__item--active"><a href="/dcosdocs/mesosphere/dcos/services">DC/OS Services</a></li><li class="header-dropdown__item"><a href="https://support.d2iq.com">Support</a></li></ul></div><div class="layout__sidebar layout__drawer"><section class="sidebar"><header class="sidebar__header"><div class="sidebar__dropdown"><ul><li><a href="/dcosdocs/mesosphere/dcos/services/kubernetes/2.8.0-1.19.2/operations/authn-and-authz">Kubernetes 2.8.0-1.19.2</a></li><li><a href="/dcosdocs/mesosphere/dcos/services/kubernetes/2.7.0-1.18.6/operations/authn-and-authz">Kubernetes 2.7.0-1.18.6</a></li><li><a href="/dcosdocs/mesosphere/dcos/services/kubernetes/2.6.1-1.17.8/operations/authn-and-authz">Kubernetes 2.6.1-1.17.8</a></li><li><a href="/dcosdocs/mesosphere/dcos/services/kubernetes/2.6.0-1.17.7/operations/authn-and-authz">Kubernetes 2.6.0-1.17.7</a></li><li><a href="/dcosdocs/mesosphere/dcos/services/kubernetes/2.5.0-1.16.9/operations/authn-and-authz">Kubernetes 2.5.0-1.16.9</a></li><li><a href="/dcosdocs/mesosphere/dcos/services/kubernetes/2.4.9-1.15.10/operations/authn-and-authz">Kubernetes 2.4.9-1.15.10</a></li><li><a href="/dcosdocs/mesosphere/dcos/services/kubernetes/2.4.8-1.15.10/operations/authn-and-authz">Kubernetes 2.4.8-1.15.10</a></li><li><a href="/dcosdocs/mesosphere/dcos/services/kubernetes/2.4.7-1.15.10/operations/authn-and-authz">Kubernetes 2.4.7-1.15.10</a></li><li><a href="/dcosdocs/mesosphere/dcos/services/kubernetes/2.4.6-1.15.6/operations/authn-and-authz">Kubernetes 2.4.6-1.15.6</a></li><li><a href="/dcosdocs/mesosphere/dcos/services/kubernetes/2.4.5-1.15.5/operations/authn-and-authz">Kubernetes 2.4.5-1.15.5</a></li><li><a href="/dcosdocs/mesosphere/dcos/services/kubernetes/2.4.4-1.15.4/operations/authn-and-authz">Kubernetes 2.4.4-1.15.4</a></li><li><a href="/dcosdocs/mesosphere/dcos/services/kubernetes/2.4.3-1.15.3/operations/authn-and-authz">Kubernetes 2.4.3-1.15.3</a></li><li><a href="/dcosdocs/mesosphere/dcos/services/kubernetes/2.4.2-1.15.3/operations/authn-and-authz">Kubernetes 2.4.2-1.15.3</a></li><li><a href="/dcosdocs/mesosphere/dcos/services/kubernetes/2.4.1-1.15.2/operations/authn-and-authz">Kubernetes 2.4.1-1.15.2</a></li><li><a href="/dcosdocs/mesosphere/dcos/services/kubernetes/2.4.10-1.15.10/operations/authn-and-authz">Kubernetes 2.4.10-1.15.10</a></li></ul><div class="toggle"><p><span class="title">Kubernetes</span><span class="version"> 2.4.3-1.15.3</span></p><i data-feather="chevron-down"></i></div></div></header><nav class="sidebar_nav" role="navigation"><ul><li><a class="d0" href="/dcosdocs/mesosphere/dcos/services/kubernetes/2.4.3-1.15.3/release-notes/">Release Notes</a></li><li><a class="d0" href="/dcosdocs/mesosphere/dcos/services/kubernetes/2.4.3-1.15.3/overview/">Overview</a></li><li><a class="d0" href="/dcosdocs/mesosphere/dcos/services/kubernetes/2.4.3-1.15.3/getting-started/"><i data-feather="chevron-right"></i>Tutorial - Kubernetes on DC/OS Enterprise</a></li><li class="active"><a class="d0" href="/dcosdocs/mesosphere/dcos/services/kubernetes/2.4.3-1.15.3/operations/"><i data-feather="chevron-right"></i>Operations</a></li><ul><li><a class="d1" href="/dcosdocs/mesosphere/dcos/services/kubernetes/2.4.3-1.15.3/operations/cluster-sizing/">Cluster Sizing</a></li><li><a class="d1" href="/dcosdocs/mesosphere/dcos/services/kubernetes/2.4.3-1.15.3/operations/kubernetes-audit/">Kubernetes Auditing</a></li><li><a class="d1" href="/dcosdocs/mesosphere/dcos/services/kubernetes/2.4.3-1.15.3/operations/kubernetes-dashboard/">Kubernetes Dashboard</a></li><li><a class="d1" href="/dcosdocs/mesosphere/dcos/services/kubernetes/2.4.3-1.15.3/operations/metrics-exporter/">Metrics Exporter</a></li><li><a class="d1" href="/dcosdocs/mesosphere/dcos/services/kubernetes/2.4.3-1.15.3/operations/quota-support/">Quota Support</a></li><li><a class="d1" href="/dcosdocs/mesosphere/dcos/services/kubernetes/2.4.3-1.15.3/operations/ingress/">External Ingress</a></li><li class="active active-on"><a class="d1" href="/dcosdocs/mesosphere/dcos/services/kubernetes/2.4.3-1.15.3/operations/authn-and-authz/">Authentication and Authorization</a></li><li><a class="d1" href="/dcosdocs/mesosphere/dcos/services/kubernetes/2.4.3-1.15.3/operations/customizing-install/">Customizing</a></li><li><a class="d1" href="/dcosdocs/mesosphere/dcos/services/kubernetes/2.4.3-1.15.3/operations/upgrade/">Upgrade</a></li><li><a class="d1" href="/dcosdocs/mesosphere/dcos/services/kubernetes/2.4.3-1.15.3/operations/storage/"><i data-feather="chevron-right"></i>Storage</a></li><li><a class="d1" href="/dcosdocs/mesosphere/dcos/services/kubernetes/2.4.3-1.15.3/operations/exposing-the-kubernetes-api/">Exposing the Kubernetes API</a></li><li><a class="d1" href="/dcosdocs/mesosphere/dcos/services/kubernetes/2.4.3-1.15.3/operations/exposing-the-kubernetes-api-marathonlb-edgelb/">Exposing the Kubernetes API via Marathon-LB or Edge-LB</a></li><li><a class="d1" href="/dcosdocs/mesosphere/dcos/services/kubernetes/2.4.3-1.15.3/operations/connecting-clients/">Connecting Clients</a></li><li><a class="d1" href="/dcosdocs/mesosphere/dcos/services/kubernetes/2.4.3-1.15.3/operations/uninstall/">Uninstall</a></li><li><a class="d1" href="/dcosdocs/mesosphere/dcos/services/kubernetes/2.4.3-1.15.3/operations/private-docker-registry/">Use private Docker registry</a></li><li><a class="d1" href="/dcosdocs/mesosphere/dcos/services/kubernetes/2.4.3-1.15.3/operations/disaster-recovery/">Disaster Recovery</a></li><li><a class="d1" href="/dcosdocs/mesosphere/dcos/services/kubernetes/2.4.3-1.15.3/operations/troubleshooting/">Troubleshooting</a></li></ul><li><a class="d0" href="/dcosdocs/mesosphere/dcos/services/kubernetes/2.4.3-1.15.3/cli/">CLI</a></li><li><a class="d0" href="/dcosdocs/mesosphere/dcos/services/kubernetes/2.4.3-1.15.3/limitations/">Limitations</a></li><li><a class="d0" href="/dcosdocs/mesosphere/dcos/services/kubernetes/2.4.3-1.15.3/changelog/">Changelog</a></li><li><a class="d0" href="/dcosdocs/mesosphere/dcos/services/kubernetes/2.4.3-1.15.3/supported-versions/">Supported Versions</a></li></ul></nav><footer class="sidebar__footer"><div class="sidebar__footer-links"><a href="https://d2iq.com/terms/">Terms of Service</a><a href="https://d2iq.com/privacy/">Privacy Policy</a></div><a class="sidebar__footer-copyright" href="https://d2iq.com/">&copy; 2022 D2iQ, Inc. All rights reserved.</a></footer></section></div><div class="layout__content" role="main"><main class="content"><div class="content__container content__container--with-sections"><div class="content__header"><div class="content__header__row"><h1 class="content__header-title">Authentication and Authorization</h1></div><h4 class="content__header-description">Authentication and authorization modes for DC/OS Kubernetes</h4><div class="actions"><ul class="actions__list"><li class="actions__item"><button class="actions__link" onclick="javascript:window.print()"><i class="actions__icon" data-feather="printer"></i><span class="actions__text">Print</span></button></li><li class="actions__item"><a class="actions__link" href="https://github.com/mesosphere/dcos-docs-site/tree/main/pages/dcosdocs/mesosphere/dcos/services/kubernetes/2.4.3-1.15.3/operations/authn-and-authz/index.md" target="_blank"><i class="actions__icon" data-feather="github"></i><span class="actions__text">Contribute</span></a></li></ul></div></div><article class="content__article"><!-- This source repo for this topic is https://github.com/mesosphere/dcos-kubernetes-cluster -->
<h1 id="authorization-modes"><a class="content__anchor" href="#authorization-modes" aria-hidden="true"><i data-feather="bookmark"></i></a>Authorization Modes</h1>
<p>DC/OS Kubernetes supports the following <a href="https://kubernetes.io/docs/reference/access-authn-authz/authorization/#authorization-modules">Kubernetes authorization modes</a>:</p>
<ul>
<li><code>AlwaysAllow</code>, the default, all-permissive mode.</li>
<li><code>RBAC</code>, a fine-grained control of <em>who</em> can access <em>what</em> Kubernetes API resources.</li>
</ul>
<p class="message--warning"><strong>WARNING: </strong>The authorization mode for a cluster must be chosen when installing the package. Changing the authorization mode after installing the package is not supported.
</p>
<h2 id="alwaysallow"><a class="content__anchor" href="#alwaysallow" aria-hidden="true"><i data-feather="bookmark"></i></a><code>AlwaysAllow</code></h2>
<p>The default authorization mode in DC/OS Kubernetes is <code>AlwaysAllow</code>. This means that every authenticated request to the Kubernetes API will be authorized.</p>
<h2 id="rbac"><a class="content__anchor" href="#rbac" aria-hidden="true"><i data-feather="bookmark"></i></a><code>RBAC</code></h2>
<p>To enable <code>RBAC</code> authorization mode set the value of the <code>kubernetes.authorization_mode</code> configuration property to <code>RBAC</code>.</p>
<p>This is done when installing the package, either via the UI:</p>
<p><img src="/dcosdocs/mesosphere/dcos/services/kubernetes/2.4.3-1.15.3/img/authorization-mode.png" alt="alt text" title="Authorization Mode"></p>
<p>Figure 1. Setting the authorization mode</p>
<p>Or, alternatively, via the CLI, with custom options:</p>
<pre><code class="language-json">{
  &quot;kubernetes&quot;: {
    &quot;authorization_mode&quot;: &quot;RBAC&quot;
  }
}
</code></pre>
<h1 id="giving-users-access-to-the-kubernetes-api"><a class="content__anchor" href="#giving-users-access-to-the-kubernetes-api" aria-hidden="true"><i data-feather="bookmark"></i></a>Giving users access to the Kubernetes API</h1>
<p>This package does not provide integration with DC/OS authentication or authorization, meaning a DC/OS user will not be a valid Kubernetes user.  This means the following:</p>
<ul>
<li>Kubernetes API <strong>Users</strong> will be modelled as Kubernetes service-accounts.</li>
<li>The install procedure will create a user (<code>bootstrapper</code>) with superuser privileges (<code>cluster-admin</code> cluster role), that can be used later by the operator to add more users - and their respective permissions if <code>RBAC</code> authorization mode is enabled.</li>
</ul>
<p class="message--warning"><strong>WARNING: </strong>We <strong>highly recommend</strong> the operator to create a service account for every user wanting access to the Kubernetes cluster (for example, using <tt>kubectl create serviceaccount</tt>), and give this service account only the permissions needed by each user (for example, using <tt>kubectl create [cluster]rolebinding</tt>).</p>
<p>We also <strong>highly recommend</strong> that the operator create new service account(s) for themselves and entirely remove the <code>bootstrapper</code> service account.</p>
<h2 id="creating-kubernetes-service-accounts-roles-and-role-bindings"><a class="content__anchor" href="#creating-kubernetes-service-accounts-roles-and-role-bindings" aria-hidden="true"><i data-feather="bookmark"></i></a>Creating Kubernetes service accounts, roles and role bindings</h2>
<p class="message--note"><strong>NOTE: </strong> Fine-grained authorization control with service accounts will only work when RBAC authorization mode is selected.</p>
<p>Once <a href="/dcosdocs/mesosphere/dcos/services/kubernetes/2.4.3-1.15.3/operations/connecting-clients/">kubectl is setup for the bootstrap user</a> you may wish to grant other users access to specific resources running in the cluster.
Below are examples on how to create service accounts and grant those accounts different permissions in the cluster.</p>
<h3 id="pre-defined-roles"><a class="content__anchor" href="#pre-defined-roles" aria-hidden="true"><i data-feather="bookmark"></i></a>Pre-defined roles</h3>
<p>A few roles are <a href="https://kubernetes.io/docs/reference/access-authn-authz/rbac/#user-facing-roles">automatically created</a> when a Kubernetes cluster is installed; these include <code>cluster-admin</code>, <code>admin</code>, <code>edit</code> and <code>view</code>.</p>
<p>Below is an example of creating a user with <code>view</code> permissions on the <code>my-namespace</code> namespace; this method can be adapted to any other user or role:</p>
<pre><code class="language-shell">kubectl create serviceaccount my-sa
kubectl create rolebinding my-sa-view \
  --clusterrole=view \
  --serviceaccount=my-namespace:my-sa \
  --namespace=my-namespace
</code></pre>
<h3 id="custom-roles"><a class="content__anchor" href="#custom-roles" aria-hidden="true"><i data-feather="bookmark"></i></a>Custom roles</h3>
<p>In addition to the pre-defined roles, you may want to grant users customized permissions.
As an example we shall create a user, <code>my-pod-sa</code>, that can only view <strong>pods</strong> in the <code>my-namespace</code> namespace.</p>
<ol>
<li>First create a service account:</li>
</ol>
<pre><code class="language-shell">kubectl create serviceaccount my-pod-sa -n my-namespace
</code></pre>
<ol start="2">
<li>Then create a <code>Role</code> definition called <code>pod-reader</code>:</li>
</ol>
<pre><code class="language-shell">cat &lt;&lt;EOF | kubectl create -f -
kind: Role
apiVersion: rbac.authorization.k8s.io/v1
metadata:
  namespace: my-namespace
  name: pod-reader
rules:
- apiGroups: [&quot;&quot;] # &quot;&quot; indicates the core API group
  resources: [&quot;pods&quot;]
  verbs: [&quot;get&quot;, &quot;watch&quot;, &quot;list&quot;]
EOF
</code></pre>
<ol start="3">
<li>Finally, bind the service account <code>my-pod-sa</code> to the new <code>pod-reader</code> role:</li>
</ol>
<pre><code class="language-shell">kubectl create rolebinding my-pod-sa-view \
  --role=pod-reader \
  --serviceaccount=my-namespace:my-pod-sa \
  --namespace=my-namespace
</code></pre>
<p>To retrieve the generated token for <code>my-pod-sa</code> service account that can later be used to configure <code>kubectl</code> or access the <a href="/dcosdocs/mesosphere/dcos/services/kubernetes/2.4.3-1.15.3/operations/kubernetes-dashboard/">Kubernetes Dashboard</a>, get the secret name and then that secret’s token:</p>
<pre><code class="language-shell">export SECRET=&quot;$(kubectl get sa my-pod-sa -o 'jsonpath={.secrets[0].name}' -n my-namespace)&quot;
kubectl describe secrets $SECRET -n my-namespace | awk '$1==&quot;token:&quot;{print $2}'
</code></pre>
<p>See the <a href="https://kubernetes.io/docs/reference/access-authn-authz/rbac/#user-facing-roles">Kubernetes RBAC documentation</a> for more detail on creating roles and binding those roles to service accounts.</p>
</article></div><aside class="content__sections"><div class="content__sections-list-container"><ul class="content__sections-list"><li class="content__sections-item content__sections-item--h1"><a href="#authorization-modes">Authorization Modes</a></li><li class="content__sections-item content__sections-item--h2"><a href="#alwaysallow">AlwaysAllow</a></li><li class="content__sections-item content__sections-item--h2"><a href="#rbac">RBAC</a></li><li class="content__sections-item content__sections-item--h1"><a href="#giving-users-access-to-the-kubernetes-api">Giving users access to the Kubernetes API</a></li><li class="content__sections-item content__sections-item--h2"><a href="#creating-kubernetes-service-accounts-roles-and-role-bindings">Creating Kubernetes service accounts, roles and role bindings</a></li></ul></div></aside></main></div></div><script src="/dcosdocs/assets/js/jquery-3.2.1.js"></script><script src="/dcosdocs/assets/js/clipboard.js"></script><script src="/dcosdocs/assets/js/prism.js"></script><script src="/js/main.js"></script></body></html>