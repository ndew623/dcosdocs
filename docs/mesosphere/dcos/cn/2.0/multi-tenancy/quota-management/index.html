<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width" initial-scale="1" user-scalable="no"><title>配额管理 - D2iQ Docs</title><meta name="description" content="为多租户使用组和配额管理"><link rel="apple-touch-icon" sizes="180x180" href="/assets/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/favicon-16x16.png"><link rel="stylesheet" type="text/css" href="/css/styles.css"><link rel="search" type="application/opensearchdescription+xml" href="/assets/opensearch.xml" title="Search"><link href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,500,500i,700,700i" rel="stylesheet"><script src="https://unpkg.com/feather-icons/dist/feather.min.js"></script><script>window.analytics||(window.analytics=[]),window.analytics.methods=["identify","track","trackLink","trackForm","trackClick","trackSubmit","page","pageview","ab","alias","ready","group","on","once","off"],window.analytics.factory=function(t){return function(){var a=Array.prototype.slice.call(arguments);return a.unshift(t),window.analytics.push(a),window.analytics}};for(var i=0;i<window.analytics.methods.length;i++){var method=window.analytics.methods[i];window.analytics[method]=window.analytics.factory(method)}window.analytics.load=function(t){var a=document.createElement("script");a.type="text/javascript",a.async=!0,a.src=("https:"===document.location.protocol?"https://":"http://")+"d2dq2ahtl5zl1z.cloudfront.net/analytics.js/v1/"+t+"/analytics.min.js";var n=document.getElementsByTagName("script")[0];n.parentNode.insertBefore(a,n)},window.analytics.SNIPPET_VERSION="2.0.8",
window.analytics.load("7sgtwqvuai");
window.analytics.page();</script><noscript><iframe src="//www.googletagmanager.com/ns.html?id=GTM-PBJ84KX" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript><script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src='//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
})(window,document,'script','dataLayer','GTM-PBJ84KX');</script></head><body><div class="layout"><header class="header"><a class="header__drawer"><i class="header__icon" data-feather="menu"></i></a><a class="header__logo" href="/"><img class="header__logo--mobile" src="/assets/D2iQ_Logotype_Color_Positive_Documentation.svg" alt="D2IQ"><img class="header__logo--desktop" src="/assets/D2iQ_Logotype_Color_Positive_Documentation.svg" alt="D2IQ"></a><div class="header__main"><div class="header__dropdown"><img class="header__dropdown-icon" src="/assets/D2IQ_Logotype_Color_Positive.png" alt="D2iQ"><strong>DC/OS文档</strong><i data-feather="chevron-down"></i></div><nav class="header__menu"><ul class="header__menu-list"><li class="header__menu-item"><a href="https://support.d2iq.com">Support</a></li></ul></nav></div><div class="chooser" id="localizer"><div class="chooser-current"><a class="chooser-title">中文 (简体)</a><svg class="chooser-svg" id="localizer-svg"><path class="pointer" d="m 13,6 -5,5 -5,-5 z" fill="#858585"></path></svg></div><ul class="chooser-list" id="localizer-list"><li class="chooser-list-item"><a href="/dcosdocs/mesosphere/dcos/2.0/multi-tenancy/quota-management">English</a></li></ul></div><section class="header__search" role="search"><form class="header__search-form" action="/search/"><input class="header__search-input" id="header-search-input" tabindex="1" type="text" name="q" placeholder="Search"><input type="hidden" name="hFR[scope][0]" value="DC/OS 2.0"><label class="header__search-label" for="header-search-input"><i class="header__icon" data-feather="search"></i></label></form></section></header><div class="header-dropdown"><ul class="header-dropdown__list"><li class="header-dropdown__top-item"><div>DKP</div></li><li class="header-dropdown__item"><a href="/dkp/konvoy">Konvoy</a></li><li class="header-dropdown__item"><a href="/dkp/kommander">Kommander</a></li><li class="header-dropdown__item"><a href="/dkp/dispatch">Dispatch</a></li><li class="header-dropdown__item"><a href="/dkp/kaptain">Kaptain</a></li><li class="header-dropdown__top-item"><div>Mesosphere</div></li><li class="header-dropdown__item header-dropdown__item--active"><a href="/mesosphere/dcos">DC/OS</a></li><li class="header-dropdown__item"><a href="/dcosdocs/mesosphere/dcos/services">DC/OS Services</a></li><li class="header-dropdown__item"><a href="https://support.d2iq.com">Support</a></li></ul></div><div class="layout__sidebar layout__drawer"><section class="sidebar"><header class="sidebar__header"><div class="sidebar__dropdown"><ul><li><a href="/dcosdocs/mesosphere/dcos/cn/2.1/multi-tenancy/quota-management">Mesosphere DC/OS 2.1.0</a></li><li><a href="/dcosdocs/mesosphere/dcos/cn/2.0/multi-tenancy/quota-management">Mesosphere DC/OS 2.0</a></li><li><a href="/dcosdocs/mesosphere/dcos/cn/1.13">Mesosphere DC/OS 1.13</a></li></ul><div class="toggle"><p><span class="title">DC/OS</span><span class="version"> 2.0</span></p><i data-feather="chevron-down"></i></div></div></header><nav class="sidebar_nav" role="navigation"><ul><li><a class="d0" href="/dcosdocs/mesosphere/dcos/cn/2.0/release-notes/"><i data-feather="chevron-right"></i>版本注释</a></li><li><a class="d0" href="/dcosdocs/mesosphere/dcos/cn/2.0/overview/"><i data-feather="chevron-right"></i>概述</a></li><li><a class="d0" href="/dcosdocs/mesosphere/dcos/cn/2.0/installing/"><i data-feather="chevron-right"></i>安装</a></li><li><a class="d0" href="/dcosdocs/mesosphere/dcos/cn/2.0/gui/"><i data-feather="chevron-right"></i>GUI</a></li><li><a class="d0" href="/dcosdocs/mesosphere/dcos/cn/2.0/cli/"><i data-feather="chevron-right"></i>CLI</a></li><li><a class="d0" href="/dcosdocs/mesosphere/dcos/cn/2.0/administering-clusters/"><i data-feather="chevron-right"></i>管理群集</a></li><li><a class="d0" href="/dcosdocs/mesosphere/dcos/cn/2.0/networking/"><i data-feather="chevron-right"></i>网络</a></li><li><a class="d0" href="/dcosdocs/mesosphere/dcos/cn/2.0/security/"><i data-feather="chevron-right"></i>安全</a></li><li><a class="d0" href="/dcosdocs/mesosphere/dcos/cn/2.0/storage/"><i data-feather="chevron-right"></i>存储</a></li><li><a class="d0" href="/dcosdocs/mesosphere/dcos/cn/2.0/metrics/"><i data-feather="chevron-right"></i>度量标准</a></li><li><a class="d0" href="/dcosdocs/mesosphere/dcos/cn/2.0/monitoring/"><i data-feather="chevron-right"></i>监控、日志记录和调试</a></li><li class="active"><a class="d0" href="/dcosdocs/mesosphere/dcos/cn/2.0/multi-tenancy/"><i data-feather="chevron-right"></i>DC/OS 群集的多租户</a></li><ul><li class="active active-on"><a class="d1" href="/dcosdocs/mesosphere/dcos/cn/2.0/multi-tenancy/quota-management/">配额管理</a></li><li><a class="d1" href="/dcosdocs/mesosphere/dcos/cn/2.0/multi-tenancy/resource-mgmt-primitives/">资源管理原语</a></li></ul><li><a class="d0" href="/dcosdocs/mesosphere/dcos/cn/2.0/hybrid-cloud/"><i data-feather="chevron-right"></i>混合云</a></li><li><a class="d0" href="/dcosdocs/mesosphere/dcos/cn/2.0/deploying-jobs/"><i data-feather="chevron-right"></i>部署作业</a></li><li><a class="d0" href="/dcosdocs/mesosphere/dcos/cn/2.0/deploying-services/"><i data-feather="chevron-right"></i>部署服务和 Pod</a></li><li><a class="d0" href="/dcosdocs/mesosphere/dcos/cn/2.0/tutorials/"><i data-feather="chevron-right"></i>教程</a></li><li><a class="d0" href="/dcosdocs/mesosphere/dcos/cn/2.0/api/"><i data-feather="chevron-right"></i>API 参考</a></li><li><a class="d0" href="/dcosdocs/mesosphere/dcos/cn/2.0/developing-services/"><i data-feather="chevron-right"></i>开发 DC/OS 服务</a></li></ul></nav><footer class="sidebar__footer"><div class="sidebar__footer-links"><a href="https://d2iq.com/terms/">Terms of Service</a><a href="https://d2iq.com/privacy/">Privacy Policy</a></div><a class="sidebar__footer-copyright" href="https://d2iq.com/">&copy; 2022 D2iQ, Inc. All rights reserved.</a></footer></section></div><div class="layout__content" role="main"><main class="content"><div class="content__container content__container--with-sections"><div class="content__header"><div class="content__header__row"><h1 class="content__header-title">配额管理</h1></div><h4 class="content__header-description">为多租户使用组和配额管理</h4><div class="actions"><ul class="actions__list"><li class="actions__item"><button class="actions__link" onclick="javascript:window.print()"><i class="actions__icon" data-feather="printer"></i><span class="actions__text">Print</span></button></li><li class="actions__item"><a class="actions__link" href="https://github.com/mesosphere/dcos-docs-site/tree/main/pages/dcosdocs/mesosphere/dcos/cn/2.0/multi-tenancy/quota-management/index.md" target="_blank"><i class="actions__icon" data-feather="github"></i><span class="actions__text">Contribute</span></a></li></ul></div></div><article class="content__article"><p>组为支持使用 Mesosphere® DC/OS™ 的多租户群集而提供基础。组让您能够创建服务、权限、密匙和配额的逻辑集合。然后，您可以使用这些逻辑集合将组映射到特定团队、项目或业务线。</p>
<p>本部分的主题讨论如何通过设置配额限制来使用 <strong>组</strong> 管理资源，从而支持多租户。</p>
<h1 id=""><a class="content__anchor" href="#" aria-hidden="true"><i data-feather="bookmark"></i></a>配额</h1>
<p>您可以定义 <strong>配额</strong> 来指定组中服务可以使用的最大资源。达到配额限制后，不允许任何新服务或扩展现有服务。</p>
<p>DC/OS 中的配额建立在 Apache® Mesos® 中的 <a href="https://mesos.apache.org/documentation/latest/quota/">配额限制</a> 原语之上。
具体来说，顶级 DC/OS 组上的配额集（例如，“/dev”）被转换为对 Mesos 中的相应资源角色（例如，“Dev”）设置配额限制。
另外，在给定组内启动的服务配置成使用分配给 <strong>组角色</strong> （例如，“Dev”）的资源，以便可以通过定义的配额来限制其资源消耗。</p>
<h1 id="-2"><a class="content__anchor" href="#-2" aria-hidden="true"><i data-feather="bookmark"></i></a>先决条件</h1>
<ul>
<li>
<p><a href="/dcosdocs/mesosphere/dcos/cn/2.0/cli/">已安装并配置 DC/OS CLI</a>。</p>
</li>
<li>
<p>有足够 <a href="/dcosdocs/mesosphere/dcos/cn/2.0/security/ent/perms-reference">权限</a> 管理配额（仅限 Enterprise DC/OS）。</p>
<p>配额管理操作通常由群集管理员执行。</p>
</li>
</ul>
<h1 id="-3"><a class="content__anchor" href="#-3" aria-hidden="true"><i data-feather="bookmark"></i></a>创建组</h1>
<p>要创建新组、dev，使用以下命令：</p>
<pre><code class="language-bash">dcos marathon group add --id /dev. # If the group doesn't exist
</code></pre>
<h1 id="-4"><a class="content__anchor" href="#-4" aria-hidden="true"><i data-feather="bookmark"></i></a>设置配额</h1>
<p>首次为某个组设置配额时，请使用以下命令：</p>
<pre><code class="language-bash">dcos quota create dev --cpu 10 --mem 1024
</code></pre>
<h1 id="-5"><a class="content__anchor" href="#-5" aria-hidden="true"><i data-feather="bookmark"></i></a>查看配额</h1>
<p>要查看组的配额限制和消耗，请使用以下命令：</p>
<pre><code class="language-bash">dcos quota get dev
</code></pre>
<p>您还可以转到 <strong>服务</strong> 视图中“配额”选项卡，查看 DC/OS UI 中的配额信息。</p>
<h1 id="-6"><a class="content__anchor" href="#-6" aria-hidden="true"><i data-feather="bookmark"></i></a>更新配额</h1>
<p>要更新组上的现有配额，请使用以下命令：</p>
<pre><code class="language-bash">dcos quota update dev --cpu 20 --mem 2048
</code></pre>
<h1 id="-7"><a class="content__anchor" href="#-7" aria-hidden="true"><i data-feather="bookmark"></i></a>删除配额</h1>
<p>要从组中删除现有配额，请使用以下命令：</p>
<pre><code class="language-bash">dcos quota delete dev
</code></pre>
<p>请注意，删除配额不会影响组内任何正在运行的服务。服务将继续运行，但不会再受配额限制。</p>
<h1 id="-8"><a class="content__anchor" href="#-8" aria-hidden="true"><i data-feather="bookmark"></i></a>部署服务</h1>
<p>在管理员为某个组设置配额后，常规用户可跟往常一样在组中部署服务。如果对组设置 <code>enforceRole</code> 属性，服务将会自动配置为使用组角色，并因此受配额限制。如果未设置属性，但用户希望其服务受配额限制，可以为其服务手动配置组角色。</p>
<h1 id="-9"><a class="content__anchor" href="#-9" aria-hidden="true"><i data-feather="bookmark"></i></a>迁移服务</h1>
<p>为了实现向后兼容，所有现有顶级组都会将 <code>enforceRole</code> 属性设置为 false。因此，这些组中所启动的现有和新服务都将继续使用其传统角色，而非组角色。要修改此设置并导致新服务消耗配额，请运行：</p>
<pre><code class="language-bash">dcos marathon group update /dev enforeceRole=true # only needed for groups created before DC/OS 2.0
</code></pre>
<p>现有服务将继续不消耗配额，必须进行迁移。要将使用传统角色的无状态服务迁移到组角色，用户可通过应用程序或 pod 更新来更新服务的角色字段：</p>
<pre><code class="language-bash">dcos marathon app update /dev/my-app role=dev
</code></pre>
<p>要迁移有状态服务（例如，用于 Kafka® 的 DC/OS 服务、用于 Cassandra® 的 DC/OS 服务），用户必须更新服务角色，并为每个相应的 Pod 运行 <code>pod replace</code> 命令。请注意，<code>pod replace</code> 命令会导致本地持久数据丢失。</p>
<p>在运行 <code>pod replace</code> 命令之前：</p>
<ol>
<li>
<p>创建群集状态备份。</p>
</li>
<li>
<p>确保基础服务复制可以一次处理一个节点的数据丢失。</p>
</li>
<li>
<p>运行以下命令来更新服务角色：</p>
<pre><code class="language-bash">dcos kafka --name=/&lt;group&gt;/kafka update start --package-version=&quot;&lt;version-supporting-group-role&gt;&quot;
</code></pre>
</li>
</ol>
<p>完成上述步骤后，针对每个 pod 运行以下命令：</p>
<pre><code class="language-bash">dcos kafka --name=/&lt;group&gt;/kafka pod replace &lt;pod-name&gt;
</code></pre>
<h1 id="-10"><a class="content__anchor" href="#-10" aria-hidden="true"><i data-feather="bookmark"></i></a>限制</h1>
<ul>
<li>您只能在顶级组（例如，&quot;/dev&quot;) 而非嵌套组 (&quot;/dev/foo&quot;) 中设置配额。</li>
<li>根组中运行的服务（例如，/app）不按配额执行。</li>
<li>并非所有目录服务都是按配额执行的。有关详细信息，请参阅具体的服务文档。</li>
<li>作业不按配额执行。</li>
<li>在不导致数据丢失的情况下，无法进行有状态服务迁移。</li>
</ul>
<h1 id="-11"><a class="content__anchor" href="#-11" aria-hidden="true"><i data-feather="bookmark"></i></a>其他资源</h1>
<p>您可以使用以下额外资源，了解有关使用配额限制的更多信息：</p>
<ul>
<li><a href="https://mesos.apache.org/documentation/latest/quota/">Mesos API</a></li>
</ul>
</article></div><aside class="content__sections"><div class="content__sections-list-container"><ul class="content__sections-list"><li class="content__sections-item content__sections-item--h1"><a href="#配额">配额</a></li><li class="content__sections-item content__sections-item--h1"><a href="#-2">先决条件</a></li><li class="content__sections-item content__sections-item--h1"><a href="#-3">创建组</a></li><li class="content__sections-item content__sections-item--h1"><a href="#-4">设置配额</a></li><li class="content__sections-item content__sections-item--h1"><a href="#-5">查看配额</a></li><li class="content__sections-item content__sections-item--h1"><a href="#-6">更新配额</a></li><li class="content__sections-item content__sections-item--h1"><a href="#-7">删除配额</a></li><li class="content__sections-item content__sections-item--h1"><a href="#-8">部署服务</a></li><li class="content__sections-item content__sections-item--h1"><a href="#-9">迁移服务</a></li><li class="content__sections-item content__sections-item--h1"><a href="#-10">限制</a></li><li class="content__sections-item content__sections-item--h1"><a href="#-11">其他资源</a></li></ul></div></aside></main></div></div><script src="/assets/js/jquery-3.2.1.js"></script><script src="/assets/js/clipboard.js"></script><script src="/assets/js/prism.js"></script><script src="/js/main.js"></script></body></html>