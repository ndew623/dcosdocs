<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width" initial-scale="1" user-scalable="no"><title>Slow Docker Apps and Deployments - D2iQ Docs</title><meta name="description" content="Troubleshooting slow Docker apps and deployments"><link rel="apple-touch-icon" sizes="180x180" href="/assets/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/favicon-16x16.png"><link rel="stylesheet" type="text/css" href="/css/styles.css"><link rel="search" type="application/opensearchdescription+xml" href="/assets/opensearch.xml" title="Search"><link href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,500,500i,700,700i" rel="stylesheet"><script src="https://unpkg.com/feather-icons/dist/feather.min.js"></script><script>window.analytics||(window.analytics=[]),window.analytics.methods=["identify","track","trackLink","trackForm","trackClick","trackSubmit","page","pageview","ab","alias","ready","group","on","once","off"],window.analytics.factory=function(t){return function(){var a=Array.prototype.slice.call(arguments);return a.unshift(t),window.analytics.push(a),window.analytics}};for(var i=0;i<window.analytics.methods.length;i++){var method=window.analytics.methods[i];window.analytics[method]=window.analytics.factory(method)}window.analytics.load=function(t){var a=document.createElement("script");a.type="text/javascript",a.async=!0,a.src=("https:"===document.location.protocol?"https://":"http://")+"d2dq2ahtl5zl1z.cloudfront.net/analytics.js/v1/"+t+"/analytics.min.js";var n=document.getElementsByTagName("script")[0];n.parentNode.insertBefore(a,n)},window.analytics.SNIPPET_VERSION="2.0.8",
window.analytics.load("7sgtwqvuai");
window.analytics.page();</script><noscript><iframe src="//www.googletagmanager.com/ns.html?id=GTM-PBJ84KX" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript><script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src='//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
})(window,document,'script','dataLayer','GTM-PBJ84KX');</script></head><body><div class="layout"><header class="header"><a class="header__drawer"><i class="header__icon" data-feather="menu"></i></a><a class="header__logo" href="/"><img class="header__logo--mobile" src="/assets/D2iQ_Logotype_Color_Positive_Documentation.svg" alt="D2IQ"><img class="header__logo--desktop" src="/assets/D2iQ_Logotype_Color_Positive_Documentation.svg" alt="D2IQ"></a><div class="header__main"><div class="header__dropdown"><img class="header__dropdown-icon" src="/assets/D2IQ_Logotype_Color_Positive.png" alt="D2iQ"><strong>DC/OS Documentation</strong><i data-feather="chevron-down"></i></div><nav class="header__menu"><ul class="header__menu-list"><li class="header__menu-item"><a href="/mesosphere/dcos">DC/OS</a></li><li class="header__menu-item"><a href="/mesosphere/dcos/services">Services</a></li><li class="header__menu-item"><a href="https://support.d2iq.com">Support</a></li></ul></nav></div><div class="chooser" id="localizer"><div class="chooser-current"><a class="chooser-title">English</a><svg class="chooser-svg" id="localizer-svg"><path class="pointer" d="m 13,6 -5,5 -5,-5 z" fill="#858585"></path></svg></div><ul class="chooser-list" id="localizer-list"><li class="chooser-list-item"><a href="/mesosphere/dcos/cn/1.13/monitoring/debugging/slow-docker">中文 (简体)</a></li></ul></div><section class="header__search" role="search"><form class="header__search-form" action="/search/"><input class="header__search-input" id="header-search-input" tabindex="1" type="text" name="q" placeholder="Search"><input type="hidden" name="hFR[scope][0]" value="DC/OS 1.13"><label class="header__search-label" for="header-search-input"><i class="header__icon" data-feather="search"></i></label></form></section></header><div class="header-dropdown"><ul class="header-dropdown__list"><li class="header-dropdown__top-item"><div>DKP</div></li><li class="header-dropdown__item"><a href="/dkp/konvoy">Konvoy</a></li><li class="header-dropdown__item"><a href="/dkp/kommander">Kommander</a></li><li class="header-dropdown__item"><a href="/dkp/dispatch">Dispatch</a></li><li class="header-dropdown__item"><a href="/dkp/kaptain">Kaptain</a></li><li class="header-dropdown__top-item"><div>Mesosphere</div></li><li class="header-dropdown__item header-dropdown__item--active"><a href="/mesosphere/dcos">DC/OS</a></li><li class="header-dropdown__item"><a href="/mesosphere/dcos/services">DC/OS Services</a></li><li class="header-dropdown__item"><a href="https://support.d2iq.com">Support</a></li></ul></div><div class="layout__sidebar layout__drawer"><section class="sidebar"><header class="sidebar__header"><div class="sidebar__dropdown"><ul><li><a href="/mesosphere/dcos/2.2/monitoring/debugging/slow-docker">Mesosphere DC/OS 2.2.0</a></li><li><a href="/mesosphere/dcos/2.1/monitoring/debugging/slow-docker">Mesosphere DC/OS 2.1.0</a></li><li><a href="/mesosphere/dcos/2.0/monitoring/debugging/slow-docker">Mesosphere DC/OS 2.0</a></li><li><a href="/mesosphere/dcos/1.13/monitoring/debugging/slow-docker">Mesosphere DC/OS 1.13</a></li></ul><div class="toggle"><p><span class="title">DC/OS</span><span class="version"> 1.13</span></p><i data-feather="chevron-down"></i></div></div></header><nav class="sidebar_nav" role="navigation"><ul><li><a class="d0" href="/mesosphere/dcos/1.13/release-notes/"><i data-feather="chevron-right"></i>Release Notes</a></li><li><a class="d0" href="/mesosphere/dcos/1.13/overview/"><i data-feather="chevron-right"></i>Overview</a></li><li><a class="d0" href="/mesosphere/dcos/1.13/installing/"><i data-feather="chevron-right"></i>Installing</a></li><li><a class="d0" href="/mesosphere/dcos/1.13/gui/"><i data-feather="chevron-right"></i>GUI</a></li><li><a class="d0" href="/mesosphere/dcos/1.13/cli/"><i data-feather="chevron-right"></i>CLI</a></li><li><a class="d0" href="/mesosphere/dcos/1.13/administering-clusters/"><i data-feather="chevron-right"></i>Administering Clusters</a></li><li><a class="d0" href="/mesosphere/dcos/1.13/networking/"><i data-feather="chevron-right"></i>Networking</a></li><li><a class="d0" href="/mesosphere/dcos/1.13/security/"><i data-feather="chevron-right"></i>Security</a></li><li><a class="d0" href="/mesosphere/dcos/1.13/storage/"><i data-feather="chevron-right"></i>Storage</a></li><li><a class="d0" href="/mesosphere/dcos/1.13/metrics/"><i data-feather="chevron-right"></i>Metrics</a></li><li class="active"><a class="d0" href="/mesosphere/dcos/1.13/monitoring/"><i data-feather="chevron-right"></i>Monitoring, Logging, and Debugging</a></li><ul><li><a class="d1" href="/mesosphere/dcos/1.13/monitoring/performance-monitoring/"><i data-feather="chevron-right"></i>Performance Monitoring</a></li><li><a class="d1" href="/mesosphere/dcos/1.13/monitoring/logging/"><i data-feather="chevron-right"></i>Logging</a></li><li class="active"><a class="d1" href="/mesosphere/dcos/1.13/monitoring/debugging/"><i data-feather="chevron-right"></i>Debugging</a></li><ul><li><a class="d2" href="/mesosphere/dcos/1.13/monitoring/debugging/gui-debugging/">Debugging from the DC/OS UI</a></li><li><a class="d2" href="/mesosphere/dcos/1.13/monitoring/debugging/debug-perms/">Granting Access to dcos task exec</a></li><li><a class="d2" href="/mesosphere/dcos/1.13/monitoring/debugging/cli-debugging/">Debugging from the DC/OS CLI</a></li><li><a class="d2" href="/mesosphere/dcos/1.13/monitoring/debugging/task-exec/">Using dcos task exec</a></li><li><a class="d2" href="/mesosphere/dcos/1.13/monitoring/debugging/stuck-deployment/">Stuck Deployments</a></li><li class="active active-on"><a class="d2" href="/mesosphere/dcos/1.13/monitoring/debugging/slow-docker/">Slow Docker Apps and Deployments</a></li></ul></ul><li><a class="d0" href="/mesosphere/dcos/1.13/hybrid-cloud/"><i data-feather="chevron-right"></i>Hybrid Cloud</a></li><li><a class="d0" href="/mesosphere/dcos/1.13/deploying-jobs/"><i data-feather="chevron-right"></i>Deploying Jobs</a></li><li><a class="d0" href="/mesosphere/dcos/1.13/deploying-services/"><i data-feather="chevron-right"></i>Deploying Services and Pods</a></li><li><a class="d0" href="/mesosphere/dcos/1.13/tutorials/"><i data-feather="chevron-right"></i>Tutorials</a></li><li><a class="d0" href="/mesosphere/dcos/1.13/api/"><i data-feather="chevron-right"></i>API Reference</a></li><li><a class="d0" href="/mesosphere/dcos/1.13/developing-services/"><i data-feather="chevron-right"></i>Developing DC/OS Services</a></li></ul></nav><footer class="sidebar__footer"><div class="sidebar__footer-links"><a href="https://d2iq.com/terms/">Terms of Service</a><a href="https://d2iq.com/privacy/">Privacy Policy</a></div><a class="sidebar__footer-copyright" href="https://d2iq.com/">&copy; 2022 D2iQ, Inc. All rights reserved.</a></footer></section></div><div class="layout__content" role="main"><main class="content"><div class="content__container content__container--with-sections"><div class="content__header"><div class="content__header__row"><h1 class="content__header-title">Slow Docker Apps and Deployments</h1></div><h4 class="content__header-description">Troubleshooting slow Docker apps and deployments</h4><div class="actions"><ul class="actions__list"><li class="actions__item"><button class="actions__link" onclick="javascript:window.print()"><i class="actions__icon" data-feather="printer"></i><span class="actions__text">Print</span></button></li><li class="actions__item"><a class="actions__link" href="https://github.com/mesosphere/dcos-docs-site/tree/main/pages/mesosphere/dcos/1.13/monitoring/debugging/slow-docker/index.md" target="_blank"><i class="actions__icon" data-feather="github"></i><span class="actions__text">Contribute</span></a></li></ul></div></div><article class="content__article"><p class="message--note"><strong>NOTE: </strong>If you recently upgraded to DC/OS 1.10 or later, and configured <code>MESOS_CGROUPS_ENABLE_CFS=true</code> in your Mesos agent configuration, you may see slow-running Docker applications or slow deployments.</p>
<h1 id="strict-cpu-limitations-are-now-default"><a class="content__anchor" href="#strict-cpu-limitations-are-now-default" aria-hidden="true"><i data-feather="bookmark"></i></a>Strict CPU limitations are now default</h1>
<p>The Apache Mesos kernel of DC/OS allows you to use either Completely Fair Scheduler strict CPU limitations (CFS CPU) or CPU shares. By default strict CPU limitations are used in DC/OS from version 1.10 onward in order to achieve better performance in high density use cases. However, in some use cases it is desirable to be able to offer up available CPU cycles to apps that take priority. Using CPU shares, DC/OS can be configured to allow Marathon apps to consume more CPU cycles than in their original app definition.</p>
<p>Your services or deployments are likely running slowly because they require more CPU cycles than they are configured to consume.</p>
<h1 id="steps-to-take"><a class="content__anchor" href="#steps-to-take" aria-hidden="true"><i data-feather="bookmark"></i></a>Steps to take</h1>
<h2 id="increase-cpu-allocation"><a class="content__anchor" href="#increase-cpu-allocation" aria-hidden="true"><i data-feather="bookmark"></i></a>Increase CPU allocation</h2>
<p>If you have slow-running Docker services or deployments on DC/OS 1.10 or later, increase the required CPU amount in your service definition. <a href="/mesosphere/dcos/1.13/deploying-services/update-user-service/">From the CLI</a> or the <a href="/mesosphere/dcos/1.13/gui/services/">Services</a> tab of the DC/OS GUI, change the <code>cpus</code> property of your service definition to a higher value and test if increased CPU allocation solves your issues.</p>
<h2 id="boost-resources-using-dcos-pods"><a class="content__anchor" href="#boost-resources-using-dcos-pods" aria-hidden="true"><i data-feather="bookmark"></i></a>Boost resources using DC/OS Pods</h2>
<p>Often, containerized applications have resource-intensive startup phases. Traditionally, tasks with high startup requirements were simply allocated extra resources for the duration of their lifetime, at the cost of lower cluster utilization once those resources were no longer needed. By taking advantage of the resource accounting strategy of DC/OS Pods, an “empty” startup container/task can be created to request additional resources and leave them available to the task that actually needs them, then complete and relinquish those resources after a reasonable time has passed. See this <a href="https://mesosphere.com/blog/application-jvm-startup/">blog post on resource boosting</a> for more information and a sample pod definition.</p>
<h2 id="change-mesos-agent-configuration"><a class="content__anchor" href="#change-mesos-agent-configuration" aria-hidden="true"><i data-feather="bookmark"></i></a>Change Mesos agent configuration</h2>
<p>In special cases, you may want to change your Mesos agent configuration to not use strict CFS CPU limitations. Consider this if the majority of your applications have a CPU peak during startup and a lower consumption afterwards, or you have other advanced CPU loads. You should only change the default behavior if you do not need strict CPU separation.</p>
<p>You will need to change the configurations for your DC/OS (or Mesos) installation by changing your Mesos agent configuration. If you are considering changing this configuration, consult the <a href="http://mesos.apache.org/documentation/latest/oversubscription/">Mesos oversubscription</a> documentation for additional considerations and configuration options.</p>
<h3 id="configuring-the-agents-to-use-cpu-shares"><a class="content__anchor" href="#configuring-the-agents-to-use-cpu-shares" aria-hidden="true"><i data-feather="bookmark"></i></a>Configuring the agents to use CPU shares</h3>
<ol>
<li>
<p>Create or modify the file <code>/var/lib/dcos/mesos-slave-common</code> on each agent node.</p>
</li>
<li>
<p>Add or set the line <code>MESOS_CGROUPS_ENABLE_CFS=false</code>.</p>
</li>
<li>
<p>Restart the Mesos agent process with <code>sudo systemctl restart dcos-mesos-slave</code>. If this is done before installing the Mesos agent it will pick up the configuration automatically.</p>
</li>
<li>
<p>After restarting all of the Mesos agents, restart all tasks. Restarting the agent will not cause the tasks to restart but they also will not pick up the new settings, so they must be restarted.</p>
</li>
</ol>
</article></div><aside class="content__sections"><div class="content__sections-list-container"><ul class="content__sections-list"><li class="content__sections-item content__sections-item--h1"><a href="#strict-cpu-limitations-are-now-default">Strict CPU limitations are now default</a></li><li class="content__sections-item content__sections-item--h1"><a href="#steps-to-take">Steps to take</a></li><li class="content__sections-item content__sections-item--h2"><a href="#increase-cpu-allocation">Increase CPU allocation</a></li><li class="content__sections-item content__sections-item--h2"><a href="#boost-resources-using-dcos-pods">Boost resources using DC/OS Pods</a></li><li class="content__sections-item content__sections-item--h2"><a href="#change-mesos-agent-configuration">Change Mesos agent configuration</a></li></ul></div></aside></main></div></div><script src="/assets/js/jquery-3.2.1.js"></script><script src="/assets/js/clipboard.js"></script><script src="/assets/js/prism.js"></script><script src="/js/main.js"></script></body></html>