<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width" initial-scale="1" user-scalable="no"><title>Compare Edge-LB to Marathon-LB - D2iQ Docs</title><meta name="description" content="Demonstrates differences between Marathon-LB and Edge-LB load balancing services"><link rel="apple-touch-icon" sizes="180x180" href="/dcosdocs/assets/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/dcosdocs/assets/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/dcosdocs/assets/favicon-16x16.png"><link rel="stylesheet" type="text/css" href="/dcosdocs/css/styles.css"><link rel="search" type="application/opensearchdescription+xml" href="/dcosdocs/assets/opensearch.xml" title="Search"><link href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,500,500i,700,700i" rel="stylesheet"><script src="https://unpkg.com/feather-icons/dist/feather.min.js"></script><script>window.analytics||(window.analytics=[]),window.analytics.methods=["identify","track","trackLink","trackForm","trackClick","trackSubmit","page","pageview","ab","alias","ready","group","on","once","off"],window.analytics.factory=function(t){return function(){var a=Array.prototype.slice.call(arguments);return a.unshift(t),window.analytics.push(a),window.analytics}};for(var i=0;i<window.analytics.methods.length;i++){var method=window.analytics.methods[i];window.analytics[method]=window.analytics.factory(method)}window.analytics.load=function(t){var a=document.createElement("script");a.type="text/javascript",a.async=!0,a.src=("https:"===document.location.protocol?"https://":"http://")+"d2dq2ahtl5zl1z.cloudfront.net/analytics.js/v1/"+t+"/analytics.min.js";var n=document.getElementsByTagName("script")[0];n.parentNode.insertBefore(a,n)},window.analytics.SNIPPET_VERSION="2.0.8",
window.analytics.load("7sgtwqvuai");
window.analytics.page();</script><noscript><iframe src="//www.googletagmanager.com/ns.html?id=GTM-PBJ84KX" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript><script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src='//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
})(window,document,'script','dataLayer','GTM-PBJ84KX');</script></head><body><div class="layout"><header class="header"><a class="header__drawer"><i class="header__icon" data-feather="menu"></i></a><a class="header__logo" href="/"><img class="header__logo--mobile" src="/dcosdocs/assets/D2iQ_Logotype_Color_Positive_Documentation.svg" alt="D2IQ"><img class="header__logo--desktop" src="/dcosdocs/assets/D2iQ_Logotype_Color_Positive_Documentation.svg" alt="D2IQ"></a><div class="header__main"><div class="header__dropdown"><img class="header__dropdown-icon" src="/dcosdocs/assets/D2IQ_Logotype_Color_Positive.png" alt="D2iQ"><strong>Edge Lb Documentation</strong><i data-feather="chevron-down"></i></div><nav class="header__menu"><ul class="header__menu-list"><li class="header__menu-item"><a href="https://support.d2iq.com">Support</a></li></ul></nav></div><div class="chooser" id="spherer"><div class="chooser-current"><a class="chooser-title">Mesosphere</a><svg class="chooser-svg" id="spherer-svg"><path class="pointer" d="m 13,6 -5,5 -5,-5 z" fill="#858585"></path></svg></div><ul class="chooser-list" id="spherer-list"><li class="chooser-list-item"><a href="/mesosphere/dcos">DC/OS</a></li><li class="chooser-list-item"><a href="/dcosdocs/mesosphere/dcos/services">DC/OS Services</a></li></ul></div><div class="chooser" id="ks"><div class="chooser-current"><a class="chooser-title">DKP</a><svg class="chooser-svg" id="kspherer-svg"><path class="pointer" d="m 13,6 -5,5 -5,-5 z" fill="#858585"></path></svg></div><ul class="chooser-list" id="kspherer-list"><li class="chooser-list-item"><a href="/dkp/konvoy">Konvoy</a></li><li class="chooser-list-item"><a href="/dkp/konvoy/partner-solutions">Partner Solutions</a></li><li class="chooser-list-item"><a href="/dkp/kommander">Kommander</a></li><li class="chooser-list-item"><a href="/dkp/dispatch">Dispatch</a></li><li class="chooser-list-item"><a href="/dkp/kaptain">Kaptain</a></li><li class="chooser-list-item"><a href="/dkp/conductor">Conductor</a></li></ul></div><div class="chooser" id="localizer"><div class="chooser-current"><a class="chooser-title">English</a><svg class="chooser-svg" id="localizer-svg"><path class="pointer" d="m 13,6 -5,5 -5,-5 z" fill="#858585"></path></svg></div><ul class="chooser-list" id="localizer-list"><li class="chooser-list-item"><a href="/dcosdocs/mesosphere/dcos/cn/services/edge-lb">中文 (简体)</a></li></ul></div><section class="header__search" role="search"><form class="header__search-form" action="/search/"><input class="header__search-input" id="header-search-input" tabindex="1" type="text" name="q" placeholder="Search"><input type="hidden" name="hFR[scope][0]" value="DC/OS Services"><label class="header__search-label" for="header-search-input"><i class="header__icon" data-feather="search"></i></label></form></section></header><div class="header-dropdown"><ul class="header-dropdown__list"><li class="header-dropdown__top-item"><div>DKP</div></li><li class="header-dropdown__item"><a href="/dkp/konvoy">Konvoy</a></li><li class="header-dropdown__item"><a href="/dkp/konvoy/partner-solutions">Partner Solutions</a></li><li class="header-dropdown__item"><a href="/dkp/kommander">Kommander</a></li><li class="header-dropdown__item"><a href="/dkp/dispatch">Dispatch</a></li><li class="header-dropdown__item"><a href="/dkp/kaptain">Kaptain</a></li><li class="header-dropdown__item"><a href="/dkp/conductor">Conductor</a></li><li class="header-dropdown__top-item"><div>Mesosphere</div></li><li class="header-dropdown__item header-dropdown__item--active"><a href="/mesosphere/dcos">DC/OS</a></li><li class="header-dropdown__item header-dropdown__item--active"><a href="/dcosdocs/mesosphere/dcos/services">DC/OS Services</a></li><li class="header-dropdown__item"><a href="https://support.d2iq.com">Support</a></li></ul></div><div class="layout__sidebar layout__drawer"><section class="sidebar"><header class="sidebar__header"><div class="sidebar__dropdown"><ul><li><a href="/dcosdocs/mesosphere/dcos/services/edge-lb/1.7/getting-started/edge-lb-mlb-example">Edge-LB 1.7</a></li><li><a href="/dcosdocs/mesosphere/dcos/services/edge-lb/1.6/getting-started/edge-lb-mlb-example">Edge-LB 1.6</a></li><li><a href="/dcosdocs/mesosphere/dcos/services/edge-lb/1.5/getting-started/edge-lb-mlb-example">Edge-LB 1.5</a></li><li><a href="/dcosdocs/mesosphere/dcos/services/edge-lb/1.4/getting-started">Edge-LB 1.4</a></li><li><a href="/dcosdocs/mesosphere/dcos/services/edge-lb/1.3">Edge-LB 1.3</a></li><li><a href="/dcosdocs/mesosphere/dcos/services/edge-lb/1.2">Edge-LB 1.2</a></li></ul><div class="toggle"><p><span class="title">Edge Lb</span><span class="version"> 1.7</span></p><i data-feather="chevron-down"></i></div></div></header><nav class="sidebar_nav" role="navigation"><ul><li><a class="d0" href="/dcosdocs/mesosphere/dcos/services/edge-lb/1.7/concepts/"><i data-feather="chevron-right"></i>Edge-LB concepts</a></li><li class="active"><a class="d0" href="/dcosdocs/mesosphere/dcos/services/edge-lb/1.7/getting-started/"><i data-feather="chevron-right"></i>Getting started with Edge-LB</a></li><ul><li><a class="d1" href="/dcosdocs/mesosphere/dcos/services/edge-lb/1.7/getting-started/installing/">Install Edge-LB</a></li><li><a class="d1" href="/dcosdocs/mesosphere/dcos/services/edge-lb/1.7/getting-started/comparing-load-balancers/">Comparing load balancing services</a></li><li><a class="d1" href="/dcosdocs/mesosphere/dcos/services/edge-lb/1.7/getting-started/auto-pools/">Automatically exposing apps with Auto Pools and labels</a></li><li><a class="d1" href="/dcosdocs/mesosphere/dcos/services/edge-lb/1.7/getting-started/single-lb/">Expose and load balance a sample service</a></li><li class="active active-on"><a class="d1" href="/dcosdocs/mesosphere/dcos/services/edge-lb/1.7/getting-started/edge-lb-mlb-example/">Compare Edge-LB to Marathon-LB</a></li><li><a class="d1" href="/dcosdocs/mesosphere/dcos/services/edge-lb/1.7/getting-started/mlb-to-edge-lb-migration/">Migrate from Marathon-LB to Edge-LB</a></li></ul><li><a class="d0" href="/dcosdocs/mesosphere/dcos/services/edge-lb/1.7/how-to-tasks/"><i data-feather="chevron-right"></i>How-to guides for Edge-LB</a></li><li><a class="d0" href="/dcosdocs/mesosphere/dcos/services/edge-lb/1.7/tutorials/"><i data-feather="chevron-right"></i>Tutorials</a></li><li><a class="d0" href="/dcosdocs/mesosphere/dcos/services/edge-lb/1.7/reference/"><i data-feather="chevron-right"></i>Reference information</a></li><li><a class="d0" href="/dcosdocs/mesosphere/dcos/services/edge-lb/1.7/related-documentation/"><i data-feather="chevron-right"></i>Related documentation</a></li></ul></nav><footer class="sidebar__footer"><div class="sidebar__footer-links"><a href="https://d2iq.com/terms/">Terms of Service</a><a href="https://d2iq.com/privacy/">Privacy Policy</a></div><a class="sidebar__footer-copyright" href="https://d2iq.com/">&copy; 2021 D2iQ, Inc. All rights reserved.</a></footer></section></div><div class="layout__content" role="main"><main class="content"><div class="content__container content__container--with-sections"><div class="content__header"><div class="content__header__row"><h1 class="content__header-title">Compare Edge-LB to Marathon-LB</h1></div><h4 class="content__header-description">Demonstrates differences between Marathon-LB and Edge-LB load balancing services</h4><div class="actions"><ul class="actions__list"><li class="actions__item"><button class="actions__link" onclick="javascript:window.print()"><i class="actions__icon" data-feather="printer"></i><span class="actions__text">Print</span></button></li><li class="actions__item"><a class="actions__link" href="https://github.com/mesosphere/dcos-docs-site/tree/main/pages/dcosdocs/mesosphere/dcos/services/edge-lb/1.7/getting-started/edge-lb-mlb-example/index.md" target="_blank"><i class="actions__icon" data-feather="github"></i><span class="actions__text">Contribute</span></a></li><li class="actions__item"><a class="actions__link" href="https://jira.d2iq.com/secure/CreateIssueDetails!init.jspa?pid=14105&amp;issuetype=1&amp;summary=Feedback+for+Compare+Edge-LB+to+Marathon-LB&amp;description=Source:%20https://docs.d2iq.com/dcosdocs/mesosphere/dcos/services/edge-lb/1.7/getting-started/edge-lb-mlb-example&amp;labels=documentation&amp;labels=needs_triage&amp;components=19804&amp;priority=3&amp;customfield_12300=44" target="_blank"><i class="actions__icon" data-feather="message-square"></i><span class="actions__text">Feedback</span></a></li></ul></div></div><article class="content__article"><p>These sample exercises demonstrate exposing and accessing the NGINX™ service by using both Marathon-LB and Edge-LB. It demonstrates the differences in configuration in terms of both load balancers.</p>
<h1 id="before-you-begin"><a class="content__anchor" href="#before-you-begin" aria-hidden="true"><i data-feather="bookmark"></i></a>Before you begin</h1>
<p>You must have:</p>
<ul>
<li>The Edge-LB API server installed as described in the Edge-LB <a href="/dcosdocs/mesosphere/dcos/services/edge-lb/1.7/getting-started/installing">installation instructions</a>.</li>
<li>The DC/OS command-line interface (CLI) installed and configured to communicate with the DC/OS™ cluster.</li>
<li>The <code>edgelb</code> command-line interface (CLI) installed.</li>
<li>An active and properly-configured DC/OS Enterprise cluster with at least one DC/OS <strong>private agent</strong> node to run the load-balanced service and at least one DC/OS <strong>public agent</strong> node for exposing the load-balanced service.</li>
<li>Marathon-LB installed as described in the Marathon-LB <a href="/dcosdocs/mesosphere/dcos/services/marathon-lb/1.14/mlb-install">installation instructions</a>.</li>
</ul>
<h1 id="preview-of-what-youll-do"><a class="content__anchor" href="#preview-of-what-youll-do" aria-hidden="true"><i data-feather="bookmark"></i></a>Preview of what you’ll do</h1>
<p>This tutorial illustrates the differences between configuring load balancing using Marathon-LB and an Edge-LB pool to provide public access to a simple Marathon app. In this tutorial, you will:</p>
<ul>
<li>Create and deploy a sample Marathon app called <code>nginx</code>.</li>
<li>Configure and deploy Marathon-LB using the Marathon service <code>nginx-mlb</code>.</li>
<li>Configure and deploy load balancing using the Edge-LB pool instance called <code>nginx-edgelb</code>.</li>
<li>Access the sample <code>nginx</code> app through the public agent URL.</li>
</ul>
<h1 id="configure-the-sample-app-for-marathon-lb"><a class="content__anchor" href="#configure-the-sample-app-for-marathon-lb" aria-hidden="true"><i data-feather="bookmark"></i></a>Configure the sample app for Marathon-LB</h1>
<p>These steps illustrate how you can configure and deploy the <code>nginx</code> service through Marathon-LB.</p>
<ol>
<li>
<p>Copy and paste the following sample app definition into your text editor to create the <code>nginx-mlb.json</code> file:</p>
<pre><code class="language-json">{
  &quot;id&quot;: &quot;/nginx-mlb&quot;,
  &quot;cpus&quot;: 0.1,
  &quot;instances&quot;: 1,
  &quot;mem&quot;: 128,
  &quot;cmd&quot;: &quot;sed -i 's:Welcome to nginx!:Welcome to nginx! - through Marathon-LB:g' /usr/share/nginx/html/index.html; nginx -g 'daemon off;'&quot;,
  &quot;container&quot;: {
    &quot;portMappings&quot;: [
      {
        &quot;containerPort&quot;: 80,
        &quot;protocol&quot;: &quot;tcp&quot;,
        &quot;servicePort&quot;: 10020
      }
    ],
    &quot;type&quot;: &quot;MESOS&quot;,
    &quot;docker&quot;: {
      &quot;image&quot;: &quot;nginx&quot;
    }
  },
  &quot;networks&quot;: [
    {
      &quot;mode&quot;: &quot;container/bridge&quot;
    }
],
  &quot;labels&quot;: {
    &quot;HAPROXY_GROUP&quot;: &quot;external&quot;,
    &quot;HAPROXY_0_STICKY&quot;: &quot;true&quot;,
    &quot;HAPROXY_0_VHOST&quot;: &quot;&lt;Public agent IP address&gt;&quot;
  }
}
</code></pre>
<p>This sample app definition includes the public IP address used to expose and access the <code>nginx</code> service.</p>
</li>
<li>
<p>Deploy the <code>nginx</code> service by adding the <code>nginx-mlb.json</code> app definition to the cluster:</p>
<pre><code class="language-bash">dcos marathon app add nginx-mlb.json
</code></pre>
</li>
<li>
<p>Verify access to the service by opening a web browser and navigating to the public agent IP address and service port defined in the <code>nginx-mlb.json</code> file.</p>
<pre><code class="language-bash">http://&lt;Public agent IP address&gt;:10020
</code></pre>
</li>
</ol>
<h1 id="configure-the-sample-app-for-edge-lb"><a class="content__anchor" href="#configure-the-sample-app-for-edge-lb" aria-hidden="true"><i data-feather="bookmark"></i></a>Configure the sample app for Edge-LB</h1>
<p>These steps illustrate how you can configure and deploy the <code>nginx</code> service through Edge-LB.</p>
<ol>
<li>
<p>Copy and paste the following sample app definition in your text editor to create the <code>nginx.json</code> file:</p>
<pre><code class="language-json">{
  &quot;id&quot;: &quot;/nginx&quot;,
  &quot;cpus&quot;: 0.1,
  &quot;instances&quot;: 1,
  &quot;mem&quot;: 128,
  &quot;cmd&quot;: &quot;sed -i 's:Welcome to nginx!:Welcome to nginx! - through Edge-LB:g' /usr/share/nginx/html/index.html; nginx -g 'daemon off;'&quot;,
  &quot;container&quot;: {
    &quot;portMappings&quot;: [
      {
        &quot;containerPort&quot;: 80,
        &quot;protocol&quot;: &quot;tcp&quot;,
        &quot;name&quot;: &quot;nginx-port&quot;
      }
    ],
    &quot;type&quot;: &quot;MESOS&quot;,
    &quot;docker&quot;: {
      &quot;image&quot;: &quot;nginx&quot;
    }
  },
  &quot;networks&quot;: [
    {
      &quot;mode&quot;: &quot;container/bridge&quot;
    }
]
}
</code></pre>
</li>
<li>
<p>Deploy the <code>nginx</code> app:</p>
<pre><code class="language-bash">dcos marathon app add nginx.json
</code></pre>
</li>
<li>
<p>Copy and paste the following in your text editor to create the <code>nginx-edgelb.json</code> pool configuration file to expose and access the <code>nginx</code> service:</p>
<pre><code class="language-json">{
  &quot;apiVersion&quot;: &quot;V2&quot;,
  &quot;name&quot;: &quot;nginx-edgelb&quot;,
  &quot;count&quot;: 1,
  &quot;haproxy&quot;: {
    &quot;frontends&quot;: [
    {
      &quot;bindPort&quot;: 15001,
      &quot;protocol&quot;: &quot;HTTP&quot;,
      &quot;linkBackend&quot;: {
        &quot;defaultBackend&quot;: &quot;nginx-backend&quot;
      }
    }
  ],
    &quot;backends&quot;: [
    {
      &quot;name&quot;: &quot;nginx-backend&quot;,
      &quot;protocol&quot;: &quot;HTTP&quot;,
      &quot;services&quot;: [
        {
        &quot;marathon&quot;: {
          &quot;serviceID&quot;: &quot;/nginx&quot;
        },
        &quot;endpoint&quot;: {
          &quot;portName&quot;: &quot;nginx-port&quot;
        }
      }
    ]
    }
  ],
    &quot;stats&quot;: {
      &quot;bindPort&quot;: 1025
    }
  }
}
</code></pre>
</li>
<li>
<p>Deploy the Edge-LB pool configuration file to expose and access the <code>nginx</code> service:</p>
<pre><code class="language-bash">dcos edgelb create nginx-edgelb.json
</code></pre>
</li>
</ol>
<p class="message--note"><strong>NOTE: </strong>When you deploy a cluster with Terraform, the default firewall configuration allows you to access only ports 80 (http) and 443 (https). Everything else is blocked. You may want to add public agent ports to the main.tf file (the Terraform configuration file of the running cluster) in module "dcos." To add public agent ports, add a line like this one, <code>public_agents_additional_ports = [ 15001, 10020, 9090, 1025 ]</code>, and then re-deploy the cluster.</p>
<h1 id="verify-deployment-status-for-sample-apps"><a class="content__anchor" href="#verify-deployment-status-for-sample-apps" aria-hidden="true"><i data-feather="bookmark"></i></a>Verify deployment status for sample apps</h1>
<ol>
<li>
<p>Verify that the Marathon-LB and Edge-LB API server packages deployed successfully:</p>
<pre><code class="language-bash">dcos package list
</code></pre>
</li>
<li>
<p>Verify the services and pool instances has been deployed sucessfully:</p>
<pre><code class="language-bash">dcos marathon app list
</code></pre>
</li>
<li>
<p>Verify the Apache® Mesos® task relevant to services and the pool instances:</p>
<pre><code class="language-bash">dcos task list
</code></pre>
</li>
<li>
<p>Verify that the Edge-LB pool named <code>nginx-edgelb</code> deployed successfully:</p>
<pre><code class="language-bash">dcos edgelb list
</code></pre>
</li>
<li>
<p>Verify that the Edge-LB pool instance deployed successfully with the configured frontend and backend ports:</p>
<pre><code class="language-bash">dcos edgelb endpoints nginx-edgelb
</code></pre>
</li>
</ol>
<h1 id="verify-service-access"><a class="content__anchor" href="#verify-service-access" aria-hidden="true"><i data-feather="bookmark"></i></a>Verify service access</h1>
<ol>
<li>
<p>Access the <code>nginx-mlb</code> service using the public IP address and port specified in the <code>nginx-mlb.json</code> file.</p>
<pre><code class="language-bash">http://&lt;public_agent_public_IP&gt;:10020
</code></pre>
<p>You should see a page for <code>Welcome to Nginx - through Marathon-LB</code>. For example:</p>
 <p>
 <img src="/dcosdocs/mesosphere/dcos/services/edge-lb/1.7/img/Edge-MLB-nginx.png" alt="Welcome page for a service using Marathon-LB">
 </p>
</li>
<li>
<p>View the load balancing statistics for the <code>nginx</code> service deployed using Marathon-LB using the default HAProxy <code>stats</code> port 9090:</p>
<pre><code class="language-bash">http://&lt;public_agent_public_IP&gt;:9090
</code></pre>
<p>For example:</p>
 <p>
 <img src="/dcosdocs/mesosphere/dcos/services/edge-lb/1.7/img/Edge-HAProxy-stats.png" alt="Statistics for a service exposed using Marathon-LB">
 </p>
</li>
<li>
<p>Access the <code>nginx</code> service that was exposed through Edge-LB using the public agent IP and the frontend port number.</p>
<pre><code class="language-bash">http://&lt;public_agent_public_IP&gt;:15001
</code></pre>
<p>You should see a page for <code>Welcome to Nginx - through Edge-LB</code>. For example:</p>
 <p>
 <img src="/dcosdocs/mesosphere/dcos/services/edge-lb/1.7/img/Edge-LB-welcome-nginx.png" alt="Welcome page for a service using Edge-LB">
 </p>
</li>
<li>
<p>View the load balancing statistics for the <code>nginx</code> service deployed using Edge-LB using the predefined HAProxy <code>stats</code> port 1025:</p>
<pre><code class="language-bash">http://&lt;public_agent_public_IP&gt;:1025
</code></pre>
<p>For example:</p>
 <p>
 <img src="/dcosdocs/mesosphere/dcos/services/edge-lb/1.7/img/Edge-HAProxy-stats-2.png" alt="Statistics for a service exposed using Edge-LB">
 </p>
</li>
</ol>
</article></div><aside class="content__sections"><div class="content__sections-list-container"><ul class="content__sections-list"><li class="content__sections-item content__sections-item--h1"><a href="#before-you-begin">Before you begin</a></li><li class="content__sections-item content__sections-item--h1"><a href="#preview-of-what-youll-do">Preview of what you’ll do</a></li><li class="content__sections-item content__sections-item--h1"><a href="#configure-the-sample-app-for-marathon-lb">Configure the sample app for Marathon-LB</a></li><li class="content__sections-item content__sections-item--h1"><a href="#configure-the-sample-app-for-edge-lb">Configure the sample app for Edge-LB</a></li><li class="content__sections-item content__sections-item--h1"><a href="#verify-deployment-status-for-sample-apps">Verify deployment status for sample apps</a></li><li class="content__sections-item content__sections-item--h1"><a href="#verify-service-access">Verify service access</a></li></ul></div></aside></main></div></div><script src="/dcosdocs/assets/js/jquery-3.2.1.js"></script><script src="/dcosdocs/assets/js/clipboard.js"></script><script src="/dcosdocs/assets/js/prism.js"></script><script src="/js/main.js"></script></body></html>