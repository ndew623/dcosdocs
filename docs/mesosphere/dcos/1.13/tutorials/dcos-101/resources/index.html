<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width" initial-scale="1" user-scalable="no"><title>Allocate and scale resources - D2iQ Docs</title><meta name="description" content="Provides strategies and examples for scaling resources allocated for deployed applications (part 9)"><link rel="apple-touch-icon" sizes="180x180" href="/dcosdocs/assets/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/dcosdocs/assets/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/dcosdocs/assets/favicon-16x16.png"><link rel="stylesheet" type="text/css" href="/dcosdocs/css/styles.css"><link rel="search" type="application/opensearchdescription+xml" href="/dcosdocs/assets/opensearch.xml" title="Search"><link href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,500,500i,700,700i" rel="stylesheet"><script src="https://unpkg.com/feather-icons/dist/feather.min.js"></script><script>window.analytics||(window.analytics=[]),window.analytics.methods=["identify","track","trackLink","trackForm","trackClick","trackSubmit","page","pageview","ab","alias","ready","group","on","once","off"],window.analytics.factory=function(t){return function(){var a=Array.prototype.slice.call(arguments);return a.unshift(t),window.analytics.push(a),window.analytics}};for(var i=0;i<window.analytics.methods.length;i++){var method=window.analytics.methods[i];window.analytics[method]=window.analytics.factory(method)}window.analytics.load=function(t){var a=document.createElement("script");a.type="text/javascript",a.async=!0,a.src=("https:"===document.location.protocol?"https://":"http://")+"d2dq2ahtl5zl1z.cloudfront.net/analytics.js/v1/"+t+"/analytics.min.js";var n=document.getElementsByTagName("script")[0];n.parentNode.insertBefore(a,n)},window.analytics.SNIPPET_VERSION="2.0.8",
window.analytics.load("7sgtwqvuai");
window.analytics.page();</script><noscript><iframe src="//www.googletagmanager.com/ns.html?id=GTM-PBJ84KX" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript><script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src='//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
})(window,document,'script','dataLayer','GTM-PBJ84KX');</script></head><body><div class="layout"><header class="header"><a class="header__drawer"><i class="header__icon" data-feather="menu"></i></a><a class="header__logo" href="/"><img class="header__logo--mobile" src="/dcosdocs/assets/D2iQ_Logotype_Color_Positive_Documentation.svg" alt="D2IQ"><img class="header__logo--desktop" src="/dcosdocs/assets/D2iQ_Logotype_Color_Positive_Documentation.svg" alt="D2IQ"></a><div class="header__main"><div class="header__dropdown"><img class="header__dropdown-icon" src="/dcosdocs/assets/D2IQ_Logotype_Color_Positive.png" alt="D2iQ"><strong>DC/OS Documentation</strong><i data-feather="chevron-down"></i></div><nav class="header__menu"><ul class="header__menu-list"><li class="header__menu-item"><a href="/mesosphere/dcos">DC/OS</a></li><li class="header__menu-item"><a href="/dcosdocs/mesosphere/dcos/services">Services</a></li><li class="header__menu-item"><a href="https://support.d2iq.com">Support</a></li></ul></nav></div><div class="chooser" id="localizer"><div class="chooser-current"><a class="chooser-title">English</a><svg class="chooser-svg" id="localizer-svg"><path class="pointer" d="m 13,6 -5,5 -5,-5 z" fill="#858585"></path></svg></div><ul class="chooser-list" id="localizer-list"><li class="chooser-list-item"><a href="/dcosdocs/mesosphere/dcos/cn/1.13/tutorials/dcos-101/resources">中文 (简体)</a></li></ul></div><section class="header__search" role="search"><form class="header__search-form" action="/search/"><input class="header__search-input" id="header-search-input" tabindex="1" type="text" name="q" placeholder="Search"><input type="hidden" name="hFR[scope][0]" value="DC/OS 1.13"><label class="header__search-label" for="header-search-input"><i class="header__icon" data-feather="search"></i></label></form></section></header><div class="header-dropdown"><ul class="header-dropdown__list"><li class="header-dropdown__top-item"><div>DKP</div></li><li class="header-dropdown__item"><a href="/dkp/konvoy">Konvoy</a></li><li class="header-dropdown__item"><a href="/dkp/kommander">Kommander</a></li><li class="header-dropdown__item"><a href="/dkp/dispatch">Dispatch</a></li><li class="header-dropdown__item"><a href="/dkp/kaptain">Kaptain</a></li><li class="header-dropdown__top-item"><div>Mesosphere</div></li><li class="header-dropdown__item header-dropdown__item--active"><a href="/mesosphere/dcos">DC/OS</a></li><li class="header-dropdown__item"><a href="/dcosdocs/mesosphere/dcos/services">DC/OS Services</a></li><li class="header-dropdown__item"><a href="https://support.d2iq.com">Support</a></li></ul></div><div class="layout__sidebar layout__drawer"><section class="sidebar"><header class="sidebar__header"><div class="sidebar__dropdown"><ul><li><a href="/dcosdocs/mesosphere/dcos/2.2/tutorials/dcos-101/resources">Mesosphere DC/OS 2.2.0</a></li><li><a href="/dcosdocs/mesosphere/dcos/2.1/tutorials/dcos-101/resources">Mesosphere DC/OS 2.1.0</a></li><li><a href="/dcosdocs/mesosphere/dcos/2.0/tutorials/dcos-101/resources">Mesosphere DC/OS 2.0</a></li><li><a href="/dcosdocs/mesosphere/dcos/1.13/tutorials/dcos-101/resources">Mesosphere DC/OS 1.13</a></li></ul><div class="toggle"><p><span class="title">DC/OS</span><span class="version"> 1.13</span></p><i data-feather="chevron-down"></i></div></div></header><nav class="sidebar_nav" role="navigation"><ul><li><a class="d0" href="/dcosdocs/mesosphere/dcos/1.13/release-notes/"><i data-feather="chevron-right"></i>Release Notes</a></li><li><a class="d0" href="/dcosdocs/mesosphere/dcos/1.13/overview/"><i data-feather="chevron-right"></i>Overview</a></li><li><a class="d0" href="/dcosdocs/mesosphere/dcos/1.13/installing/"><i data-feather="chevron-right"></i>Installing</a></li><li><a class="d0" href="/dcosdocs/mesosphere/dcos/1.13/gui/"><i data-feather="chevron-right"></i>GUI</a></li><li><a class="d0" href="/dcosdocs/mesosphere/dcos/1.13/cli/"><i data-feather="chevron-right"></i>CLI</a></li><li><a class="d0" href="/dcosdocs/mesosphere/dcos/1.13/administering-clusters/"><i data-feather="chevron-right"></i>Administering Clusters</a></li><li><a class="d0" href="/dcosdocs/mesosphere/dcos/1.13/networking/"><i data-feather="chevron-right"></i>Networking</a></li><li><a class="d0" href="/dcosdocs/mesosphere/dcos/1.13/security/"><i data-feather="chevron-right"></i>Security</a></li><li><a class="d0" href="/dcosdocs/mesosphere/dcos/1.13/storage/"><i data-feather="chevron-right"></i>Storage</a></li><li><a class="d0" href="/dcosdocs/mesosphere/dcos/1.13/metrics/"><i data-feather="chevron-right"></i>Metrics</a></li><li><a class="d0" href="/dcosdocs/mesosphere/dcos/1.13/monitoring/"><i data-feather="chevron-right"></i>Monitoring, Logging, and Debugging</a></li><li><a class="d0" href="/dcosdocs/mesosphere/dcos/1.13/hybrid-cloud/"><i data-feather="chevron-right"></i>Hybrid Cloud</a></li><li><a class="d0" href="/dcosdocs/mesosphere/dcos/1.13/deploying-jobs/"><i data-feather="chevron-right"></i>Deploying Jobs</a></li><li><a class="d0" href="/dcosdocs/mesosphere/dcos/1.13/deploying-services/"><i data-feather="chevron-right"></i>Deploying Services and Pods</a></li><li class="active"><a class="d0" href="/dcosdocs/mesosphere/dcos/1.13/tutorials/"><i data-feather="chevron-right"></i>Tutorials</a></li><ul><li class="active"><a class="d1" href="/dcosdocs/mesosphere/dcos/1.13/tutorials/dcos-101/"><i data-feather="chevron-right"></i>Introducing DC/OS</a></li><ul><li><a class="d2" href="/dcosdocs/mesosphere/dcos/1.13/tutorials/dcos-101/start-here/">Create a cluster</a></li><li><a class="d2" href="/dcosdocs/mesosphere/dcos/1.13/tutorials/dcos-101/cli/">Install the command-line interface</a></li><li><a class="d2" href="/dcosdocs/mesosphere/dcos/1.13/tutorials/dcos-101/first-package/">Install the first package</a></li><li><a class="d2" href="/dcosdocs/mesosphere/dcos/1.13/tutorials/dcos-101/first-app/">Deploy the first application</a></li><li><a class="d2" href="/dcosdocs/mesosphere/dcos/1.13/tutorials/dcos-101/create-service/">Create and run custom apps</a></li><li><a class="d2" href="/dcosdocs/mesosphere/dcos/1.13/tutorials/dcos-101/schedule-jobs/">Create and schedule jobs</a></li><li><a class="d2" href="/dcosdocs/mesosphere/dcos/1.13/tutorials/dcos-101/service-discovery/">Discover deployed services</a></li><li><a class="d2" href="/dcosdocs/mesosphere/dcos/1.13/tutorials/dcos-101/native-app/">Deploy and expose native applications</a></li><li class="active active-on"><a class="d2" href="/dcosdocs/mesosphere/dcos/1.13/tutorials/dcos-101/resources/">Allocate and scale resources</a></li><li><a class="d2" href="/dcosdocs/mesosphere/dcos/1.13/tutorials/dcos-101/loadbalancing/">Load balancing workload</a></li></ul><li><a class="d1" href="/dcosdocs/mesosphere/dcos/1.13/tutorials/stateful-services/">Running stateful services on DC/OS</a></li><li><a class="d1" href="/dcosdocs/mesosphere/dcos/1.13/tutorials/autoscaling/"><i data-feather="chevron-right"></i>Autoscaling with Marathon</a></li><li><a class="d1" href="/dcosdocs/mesosphere/dcos/1.13/tutorials/iot_pipeline/">Deploying a load-balanced data pipeline</a></li><li><a class="d1" href="/dcosdocs/mesosphere/dcos/1.13/tutorials/deploy-on-marathon/">Deploying Marathon apps with Jenkins</a></li><li><a class="d1" href="/dcosdocs/mesosphere/dcos/1.13/tutorials/task-labels/">Labeling tasks and jobs</a></li><li><a class="d1" href="/dcosdocs/mesosphere/dcos/1.13/tutorials/dcos-debug/"><i data-feather="chevron-right"></i>Debugging applications on DC/OS</a></li></ul><li><a class="d0" href="/dcosdocs/mesosphere/dcos/1.13/api/"><i data-feather="chevron-right"></i>API Reference</a></li><li><a class="d0" href="/dcosdocs/mesosphere/dcos/1.13/developing-services/"><i data-feather="chevron-right"></i>Developing DC/OS Services</a></li></ul></nav><footer class="sidebar__footer"><div class="sidebar__footer-links"><a href="https://d2iq.com/terms/">Terms of Service</a><a href="https://d2iq.com/privacy/">Privacy Policy</a></div><a class="sidebar__footer-copyright" href="https://d2iq.com/">&copy; 2022 D2iQ, Inc. All rights reserved.</a></footer></section></div><div class="layout__content" role="main"><main class="content"><div class="content__container content__container--with-sections"><div class="content__header"><div class="content__header__row"><h1 class="content__header-title">Allocate and scale resources</h1></div><h4 class="content__header-description">Provides strategies and examples for scaling resources allocated for deployed applications (part 9)</h4><div class="actions"><ul class="actions__list"><li class="actions__item"><button class="actions__link" onclick="javascript:window.print()"><i class="actions__icon" data-feather="printer"></i><span class="actions__text">Print</span></button></li><li class="actions__item"><a class="actions__link" href="https://github.com/mesosphere/dcos-docs-site/tree/main/pages/dcosdocs/mesosphere/dcos/1.13/tutorials/dcos-101/resources/index.md" target="_blank"><i class="actions__icon" data-feather="github"></i><span class="actions__text">Contribute</span></a></li></ul></div></div><article class="content__article"><p>To this point, you have seen how to create a cluster and how to deploy and test applications and services that run on the cluster. You’ve worked with single commands and apps that run in Docker and DC/OS UCR containers. With this tutorial, you will see some of the key benefits provider by container orchestration and perform a few common resource scaling tasks.</p>
<h1 id="orchestration-and-cluster-management"><a class="content__anchor" href="#orchestration-and-cluster-management" aria-hidden="true"><i data-feather="bookmark"></i></a>Orchestration and cluster management</h1>
<p>Container orchestration plays a key role in cluster management. Container orchestration helps you manage the lifecycle for apps deployed on the cluster by providing features that address important requirements, such as resilient operation, resource allocation, and service management.</p>
<h2 id="cluster-resiliency"><a class="content__anchor" href="#cluster-resiliency" aria-hidden="true"><i data-feather="bookmark"></i></a>Cluster resiliency</h2>
<p>Container orchestration helps ensure resilient operation by:</p>
<ul>
<li>Determining the appropriate location for the initial placement of containers based on the current state, size, and configuration of the cluster.</li>
<li>Supporting distributed processing and scaling to optimize performance, fault-tolerance, and high availability.</li>
<li>Providing self-contained health monitoring and self-healing operations to resurrect failed containers or agents so activity can continue without disruption.</li>
<li>Simplifying the deployment of software upgrades or downgrades.</li>
</ul>
<h2 id="resource-allocation-and-usage"><a class="content__anchor" href="#resource-allocation-and-usage" aria-hidden="true"><i data-feather="bookmark"></i></a>Resource allocation and usage</h2>
<p>Container orchestration improves your ability to manage resources allocation and monitor resource consumption by making sure containers get the specific resources they need to run, including:</p>
<ul>
<li>Memory</li>
<li>CPU</li>
<li>Disk</li>
<li>GPU</li>
<li>Volumes</li>
<li>Ports</li>
<li>IP addresses</li>
<li>Images and artifacts</li>
</ul>
<h2 id="service-identification-and-management"><a class="content__anchor" href="#service-identification-and-management" aria-hidden="true"><i data-feather="bookmark"></i></a>Service identification and management</h2>
<p>In combination with other features, container orchestration helps you to organize, distribute, and monitor the services you deploy. For example, you can:</p>
<ul>
<li>Add labels to services to create metadata for querying and organizing services.</li>
<li>Use groups or namespaces to define a hierarchy of services and the relationships between them, including dependencies.</li>
<li>Monitor health and readiness to ensure applications are available and running properly.</li>
</ul>
<p>This tutorial focuses on <strong>resource management</strong> and <strong>resource isolation</strong> between tasks. These two activities are core functions of any operating system and are central elements of effective cluster administration. In this tutorial, you will learn how to monitor resource usage, how resource limits are enforced, and how to debug resource management issues. For information about other aspects of container orchestration, see the <a href="#related-topics">Related topics</a> listed at the end of this tutorial.</p>
<h1 id="before-you-begin"><a class="content__anchor" href="#before-you-begin" aria-hidden="true"><i data-feather="bookmark"></i></a>Before you begin</h1>
<p>Before starting this tutorial, you should verify the following:</p>
<ul>
<li>You have access to a running <a href="../start-here/">DC/OS cluster</a> with at least at least one master node and three agent nodes.</li>
<li>You have access to a computer where the <a href="../cli/">DC/OS CLI</a> is installed.</li>
<li>You have the sample <a href="../native-app/">dcos-101/app2</a> application deployed and running in your cluster.</li>
</ul>
<h1 id="learning-objectives"><a class="content__anchor" href="#learning-objectives" aria-hidden="true"><i data-feather="bookmark"></i></a>Learning objectives</h1>
<p>By completing this tutorial, you will learn:</p>
<ul>
<li>How to add resource placement constraints for apps.</li>
<li>How to monitor and understand your resource utilization.</li>
<li>How resource limits are enforced.</li>
<li>How to debug resource management issues.</li>
</ul>
<h1 id="review-the-app-definition"><a class="content__anchor" href="#review-the-app-definition" aria-hidden="true"><i data-feather="bookmark"></i></a>Review the app definition</h1>
<p>If you take another look at the <a href="https://raw.githubusercontent.com/joerg84/dcos-101/master/app2/app2.json">app definition</a> for the <a href="https://github.com/joerg84/dcos-101/blob/master/app2/app2.go">app2</a> sample application, you can see the resources allocated for the app in the <code>cpus</code>, <code>mem</code>, <code>disk</code>, and <code>gpus</code> settings. For example:</p>
<pre><code class="language-json">{
  &quot;id&quot;: &quot;/dcos-101/app2&quot;,
  &quot;cmd&quot;: &quot;chmod u+x app2 &amp;&amp; ./app2&quot;,
  &quot;args&quot;: null,
  &quot;user&quot;: null,
  &quot;env&quot;: null,
  &quot;instances&quot;: 1,
  &quot;cpus&quot;: 1,
  &quot;mem&quot;: 128,
  &quot;disk&quot;: 0,
  &quot;gpus&quot;: 0,
  &quot;executor&quot;: null,
  &quot;constraints&quot;: null,
</code></pre>
<h3 id="resource-allocation-before-scaling"><a class="content__anchor" href="#resource-allocation-before-scaling" aria-hidden="true"><i data-feather="bookmark"></i></a>Resource allocation before scaling</h3>
<p>The values for <code>cpus</code>, <code>mem</code>, <code>disk</code>, and <code>gpus</code> define the <strong>maximum</strong> for each of these resources that a task can use. Tasks rarely use the maximum resources allocated, but these settings specify an upper limit to what you will allow a task to use.</p>
<h3 id="using-groups-for-common-resource-requirements"><a class="content__anchor" href="#using-groups-for-common-resource-requirements" aria-hidden="true"><i data-feather="bookmark"></i></a>Using groups for common resource requirements</h3>
<p>You might have noticed that the identifier in the app definitions for both <a href="https://raw.githubusercontent.com/joerg84/dcos-101/master/app1/app1.json">app1</a> and <a href="https://github.com/joerg84/dcos-101/blob/master/app2/app2.go">app2</a> is prefixed by <code>/dcos-101/</code>.</p>
<p>This common identifier is used to define the specific <strong>application group</strong> that both sample applications belong to. Application groups allow you to specify and apply configuration details and dependencies to multiple applications at the same time.</p>
<h1 id="scale-applications"><a class="content__anchor" href="#scale-applications" aria-hidden="true"><i data-feather="bookmark"></i></a>Scale applications</h1>
<p>When you need more resources for your application, you can scale resources <strong>horizontally</strong> or <strong>vertically</strong>.</p>
<p>Horizontal scaling involves increasing or decreasing the number of instances of an application. You can scale the instance count in two ways:</p>
<ul>
<li>By setting a factor to apply to an entire application group by a factor.</li>
<li>By setting a specific number of instances for an individual application.</li>
</ul>
<h2 id="scale-the-application-group"><a class="content__anchor" href="#scale-the-application-group" aria-hidden="true"><i data-feather="bookmark"></i></a>Scale the application group</h2>
<p>Since both <code>appl</code> and <code>app2</code> sample application share the same application group, you can scale them together.</p>
<p>To see how you can scale up and scale down an entire application group, do the following:</p>
<ol>
<li>
<p>Scale the application group up using a scale factor of two by running the following command:</p>
<pre><code class="language-bash">dcos marathon group scale dcos-101 2
</code></pre>
</li>
<li>
<p>Verify that both sample apps have scaled up by running the following command:</p>
<pre><code class="language-bash">dcos marathon app list
</code></pre>
</li>
<li>
<p>Scale the application group down again by running the following command:</p>
<pre><code class="language-bash">dcos marathon group scale dcos-101 0.5
</code></pre>
</li>
<li>
<p>Verify that both apps have scaled down by running the following command:</p>
<pre><code class="language-bash">dcos marathon app list
</code></pre>
</li>
</ol>
<h2 id="set-instance-count-directly"><a class="content__anchor" href="#set-instance-count-directly" aria-hidden="true"><i data-feather="bookmark"></i></a>Set instance count directly</h2>
<p>In some cases, you might want to scale a single application independently. To see how you can scale up and scale down an entire application group, do the following:</p>
<ol>
<li>
<p>Scale <code>app2</code> to three instances by running the following command:</p>
<pre><code class="language-bash">dcos marathon app update /dcos-101/app2 instances=3
</code></pre>
<p>The instance updates are applied incrementally to an existing app definition.</p>
</li>
<li>
<p>Verify that <code>app2</code> has scaled by running the following command:</p>
<pre><code class="language-bash">dcos marathon app list
</code></pre>
</li>
<li>
<p>Scale <code>app2</code> back to one instance by running the following command:</p>
<pre><code class="language-bash">dcos marathon app update /dcos-101/app2 instances=1
</code></pre>
</li>
<li>
<p>Verify that <code>app2</code> has scaled by running the following command:</p>
<pre><code class="language-bash">dcos marathon app list
</code></pre>
</li>
</ol>
<h2 id="scale-allocated-resources"><a class="content__anchor" href="#scale-allocated-resources" aria-hidden="true"><i data-feather="bookmark"></i></a>Scale allocated resources</h2>
<p>Vertical scaling involves increasing or decreasing the resources, such as CPU or memory, that are allocated to an application instance. You should keep in mind that vertical scaling requires restarting the application, which can affect service availability. In a production environment, you should plan for resource scaling and incorporate any changes into your scheduled maintenance periods, if possible.</p>
<ol>
<li>
<p>Scale up to two CPUs for the <code>app2</code> instance by running the following command:</p>
<pre><code class="language-bash">dcos marathon app update /dcos-101/app2 cpus=2
</code></pre>
</li>
<li>
<p>Verify that <code>app2</code> has scaled by running the following command:</p>
<pre><code class="language-bash">dcos marathon app list
</code></pre>
</li>
<li>
<p>Scale back down to one CPU for the <code>app2</code> instance by running the following command:</p>
<pre><code class="language-bash">dcos marathon app update /dcos-101/app2 cpus=1
</code></pre>
</li>
</ol>
<h1 id="debug-resource-problems"><a class="content__anchor" href="#debug-resource-problems" aria-hidden="true"><i data-feather="bookmark"></i></a>Debug resource problems</h1>
<p>When you are managing resources for the applications running on the DC/OS cluster, there are a few common issues that you should learn how to identify and address. The next topics cover a few of these cases.</p>
<h2 id="not-enough-resources-in-the-cluster"><a class="content__anchor" href="#not-enough-resources-in-the-cluster" aria-hidden="true"><i data-feather="bookmark"></i></a>Not enough resources in the cluster</h2>
<p>To simulate this issue, try increasing the number of <code>app2</code> instances by running a command similar to the following:
<code>dcos marathon app update /dcos-101/app2 instances=100</code></p>
<p>This example increases the number of instances to 100. If you have a large cluster, you might need to set the number of instances even higher.</p>
<h3 id="symptom"><a class="content__anchor" href="#symptom" aria-hidden="true"><i data-feather="bookmark"></i></a>Symptom</h3>
<p>After increasing the number of instances, run <code>dcos marathon app list</code> or <code>dcos marathon deployment list</code> to check that the <code>scale</code> deployment is stuck.</p>
<pre><code>/dcos-101/app2   128    1    1/100   N/A      scale     True        N/A     chmod u+x app2 &amp;&amp; ./app2
</code></pre>
<h3 id="cause"><a class="content__anchor" href="#cause" aria-hidden="true"><i data-feather="bookmark"></i></a>Cause</h3>
<p>The problem here is that there are no matching resources available. For example, there might be resources left for the public agent role, but not for the default role.</p>
<h3 id="solution"><a class="content__anchor" href="#solution" aria-hidden="true"><i data-feather="bookmark"></i></a>Solution</h3>
<p>To resolve this issue, you can add nodes to the cluster or scale the application back to a level at which resources are available. For example, run a command similar to the following:
<code>dcos marathon app update /dcos-101/app2 --force instances=1</code></p>
<p>You must use the <code>--force</code> option in this command because the previous deployment is ongoing.</p>
<h2 id="not-enough-resources-on-a-single-node"><a class="content__anchor" href="#not-enough-resources-on-a-single-node" aria-hidden="true"><i data-feather="bookmark"></i></a>Not enough resources on a single node</h2>
<p>Because each application is started on a single node, task resources must also fit onto a single node. To simulate this issue, try updating the <code>app2</code> app to use 10 CPUs by running a command similar to the following:
<code>dcos marathon app update /dcos-101/app2 cpus=10</code></p>
<h3 id="symptom-2"><a class="content__anchor" href="#symptom-2" aria-hidden="true"><i data-feather="bookmark"></i></a>Symptom</h3>
<p>After increasing the number of CPUs, run <code>dcos marathon app list</code> or <code>dcos marathon deployment list</code> to check that the <code>restart</code> deployment is stuck. For example, if you run <code>dcos marathon deployment list</code>, you might see:</p>
<pre><code>APP             POD  ACTION   PROGRESS  ID                                    
/dcos-101/app1  -    restart    0/1     f257caa6-672b-4a92-8621-27fba79b9c00  
/dcos-101/app2  -    restart    0/1     692cce55-fd2a-482e-8d46-84fbc12a2927  
</code></pre>
<h3 id="cause-2"><a class="content__anchor" href="#cause-2" aria-hidden="true"><i data-feather="bookmark"></i></a>Cause</h3>
<p>The problem here is that there are no resource offers large enough to match the request.</p>
<h3 id="solution-2"><a class="content__anchor" href="#solution-2" aria-hidden="true"><i data-feather="bookmark"></i></a>Solution</h3>
<p>To resolve this issue, you can provision larger or scale the application back to a level at which it fits onto the free resources on a single node. For example, run a command similar to the following:
<code>dcos marathon app update /dcos-101/app2 --force cpus=1</code></p>
<p>You must use the <code>--force</code> option in this command because the previous deployment is ongoing.</p>
<h1 id="insufficient-resource-allocation-or-resource-isolation"><a class="content__anchor" href="#insufficient-resource-allocation-or-resource-isolation" aria-hidden="true"><i data-feather="bookmark"></i></a>Insufficient resource allocation or resource isolation</h1>
<p>In some cases, you might have an application that attempts to use more resources than it is allocated. This is a common problem with memory consumption in conjunction with JVM-based applications. To simulate this issue, try deploying the sample <a href="https://github.com/joerg84/dcos-101/blob/master/oomApp/oomApp.go">out-of-memory app</a> by running the following command:
<code>dcos marathon app add https://raw.githubusercontent.com/joerg84/dcos-101/master/oomApp/oomApp.json</code></p>
<h3 id="symptom-3"><a class="content__anchor" href="#symptom-3" aria-hidden="true"><i data-feather="bookmark"></i></a>Symptom</h3>
<p>After deploying the sample app, check the Marathon log to see if it includes Out of Memory errors. Because the kernel is killing the app, the errors are not always visible to DC/OS. To see the problem in this case, you need to determine the Mesos ID for the out-of-memory application task and view the kernel log file on the computer where that task runs.</p>
<ol>
<li>
<p>Open a terminal and secure shell (SSH) session on an agent where the Out of Memory app runs by running a command similar to the following:</p>
<pre><code class="language-bash">dcos node ssh --master-proxy --mesos-id=99f56b43-c1a7-4858-be19-5fec03fc88de-S1
</code></pre>
</li>
<li>
<p>Check the kernel log by running the following command:</p>
<pre><code class="language-bash">journalctl -f _TRANSPORT=kernel
</code></pre>
<p>The log file should include a message similar to the following:</p>
<pre><code>Memory cgroup out of memory: Kill process 10106 (oomApp) score 925 or sacrifice child; Killed process 10390 (oomApp) total-vm:3744760kB, anon-rss:60816kB, file-rss:1240kB, shmem-rss:0kB`
</code></pre>
</li>
</ol>
<h3 id="cause-3"><a class="content__anchor" href="#cause-3" aria-hidden="true"><i data-feather="bookmark"></i></a>Cause</h3>
<p>In most cases, there are two potential reasons for your application to be using too much memory:</p>
<ul>
<li>
<p>There are issues in the application code causing the app to use too much memory, for example, because there is a memory leak in the code logic.</p>
</li>
<li>
<p>You have allocated too little memory for the application.</p>
</li>
</ul>
<h3 id="solution-3"><a class="content__anchor" href="#solution-3" aria-hidden="true"><i data-feather="bookmark"></i></a>Solution</h3>
<p>To resolve these potential issues, check the application code to correct any programming errors such. If the problem is not in the code itself, increase the amount of memory you have allocated for the application.</p>
<p>To complete this tutorial, be sure to remove the out-of-memory application by running the following command:</p>
<pre><code class="language-bash">dcos marathon app remove /dcoc-101/oom-app
</code></pre>
<h1 id="next-steps"><a class="content__anchor" href="#next-steps" aria-hidden="true"><i data-feather="bookmark"></i></a>Next steps</h1>
<p>In this tutorial, you learned how to view the resources allocated for application tasks and how to scale and debug potential resource issues.</p>
<h1 id="related-topics"><a class="content__anchor" href="#related-topics" aria-hidden="true"><i data-feather="bookmark"></i></a>Related topics</h1>
<p>Now that you are practically a pro, you might want to begin exploring more advanced topics and configuration options such as:</p>
<ul>
<li>Using application groups and <a href="../../task-labels/">labels</a></li>
<li>Defining <a href="/dcosdocs/mesosphere/dcos/1.13/deploying-services/marathon-constraints/">placement constraints</a></li>
<li>Deploying applications in <a href="/dcosdocs/mesosphere/dcos/1.13/deploying-services/pods/">pods</a></li>
</ul>
</article></div><aside class="content__sections"><div class="content__sections-list-container"><ul class="content__sections-list"><li class="content__sections-item content__sections-item--h1"><a href="#orchestration-and-cluster-management">Orchestration and cluster management</a></li><li class="content__sections-item content__sections-item--h2"><a href="#cluster-resiliency">Cluster resiliency</a></li><li class="content__sections-item content__sections-item--h2"><a href="#resource-allocation-and-usage">Resource allocation and usage</a></li><li class="content__sections-item content__sections-item--h2"><a href="#service-identification-and-management">Service identification and management</a></li><li class="content__sections-item content__sections-item--h1"><a href="#before-you-begin">Before you begin</a></li><li class="content__sections-item content__sections-item--h1"><a href="#learning-objectives">Learning objectives</a></li><li class="content__sections-item content__sections-item--h1"><a href="#review-the-app-definition">Review the app definition</a></li><li class="content__sections-item content__sections-item--h1"><a href="#scale-applications">Scale applications</a></li><li class="content__sections-item content__sections-item--h2"><a href="#scale-the-application-group">Scale the application group</a></li><li class="content__sections-item content__sections-item--h2"><a href="#set-instance-count-directly">Set instance count directly</a></li><li class="content__sections-item content__sections-item--h2"><a href="#scale-allocated-resources">Scale allocated resources</a></li><li class="content__sections-item content__sections-item--h1"><a href="#debug-resource-problems">Debug resource problems</a></li><li class="content__sections-item content__sections-item--h2"><a href="#not-enough-resources-in-the-cluster">Not enough resources in the cluster</a></li><li class="content__sections-item content__sections-item--h2"><a href="#not-enough-resources-on-a-single-node">Not enough resources on a single node</a></li><li class="content__sections-item content__sections-item--h1"><a href="#insufficient-resource-allocation-or-resource-isolation">Insufficient resource allocation or resource isolation</a></li><li class="content__sections-item content__sections-item--h1"><a href="#next-steps">Next steps</a></li><li class="content__sections-item content__sections-item--h1"><a href="#related-topics">Related topics</a></li></ul></div></aside></main></div></div><script src="/dcosdocs/assets/js/jquery-3.2.1.js"></script><script src="/dcosdocs/assets/js/clipboard.js"></script><script src="/dcosdocs/assets/js/prism.js"></script><script src="/js/main.js"></script></body></html>