<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width" initial-scale="1" user-scalable="no"><title>Design - Distributed DNS - D2iQ Docs</title><meta name="description" content="Understanding distributed DNS"><link rel="apple-touch-icon" sizes="180x180" href="/assets/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/favicon-16x16.png"><link rel="stylesheet" type="text/css" href="/css/styles.css"><link rel="search" type="application/opensearchdescription+xml" href="/assets/opensearch.xml" title="Search"><link href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,500,500i,700,700i" rel="stylesheet"><script src="https://unpkg.com/feather-icons/dist/feather.min.js"></script><script>window.analytics||(window.analytics=[]),window.analytics.methods=["identify","track","trackLink","trackForm","trackClick","trackSubmit","page","pageview","ab","alias","ready","group","on","once","off"],window.analytics.factory=function(t){return function(){var a=Array.prototype.slice.call(arguments);return a.unshift(t),window.analytics.push(a),window.analytics}};for(var i=0;i<window.analytics.methods.length;i++){var method=window.analytics.methods[i];window.analytics[method]=window.analytics.factory(method)}window.analytics.load=function(t){var a=document.createElement("script");a.type="text/javascript",a.async=!0,a.src=("https:"===document.location.protocol?"https://":"http://")+"d2dq2ahtl5zl1z.cloudfront.net/analytics.js/v1/"+t+"/analytics.min.js";var n=document.getElementsByTagName("script")[0];n.parentNode.insertBefore(a,n)},window.analytics.SNIPPET_VERSION="2.0.8",
window.analytics.load("7sgtwqvuai");
window.analytics.page();</script><noscript><iframe src="//www.googletagmanager.com/ns.html?id=GTM-PBJ84KX" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript><script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src='//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
})(window,document,'script','dataLayer','GTM-PBJ84KX');</script></head><body><div class="layout"><header class="header"><a class="header__drawer"><i class="header__icon" data-feather="menu"></i></a><a class="header__logo" href="/"><img class="header__logo--mobile" src="/assets/D2iQ_Logotype_Color_Positive_Documentation.svg" alt="D2IQ"><img class="header__logo--desktop" src="/assets/D2iQ_Logotype_Color_Positive_Documentation.svg" alt="D2IQ"></a><div class="header__main"><div class="header__dropdown"><img class="header__dropdown-icon" src="/assets/D2IQ_Logotype_Color_Positive.png" alt="D2iQ"><strong>DC/OS Documentation</strong><i data-feather="chevron-down"></i></div><nav class="header__menu"><ul class="header__menu-list"><li class="header__menu-item"><a href="/mesosphere/dcos">DC/OS</a></li><li class="header__menu-item"><a href="/dcosdocs/mesosphere/dcos/services">Services</a></li><li class="header__menu-item"><a href="https://support.d2iq.com">Support</a></li></ul></nav></div><div class="chooser" id="localizer"><div class="chooser-current"><a class="chooser-title">English</a><svg class="chooser-svg" id="localizer-svg"><path class="pointer" d="m 13,6 -5,5 -5,-5 z" fill="#858585"></path></svg></div><ul class="chooser-list" id="localizer-list"><li class="chooser-list-item"><a href="/dcosdocs/mesosphere/dcos/cn/2.1/overview/design/dns-proxy">中文 (简体)</a></li></ul></div><section class="header__search" role="search"><form class="header__search-form" action="/search/"><input class="header__search-input" id="header-search-input" tabindex="1" type="text" name="q" placeholder="Search"><input type="hidden" name="hFR[scope][0]" value="DC/OS 2.1"><label class="header__search-label" for="header-search-input"><i class="header__icon" data-feather="search"></i></label></form></section></header><div class="header-dropdown"><ul class="header-dropdown__list"><li class="header-dropdown__top-item"><div>DKP</div></li><li class="header-dropdown__item"><a href="/dkp/konvoy">Konvoy</a></li><li class="header-dropdown__item"><a href="/dkp/kommander">Kommander</a></li><li class="header-dropdown__item"><a href="/dkp/dispatch">Dispatch</a></li><li class="header-dropdown__item"><a href="/dkp/kaptain">Kaptain</a></li><li class="header-dropdown__top-item"><div>Mesosphere</div></li><li class="header-dropdown__item header-dropdown__item--active"><a href="/mesosphere/dcos">DC/OS</a></li><li class="header-dropdown__item"><a href="/dcosdocs/mesosphere/dcos/services">DC/OS Services</a></li><li class="header-dropdown__item"><a href="https://support.d2iq.com">Support</a></li></ul></div><div class="layout__sidebar layout__drawer"><section class="sidebar"><header class="sidebar__header"><div class="sidebar__dropdown"><ul><li><a href="/dcosdocs/mesosphere/dcos/2.2/overview/design/dns-proxy">Mesosphere DC/OS 2.2.0</a></li><li><a href="/dcosdocs/mesosphere/dcos/2.1/overview/design/dns-proxy">Mesosphere DC/OS 2.1.0</a></li><li><a href="/dcosdocs/mesosphere/dcos/2.0/overview/design/dns-proxy">Mesosphere DC/OS 2.0</a></li><li><a href="/dcosdocs/mesosphere/dcos/1.13/overview/design/dns-proxy">Mesosphere DC/OS 1.13</a></li></ul><div class="toggle"><p><span class="title">DC/OS</span><span class="version"> 2.1</span></p><i data-feather="chevron-down"></i></div></div></header><nav class="sidebar_nav" role="navigation"><ul><li><a class="d0" href="/dcosdocs/mesosphere/dcos/2.1/release-notes/"><i data-feather="chevron-right"></i>Release Notes</a></li><li class="active"><a class="d0" href="/dcosdocs/mesosphere/dcos/2.1/overview/"><i data-feather="chevron-right"></i>Overview</a></li><ul><li><a class="d1" href="/dcosdocs/mesosphere/dcos/2.1/overview/what-is-dcos/">What is DC/OS</a></li><li><a class="d1" href="/dcosdocs/mesosphere/dcos/2.1/overview/architecture/"><i data-feather="chevron-right"></i>Architecture</a></li><li><a class="d1" href="/dcosdocs/mesosphere/dcos/2.1/overview/features/">Features</a></li><li><a class="d1" href="/dcosdocs/mesosphere/dcos/2.1/overview/concepts/">Concepts</a></li><li><a class="d1" href="/dcosdocs/mesosphere/dcos/2.1/overview/high-availability/">High Availability</a></li><li class="active"><a class="d1" href="/dcosdocs/mesosphere/dcos/2.1/overview/design/"><i data-feather="chevron-right"></i>Design</a></li><ul><li><a class="d2" href="/dcosdocs/mesosphere/dcos/2.1/overview/design/auth-flow/">Authentication Architecture</a></li><li><a class="d2" href="/dcosdocs/mesosphere/dcos/2.1/overview/design/azure-container-service/">ACS</a></li><li class="active active-on"><a class="d2" href="/dcosdocs/mesosphere/dcos/2.1/overview/design/dns-proxy/">Distributed DNS</a></li><li><a class="d2" href="/dcosdocs/mesosphere/dcos/2.1/overview/design/installation/">Installation</a></li><li><a class="d2" href="/dcosdocs/mesosphere/dcos/2.1/overview/design/overlay/">Overlay</a></li></ul><li><a class="d1" href="/dcosdocs/mesosphere/dcos/2.1/overview/feature-maturity/">Feature Maturity</a></li></ul><li><a class="d0" href="/dcosdocs/mesosphere/dcos/2.1/installing/"><i data-feather="chevron-right"></i>Installing</a></li><li><a class="d0" href="/dcosdocs/mesosphere/dcos/2.1/gui/"><i data-feather="chevron-right"></i>GUI</a></li><li><a class="d0" href="/dcosdocs/mesosphere/dcos/2.1/cli/"><i data-feather="chevron-right"></i>CLI</a></li><li><a class="d0" href="/dcosdocs/mesosphere/dcos/2.1/administering-clusters/"><i data-feather="chevron-right"></i>Administering Clusters</a></li><li><a class="d0" href="/dcosdocs/mesosphere/dcos/2.1/networking/"><i data-feather="chevron-right"></i>Networking</a></li><li><a class="d0" href="/dcosdocs/mesosphere/dcos/2.1/security/"><i data-feather="chevron-right"></i>Security</a></li><li><a class="d0" href="/dcosdocs/mesosphere/dcos/2.1/storage/"><i data-feather="chevron-right"></i>Storage</a></li><li><a class="d0" href="/dcosdocs/mesosphere/dcos/2.1/metrics/"><i data-feather="chevron-right"></i>Metrics</a></li><li><a class="d0" href="/dcosdocs/mesosphere/dcos/2.1/monitoring/"><i data-feather="chevron-right"></i>Monitoring, Logging, and Debugging</a></li><li><a class="d0" href="/dcosdocs/mesosphere/dcos/2.1/multi-tenancy/"><i data-feather="chevron-right"></i>Multi-Tenancy for DC/OS Clusters</a></li><li><a class="d0" href="/dcosdocs/mesosphere/dcos/2.1/hybrid-cloud/"><i data-feather="chevron-right"></i>Hybrid Cloud</a></li><li><a class="d0" href="/dcosdocs/mesosphere/dcos/2.1/deploying-jobs/"><i data-feather="chevron-right"></i>Deploying Jobs</a></li><li><a class="d0" href="/dcosdocs/mesosphere/dcos/2.1/deploying-services/"><i data-feather="chevron-right"></i>Deploying Services and Pods</a></li><li><a class="d0" href="/dcosdocs/mesosphere/dcos/2.1/tutorials/"><i data-feather="chevron-right"></i>Tutorials</a></li><li><a class="d0" href="/dcosdocs/mesosphere/dcos/2.1/api/"><i data-feather="chevron-right"></i>API Reference</a></li><li><a class="d0" href="/dcosdocs/mesosphere/dcos/2.1/developing-services/"><i data-feather="chevron-right"></i>Developing DC/OS Services</a></li></ul></nav><footer class="sidebar__footer"><div class="sidebar__footer-links"><a href="https://d2iq.com/terms/">Terms of Service</a><a href="https://d2iq.com/privacy/">Privacy Policy</a></div><a class="sidebar__footer-copyright" href="https://d2iq.com/">&copy; 2022 D2iQ, Inc. All rights reserved.</a></footer></section></div><div class="layout__content" role="main"><main class="content"><div class="content__container content__container--with-sections"><div class="content__header"><div class="content__header__row"><h1 class="content__header-title">Design - Distributed DNS</h1></div><h4 class="content__header-description">Understanding distributed DNS</h4><div class="actions"><ul class="actions__list"><li class="actions__item"><button class="actions__link" onclick="javascript:window.print()"><i class="actions__icon" data-feather="printer"></i><span class="actions__text">Print</span></button></li><li class="actions__item"><a class="actions__link" href="https://github.com/mesosphere/dcos-docs-site/tree/main/pages/dcosdocs/mesosphere/dcos/2.1/overview/design/dns-proxy/index.md" target="_blank"><i class="actions__icon" data-feather="github"></i><span class="actions__text">Contribute</span></a></li></ul></div></div><article class="content__article"><p>Tasks move around frequently in DC/OS, resources must be dynamically resolved by an application protocol, and they are referred to by name. This means that DNS is an integral part of DC/OS. Rather than implementing a ZooKeeper or Mesos client in every project, we have chosen DNS as the common language for discovery amongst all of our components in DC/OS.</p>
<p>To do this, we use Mesos-DNS, which runs on each of the DC/OS masters. In the client systems, we put each of the masters into the directory <code>/etc/resolv.conf</code>. If a master goes down, DNS queries to that master will time out. DNS Forwarder (Spartan) solves this problem by dual-dispatching DNS queries to multiple masters and returning the first result. To further alleviate risk, DNS Forwarder (Spartan) routes queries to nodes that it determines are best suited to perform a query. Specifically, if a domain ends in <code>mesos</code>, it will dispatch queries to the Mesos masters. If it does not end in <code>mesos</code>, it will send the query to two of the configured upstream nodes.</p>
<h1 id="implementation"><a class="content__anchor" href="#implementation" aria-hidden="true"><i data-feather="bookmark"></i></a>Implementation</h1>
<p>DNS Forwarder (Spartan) is very simple. It has dual-dispatch logic and hosts a domain <code>spartan</code> which has only one record – <code>ready.spartan</code>. The purpose of this record is to investigate the availability of DNS Forwarder (Spartan). Many services, including ICMP, ping this address prior to starting. DNS Forwarder (Spartan) obtains its information from Exhibitor. For this reason, it is critical that Exhibitor is <a href="/dcosdocs/mesosphere/dcos/2.1/installing/production/advanced-configuration/configuration-reference/">configured</a> correctly on the masters. Alternatively, if the cluster is configured using static masters, it will load them from the static configuration file.</p>
<h2 id="zookeeper"><a class="content__anchor" href="#zookeeper" aria-hidden="true"><i data-feather="bookmark"></i></a>ZooKeeper</h2>
<p>DNS Forwarder (Spartan) also enables high availability of ZooKeepers. You can always use the addresses <code>zk-1.zk</code>, <code>zk-2.zk</code>, <code>zk-3.zk</code>, <code>zk-4.zk</code>, <code>zk-5.zk</code>. If there are fewer than five ZooKeepers, DNS Forwarder (Spartan) will point multiple records at a single ZooKeeper.</p>
<h2 id="watchdog"><a class="content__anchor" href="#watchdog" aria-hidden="true"><i data-feather="bookmark"></i></a>Watchdog</h2>
<p>Since DNS is such a specialized, sensitive subsystem, we have chosen to protect it with a watchdog. There is a service installed on each node that runs every five minutes and checks whether or not it can query <code>ready.spartan</code>. To avoid harmonic effects, it sleeps for one minute past its initial start time, to avoid racing Spartan. You can monitor the system health of the watchdog as DNS Forwarder (Spartan) Watchdog in the system health <a href="/dcosdocs/mesosphere/dcos/2.1/gui/dashboard/">dashboard</a>.</p>
<p>In addition to this watchdog, we also run <code>genresolv</code>, which checks whether or not DNS Forwarder (Spartan) is alive to generate the <code>resolv.conf</code>. If it believes DNS Forwarder (Spartan) not to be alive, it then rewrites the <code>resolv.conf</code> with the upstream resolvers that you have configured into your DC/OS cluster.</p>
<h2 id="dns-forwarder-interface"><a class="content__anchor" href="#dns-forwarder-interface" aria-hidden="true"><i data-feather="bookmark"></i></a>DNS Forwarder Interface</h2>
<p>DNS Forwarder (Spartan) creates its own network interface. This interface is actually a dummy device called <code>spartan</code>. This device hosts three IPs: <code>198.51.100.1/32</code>, <code>198.51.100.2/32</code>, <code>198.51.100.3/32</code>. You can monitor the health of the DNS Forwarder (Spartan) component in the system health <a href="/dcosdocs/mesosphere/dcos/2.1/gui/dashboard/">dashboard</a>.</p>
</article></div><aside class="content__sections"><div class="content__sections-list-container"><ul class="content__sections-list"><li class="content__sections-item content__sections-item--h1"><a href="#implementation">Implementation</a></li><li class="content__sections-item content__sections-item--h2"><a href="#zookeeper">ZooKeeper</a></li><li class="content__sections-item content__sections-item--h2"><a href="#watchdog">Watchdog</a></li><li class="content__sections-item content__sections-item--h2"><a href="#dns-forwarder-interface">DNS Forwarder Interface</a></li></ul></div></aside></main></div></div><script src="/assets/js/jquery-3.2.1.js"></script><script src="/assets/js/clipboard.js"></script><script src="/assets/js/prism.js"></script><script src="/js/main.js"></script></body></html>