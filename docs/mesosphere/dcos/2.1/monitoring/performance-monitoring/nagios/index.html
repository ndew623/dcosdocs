<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width" initial-scale="1" user-scalable="no"><title>Monitoring with Nagios - D2iQ Docs</title><meta name="description" content="Monitoring a DC/OS cluster with Nagios"><link rel="apple-touch-icon" sizes="180x180" href="/assets/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/favicon-16x16.png"><link rel="stylesheet" type="text/css" href="/css/styles.css"><link rel="search" type="application/opensearchdescription+xml" href="/assets/opensearch.xml" title="Search"><link href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,500,500i,700,700i" rel="stylesheet"><script src="https://unpkg.com/feather-icons/dist/feather.min.js"></script><script>window.analytics||(window.analytics=[]),window.analytics.methods=["identify","track","trackLink","trackForm","trackClick","trackSubmit","page","pageview","ab","alias","ready","group","on","once","off"],window.analytics.factory=function(t){return function(){var a=Array.prototype.slice.call(arguments);return a.unshift(t),window.analytics.push(a),window.analytics}};for(var i=0;i<window.analytics.methods.length;i++){var method=window.analytics.methods[i];window.analytics[method]=window.analytics.factory(method)}window.analytics.load=function(t){var a=document.createElement("script");a.type="text/javascript",a.async=!0,a.src=("https:"===document.location.protocol?"https://":"http://")+"d2dq2ahtl5zl1z.cloudfront.net/analytics.js/v1/"+t+"/analytics.min.js";var n=document.getElementsByTagName("script")[0];n.parentNode.insertBefore(a,n)},window.analytics.SNIPPET_VERSION="2.0.8",
window.analytics.load("7sgtwqvuai");
window.analytics.page();</script><noscript><iframe src="//www.googletagmanager.com/ns.html?id=GTM-PBJ84KX" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript><script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src='//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
})(window,document,'script','dataLayer','GTM-PBJ84KX');</script></head><body><div class="layout"><header class="header"><a class="header__drawer"><i class="header__icon" data-feather="menu"></i></a><a class="header__logo" href="/"><img class="header__logo--mobile" src="/assets/D2iQ_Logotype_Color_Positive_Documentation.svg" alt="D2IQ"><img class="header__logo--desktop" src="/assets/D2iQ_Logotype_Color_Positive_Documentation.svg" alt="D2IQ"></a><div class="header__main"><div class="header__dropdown"><img class="header__dropdown-icon" src="/assets/D2IQ_Logotype_Color_Positive.png" alt="D2iQ"><strong>DC/OS Documentation</strong><i data-feather="chevron-down"></i></div><nav class="header__menu"><ul class="header__menu-list"><li class="header__menu-item"><a href="/mesosphere/dcos">DC/OS</a></li><li class="header__menu-item"><a href="/dcosdocs/mesosphere/dcos/services">Services</a></li><li class="header__menu-item"><a href="https://support.d2iq.com">Support</a></li></ul></nav></div><div class="chooser" id="localizer"><div class="chooser-current"><a class="chooser-title">English</a><svg class="chooser-svg" id="localizer-svg"><path class="pointer" d="m 13,6 -5,5 -5,-5 z" fill="#858585"></path></svg></div><ul class="chooser-list" id="localizer-list"><li class="chooser-list-item"><a href="/dcosdocs/mesosphere/dcos/cn/2.1/monitoring/performance-monitoring/nagios">中文 (简体)</a></li></ul></div><section class="header__search" role="search"><form class="header__search-form" action="/search/"><input class="header__search-input" id="header-search-input" tabindex="1" type="text" name="q" placeholder="Search"><input type="hidden" name="hFR[scope][0]" value="DC/OS 2.1"><label class="header__search-label" for="header-search-input"><i class="header__icon" data-feather="search"></i></label></form></section></header><div class="header-dropdown"><ul class="header-dropdown__list"><li class="header-dropdown__top-item"><div>DKP</div></li><li class="header-dropdown__item"><a href="/dkp/konvoy">Konvoy</a></li><li class="header-dropdown__item"><a href="/dkp/kommander">Kommander</a></li><li class="header-dropdown__item"><a href="/dkp/dispatch">Dispatch</a></li><li class="header-dropdown__item"><a href="/dkp/kaptain">Kaptain</a></li><li class="header-dropdown__top-item"><div>Mesosphere</div></li><li class="header-dropdown__item header-dropdown__item--active"><a href="/mesosphere/dcos">DC/OS</a></li><li class="header-dropdown__item"><a href="/dcosdocs/mesosphere/dcos/services">DC/OS Services</a></li><li class="header-dropdown__item"><a href="https://support.d2iq.com">Support</a></li></ul></div><div class="layout__sidebar layout__drawer"><section class="sidebar"><header class="sidebar__header"><div class="sidebar__dropdown"><ul><li><a href="/dcosdocs/mesosphere/dcos/2.2/monitoring/performance-monitoring/nagios">Mesosphere DC/OS 2.2.0</a></li><li><a href="/dcosdocs/mesosphere/dcos/2.1/monitoring/performance-monitoring/nagios">Mesosphere DC/OS 2.1.0</a></li><li><a href="/dcosdocs/mesosphere/dcos/2.0/monitoring/performance-monitoring/nagios">Mesosphere DC/OS 2.0</a></li><li><a href="/dcosdocs/mesosphere/dcos/1.13/monitoring/performance-monitoring/nagios">Mesosphere DC/OS 1.13</a></li></ul><div class="toggle"><p><span class="title">DC/OS</span><span class="version"> 2.1</span></p><i data-feather="chevron-down"></i></div></div></header><nav class="sidebar_nav" role="navigation"><ul><li><a class="d0" href="/dcosdocs/mesosphere/dcos/2.1/release-notes/"><i data-feather="chevron-right"></i>Release Notes</a></li><li><a class="d0" href="/dcosdocs/mesosphere/dcos/2.1/overview/"><i data-feather="chevron-right"></i>Overview</a></li><li><a class="d0" href="/dcosdocs/mesosphere/dcos/2.1/installing/"><i data-feather="chevron-right"></i>Installing</a></li><li><a class="d0" href="/dcosdocs/mesosphere/dcos/2.1/gui/"><i data-feather="chevron-right"></i>GUI</a></li><li><a class="d0" href="/dcosdocs/mesosphere/dcos/2.1/cli/"><i data-feather="chevron-right"></i>CLI</a></li><li><a class="d0" href="/dcosdocs/mesosphere/dcos/2.1/administering-clusters/"><i data-feather="chevron-right"></i>Administering Clusters</a></li><li><a class="d0" href="/dcosdocs/mesosphere/dcos/2.1/networking/"><i data-feather="chevron-right"></i>Networking</a></li><li><a class="d0" href="/dcosdocs/mesosphere/dcos/2.1/security/"><i data-feather="chevron-right"></i>Security</a></li><li><a class="d0" href="/dcosdocs/mesosphere/dcos/2.1/storage/"><i data-feather="chevron-right"></i>Storage</a></li><li><a class="d0" href="/dcosdocs/mesosphere/dcos/2.1/metrics/"><i data-feather="chevron-right"></i>Metrics</a></li><li class="active"><a class="d0" href="/dcosdocs/mesosphere/dcos/2.1/monitoring/"><i data-feather="chevron-right"></i>Monitoring, Logging, and Debugging</a></li><ul><li class="active"><a class="d1" href="/dcosdocs/mesosphere/dcos/2.1/monitoring/performance-monitoring/"><i data-feather="chevron-right"></i>Performance Monitoring</a></li><ul><li class="active active-on"><a class="d2" href="/dcosdocs/mesosphere/dcos/2.1/monitoring/performance-monitoring/nagios/">Monitoring with Nagios</a></li></ul><li><a class="d1" href="/dcosdocs/mesosphere/dcos/2.1/monitoring/logging/"><i data-feather="chevron-right"></i>Logging</a></li><li><a class="d1" href="/dcosdocs/mesosphere/dcos/2.1/monitoring/debugging/"><i data-feather="chevron-right"></i>Debugging</a></li></ul><li><a class="d0" href="/dcosdocs/mesosphere/dcos/2.1/multi-tenancy/"><i data-feather="chevron-right"></i>Multi-Tenancy for DC/OS Clusters</a></li><li><a class="d0" href="/dcosdocs/mesosphere/dcos/2.1/hybrid-cloud/"><i data-feather="chevron-right"></i>Hybrid Cloud</a></li><li><a class="d0" href="/dcosdocs/mesosphere/dcos/2.1/deploying-jobs/"><i data-feather="chevron-right"></i>Deploying Jobs</a></li><li><a class="d0" href="/dcosdocs/mesosphere/dcos/2.1/deploying-services/"><i data-feather="chevron-right"></i>Deploying Services and Pods</a></li><li><a class="d0" href="/dcosdocs/mesosphere/dcos/2.1/tutorials/"><i data-feather="chevron-right"></i>Tutorials</a></li><li><a class="d0" href="/dcosdocs/mesosphere/dcos/2.1/api/"><i data-feather="chevron-right"></i>API Reference</a></li><li><a class="d0" href="/dcosdocs/mesosphere/dcos/2.1/developing-services/"><i data-feather="chevron-right"></i>Developing DC/OS Services</a></li></ul></nav><footer class="sidebar__footer"><div class="sidebar__footer-links"><a href="https://d2iq.com/terms/">Terms of Service</a><a href="https://d2iq.com/privacy/">Privacy Policy</a></div><a class="sidebar__footer-copyright" href="https://d2iq.com/">&copy; 2022 D2iQ, Inc. All rights reserved.</a></footer></section></div><div class="layout__content" role="main"><main class="content"><div class="content__container content__container--with-sections"><div class="content__header"><div class="content__header__row"><h1 class="content__header-title">Monitoring with Nagios</h1></div><h4 class="content__header-description">Monitoring a DC/OS cluster with Nagios</h4><div class="actions"><ul class="actions__list"><li class="actions__item"><button class="actions__link" onclick="javascript:window.print()"><i class="actions__icon" data-feather="printer"></i><span class="actions__text">Print</span></button></li><li class="actions__item"><a class="actions__link" href="https://github.com/mesosphere/dcos-docs-site/tree/main/pages/dcosdocs/mesosphere/dcos/2.1/monitoring/performance-monitoring/nagios/index.md" target="_blank"><i class="actions__icon" data-feather="github"></i><span class="actions__text">Contribute</span></a></li></ul></div></div><article class="content__article"><p>Nagios is a popular monitoring framework for distributed hosts. This guide explains how to monitor a DC/OS cluster with <a href="https://assets.nagios.com/downloads/nagioscore/docs/nagioscore/4/en/monitoring-linux.html">Nagios Core 4x</a> using <a href="https://assets.nagios.com/downloads/nagioscore/docs/nagioscore/4/en/addons.html#nrpe">NRPE</a>.</p>
<h2 id="installation"><a class="content__anchor" href="#installation" aria-hidden="true"><i data-feather="bookmark"></i></a>Installation</h2>
<p>This guide assumes that you have installed and configured Nagios for your cluster. Below are links to popular configuration management suites:</p>
<ul>
<li>Puppet Module: <a href="https://forge.puppet.com/thias/nagios">thias/nagios</a></li>
<li>Chef Cookbook: <a href="https://github.com/schubergphilis/nagios">schubergphilis/nagios</a></li>
<li>Manual Install: <a href="https://www.nagios.org/documentation/">nagios.org/documentation</a></li>
</ul>
<h3 id="recommendations"><a class="content__anchor" href="#recommendations" aria-hidden="true"><i data-feather="bookmark"></i></a>Recommendations</h3>
<ol>
<li>
<p>Use SSL</p>
<p>The NRPE plugin for Nagios allows you to set up a server-daemon interface with SSL. We recommend you do this for security.</p>
</li>
<li>
<p>Lightweight Checks</p>
<p>The most common Nagios implementation error is building overly complicated scripts that do not pay attention to the resources the check requires. This could undermine your cluster performance. Ensure your checks are clean, require low resource overhead, and make full use of the process in which they’re spawned (for example, do not pipe <code>grep</code> to <code>awk</code>).</p>
</li>
<li>
<p>Nagios via DC/OS</p>
<p>We <strong><em>do not</em></strong> recommend running Nagios via DC/OS. Running your monitoring platform on the cluster you are monitoring has intrinsic pitfalls: if your cluster goes down, your monitoring platform will also.</p>
</li>
</ol>
<h2 id="what-to-monitor"><a class="content__anchor" href="#what-to-monitor" aria-hidden="true"><i data-feather="bookmark"></i></a>What to monitor</h2>
<p>Once you have Nagios installed on your cluster and have the NRPE plugin configured, then you can construct scripts to monitor resource health for DC/OS.</p>
<h3 id="systemd-units"><a class="content__anchor" href="#systemd-units" aria-hidden="true"><i data-feather="bookmark"></i></a><code>systemd</code> units</h3>
<p>DC/OS runs only on <code>systemd</code>. Tracking units with Nagios is easy. You can use one of the popular scripts for NRPE remote checks such as <a href="https://github.com/jonschipp/nagios-plugins/blob/master/check_service.sh">jonschipp/nagios-plugins/check_service.sh</a> or design  your own.</p>
<p>Units differ between agents and masters, but you can easily determine which units to monitor without hard coding them (since they are prone to changing or being added to). Modify <a href="https://github.com/jonschipp/nagios-plugins/blob/master/check_service.sh">jonschipp/nagios-plugins/check_service.sh</a> for monitoring only DC/OS units by adding a simple wrapper:</p>
<pre><code class="language-bash"># cat dcos_unit_check.sh
#!/bin/bash
for unit in `ls /etc/systemd/system/dcos.target.wants`; do
  echo &quot;Checking $unit&quot;
  ./check_service.sh -s ${unit} &gt; /dev/null 2&gt;&amp;1
  STATUS=$?
  if [ &quot;${STATUS}&quot; -ne 0 ]; then
    echo &quot;Status for $unit is not 0, got $STATUS&quot;
    exit $STATUS
  fi
done
</code></pre>
<p>If a component service is not healthy, such as Admin Router, you will get a failure from this script:</p>
<pre><code class="language-bash">ip-10-0-6-126 core # ./dcos_unit_check.sh
Checking dcos-adminrouter-reload.service
Status for dcos-adminrouter-reload.service is not 0, got 2
</code></pre>
<h3 id="docker"><a class="content__anchor" href="#docker" aria-hidden="true"><i data-feather="bookmark"></i></a>Docker</h3>
<p>Monitoring Docker via Nagios can be tricky, as there are many aspects you might want to watch. If your intent is to check if the service is available and running, (for example, Docker service is running and enabled and healthy according to <code>systemd</code>) then we recommend a NRPE script that does just that.</p>
<p>If your intent is to monitor what is going on inside the container, we recommend you run a service such as <a href="https://github.com/google/cadvisor">cAdvisor</a>.</p>
</article></div><aside class="content__sections"><div class="content__sections-list-container"><ul class="content__sections-list"><li class="content__sections-item content__sections-item--h2"><a href="#installation">Installation</a></li><li class="content__sections-item content__sections-item--h2"><a href="#what-to-monitor">What to monitor</a></li></ul></div></aside></main></div></div><script src="/assets/js/jquery-3.2.1.js"></script><script src="/assets/js/clipboard.js"></script><script src="/assets/js/prism.js"></script><script src="/js/main.js"></script></body></html>