<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width" initial-scale="1" user-scalable="no"><title>故障排除 - D2iQ Docs</title><meta name="description" content="排除 DC/OS 安装问题"><link rel="apple-touch-icon" sizes="180x180" href="/dcosdocs/assets/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/dcosdocs/assets/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/dcosdocs/assets/favicon-16x16.png"><link rel="stylesheet" type="text/css" href="/dcosdocs/css/styles.css"><link rel="search" type="application/opensearchdescription+xml" href="/dcosdocs/assets/opensearch.xml" title="Search"><link href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,500,500i,700,700i" rel="stylesheet"><script src="https://unpkg.com/feather-icons/dist/feather.min.js"></script><script>window.analytics||(window.analytics=[]),window.analytics.methods=["identify","track","trackLink","trackForm","trackClick","trackSubmit","page","pageview","ab","alias","ready","group","on","once","off"],window.analytics.factory=function(t){return function(){var a=Array.prototype.slice.call(arguments);return a.unshift(t),window.analytics.push(a),window.analytics}};for(var i=0;i<window.analytics.methods.length;i++){var method=window.analytics.methods[i];window.analytics[method]=window.analytics.factory(method)}window.analytics.load=function(t){var a=document.createElement("script");a.type="text/javascript",a.async=!0,a.src=("https:"===document.location.protocol?"https://":"http://")+"d2dq2ahtl5zl1z.cloudfront.net/analytics.js/v1/"+t+"/analytics.min.js";var n=document.getElementsByTagName("script")[0];n.parentNode.insertBefore(a,n)},window.analytics.SNIPPET_VERSION="2.0.8",
window.analytics.load("7sgtwqvuai");
window.analytics.page();</script><noscript><iframe src="//www.googletagmanager.com/ns.html?id=GTM-PBJ84KX" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript><script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src='//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
})(window,document,'script','dataLayer','GTM-PBJ84KX');</script></head><body><div class="layout"><header class="header"><a class="header__drawer"><i class="header__icon" data-feather="menu"></i></a><a class="header__logo" href="/"><img class="header__logo--mobile" src="/dcosdocs/assets/D2iQ_Logotype_Color_Positive_Documentation.svg" alt="D2IQ"><img class="header__logo--desktop" src="/dcosdocs/assets/D2iQ_Logotype_Color_Positive_Documentation.svg" alt="D2IQ"></a><div class="header__main"><div class="header__dropdown"><img class="header__dropdown-icon" src="/dcosdocs/assets/D2IQ_Logotype_Color_Positive.png" alt="D2iQ"><strong>DC/OS文档</strong><i data-feather="chevron-down"></i></div><nav class="header__menu"><ul class="header__menu-list"><li class="header__menu-item"><a href="https://support.d2iq.com">Support</a></li></ul></nav></div><div class="chooser" id="localizer"><div class="chooser-current"><a class="chooser-title">中文 (简体)</a><svg class="chooser-svg" id="localizer-svg"><path class="pointer" d="m 13,6 -5,5 -5,-5 z" fill="#858585"></path></svg></div><ul class="chooser-list" id="localizer-list"><li class="chooser-list-item"><a href="/dcosdocs/mesosphere/dcos/2.1/installing/troubleshooting">English</a></li></ul></div><section class="header__search" role="search"><form class="header__search-form" action="/search/"><input class="header__search-input" id="header-search-input" tabindex="1" type="text" name="q" placeholder="Search"><input type="hidden" name="hFR[scope][0]" value="DC/OS 2.1"><label class="header__search-label" for="header-search-input"><i class="header__icon" data-feather="search"></i></label></form></section></header><div class="header-dropdown"><ul class="header-dropdown__list"><li class="header-dropdown__top-item"><div>DKP</div></li><li class="header-dropdown__item"><a href="/dkp/konvoy">Konvoy</a></li><li class="header-dropdown__item"><a href="/dkp/kommander">Kommander</a></li><li class="header-dropdown__item"><a href="/dkp/dispatch">Dispatch</a></li><li class="header-dropdown__item"><a href="/dkp/kaptain">Kaptain</a></li><li class="header-dropdown__top-item"><div>Mesosphere</div></li><li class="header-dropdown__item header-dropdown__item--active"><a href="/mesosphere/dcos">DC/OS</a></li><li class="header-dropdown__item"><a href="/dcosdocs/mesosphere/dcos/services">DC/OS Services</a></li><li class="header-dropdown__item"><a href="https://support.d2iq.com">Support</a></li></ul></div><div class="layout__sidebar layout__drawer"><section class="sidebar"><header class="sidebar__header"><div class="sidebar__dropdown"><ul><li><a href="/dcosdocs/mesosphere/dcos/cn/2.1/installing/troubleshooting">Mesosphere DC/OS 2.1.0</a></li><li><a href="/dcosdocs/mesosphere/dcos/cn/2.0/installing/troubleshooting">Mesosphere DC/OS 2.0</a></li><li><a href="/dcosdocs/mesosphere/dcos/cn/1.13/installing/troubleshooting">Mesosphere DC/OS 1.13</a></li></ul><div class="toggle"><p><span class="title">DC/OS</span><span class="version"> 2.1</span></p><i data-feather="chevron-down"></i></div></div></header><nav class="sidebar_nav" role="navigation"><ul><li><a class="d0" href="/dcosdocs/mesosphere/dcos/cn/2.1/release-notes/"><i data-feather="chevron-right"></i>版本注释</a></li><li><a class="d0" href="/dcosdocs/mesosphere/dcos/cn/2.1/overview/"><i data-feather="chevron-right"></i>概述</a></li><li class="active"><a class="d0" href="/dcosdocs/mesosphere/dcos/cn/2.1/installing/"><i data-feather="chevron-right"></i>安装</a></li><ul><li><a class="d1" href="/dcosdocs/mesosphere/dcos/cn/2.1/installing/evaluation/"><i data-feather="chevron-right"></i>云安装</a></li><li><a class="d1" href="/dcosdocs/mesosphere/dcos/cn/2.1/installing/production/"><i data-feather="chevron-right"></i>本地安装</a></li><li><a class="d1" href="/dcosdocs/mesosphere/dcos/cn/2.1/installing/installation-faq/">常见问题</a></li><li class="active active-on"><a class="d1" href="/dcosdocs/mesosphere/dcos/cn/2.1/installing/troubleshooting/">故障排除</a></li></ul><li><a class="d0" href="/dcosdocs/mesosphere/dcos/cn/2.1/gui/"><i data-feather="chevron-right"></i>GUI</a></li><li><a class="d0" href="/dcosdocs/mesosphere/dcos/cn/2.1/cli/"><i data-feather="chevron-right"></i>CLI</a></li><li><a class="d0" href="/dcosdocs/mesosphere/dcos/cn/2.1/administering-clusters/"><i data-feather="chevron-right"></i>管理群集</a></li><li><a class="d0" href="/dcosdocs/mesosphere/dcos/cn/2.1/networking/"><i data-feather="chevron-right"></i>网络</a></li><li><a class="d0" href="/dcosdocs/mesosphere/dcos/cn/2.1/security/"><i data-feather="chevron-right"></i>安全</a></li><li><a class="d0" href="/dcosdocs/mesosphere/dcos/cn/2.1/storage/"><i data-feather="chevron-right"></i>存储</a></li><li><a class="d0" href="/dcosdocs/mesosphere/dcos/cn/2.1/metrics/"><i data-feather="chevron-right"></i>度量标准</a></li><li><a class="d0" href="/dcosdocs/mesosphere/dcos/cn/2.1/monitoring/"><i data-feather="chevron-right"></i>监控、日志记录和调试</a></li><li><a class="d0" href="/dcosdocs/mesosphere/dcos/cn/2.1/multi-tenancy/"><i data-feather="chevron-right"></i>DC/OS 群集的多租户</a></li><li><a class="d0" href="/dcosdocs/mesosphere/dcos/cn/2.1/hybrid-cloud/"><i data-feather="chevron-right"></i>混合云</a></li><li><a class="d0" href="/dcosdocs/mesosphere/dcos/cn/2.1/deploying-jobs/"><i data-feather="chevron-right"></i>部署作业</a></li><li><a class="d0" href="/dcosdocs/mesosphere/dcos/cn/2.1/deploying-services/"><i data-feather="chevron-right"></i>部署服务和 Pod</a></li><li><a class="d0" href="/dcosdocs/mesosphere/dcos/cn/2.1/tutorials/"><i data-feather="chevron-right"></i>教程</a></li><li><a class="d0" href="/dcosdocs/mesosphere/dcos/cn/2.1/api/"><i data-feather="chevron-right"></i>API 参考</a></li><li><a class="d0" href="/dcosdocs/mesosphere/dcos/cn/2.1/developing-services/"><i data-feather="chevron-right"></i>开发 DC/OS 服务</a></li></ul></nav><footer class="sidebar__footer"><div class="sidebar__footer-links"><a href="https://d2iq.com/terms/">Terms of Service</a><a href="https://d2iq.com/privacy/">Privacy Policy</a></div><a class="sidebar__footer-copyright" href="https://d2iq.com/">&copy; 2022 D2iQ, Inc. All rights reserved.</a></footer></section></div><div class="layout__content" role="main"><main class="content"><div class="content__container content__container--with-sections"><div class="content__header"><div class="content__header__row"><h1 class="content__header-title">故障排除</h1></div><h4 class="content__header-description">排除 DC/OS 安装问题</h4><div class="actions"><ul class="actions__list"><li class="actions__item"><button class="actions__link" onclick="javascript:window.print()"><i class="actions__icon" data-feather="printer"></i><span class="actions__text">Print</span></button></li><li class="actions__item"><a class="actions__link" href="https://github.com/mesosphere/dcos-docs-site/tree/main/pages/dcosdocs/mesosphere/dcos/cn/2.1/installing/troubleshooting/index.md" target="_blank"><i class="actions__icon" data-feather="github"></i><span class="actions__text">Contribute</span></a></li></ul></div></div><article class="content__article"><h1 id=""><a class="content__anchor" href="#" aria-hidden="true"><i data-feather="bookmark"></i></a><a name="general"></a>一般故障排除方法</h1>
<ul>
<li>验证您具有有效的 IP 检测脚本、运行正常的 DNS 解析器将 DC/OS 服务绑定到 NTP，以及所有节点与 NTP 同步。</li>
</ul>
<h2 id="ip"><a class="content__anchor" href="#ip" aria-hidden="true"><i data-feather="bookmark"></i></a>IP 检测脚本</h2>
<p>您必须具有有效的 <a href="/dcosdocs/mesosphere/dcos/cn/2.1/installing/production/deploying-dcos/installation/#create-an-ip-detection-script">ip-detect</a> 脚本。您可以手动运行群集中所有节点上的 <code>ip-detect</code>，或检查现有装置上的 <code>/opt/mesosphere/bin/detect_ip</code>，以确保其返回有效的 IP 地址。有效的 IP 地址没有：</p>
<ul>
<li>额外的行</li>
<li>空白空间</li>
<li>特殊或隐藏字符</li>
</ul>
<p>我们建议您使用 <code>ip-detect</code> <a href="/dcosdocs/mesosphere/dcos/cn/2.1/installing/production/deploying-dcos/installation/">示例</a>.</p>
<h2 id="dns"><a class="content__anchor" href="#dns" aria-hidden="true"><i data-feather="bookmark"></i></a>DNS 解析器</h2>
<p>您必须有正常运行的 DNS 解析器，这在您的 <a href="/dcosdocs/mesosphere/dcos/cn/2.1/installing/production/advanced-configuration/configuration-reference/#resolvers">config.yaml</a> 文件中指定。我们建议您对 FQDN、短主机名和 IP 地址进行正向和反向查找。DC/OS 可以在没有有效 DNS 支持的环境中运行，但以下 <em>必须</em> 工作才能支持 DC/OS 服务，包括 Spark：</p>
<ul>
<li>
<p><code>hostname -f</code> 返回 FQDN</p>
</li>
<li>
<p><code>hostname -s</code> 返回短主机名</p>
<p>您还应对所有节点上 <code>hostnamectl</code> 的输出执行运行状况检查。</p>
</li>
</ul>
<p>在排除 DC/OS 安装问题时，您应该按以下顺序检查组件：</p>
<ol>
<li>时间同步</li>
<li>Exhibitor</li>
<li>Mesos 管理节点</li>
<li>Mesos DNS</li>
<li>DNS 转发器</li>
<li>DC/OS Marathon</li>
<li>作业</li>
<li>Admin Router</li>
</ol>
<p>确保在验证代理节点之前先验证所有服务都在管理节点上是否都运行且状态良好。</p>
<ul>
<li>
<p>网络时间协议 (NTP) 必须在所有节点上启用，以便时钟同步。默认情况下，在 DC/OS 启动期间，如果未启用，将会出现错误。您可以通过运行以下一个命令来验证 NTP 是否启用，具体取决于您的 OS 和配置：</p>
<pre><code class="language-bash">ntptime
</code></pre>
<pre><code class="language-bash">adjtimex -p
</code></pre>
<pre><code class="language-bash">timedatectl
</code></pre>
</li>
<li>
<p>确保防火墙和任何其他连接过滤机制不干扰群集组件通信。必须允许 TCP、UDP 和 ICMP。</p>
</li>
</ul>
<ul>
<li>确保绑定到端口 <code>53</code> 的服务（DNS 转发器 (&gt;<code>dcos-net.service</code>) 必需的操作）被禁用并停止。例如：</li>
</ul>
<pre><code class="language-bash">sudo systemctl disable dnsmasq &amp;&amp; sudo systemctl stop dnsmasq
</code></pre>
<ul>
<li>
<p>验证 Exhibitor 确实在端口 8181 上侦听。</p>
<p>在带有静态管理节点列表的 DC/OS Enterprise 群集中，在管理节点上运行以下命令：</p>
<pre><code class="language-bash">sudo curl --cacert /var/lib/dcos/exhibitor-tls-artifacts/root-cert.pem --cert /var/lib/dcos/exhibitor-tls-artifacts/client-cert.pem --key /var/lib/dcos/exhibitor-tls-artifacts/client-key.pem https://localhost:8181/exhibitor/v1/cluster/status
</code></pre>
<p>在其他群集中，在管理节点上运行以下命令：</p>
<pre><code class="language-bash">curl http://localhost:8181/exhibitor/v1/cluster/status
</code></pre>
<p>如 Exhibitor 有响应，请验证上述命令的输出会显示正确数量的管理节点，并且所有这些管理节点都有 <code>&quot;description&quot;: &quot;serving&quot;</code> ，而只有其中一个有 <code>&quot;isLeader&quot;: true</code>。</p>
<pre><code>[
   {
      &quot;code&quot;: 3,
      &quot;description&quot;: &quot;serving&quot;,
      &quot;hostname&quot;: &quot;10.0.6.70&quot;,
      &quot;isLeader&quot;: false
   },
   {
      &quot;code&quot;: 3,
      &quot;description&quot;: &quot;serving&quot;,
      &quot;hostname&quot;: &quot;10.0.6.69&quot;,
      &quot;isLeader&quot;: false
   },
   {
      &quot;code&quot;: 3,
      &quot;description&quot;: &quot;serving&quot;,
      &quot;hostname&quot;: &quot;10.0.6.68&quot;,
      &quot;isLeader&quot;: true
   }
]
</code></pre>
</li>
</ul>
   <p class="message--note"><strong>注意：</strong>在多管理节点配置中运行此命令需要 15 分钟才能完成。</p>
<p>如有任何问题，请检查 Exhibitor 日志：</p>
<pre><code class="language-bash">journalctl -flu dcos-exhibitor
</code></pre>
<ul>
<li>验证您是否可以 ping DNS 转发器 (<code>ready.spartan</code>). 如果没有，请查看 DNS 调度器服务日志：</li>
</ul>
<pre><code>journalctl -flu dcos-net﻿⁠⁠⁠⁠
</code></pre>
<ul>
<li>
<p>验证您是否可以 ping <code>⁠⁠⁠⁠leader.mesos</code> 和 <code>master.mesos</code>. 如果不可以：</p>
<ul>
<li>使用此命令查看 Mesos-DNS 服务日志：</li>
</ul>
<pre><code class="language-bash">journalctl -flu dcos-mesos-dns﻿⁠⁠⁠⁠
</code></pre>
<ul>
<li>
<p>如果能够 ping <code>ready.spartan</code>，但不是 <code>leader.mesos</code>，则使用以下命令查看 Mesos 管理节点服务日志：</p>
<pre><code class="language-bash">⁠⁠⁠⁠journalctl -flu dcos-mesos-master
</code></pre>
<p>Mesos 管理节点必须在 Mesos-DNS 从  生成其 DNS 记录之前，与选举的领导节点一起启动并运行。<code>⁠⁠⁠⁠/state</code>.﻿⁠⁠⁠⁠</p>
</li>
</ul>
</li>
</ul>
<h1 id="-2"><a class="content__anchor" href="#-2" aria-hidden="true"><i data-feather="bookmark"></i></a><a name="component-logs"></a>组件日志</h1>
<p>在 DC/OS 安装期间，每个组件将在日志中从故障状态收敛到运行状态。</p>
<ul>
<li><a href="#admin-router">Admin Router</a></li>
<li><a href="#dcos-agent-node">DC/OS 代理节点</a></li>
<li><a href="#dcos-marathon">DC/OS Marathon</a></li>
<li><a href="#gen-resolvconf">gen_resolvconf</a></li>
<li><a href="#mesos-dns">Mesos DNS</a></li>
<li><a href="#mesos-master-process">Mesos 管理节点进程</a></li>
<li><a href="#zookeeper-and-exhibitor">ZooKeeper 和 Exhibitor</a></li>
</ul>
<h2 id="admin-router"><a class="content__anchor" href="#admin-router" aria-hidden="true"><i data-feather="bookmark"></i></a><a name="admin-router"></a>Admin Router</h2>
<p>Admin Router 在管理节点上启动。Admin Router 为群集中的 DC/OS 服务提供中央认证和代理。这让您可以从网络的外部管理群集，而无需 VPN 或 SSH 隧道。对于 HA，可以在每个管理节点（负载均衡端口 80）的前面配置一个可选的负载均衡器，以提供故障切换和负载均衡。</p>
<h3 id="-3"><a class="content__anchor" href="#-3" aria-hidden="true"><i data-feather="bookmark"></i></a>故障排除</h3>
<p>对管理节点执行 SSH，并输入以下命令来查看从启动时间起的日志：</p>
<pre><code>journalctl -u dcos-adminrouter -b
</code></pre>
<p>例如，此处是随着其转为成功状态，Admin Router 日志的一个片段：</p>
<pre><code>systemd[1]: Starting A high performance web server and a reverse proxy server...
systemd[1]: Started A high performance web server and a reverse proxy server.
nginx[1652]: ip-10-0-7-166.us-west-2.compute.internal nginx: 10.0.7.166 - - [18/Nov/2015:14:01:10 +0000] &quot;GET /mesos/master/state-summary HTTP/1.1&quot; 200 575 &quot;-&quot; &quot;python-requests/2.6.0 CPython/3.4.2 Linux/4.1.7-coreos&quot;
nginx[1652]: ip-10-0-7-166.us-west-2.compute.internal nginx: 10.0.7.166 - - [18/Nov/2015:14:01:10 +0000] &quot;GET /metadata HTTP/1.1&quot; 200 175 &quot;-&quot; &quot;python-requests/2.6.0 CPython/3.4.2 Linux/4.1.7-coreos&quot;
</code></pre>
<h2 id="dcos"><a class="content__anchor" href="#dcos" aria-hidden="true"><i data-feather="bookmark"></i></a><a name="dcos-agent-nodes"></a>DC/OS 代理节点</h2>
<p>DC/OS 专用和公共代理节点启动。已部署的应用程序和服务在专用代理节点上运行。您必须至少有一个专用代理节点。</p>
<p>公共可访问应用程序在公共代理节点上运行。可以配置公共代理节点以便外部流量访问您的群集。公共代理节点是可选的，没有最小值。您可以在这里运行负载均衡器，从群集内部向外部公众提供服务。</p>
<h3 id="-4"><a class="content__anchor" href="#-4" aria-hidden="true"><i data-feather="bookmark"></i></a>故障排除</h3>
<ul>
<li>
<p>您可能无法对代理节点执行 SSH，具体取决于群集网络的配置。我们通过 DC/OS CLI 使之更简单易用。如需更多信息，请参阅 <a href="/dcosdocs/mesosphere/dcos/2.1/administering-clusters/sshcluster/">对 DC/OS 群集执行 SSH</a>。</p>
</li>
<li>
<p>您可以从 DC/OS 仪表盘的<strong>节点</strong>选项卡获取已注册代理节点的 IP 地址。未注册的节点未显示。</p>
</li>
<li>
<p>对代理节点执行 SSH，并输入以下命令查看从启动时间起的日志：</p>
<pre><code class="language-bash">journalctl -u dcos-marathon -b
</code></pre>
</li>
</ul>
<p>例如，此处是随着其转为成功状态，Mesos 代理节点日志的一个片段：</p>
<pre><code>mesos-slave[1080]: I1118 14:00:43.687366  1080 main.cpp:272] 正在启动 Mesos 从设备
mesos-slave[1080]: I1118 14:00:43.688474  1080 slave.cpp:190] 从设备启动于 1)@10.0.1.108:5051
mesos-slave[1080]: I1118 14:00:43.688503  1080 slave.cpp:191] 启动时的标记： --appc_store_dir=&quot;/tmp/mesos/store/appc&quot; --authenticatee=&quot;crammd5&quot; --cgroups_cpu_enable_pids_and_tids_count=&quot;false&quot; --cgroups_enable_cfs=&quot;false&quot; --cgroups_hierarchy=&quot;/sys/fs/cgroup&quot; --cgroups_limit_swap=&quot;false&quot; --cgroups_root=&quot;mesos&quot; --container_disk_watch_interval=&quot;15secs&quot; --containerizers=&quot;docker,mesos&quot; --default_role=&quot;*&quot; --disk_watch_interval=&quot;1mins&quot; --docker=&quot;docker&quot; --docker_kill_orphans=&quot;true&quot; --docker_remove_delay=&quot;1hrs&quot; --docker_socket=&quot;/var/run/docker.sock&quot; --docker_stop_timeout=&quot;0ns&quot; --enforce_container_disk_quota=&quot;false&quot; --executor_environment_variables=&quot;{&quot;LD_LIBRARY_PATH&quot;:&quot;\/opt\/mesosphere\/lib&quot;,&quot;PATH&quot;:&quot;\/usr\/bin&quot;,&quot;SASL_PATH&quot;:&quot;\/opt\/mesosphere\/lib\/sasl2&quot;,&quot;SHELL&quot;:&quot;\/usr\/bin\/bash&quot;}&quot; --executor_registration_timeout=&quot;5mins&quot; --executor_shutdown_grace_period=&quot;5secs&quot; --fetcher_cache_dir=&quot;/tmp/mesos/fetch&quot; --fetcher_cache_size=&quot;2GB&quot; --frameworks_home=&quot;&quot; --gc_delay=&quot;2days&quot; --gc_disk_headroom=&quot;0.1&quot; --hadoop_home=&quot;&quot; --help=&quot;false&quot; --hostname_lookup=&quot;false&quot; --image_provisioner_backend=&quot;copy&quot; --initialize_driver_logging=&quot;true&quot; --ip_discovery_command=&quot;/opt/mesosphere/bin/detect_ip&quot; --isolation=&quot;cgroups/cpu,cgroups/mem&quot; --launcher_dir=&quot;/opt/mesosphere/packages/mesos--30d3fbeb6747bb086d71385e3e2e0eb74ccdcb8b/libexec/mesos&quot; --log_dir=&quot;/var/log/mesos&quot; --logbufsecs=&quot;0&quot; --logging_level=&quot;INFO&quot; --master=&quot;zk://leader.mesos:2181/mesos&quot; --oversubscribed_resources_interval=&quot;15secs&quot; --perf_duration=&quot;10secs&quot; --perf_interval=&quot;1mins&quot; --port=&quot;5051&quot; --qos_correction_interval_min=&quot;0ns&quot; --quiet=&quot;false&quot; --recover=&quot;reconnect&quot; --recovery_timeout=&quot;15mins&quot; --registration_backoff_factor=&quot;1secs&quot; --resource_monitoring_interval=&quot;1secs&quot; --resources=&quot;ports:[1025-2180,2182-3887,3889-5049,5052-8079,8082-8180,8182-32000]&quot; --revocable_cpu_low_priority=&quot;true&quot; --sandbox_directory=&quot;/mnt/mesos/sandbox&quot; --slave_subsystems=&quot;cpu,memory&quot; --strict=&quot;true&quot; --switch_user=&quot;true&quot; --systemd_runtime_directory=&quot;/run/systemd/system&quot; --version=&quot;false&quot; --work_dir=&quot;/var/lib/mesos/slave&quot;
mesos-slave[1080]: I1118 14:00:43.688711  1080 slave.cpp:211] 将从设备进程转入自己的子系统 cgroup：cpu
mesos-slave[1080]: 2015-11-18 14:00:43,689:1080(0x7f9b526c4700):ZOO_INFO@check_events@1703: 发起与服务器的连接 [10.0.7.166:2181]
mesos-slave[1080]: I1118 14:00:43.692811  1080 slave.cpp:211] 将从设备进程转入自己的子系统 cgroup：内存
mesos-slave[1080]: I1118 14:00:43.697872  1080 slave.cpp:354] 从设备资源：ports(*):[1025-2180, 2182-3887, 3889-5049, 5052-8079, 8082-8180, 8182-32000]; cpus(*):4; mem(*):14019; disk(*):32541
mesos-slave[1080]: I1118 14:00:43.697916  1080 slave.cpp:390] 从设备主机名：10.0.1.108
mesos-slave[1080]: I1118 14:00:43.697928  1080 slave.cpp:395] 从设备检查点：true
</code></pre>
<h2 id="dcos-marathon"><a class="content__anchor" href="#dcos-marathon" aria-hidden="true"><i data-feather="bookmark"></i></a><a name="dcos-marathon"></a>DC/OS Marathon</h2>
<p>DC/OS Marathon 在管理节点上启动。本地 Marathon 实例是 DC/OS 的“init system”。它启动并监控应用程序和服务。</p>
<h3 id="-5"><a class="content__anchor" href="#-5" aria-hidden="true"><i data-feather="bookmark"></i></a>故障排除</h3>
<ul>
<li>
<p>转到 DC/OS 仪表盘上的<strong>服务 &gt; 服务</strong>选项卡并查看状态。</p>
</li>
<li>
<p>对管理节点执行 SSH，并输入以下命令来查看从启动时间起的日志：</p>
<pre><code class="language-bash">journalctl -u dcos-marathon -b
</code></pre>
</li>
</ul>
<p>例如，此处是随着其转为成功状态，DC/PS Marathon 日志的一个片段：</p>
<pre><code>java[1288]: I1118 13:59:39.125041  1363 group.cpp:331] 组进程 (group(1)@10.0.7.166:48531) 已连接到 ZooKeeper
java[1288]: I1118 13:59:39.125100  1363 group.cpp:805] 同步组操作：队列大小 (joins, cancels, datas) = (0, 0, 0)
java[1288]: I1118 13:59:39.125121  1363 group.cpp:403] 尝试在 ZooKeeper 中创建路径 '/mesos'
java[1288]: [2015-11-18 13:59:39,130] INFO 调度器角色就绪 (mesosphere.marathon.MarathonSchedulerActor:marathon-akka.actor.default-dispatcher-5)
java[1288]: I1118 13:59:39.147804  1363 detector.cpp:156] 检测到新的领导节点：(id='1')
java[1288]: I1118 13:59:39.147924  1363 group.cpp:674] 尝试在 ZooKeeper 中获取 '/mesos/json.info_0000000001'
java[1288]: I1118 13:59:39.148727  1363 detector.cpp:481] 检测到新的领导管理节点 (UPID=master@10.0.7.166:5050)
java[1288]: I1118 13:59:39.148787  1363 sched.cpp:262] 在 master@10.0.7.166:5050 处检测到新的管理节点
java[1288]: I1118 13:59:39.148952  1363 sched.cpp:272] 未提供凭据。尝试在没有认证的情况下注册
java[1288]: I1118 13:59:39.150403  1363 sched.cpp:641] 框架已向 cdcb6222-65a1-4d60-83af-33dadec41e92-0000 注册
</code></pre>
<h2 id="gen-resolvconf"><a class="content__anchor" href="#gen-resolvconf" aria-hidden="true"><i data-feather="bookmark"></i></a><a name="gen-resolvconf"></a>gen_resolvconf</h2>
<p>gen_resolvconf 已启动。这是一个帮助代理节点定位管理节点的服务。它更新了 <code>/etc/resolv.conf</code>，使得代理节点可以使用 Mesos-DNS 服务进行服务发现。gen_resolvconf 使用内部负载均衡器、vrrp 或管理节点静态列表来定位管理节点。如需更多信息，请参阅 <code>master_discovery</code> <a href="/dcosdocs/mesosphere/dcos/2.1/installing/production/advanced-configuration/configuration-reference/">配置参数</a>。</p>
<h3 id="-6"><a class="content__anchor" href="#-6" aria-hidden="true"><i data-feather="bookmark"></i></a>故障排除</h3>
<ul>
<li>
<p>当 gen_resolvconf 启动并运行时，您可以查看 <code>/etc/resolv.conf</code> 内容。它应该包含管理节点的一个或多个 IP 地址，以及可选的外部 DNS 服务器。</p>
</li>
<li>
<p>对管理节点执行 SSH，并输入以下命令来查看从启动时间起的日志：</p>
<pre><code class="language-bash">journalctl -u dcos-gen-resolvconf -b
</code></pre>
</li>
</ul>
<p>例如，此处是随着其转为成功状态，gen_resolvconf 日志的一个片段：</p>
<pre><code>systemd[1]: Started Update systemd-resolved for mesos-dns.
systemd[1]: Starting Update systemd-resolved for mesos-dns...
gen_resolvconf.py[1073]: options timeout:1
gen_resolvconf.py[1073]: options attempts:3
gen_resolvconf.py[1073]: nameserver 10.0.7.166
gen_resolvconf.py[1073]: nameserver 10.0.0.2
gen_resolvconf.py[1073]: 正在更新 /etc/resolv.conf
</code></pre>
<h2 id="mesos"><a class="content__anchor" href="#mesos" aria-hidden="true"><i data-feather="bookmark"></i></a><a name="mesos-master-process"></a>Mesos 管理节点进程</h2>
<p>Mesos 管理节点进程在管理节点上开始。<code>mesos-master</code> 进程在群集中的一个节点上运行，通过接收来自代理节点的资源邀约并将这些资源提供给注册的服务（如 Marathon 或 Chronos）来编排代理节点上任务的运行。如需更多信息，请参阅 <a href="https://open.mesosphere.com/reference/mesos-master/">Mesos 管理节点配置</a> 文档。</p>
<h3 id="-7"><a class="content__anchor" href="#-7" aria-hidden="true"><i data-feather="bookmark"></i></a>故障排除</h3>
<ul>
<li>
<p>直接转到 Mesos Web 界面，并在  中查看其状态。<code>&lt;master-hostname&gt;/mesos</code>.</p>
</li>
<li>
<p>对管理节点执行 SSH，并输入以下命令来查看从启动时间起的日志：</p>
<pre><code class="language-bash">journalctl -u dcos-mesos-master -b
</code></pre>
</li>
</ul>
<p>例如，此处是随着其转为成功状态，Mesos 管理节点日志的一个片段：</p>
<pre><code>mesos-master[1250]: I1118 13:59:33.890916  1250 master.cpp:376] 管理节点 cdcb6222-65a1-4d60-83af-33dadec41e92 (10.0.7.166) 启动于 10.0.7.166:5050
mesos-master[1250]: I1118 13:59:33.890945  1250 master.cpp:378] 启动时的标记：--allocation_interval=&quot;1secs&quot; --allocator=&quot;HierarchicalDRF&quot; --authenticate=&quot;false&quot; --authenticate_slaves=&quot;false&quot; --authenticators=&quot;crammd5&quot; --authorizers=&quot;local&quot; --cluster=&quot;pool-880dfdbf0f2845bf8191&quot; --framework_sorter=&quot;drf&quot; --help=&quot;false&quot; --hostname_lookup=&quot;false&quot; --initialize *driver_logging=&quot;true&quot; --ip_discovery_command=&quot;/opt/mesosphere/bin/detect_ip&quot; --log_auto_initialize=&quot;true&quot; --log_dir=&quot;/var/log/mesos&quot; --logbufsecs=&quot;0&quot; --logging_level=&quot;INFO&quot; --max* slave_ping_timeouts=&quot;5&quot; --port=&quot;5050&quot; --quiet=&quot;false&quot; --quorum=&quot;1&quot; --recovery_slave_removal_limit=&quot;100%&quot; --registry=&quot;replicated_log&quot; --registry_fetch_timeout=&quot;1mins&quot; --registry_sto re_timeout=&quot;5secs&quot; --registry_strict=&quot;false&quot; --roles=&quot;slave_public&quot; --root_submissions=&quot;true&quot; --slave_ping_timeout=&quot;15secs&quot; --slave_reregister_timeout=&quot;10mins&quot; --user_sorter=&quot;drf&quot; --version=&quot;false&quot; --webui_dir=&quot;/opt/mesosphere/packages/mesos--30d3fbeb6747bb086d71385e3e2e0eb74ccdcb8b/share/mesos/webui&quot; --weights=&quot;slave_public=1&quot; --work_dir=&quot;/var/lib/mesos/mas ter&quot; --zk=&quot;zk://127.0.0.1:2181/mesos&quot; --zk_session_timeout=&quot;10secs&quot; mesos-master[1250]: 2015-11-18 13:59:33,891:1250(0x7f14427fc700):ZOO_INFO@check_events@1750: session establishment complete on server [127.0.0.1:2181], sessionId=0x1511ae440bc0001, negotiated timeout=10000
</code></pre>
<h2 id="mesos-dns"><a class="content__anchor" href="#mesos-dns" aria-hidden="true"><i data-feather="bookmark"></i></a><a name="mesos-dns"></a>Mesos-DNS</h2>
<p>Mesos-DNS 在 DC/OS 管理节点上启动。Mesos DNS 在群集内提供服务发现。可选的是，Mesos-DNS 可以根据群集的配置方式，将未处理的请求转发到外部 DNS 服务器。例如，任何未在 <code>.mesos</code> 结束的内容将会转发给外部解析器。</p>
<h3 id="-8"><a class="content__anchor" href="#-8" aria-hidden="true"><i data-feather="bookmark"></i></a>故障排除</h3>
<ul>
<li>
<p>对管理节点执行 SSH，并输入以下命令来查看从启动时间起的日志：</p>
<pre><code class="language-bash">journalctl -u dcos-mesos-dns -b
</code></pre>
</li>
</ul>
<p>例如，此处是随着其转为成功状态，Mesos-DNS 日志的一个片段：</p>
<pre><code>mesos-dns[1197]: I1118 13:59:34.763885 1197 detect.go:135] 从 &quot;&quot; -&gt; &quot;json.info_0000000001&quot; 更改首要节点
mesos-dns[1197]: I1118 13:59:34.764537 1197 detect.go:145] 检测到管理节点信息：&amp;MasterInfo{Id:*cdcb6222-65a1-4d60-83af-33dadec41e92,Ip:*2785476618,Port:*5050,Pid:*master@10.0.7.166:5050,Hostname:*10\.0.7.166,Version:*0\.25.0,Address:&amp;Address{Hostname:*10\.0.7.166,Ip:*10\.0.7.166,Port:*5050,XXX_unrecognized:[],},XXX_unrecognized:[],}
mesos-dns[1197]: 非常详细：2015/11/18 13:59:34 masters.go:47: 更新的首要节点：&amp;MasterInfo{Id:*cdcb6222-65a1-4d60-83af-33dadec41e92,Ip:*2785476618,Port:*5050,Pid:*master@10.0.7.166:5050,Hostname:*10\.0.7.166,Version:*0\.25.0,Address:&amp;Address{Hostname:*10\.0.7.166,Ip:*10\.0.7.166,Port:*5050,XXX_unrecognized:[],},XXX_unrecognized:[],}
mesos-dns[1197]: 非常详细：2015/11/18 13:59:34 main.go:76：检测到新的管理节点：[10.0.7.166:5050]
mesos-dns[1197]: 非常详细：2015/11/18 13:59:34 generator.go:70: Zookeeper 认为领导者是：10.0.7.166:5050
mesos-dns[1197]: 非常详细：2015/11/18 13:59:34 generator.go:162: 从管理节点 10.0.7.166 重新加载
mesos-dns[1197]: I1118 13:59:34.766005 1197 detect.go:219] 通知管理节点成员变化：[&amp;MasterInfo{Id:*cdcb6222-65a1-4d60-83af-33dadec41e92,Ip:*2785476618,Port:*5050,Pid:*master@10.0.7.166:5050,Hostname:*10\.0.7.166,Version:*0\.25.0,Address:&amp;Address{Hostname:*10\.0.7.166,Ip:*10\.0.7.166,Port:*5050,XXX_unrecognized:[],},XXX_unrecognized:[],}]
mesos-dns[1197]: 非常详细：2015/11/18 13:59:34 masters.go:56: 更新的管理节点：[&amp;MasterInfo{Id:*cdcb6222-65a1-4d60-83af-33dadec41e92,Ip:*2785476618,Port:*5050,Pid:*master@10.0.7.166:5050,Hostname:*10\.0.7.166,Version:*0\.25.0,Address:&amp;Address{Hostname:*10\.0.7.166,Ip:*10\.0.7.166,Port:*5050,XXX_unrecognized:[],},XXX_unrecognized:[],}]
mesos-dns[1197]: I1118 13:59:34.766124 1197 detect.go:313] 在下一个检测周期之前休息
</code></pre>
<h2 id="zookeeper-exhibitor"><a class="content__anchor" href="#zookeeper-exhibitor" aria-hidden="true"><i data-feather="bookmark"></i></a><a name="zookeeper-and-exhibitor"></a>ZooKeeper 和 Exhibitor</h2>
<p>ZooKeeper 和 Exhibitor 在管理节点上启动。Exhibitor 存储位置必须正确配置才能让其工作。如需更多信息，请参阅 <a href="/dcosdocs/mesosphere/dcos/cn/2.1/installing/production/advanced-configuration/configuration-reference/#exhibitor-storage-backend">exhibitor_storage_backend</a> 参数。</p>
<p>DC/OS 使用 ZooKeeper，后者是一个高性能协调服务，用来管理已安装的 DC/OS 服务。Exhibitor 在 DC/OS 安装期间自动配置管理节点上的 ZooKeeper。如需更多信息，请参阅 <a href="/dcosdocs/mesosphere/dcos/cn/2.1/installing/production/advanced-configuration/configuration-reference/">配置参数</a>.</p>
<ul>
<li>
<p>转到 Exhibitor Web 界面，并在  中查看状态。<code>&lt;master-hostname&gt;/exhibitor</code>.</p>
</li>
<li>
<p>对管理节点执行 SSH，并输入以下命令来查看从启动时间起的日志：</p>
<pre><code class="language-bash">journalctl -u dcos-exhibitor -b
</code></pre>
</li>
</ul>
<p>例如，此处是随着其转为成功状态，Exhibitor 日志的一个片段：</p>
<pre><code>INFO com.netflix.exhibitor.core.activity.ActivityLog 自动实例管理将更改服务器列表：==&gt; 1:10.0.7.166 [ActivityQueue-0]
INFO com.netflix.exhibitor.core.activity.ActivityLog 状态：正在服务 [ActivityQueue-0]
INFO com.netflix.exhibitor.core.activity.ActivityLog 服务器列表已更改 [ActivityQueue-0]
INFO com.netflix.exhibitor.core.activity.ActivityLog 尝试停止实例 [ActivityQueue-0]
INFO com.netflix.exhibitor.core.activity.ActivityLog 尝试启动/重启 ZooKeeper [ActivityQueue-0]
INFO com.netflix.particiitor.core.activity.ActivityLog 结束尝试的结果：0 [ActivityQueue-0]
INFO  com.netflix.exhibitor.core.activity.ActivityLog  Process started via: /opt/mesosphere/active/exhibitor/usr/zookeeper/bin/zkServer.sh [ActivityQueue-0]
ERROR com.netflix.exhibitor.core.activity.ActivityLog ZooKeeper 服务器：JMX 默认启用 [pool-3-thread-1] ERROR com.netflix.exhibitor.core.activity.ActivityLog ZooKeeper 服务器：使用配置：/opt/mesosphere/active/exhibitor/usr/zookeeper/bin/../conf/zoo.cfg [pool-3-thread-1]
INFO com.netflix.exhibitor.core.activity.ActivityLog ZooKeeper 服务器：正在启动 Cookeeper ... 已启动 [pool-3-thread-3]
INFO com.netflix.exhibitor.core.activity.ActivityLog 清理任务已完成 [pool-3-thread-6]
INFO com.netflix.exhibitor.core.activity.ActivityLog 清理任务已完成 [pool-3-thread-9]
</code></pre>
</article></div><aside class="content__sections"><div class="content__sections-list-container"><ul class="content__sections-list"><li class="content__sections-item content__sections-item--h1"><a href="#一般故障排除方法">一般故障排除方法</a></li><li class="content__sections-item content__sections-item--h2"><a href="#ip">IP 检测脚本</a></li><li class="content__sections-item content__sections-item--h2"><a href="#dns">DNS 解析器</a></li><li class="content__sections-item content__sections-item--h1"><a href="#-2">组件日志</a></li><li class="content__sections-item content__sections-item--h2"><a href="#admin-router">Admin Router</a></li><li class="content__sections-item content__sections-item--h2"><a href="#dcos">DC/OS 代理节点</a></li><li class="content__sections-item content__sections-item--h2"><a href="#dcos-marathon">DC/OS Marathon</a></li><li class="content__sections-item content__sections-item--h2"><a href="#gen-resolvconf">gen_resolvconf</a></li><li class="content__sections-item content__sections-item--h2"><a href="#mesos">Mesos 管理节点进程</a></li><li class="content__sections-item content__sections-item--h2"><a href="#mesos-dns">Mesos-DNS</a></li><li class="content__sections-item content__sections-item--h2"><a href="#zookeeper-exhibitor">ZooKeeper 和 Exhibitor</a></li></ul></div></aside></main></div></div><script src="/dcosdocs/assets/js/jquery-3.2.1.js"></script><script src="/dcosdocs/assets/js/clipboard.js"></script><script src="/dcosdocs/assets/js/prism.js"></script><script src="/js/main.js"></script></body></html>