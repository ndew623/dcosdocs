<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width" initial-scale="1" user-scalable="no"><title>排除 LDAP 错误 - D2iQ Docs</title><meta name="description" content="排除 LDAP 目录的常见身份认证和配置问题"><link rel="apple-touch-icon" sizes="180x180" href="/dcosdocs/assets/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/dcosdocs/assets/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/dcosdocs/assets/favicon-16x16.png"><link rel="stylesheet" type="text/css" href="/dcosdocs/css/styles.css"><link rel="search" type="application/opensearchdescription+xml" href="/dcosdocs/assets/opensearch.xml" title="Search"><link href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,500,500i,700,700i" rel="stylesheet"><script src="https://unpkg.com/feather-icons/dist/feather.min.js"></script><script>window.analytics||(window.analytics=[]),window.analytics.methods=["identify","track","trackLink","trackForm","trackClick","trackSubmit","page","pageview","ab","alias","ready","group","on","once","off"],window.analytics.factory=function(t){return function(){var a=Array.prototype.slice.call(arguments);return a.unshift(t),window.analytics.push(a),window.analytics}};for(var i=0;i<window.analytics.methods.length;i++){var method=window.analytics.methods[i];window.analytics[method]=window.analytics.factory(method)}window.analytics.load=function(t){var a=document.createElement("script");a.type="text/javascript",a.async=!0,a.src=("https:"===document.location.protocol?"https://":"http://")+"d2dq2ahtl5zl1z.cloudfront.net/analytics.js/v1/"+t+"/analytics.min.js";var n=document.getElementsByTagName("script")[0];n.parentNode.insertBefore(a,n)},window.analytics.SNIPPET_VERSION="2.0.8",
window.analytics.load("7sgtwqvuai");
window.analytics.page();</script><noscript><iframe src="//www.googletagmanager.com/ns.html?id=GTM-PBJ84KX" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript><script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src='//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
})(window,document,'script','dataLayer','GTM-PBJ84KX');</script></head><body><div class="layout"><header class="header"><a class="header__drawer"><i class="header__icon" data-feather="menu"></i></a><a class="header__logo" href="/"><img class="header__logo--mobile" src="/dcosdocs/assets/D2iQ_Logotype_Color_Positive_Documentation.svg" alt="D2IQ"><img class="header__logo--desktop" src="/dcosdocs/assets/D2iQ_Logotype_Color_Positive_Documentation.svg" alt="D2IQ"></a><div class="header__main"><div class="header__dropdown"><img class="header__dropdown-icon" src="/dcosdocs/assets/D2IQ_Logotype_Color_Positive.png" alt="D2iQ"><strong>DC/OS文档</strong><i data-feather="chevron-down"></i></div><nav class="header__menu"><ul class="header__menu-list"><li class="header__menu-item"><a href="https://support.d2iq.com">Support</a></li></ul></nav></div><div class="chooser" id="localizer"><div class="chooser-current"><a class="chooser-title">中文 (简体)</a><svg class="chooser-svg" id="localizer-svg"><path class="pointer" d="m 13,6 -5,5 -5,-5 z" fill="#858585"></path></svg></div><ul class="chooser-list" id="localizer-list"><li class="chooser-list-item"><a href="/dcosdocs/mesosphere/dcos/1.13/security/ent/ldap/ldap-troubleshooting">English</a></li></ul></div><section class="header__search" role="search"><form class="header__search-form" action="/search/"><input class="header__search-input" id="header-search-input" tabindex="1" type="text" name="q" placeholder="Search"><input type="hidden" name="hFR[scope][0]" value="DC/OS 1.13"><label class="header__search-label" for="header-search-input"><i class="header__icon" data-feather="search"></i></label></form></section></header><div class="header-dropdown"><ul class="header-dropdown__list"><li class="header-dropdown__top-item"><div>DKP</div></li><li class="header-dropdown__item"><a href="/dkp/konvoy">Konvoy</a></li><li class="header-dropdown__item"><a href="/dkp/kommander">Kommander</a></li><li class="header-dropdown__item"><a href="/dkp/dispatch">Dispatch</a></li><li class="header-dropdown__item"><a href="/dkp/kaptain">Kaptain</a></li><li class="header-dropdown__top-item"><div>Mesosphere</div></li><li class="header-dropdown__item header-dropdown__item--active"><a href="/mesosphere/dcos">DC/OS</a></li><li class="header-dropdown__item"><a href="/dcosdocs/mesosphere/dcos/services">DC/OS Services</a></li><li class="header-dropdown__item"><a href="https://support.d2iq.com">Support</a></li></ul></div><div class="layout__sidebar layout__drawer"><section class="sidebar"><header class="sidebar__header"><div class="sidebar__dropdown"><ul><li><a href="/dcosdocs/mesosphere/dcos/cn/2.1/security/ent/ldap/ldap-troubleshooting">Mesosphere DC/OS 2.1.0</a></li><li><a href="/dcosdocs/mesosphere/dcos/cn/2.0/security/ent/ldap/ldap-troubleshooting">Mesosphere DC/OS 2.0</a></li><li><a href="/dcosdocs/mesosphere/dcos/cn/1.13/security/ent/ldap/ldap-troubleshooting">Mesosphere DC/OS 1.13</a></li></ul><div class="toggle"><p><span class="title">DC/OS</span><span class="version"> 1.13</span></p><i data-feather="chevron-down"></i></div></div></header><nav class="sidebar_nav" role="navigation"><ul><li><a class="d0" href="/dcosdocs/mesosphere/dcos/cn/1.13/release-notes/"><i data-feather="chevron-right"></i>版本注释</a></li><li><a class="d0" href="/dcosdocs/mesosphere/dcos/cn/1.13/overview/"><i data-feather="chevron-right"></i>概述</a></li><li><a class="d0" href="/dcosdocs/mesosphere/dcos/cn/1.13/installing/"><i data-feather="chevron-right"></i>安装</a></li><li><a class="d0" href="/dcosdocs/mesosphere/dcos/cn/1.13/gui/"><i data-feather="chevron-right"></i>GUI</a></li><li><a class="d0" href="/dcosdocs/mesosphere/dcos/cn/1.13/cli/"><i data-feather="chevron-right"></i>CLI</a></li><li><a class="d0" href="/dcosdocs/mesosphere/dcos/cn/1.13/administering-clusters/"><i data-feather="chevron-right"></i>管理群集</a></li><li><a class="d0" href="/dcosdocs/mesosphere/dcos/cn/1.13/networking/"><i data-feather="chevron-right"></i>网络</a></li><li class="active"><a class="d0" href="/dcosdocs/mesosphere/dcos/cn/1.13/security/"><i data-feather="chevron-right"></i>安全</a></li><ul><li class="active"><a class="d1" href="/dcosdocs/mesosphere/dcos/cn/1.13/security/ent/"><i data-feather="chevron-right"></i>DC/OS Enterprise 安全性</a></li><ul><li><a class="d2" href="/dcosdocs/mesosphere/dcos/cn/1.13/security/ent/users-groups/"><i data-feather="chevron-right"></i>管理用户和组</a></li><li><a class="d2" href="/dcosdocs/mesosphere/dcos/cn/1.13/security/ent/gui-permissions/"><i data-feather="chevron-right"></i>授予访问 UI 的权限</a></li><li><a class="d2" href="/dcosdocs/mesosphere/dcos/cn/1.13/security/ent/perms-management/">权限管理</a></li><li><a class="d2" href="/dcosdocs/mesosphere/dcos/cn/1.13/security/ent/perms-reference/">权限参考</a></li><li class="active"><a class="d2" href="/dcosdocs/mesosphere/dcos/cn/1.13/security/ent/ldap/"><i data-feather="chevron-right"></i>LDAP 身份认证</a></li><ul><li><a class="d3" href="/dcosdocs/mesosphere/dcos/cn/1.13/security/ent/ldap/ldap-conn/">连接</a></li><li><a class="d3" href="/dcosdocs/mesosphere/dcos/cn/1.13/security/ent/ldap/ldap-auth/">指定身份认证和参数</a></li><li><a class="d3" href="/dcosdocs/mesosphere/dcos/cn/1.13/security/ent/ldap/ldap-verify/">验证</a></li><li><a class="d3" href="/dcosdocs/mesosphere/dcos/cn/1.13/security/ent/ldap/ldap-sync/">同步</a></li><li class="active active-on"><a class="d3" href="/dcosdocs/mesosphere/dcos/cn/1.13/security/ent/ldap/ldap-troubleshooting/">排除 LDAP 错误</a></li></ul><li><a class="d2" href="/dcosdocs/mesosphere/dcos/cn/1.13/security/ent/secrets/"><i data-feather="chevron-right"></i>密钥</a></li><li><a class="d2" href="/dcosdocs/mesosphere/dcos/cn/1.13/security/ent/sso/"><i data-feather="chevron-right"></i>基于身份提供程序的身份认证</a></li><li><a class="d2" href="/dcosdocs/mesosphere/dcos/cn/1.13/security/ent/service-auth/"><i data-feather="chevron-right"></i>服务认证</a></li><li><a class="d2" href="/dcosdocs/mesosphere/dcos/cn/1.13/security/ent/restrict-service-access/">限制对 DC/OS 服务组的访问</a></li><li><a class="d2" href="/dcosdocs/mesosphere/dcos/cn/1.13/security/ent/hardening/">强化</a></li><li><a class="d2" href="/dcosdocs/mesosphere/dcos/cn/1.13/security/ent/iam-api/">身份和访问管理 API</a></li><li><a class="d2" href="/dcosdocs/mesosphere/dcos/cn/1.13/security/ent/tls-ssl/"><i data-feather="chevron-right"></i>确保与 TLS 通信的安全</a></li></ul><li><a class="d1" href="/dcosdocs/mesosphere/dcos/cn/1.13/security/oss/"><i data-feather="chevron-right"></i>DC/OS 开源安全</a></li></ul><li><a class="d0" href="/dcosdocs/mesosphere/dcos/cn/1.13/storage/"><i data-feather="chevron-right"></i>存储</a></li><li><a class="d0" href="/dcosdocs/mesosphere/dcos/cn/1.13/metrics/"><i data-feather="chevron-right"></i>度量标准</a></li><li><a class="d0" href="/dcosdocs/mesosphere/dcos/cn/1.13/monitoring/"><i data-feather="chevron-right"></i>监控、日志记录和调试</a></li><li><a class="d0" href="/dcosdocs/mesosphere/dcos/cn/1.13/hybrid-cloud/"><i data-feather="chevron-right"></i>混合云</a></li><li><a class="d0" href="/dcosdocs/mesosphere/dcos/cn/1.13/deploying-jobs/"><i data-feather="chevron-right"></i>部署作业</a></li><li><a class="d0" href="/dcosdocs/mesosphere/dcos/cn/1.13/deploying-services/"><i data-feather="chevron-right"></i>部署服务和 Pod</a></li><li><a class="d0" href="/dcosdocs/mesosphere/dcos/cn/1.13/tutorials/"><i data-feather="chevron-right"></i>教程</a></li><li><a class="d0" href="/dcosdocs/mesosphere/dcos/cn/1.13/api/"><i data-feather="chevron-right"></i>API 参考</a></li><li><a class="d0" href="/dcosdocs/mesosphere/dcos/cn/1.13/developing-services/"><i data-feather="chevron-right"></i>开发 DC/OS 服务</a></li></ul></nav><footer class="sidebar__footer"><div class="sidebar__footer-links"><a href="https://d2iq.com/terms/">Terms of Service</a><a href="https://d2iq.com/privacy/">Privacy Policy</a></div><a class="sidebar__footer-copyright" href="https://d2iq.com/">&copy; 2022 D2iQ, Inc. All rights reserved.</a></footer></section></div><div class="layout__content" role="main"><main class="content"><div class="content__container content__container--with-sections"><div class="content__header"><div class="content__header__row"><h1 class="content__header-title">排除 LDAP 错误</h1><p class="badge badge--content-header badge--enterprise">ENTERPRISE</p></div><h4 class="content__header-description">排除 LDAP 目录的常见身份认证和配置问题</h4><div class="actions"><ul class="actions__list"><li class="actions__item"><button class="actions__link" onclick="javascript:window.print()"><i class="actions__icon" data-feather="printer"></i><span class="actions__text">Print</span></button></li><li class="actions__item"><a class="actions__link" href="https://github.com/mesosphere/dcos-docs-site/tree/main/pages/dcosdocs/mesosphere/dcos/cn/1.13/security/ent/ldap/ldap-troubleshooting/index.md" target="_blank"><i class="actions__icon" data-feather="github"></i><span class="actions__text">Contribute</span></a></li></ul></div></div><article class="content__article"><p>轻量目录访问协议 (LDAP) 为访问目录服务提供一个轻量客户端-服务器协议。协议提供基于标准的方法，用于为基于 X.500 的目录服务定义对象及其属性。LDAP 通过 TCP/IP 或其他以连接为导向的传输服务运行。</p>
<h1 id="microsoft-active-directory"><a class="content__anchor" href="#microsoft-active-directory" aria-hidden="true"><i data-feather="bookmark"></i></a>使用 Microsoft Active Directory 时的常见问题</h1>
<p>Microsoft Windows Server Active Directory 是 Windows 森林和域的基于 LDAP 的身份存储。Active Directory 在与 LDAP 兼容的对象和属性中存储有关用户、组、计算机、角色和组织的详细信息，并以与其他 LDAP 服务（如 OpenLDAP）相同的格式返回您使用 LDAP 查询搜索的信息。</p>
<p>由于将 Active Directory 身份认证集成到多平台环境中可能会带来使用 ApacheDS、OpenLDAP 或其他 LDAP 服务时不太可能遇到的挑战，LDAP 身份认证和配置中最常见的问题会涉及与 Active Directory 域控制器的通信或跨 Active Directory 域的复制。</p>
<h1 id=""><a class="content__anchor" href="#" aria-hidden="true"><i data-feather="bookmark"></i></a>无法连接到目录后端</h1>
<p>如果尝试从 Active Directory 检索信息，但连接失败，您可能会看到以下错误消息：</p>
<p><img src="/dcosdocs/mesosphere/dcos/cn/1.13/img/ldap-cannot-open-connection-error.png" alt="无法连接到目录"></p>
<p>图 1. 连接错误消息：超时</p>
<p>如果看到错误消息，指出与后端目录的连接失败，那么这通常是由以下问题引起的：</p>
<ul>
<li>
<p>所需的端口拒绝所有流量或受防火墙规则保护。</p>
<p>具体端口要求取决于您使用的 Active Directory 版本和通信流量类型。例如，大多数 LDAP 流量需要 TCP 或 UDP 连接的端口 389，以处理目录和复制服务、用户和计算机身份认证以及组策略分发。</p>
<p>要通过安全通信通道处理相同类型的流量，LDAP 需要 TCP 连接的端口 636，才能通过安全套接字层 (SSL) 传递加密消息。</p>
</li>
<li>
<p>DNS 无法解析 Active Directory 域控制器的名称或 IP 地址。</p>
</li>
</ul>
<p>如果遇到此错误，请检查错误所在的计算机是否具有用于网络接口和域控制器的正确 IP地址。您可以使用 DHCP 服务器角色或在网络适配器设置中手动检查域连接的当前 IP 地址和网络设置。例如，您可以使用 <code>ipconfig</code> 或类似的操作系统命令来检索当前的网络设置，以显示网络配置详细信息。</p>
<p>如果端口号、主机名或主机 IP 地址存在问题，请编辑 LDAP 目录设置中的值，以指定正确的端口、主机名或主机 IP 地址。</p>
<p>要编辑 LDAP 目录设置：</p>
<ol>
<li>
<p>登录到 DC/OS 基于 Web 的控制台。</p>
</li>
<li>
<p>单击 <strong>设置</strong>，然后单击 <strong>LDAP 目录</strong>。</p>
</li>
<li>
<p>单击 <strong>编辑目录</strong>。</p>
</li>
<li>
<p>修改主机名、主机 IP 地址或 LDAP 端口。</p>
</li>
<li>
<p>单击 <strong>保存配置</strong>。</p>
</li>
</ol>
<h1 id="ssltls"><a class="content__anchor" href="#ssltls" aria-hidden="true"><i data-feather="bookmark"></i></a>传输层安全 (SSL/TLS) 连接错误</h1>
<p>如果您尝试连接到 Active Directory，并且使用传输层安全 (SSL/TLS) 与服务器通信时出现问题而导致连接失败，您可能会看到以下错误消息：</p>
<p><img src="/dcosdocs/mesosphere/dcos/cn/1.13/img/ldap-tsl-ssl-socket-error.png" alt="SSL 连接错误"></p>
<p>图 2. 连接错误：套接字 SSL 封装错误</p>
<p>例如，如果未将 LDAP 服务器配置为接受 SSL/TLS 连接，或者用于保护通道的证书无效，则可能会看到此错误。</p>
<p>如果在使用安全套接字层 (SSL) 连接来连接到 Active Directory 时出现问题，您应该：</p>
<ul>
<li>检查是否为 Active Directory LDAP 服务器角色启用了 SSL 上的 LDAP (LDAPS)，并且您已导入有效的 CA 证书以允许 SSL/TLS 连接。</li>
<li>检查您如何为 DC/OS 群集中的目录配置适当的相应 LDAP SSL/TLS 设置。</li>
</ul>
<p>如果 Active Directory LDAP 服务器角色未配置为允许 SSL/TLS 连接，则应验证 DC/OS 群集是否已配置为允许未加密通信。</p>
<p>要更改 DC/OS 处理 SSL/TLS 连接错误的方式：</p>
<ol>
<li>
<p>登录到 DC/OS 基于 Web 的控制台。</p>
</li>
<li>
<p>单击 <strong>设置</strong>，然后单击 <strong>LDAP 目录</strong>。</p>
</li>
<li>
<p>单击 <strong>编辑目录</strong>。</p>
</li>
<li>
<p>在 <strong>选择 SSL/TLS 设置</strong>下，选择另一个选项。</p>
<p><img src="/dcosdocs/mesosphere/dcos/cn/1.13/img/ldap-ssl-options.png" alt="SSL/TLS 设置选项"></p>
<p>图 3. SSL/TLS 设置选项</p>
<p>例如，如果已将“选择 SSL/TLS 设置”配置为 <strong>对所有连接都使用 SSL/TLS</strong>，则可能需要将设置更改为“尝试 StartTLS，如果失败，则不进行加密”。</p>
</li>
<li>
<p>单击 <strong>保存配置</strong>。</p>
</li>
</ol>
<h1 id="ssltls-2"><a class="content__anchor" href="#ssltls-2" aria-hidden="true"><i data-feather="bookmark"></i></a>强制执行 SSL/TLS，但连接失败</h1>
<p>如果已将与 LDAP 服务器的连接配置为“在无法使用传输层安全 (SSL/TLS) 时中止连接”，则可能会看到以下错误消息：</p>
<p><img src="/dcosdocs/mesosphere/dcos/cn/1.13/img/ldap-enforced-TLS-error.png" alt="已中止 SSL/TLS 连接"></p>
<p>图 4. 连接错误消息：TLS 错误</p>
<p>要更改 DC/OS 处理 SSL/TLS 连接错误的方式：</p>
<ol>
<li>
<p>登录到 DC/OS 基于 Web 的控制台。</p>
</li>
<li>
<p>单击 <strong>设置</strong>，然后单击 <strong>LDAP 目录</strong>。</p>
</li>
<li>
<p>单击 <strong>编辑目录</strong>。</p>
</li>
<li>
<p>在 <strong>选择 SSL/TLS 设置</strong>下，选择另一个选项。</p>
<p><img src="/dcosdocs/mesosphere/dcos/cn/1.13/img/ldap-ssl-options.png" alt="SSL/TLS 设置选项"></p>
<p>图 5. SSL/TLS 设置选项</p>
<p>例如，如果您想在安全通信不可用时继续连接到 LDAP 服务器，则可以将“选择 SSL/TLS 设置”设置为 <strong>尝试 StartTLS，如果失败，则不进行加密</strong>。</p>
</li>
<li>
<p>单击 <strong>保存配置</strong>。</p>
</li>
</ol>
<h1 id="-2"><a class="content__anchor" href="#-2" aria-hidden="true"><i data-feather="bookmark"></i></a>服务账户凭据问题</h1>
<p>如果 LDAP 服务器连接成功，但服务账户的身份认证凭据不正确，则可能会看到以下错误消息：</p>
<p><img src="/dcosdocs/mesosphere/dcos/cn/1.13/img/ldap-lookup-DN-error.png" alt="LDAP 身份认证错误"></p>
<p>图 6. LDAP 身份认证错误</p>
<p>要解决此问题：</p>
<ol>
<li>
<p>登录到 DC/OS 基于 Web 的控制台。</p>
</li>
<li>
<p>单击 <strong>设置</strong>，然后单击 <strong>LDAP 目录</strong>。</p>
</li>
<li>
<p>单击 <strong>编辑目录</strong>。</p>
</li>
<li>
<p>单击 <strong>身份认证</strong>。</p>
</li>
<li>
<p>更正 <strong>查找 DN</strong> 和 <strong>查找密码</strong>。</p>
<p><img src="/dcosdocs/mesosphere/dcos/cn/1.13/img/ldap-lookup-dn.png" alt="修改身份认证信息"></p>
<p>图 7. 修改身份认证信息</p>
</li>
<li>
<p>单击 <strong>保存配置</strong>。</p>
</li>
</ol>
<h1 id="-3"><a class="content__anchor" href="#-3" aria-hidden="true"><i data-feather="bookmark"></i></a>无法找到用户</h1>
<p>如果 LDAP 服务器连接成功且服务账户凭据正确，但无法找到用户，则可能会看到以下错误消息：</p>
<p><img src="/dcosdocs/mesosphere/dcos/cn/1.13/img/ldap-user-error.png" alt="未找到 LDAP 用户"></p>
<p>图 8. 未找到 LDAP 用户</p>
<p>大多数情况下，如果指定的用户或服务账户不在您定义的用户搜索库范围之内，或者用于绑定到 LDAP 服务器的用户可分辨名称 (DN) 或用户可分辨名称 (DN) 模板存在问题，您会看到此错误。如果您看到此错误，您应该验证以下设置：</p>
<ul>
<li>用于连接到 LDAP 服务器的绑定操作和身份认证方法的类型。</li>
<li>为用户搜索库定义的范围。</li>
<li>您正在使用的用户可分辨名称 (DN) 模板。</li>
<li>您正在使用的用户搜索筛选模板。</li>
</ul>
<h2 id="dn"><a class="content__anchor" href="#dn" aria-hidden="true"><i data-feather="bookmark"></i></a>指定用户可分辨名称 (DN) 模板</h2>
<p>如果您要使用 <strong>简单</strong> 身份认证来绑定到 LDAP 服务器，则确保您已指定一个有效的用户 DN 模板。大多数情况下，可分辨名称模板包括运行时变量占位符 <code>cn=%(username)s</code>，该占位符在查找请求中被替换为实际的账户名值。</p>
<h2 id="-4"><a class="content__anchor" href="#-4" aria-hidden="true"><i data-feather="bookmark"></i></a>指定用户搜索库和筛选模板</h2>
<p>如果您要使用 <strong>搜索</strong> 身份认证来绑定到 LDAP 服务器，则确保您已指定一个有效的用户搜索库和用户搜索筛选模板。</p>
<p>用户搜索库应足够宽泛，以包括要从中返回结果的相应容器、组织单位和域。</p>
<p>定义搜索筛选模板时，应记住以下内容：
<code>%(username)s</code> 运行时变量是一个占位符，该占位符在查找请求中被替换为实际的账户名值。</p>
<ul>
<li>对于 OpenLDAP 部署，账户查找请求通常使用 UID 属性，因此通常使用  来定义搜索模板占位符。<code>(uid=%(username)s))</code>.</li>
<li>对于 Active Directory 部署，账户查找请求通常使用 <code>sAMAccountName</code> 属性，因此通常使用 <code>(sAMAccountName=%(username)s))</code>. 来定义搜索模板占位符。大多数情况下，sAMAccountName 属性是用户为登录 Windows 域中的计算机而输入的账户名。</li>
</ul>
<h2 id="active-directory"><a class="content__anchor" href="#active-directory" aria-hidden="true"><i data-feather="bookmark"></i></a>验证 Active Directory 用户账户名</h2>
<p>如果您要使用 LDAP 服务器来访问 Windows 用户的 Active Directory 账户，则可以使用 Active Directory 用户和计算机或 Windows PowerShell 来找到 SamAccountName 属性和其他账户信息。</p>
<p>要使用 Active Directory 用户和计算机查找账户信息：</p>
<ol>
<li>
<p>使用具有管理权限的账户登录 Windows 计算机。</p>
</li>
<li>
<p>打开 <strong>管理工具</strong> 的控制面板。</p>
</li>
<li>
<p>打开 <strong>Active Directory 用户和计算机</strong>。</p>
</li>
<li>
<p>选择用户账户。</p>
<p><img src="/dcosdocs/mesosphere/dcos/cn/1.13/img/ldap-aduc.png" alt="在 Active Directory 用户和计算机中选择一个用户"></p>
<p>图 9. Active Directory 选项</p>
</li>
<li>
<p>右键单击，然后选择 <strong>属性</strong>。</p>
</li>
<li>
<p>单击 <strong>账户</strong> 选项卡并勾选 <strong>用户登录名称</strong>。</p>
<p><img src="/dcosdocs/mesosphere/dcos/cn/1.13/img/ldap-aduc-account-properties.png" alt="用户登录账户属性"></p>
<p>图 10. 用户登录账户</p>
</li>
</ol>
<h2 id="-5"><a class="content__anchor" href="#-5" aria-hidden="true"><i data-feather="bookmark"></i></a>检查替代账户名称格式</h2>
<p>某些情况下，您可能希望使用  的替代项来查找账户信息。<code>sAMAccountName</code>. 例如，您可能想通过 <code>userPrincipalName</code> 查找账户信息，它在 <code>user@domain.com</code> 格式的域中定义了唯一账户。</p>
<p>如果您想使用任何其他有效的账户名称格式，例如 <code>user@domain.com</code>，则可以使用 Active Directory 用户和计算机或使用 Windows Powershell 运行命令来找到有效的替代项来替代 <code>sAMAccountName</code></p>
<p>要使用 Window PowerShell 查找 Active Directory 用户信息，请执行以下操作：</p>
<ol>
<li>
<p>打开 Windows Powershell 管理员控制台。</p>
</li>
<li>
<p>使用导入菜单选项或 Import-Module cmdlet 来导入 Active Directory 模块。例如，在 PowerShell 控制台中，您可以按以下方式运行 <code>import-module</code> cmdlet：PS C:\Users\Administrator&gt; import-module activedirectory</p>
</li>
<li>
<p>运行 Get-ADUser cmdlet，以检索指定用户的 Active Directory 属性。例如：PS C:\Users\Administrator&gt; Get-ADUser rmcdonald -properties *</p>
</li>
</ol>
<p>此 cmdlet 将通过 <code>SAMAccountName</code> rmcdonald 为用户返回所有属性。</p>
<pre><code>AccountExpirationDate : 
accountExpires : 9223372036854775807
AccountLockoutTime : 
AccountNotDelegated : False
AllowReversiblePasswordEncryption : False
BadLogonCount : 1
badPasswordTime : 131896358930929294
badPwdCount : 1 
CannotChangePassword : False
CanonicalName : example.com/Users/Ronald McDonald
Certificates : {} 
City : 
CN : Ronald McDonald 
codePage : 0 
Company : 
Country : 
countryCode : 0 
Created : 12/17/2018 2:27:43 PM 
createTimeStamp : 12/17/2018 2:27:43 PM 
Deleted : 
Department : 
Description : 
DisplayName : Ronald McDonald 
DistinguishedName : CN=Ronald McDonald,CN=Users,DC=example,DC=com
Division : 
DoesNotRequirePreAuth : False 
dSCorePropagationData : {12/31/1600 4:00:00 PM}
EmailAddress : 
EmployeeID : 
EmployeeNumber : 
Enabled : True 
Fax : 
GivenName : Ronald
HomeDirectory : 
HomedirRequired : False 
HomeDrive : 
HomePage : 
HomePhone : 
Initials : 
instanceType : 4
isDeleted : 
LastBadPasswordAttempt : 12/18/2018 11:44:53 AM
LastKnownParent : 
lastLogoff : 0 
lastLogon : 0 
LastLogonDate : 12/17/2018 2:36:30 PM
lastLogonTimestamp : 131895597903404620
LockedOut : False
logonCount : 0 
LogonWorkstations : 
Manager : 
MemberOf : {} 
MNSLogonAccount : False
MobilePhone : 
Modified : 12/17/2018 2:36:30 PM 
modifyTimeStamp : 12/17/2018 2:36:30 PM
msDS-User-Account-Control-Computed : 0 
Name : Ronald McDonald 
nTSecurityDescriptor : System.DirectoryServices.ActiveDirectorySecurity
ObjectCategory : CN=Person,CN=Schema,CN=Configuration,DC=example,DC=com 
ObjectClass : user 
ObjectGUID : 8a372fe3-b879-4a58-aabd-6001327b2548
objectSid : S-1-5-21-1469461492-1576009741-989685995-1104
Office : 
OfficePhone : 
Organization : 
OtherName : 
PasswordExpired : False 
PasswordLastSet : 12/17/2018 2:27:43 PM
PasswordNeverExpires : True
PasswordNotRequired : False 
POBox : 
PostalCode : 
PrimaryGroup : CN=Domain Users,CN=Users,DC=example,DC=com
primaryGroupID : 513 
ProfilePath : 
ProtectedFromAccidentalDeletion : False
pwdLastSet : 131895592635431368 
SamAccountName : rmcdonald 
sAMAccountType : 805306368 
ScriptPath : 
sDRightsEffective : 15 
ServicePrincipalNames : {} 
SID : S-1-5-21-1469461492-1576009741-989685995-1104
SIDHistory : {} 
SmartcardLogonRequired : False 
sn : McDonald 
State : 
StreetAddress : 
Surname : McDonald 
Title : 
TrustedForDelegation : False
TrustedToAuthForDelegation : False
UseDESKeyOnly : False
userAccountControl : 66048 
userCertificate : {} 
UserPrincipalName : rmcdonald@example.com
uSNChanged : 16787 
uSNCreated : 16781 
whenChanged : 12/17/2018 2:36:30 PM 
whenCreated : 12/17/2018 2:27:43 PM
</code></pre>
<h1 id="-6"><a class="content__anchor" href="#-6" aria-hidden="true"><i data-feather="bookmark"></i></a>带错误凭据的用户</h1>
<p>如果与 LDAP 服务器的连接成功，且可以在用户搜索库范围内找到指定用户，但凭据是错误的，则可能会看到以下错误消息：</p>
<p><img src="/dcosdocs/mesosphere/dcos/cn/1.13/img/ldap-wrong-user-credentials.png" alt="无效用户凭据"></p>
<p>图 11. 无效用户凭据</p>
<p>如果您看到此错误，则检查是否存在以下可能导致用户凭据无效的潜在问题：</p>
<ul>
<li>验证账户未被锁定或禁用。</li>
<li>验证账户密码未过期。</li>
<li>检查是否存在阻止用户身份认证的登录时间或其他访问控制限制。</li>
</ul>
</article></div><aside class="content__sections"><div class="content__sections-list-container"><ul class="content__sections-list"><li class="content__sections-item content__sections-item--h1"><a href="#microsoft-active-directory">使用 Microsoft Active Directory 时的常见问题</a></li><li class="content__sections-item content__sections-item--h1"><a href="#无法连接到目录后端">无法连接到目录后端</a></li><li class="content__sections-item content__sections-item--h1"><a href="#ssltls">传输层安全 (SSL/TLS) 连接错误</a></li><li class="content__sections-item content__sections-item--h1"><a href="#ssltls-2">强制执行 SSL/TLS，但连接失败</a></li><li class="content__sections-item content__sections-item--h1"><a href="#-2">服务账户凭据问题</a></li><li class="content__sections-item content__sections-item--h1"><a href="#-3">无法找到用户</a></li><li class="content__sections-item content__sections-item--h2"><a href="#dn">指定用户可分辨名称 (DN) 模板</a></li><li class="content__sections-item content__sections-item--h2"><a href="#-4">指定用户搜索库和筛选模板</a></li><li class="content__sections-item content__sections-item--h2"><a href="#active-directory">验证 Active Directory 用户账户名</a></li><li class="content__sections-item content__sections-item--h2"><a href="#-5">检查替代账户名称格式</a></li><li class="content__sections-item content__sections-item--h1"><a href="#-6">带错误凭据的用户</a></li></ul></div></aside></main></div></div><script src="/dcosdocs/assets/js/jquery-3.2.1.js"></script><script src="/dcosdocs/assets/js/clipboard.js"></script><script src="/dcosdocs/assets/js/prism.js"></script><script src="/js/main.js"></script></body></html>