<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width" initial-scale="1" user-scalable="no"><title>生产安装 - D2iQ Docs</title><meta name="description" content="安装生产就绪的 DC/OS"><link rel="apple-touch-icon" sizes="180x180" href="/assets/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/favicon-16x16.png"><link rel="stylesheet" type="text/css" href="/dcosdocs/css/styles.css"><link rel="search" type="application/opensearchdescription+xml" href="/assets/opensearch.xml" title="Search"><link href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,500,500i,700,700i" rel="stylesheet"><script src="https://unpkg.com/feather-icons/dist/feather.min.js"></script><script>window.analytics||(window.analytics=[]),window.analytics.methods=["identify","track","trackLink","trackForm","trackClick","trackSubmit","page","pageview","ab","alias","ready","group","on","once","off"],window.analytics.factory=function(t){return function(){var a=Array.prototype.slice.call(arguments);return a.unshift(t),window.analytics.push(a),window.analytics}};for(var i=0;i<window.analytics.methods.length;i++){var method=window.analytics.methods[i];window.analytics[method]=window.analytics.factory(method)}window.analytics.load=function(t){var a=document.createElement("script");a.type="text/javascript",a.async=!0,a.src=("https:"===document.location.protocol?"https://":"http://")+"d2dq2ahtl5zl1z.cloudfront.net/analytics.js/v1/"+t+"/analytics.min.js";var n=document.getElementsByTagName("script")[0];n.parentNode.insertBefore(a,n)},window.analytics.SNIPPET_VERSION="2.0.8",
window.analytics.load("7sgtwqvuai");
window.analytics.page();</script><noscript><iframe src="//www.googletagmanager.com/ns.html?id=GTM-PBJ84KX" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript><script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src='//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
})(window,document,'script','dataLayer','GTM-PBJ84KX');</script></head><body><div class="layout"><header class="header"><a class="header__drawer"><i class="header__icon" data-feather="menu"></i></a><a class="header__logo" href="/"><img class="header__logo--mobile" src="/assets/D2iQ_Logotype_Color_Positive_Documentation.svg" alt="D2IQ"><img class="header__logo--desktop" src="/assets/D2iQ_Logotype_Color_Positive_Documentation.svg" alt="D2IQ"></a><div class="header__main"><div class="header__dropdown"><img class="header__dropdown-icon" src="/assets/D2IQ_Logotype_Color_Positive.png" alt="D2iQ"><strong>DC/OS文档</strong><i data-feather="chevron-down"></i></div><nav class="header__menu"><ul class="header__menu-list"><li class="header__menu-item"><a href="https://support.d2iq.com">Support</a></li></ul></nav></div><div class="chooser" id="localizer"><div class="chooser-current"><a class="chooser-title">中文 (简体)</a><svg class="chooser-svg" id="localizer-svg"><path class="pointer" d="m 13,6 -5,5 -5,-5 z" fill="#858585"></path></svg></div><ul class="chooser-list" id="localizer-list"><li class="chooser-list-item"><a href="/dcosdocs/mesosphere/dcos/1.13/installing/production/deploying-dcos/installation">English</a></li></ul></div><section class="header__search" role="search"><form class="header__search-form" action="/search/"><input class="header__search-input" id="header-search-input" tabindex="1" type="text" name="q" placeholder="Search"><input type="hidden" name="hFR[scope][0]" value="DC/OS 1.13"><label class="header__search-label" for="header-search-input"><i class="header__icon" data-feather="search"></i></label></form></section></header><div class="header-dropdown"><ul class="header-dropdown__list"><li class="header-dropdown__top-item"><div>DKP</div></li><li class="header-dropdown__item"><a href="/dkp/konvoy">Konvoy</a></li><li class="header-dropdown__item"><a href="/dkp/kommander">Kommander</a></li><li class="header-dropdown__item"><a href="/dkp/dispatch">Dispatch</a></li><li class="header-dropdown__item"><a href="/dkp/kaptain">Kaptain</a></li><li class="header-dropdown__top-item"><div>Mesosphere</div></li><li class="header-dropdown__item header-dropdown__item--active"><a href="/mesosphere/dcos">DC/OS</a></li><li class="header-dropdown__item"><a href="/dcosdocs/mesosphere/dcos/services">DC/OS Services</a></li><li class="header-dropdown__item"><a href="https://support.d2iq.com">Support</a></li></ul></div><div class="layout__sidebar layout__drawer"><section class="sidebar"><header class="sidebar__header"><div class="sidebar__dropdown"><ul><li><a href="/dcosdocs/mesosphere/dcos/cn/2.1/installing/production/deploying-dcos/installation">Mesosphere DC/OS 2.1.0</a></li><li><a href="/dcosdocs/mesosphere/dcos/cn/2.0/installing/production/deploying-dcos/installation">Mesosphere DC/OS 2.0</a></li><li><a href="/dcosdocs/mesosphere/dcos/cn/1.13/installing/production/deploying-dcos/installation">Mesosphere DC/OS 1.13</a></li></ul><div class="toggle"><p><span class="title">DC/OS</span><span class="version"> 1.13</span></p><i data-feather="chevron-down"></i></div></div></header><nav class="sidebar_nav" role="navigation"><ul><li><a class="d0" href="/dcosdocs/mesosphere/dcos/cn/1.13/release-notes/"><i data-feather="chevron-right"></i>版本注释</a></li><li><a class="d0" href="/dcosdocs/mesosphere/dcos/cn/1.13/overview/"><i data-feather="chevron-right"></i>概述</a></li><li class="active"><a class="d0" href="/dcosdocs/mesosphere/dcos/cn/1.13/installing/"><i data-feather="chevron-right"></i>安装</a></li><ul><li><a class="d1" href="/dcosdocs/mesosphere/dcos/cn/1.13/installing/evaluation/"><i data-feather="chevron-right"></i>云安装</a></li><li class="active"><a class="d1" href="/dcosdocs/mesosphere/dcos/cn/1.13/installing/production/"><i data-feather="chevron-right"></i>本地安装</a></li><ul><li><a class="d2" href="/dcosdocs/mesosphere/dcos/cn/1.13/installing/production/virt-infra/">虚拟基础架构</a></li><li><a class="d2" href="/dcosdocs/mesosphere/dcos/cn/1.13/installing/production/system-requirements/"><i data-feather="chevron-right"></i>系统要求</a></li><li class="active"><a class="d2" href="/dcosdocs/mesosphere/dcos/cn/1.13/installing/production/deploying-dcos/"><i data-feather="chevron-right"></i>部署 DC/OS</a></li><ul><li><a class="d3" href="/dcosdocs/mesosphere/dcos/cn/1.13/installing/production/deploying-dcos/configuration/"><i data-feather="chevron-right"></i>配置</a></li><li class="active active-on"><a class="d3" href="/dcosdocs/mesosphere/dcos/cn/1.13/installing/production/deploying-dcos/installation/">生产安装</a></li><li><a class="d3" href="/dcosdocs/mesosphere/dcos/cn/1.13/installing/production/deploying-dcos/opt-out/">禁用</a></li><li><a class="d3" href="/dcosdocs/mesosphere/dcos/cn/1.13/installing/production/deploying-dcos/node-cluster-health-check/">节点和群集健康检查</a></li></ul><li><a class="d2" href="/dcosdocs/mesosphere/dcos/cn/1.13/installing/production/advanced-configuration/"><i data-feather="chevron-right"></i>高级配置</a></li><li><a class="d2" href="/dcosdocs/mesosphere/dcos/cn/1.13/installing/production/dcos-ansible/"><i data-feather="chevron-right"></i>带 Ansible 的 DC/OS</a></li><li><a class="d2" href="/dcosdocs/mesosphere/dcos/cn/1.13/installing/production/patching/">打补丁</a></li><li><a class="d2" href="/dcosdocs/mesosphere/dcos/cn/1.13/installing/production/upgrading/">升级</a></li><li><a class="d2" href="/dcosdocs/mesosphere/dcos/cn/1.13/installing/production/uninstalling/">卸载</a></li></ul><li><a class="d1" href="/dcosdocs/mesosphere/dcos/cn/1.13/installing/installation-faq/">常见问题</a></li><li><a class="d1" href="/dcosdocs/mesosphere/dcos/cn/1.13/installing/troubleshooting/">故障排除</a></li></ul><li><a class="d0" href="/dcosdocs/mesosphere/dcos/cn/1.13/gui/"><i data-feather="chevron-right"></i>GUI</a></li><li><a class="d0" href="/dcosdocs/mesosphere/dcos/cn/1.13/cli/"><i data-feather="chevron-right"></i>CLI</a></li><li><a class="d0" href="/dcosdocs/mesosphere/dcos/cn/1.13/administering-clusters/"><i data-feather="chevron-right"></i>管理群集</a></li><li><a class="d0" href="/dcosdocs/mesosphere/dcos/cn/1.13/networking/"><i data-feather="chevron-right"></i>网络</a></li><li><a class="d0" href="/dcosdocs/mesosphere/dcos/cn/1.13/security/"><i data-feather="chevron-right"></i>安全</a></li><li><a class="d0" href="/dcosdocs/mesosphere/dcos/cn/1.13/storage/"><i data-feather="chevron-right"></i>存储</a></li><li><a class="d0" href="/dcosdocs/mesosphere/dcos/cn/1.13/metrics/"><i data-feather="chevron-right"></i>度量标准</a></li><li><a class="d0" href="/dcosdocs/mesosphere/dcos/cn/1.13/monitoring/"><i data-feather="chevron-right"></i>监控、日志记录和调试</a></li><li><a class="d0" href="/dcosdocs/mesosphere/dcos/cn/1.13/hybrid-cloud/"><i data-feather="chevron-right"></i>混合云</a></li><li><a class="d0" href="/dcosdocs/mesosphere/dcos/cn/1.13/deploying-jobs/"><i data-feather="chevron-right"></i>部署作业</a></li><li><a class="d0" href="/dcosdocs/mesosphere/dcos/cn/1.13/deploying-services/"><i data-feather="chevron-right"></i>部署服务和 Pod</a></li><li><a class="d0" href="/dcosdocs/mesosphere/dcos/cn/1.13/tutorials/"><i data-feather="chevron-right"></i>教程</a></li><li><a class="d0" href="/dcosdocs/mesosphere/dcos/cn/1.13/api/"><i data-feather="chevron-right"></i>API 参考</a></li><li><a class="d0" href="/dcosdocs/mesosphere/dcos/cn/1.13/developing-services/"><i data-feather="chevron-right"></i>开发 DC/OS 服务</a></li></ul></nav><footer class="sidebar__footer"><div class="sidebar__footer-links"><a href="https://d2iq.com/terms/">Terms of Service</a><a href="https://d2iq.com/privacy/">Privacy Policy</a></div><a class="sidebar__footer-copyright" href="https://d2iq.com/">&copy; 2022 D2iQ, Inc. All rights reserved.</a></footer></section></div><div class="layout__content" role="main"><main class="content"><div class="content__container content__container--with-sections"><div class="content__header"><div class="content__header__row"><h1 class="content__header-title">生产安装</h1></div><h4 class="content__header-description">安装生产就绪的 DC/OS</h4><div class="actions"><ul class="actions__list"><li class="actions__item"><button class="actions__link" onclick="javascript:window.print()"><i class="actions__icon" data-feather="printer"></i><span class="actions__text">Print</span></button></li><li class="actions__item"><a class="actions__link" href="https://github.com/mesosphere/dcos-docs-site/tree/main/pages/dcosdocs/mesosphere/dcos/cn/1.13/installing/production/deploying-dcos/installation/index.md" target="_blank"><i class="actions__icon" data-feather="github"></i><span class="actions__text">Contribute</span></a></li></ul></div></div><article class="content__article"><p>本页概括如何安装 DC/OS 用于生产。使用这种方法，您可以打包 DC/OS 分发并手动连接到每个节点，以运行 DC/OS 安装命令。若要与现有系统集成，或者您没有群集的 SSH 访问权限，则推荐使用这种安装方法。</p>
<p>DC/OS 安装进程需要 bootstrap 节点、管理节点、公共代理节点和专用代理节点。可以查看 <a href="/dcosdocs/mesosphere/dcos/cn/1.13/overview/concepts/#node">节点</a> 文档以了解更多信息。</p>
<h1 id=""><a class="content__anchor" href="#" aria-hidden="true"><i data-feather="bookmark"></i></a>生产安装流程</h1>
<p>安装 DC/OS 群集需要以下步骤：</p>
<ol>
<li>配置 bootstrap 节点</li>
<li>在管理节点上安装 DC/OS</li>
<li>在代理节点上安装 DC/OS</li>
</ol>
<p><img src="/dcosdocs/mesosphere/dcos/cn/1.13/img/advanced-installer.png" alt="Production Installation Process">
图 1. 生产安装流程</p>
<p>此安装方法需要下列设置：</p>
<ul>
<li>bootstrap 节点必须是可从群集节点访问的网络。</li>
<li>bootstrap 节点必须从群集节点打开 HTTP(S) 端口。</li>
</ul>
<p>DC/OS 安装会创建以下文件夹：</p>
<table>
<thead>
<tr>
<th>文件夹</th>
<th>描述</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>/opt/mesosphere</code></td>
<td>包含 DC/OS 二进制文件、库和群集配置。请勿修改。</td>
</tr>
<tr>
<td><code>/etc/systemd/system/dcos.target.wants</code></td>
<td>包含启动 systemd 组件的 systemd 服务。它们因受 systemd 限制而必须位于 <code>/opt/mesosphere</code> 之外。</td>
</tr>
<tr>
<td><code>/etc/systemd/system/dcos.&lt;units&gt;</code></td>
<td><code>/etc/systemd/system/dcos.target.wants</code> 中包含单位的副本。它们必须位于顶部文件夹以及  内部。</td>
</tr>
<tr>
<td><code>/var/lib/dcos/exhibitor/zookeeper</code></td>
<td>包含 <a href="/dcosdocs/mesosphere/dcos/cn/1.13/overview/concepts/#exhibitor-zookeeper">ZooKeeper</a> 数据。</td>
</tr>
<tr>
<td><code>/var/lib/docker</code></td>
<td>包含 Docker 数据。</td>
</tr>
<tr>
<td><code>/var/lib/dcos</code></td>
<td>包含 DC/OS 数据。</td>
</tr>
<tr>
<td><code>/var/lib/mesos</code></td>
<td>包含 Mesos 数据。</td>
</tr>
</tbody>
</table>
<p class="message--warning"><strong>警告：</strong>不支持更改为 <code>/opt/mesosphere</code> 它们可能导致 DC/OS 中出现不可预测的行为，并防止升级。</p>
<h2 id="-2"><a class="content__anchor" href="#-2" aria-hidden="true"><i data-feather="bookmark"></i></a>前提条件</h2>
<p>您的群集必须符合软件和硬件 [要求]，才能安装 DC/OS。(/dcosdocs/mesosphere/dcos/cn/1.13/installing/production/system-requirements/).</p>
<h1 id="-3"><a class="content__anchor" href="#-3" aria-hidden="true"><i data-feather="bookmark"></i></a><a name="configure-cluster"></a>配置您的群集</h1>
<ol>
<li>
<p>在 bootstrap 节点上创建名为 <code>genconf</code> 的目录，并导航到该目录。</p>
<pre><code class="language-bash">mkdir -p genconf
</code></pre>
</li>
</ol>
<h1 id="enterprise"><a class="content__anchor" href="#enterprise" aria-hidden="true"><i data-feather="bookmark"></i></a><a name="license"></a>存储许可证文件 <span class="badge badge--shortcode badge--large badge--block badge--enterprise">Enterprise</span></h1>
<ol>
<li>创建 <a href="/dcosdocs/mesosphere/dcos/cn/1.13/administering-clusters/licenses/">许可证文件</a>（包含您的授权支持联系人发送的电子邮件中提供的许可文本）并另存为 <code>genconf/license.txt</code>.</li>
</ol>
<h1 id="ip"><a class="content__anchor" href="#ip" aria-hidden="true"><i data-feather="bookmark"></i></a><a name="ip-detect-script"></a>创建 IP 检测脚本</h1>
<p>在这一步创建 IP 检测脚本。这一脚本报告群集中每个节点的 IP 地址。DC/OS 群集中的每个节点都有一个唯一的 IP 地址，用于在群集中的节点之间进行通信。每次在节点上启动 DC/OS 时，IP 检测脚本都会将节点的唯一 IPv4 地址打印到 STDOUT。</p>
<p class="message--note"><strong>注意：</strong>在节点上安装 DC/OS 后，节点的 IP 地址不能更改。例如，当重新启动节点或更新 DHCP 租约时，IP 地址不应更改。如果节点的 IP 地址发生更改，该节点必须<a href="/dcosdocs/mesosphere/dcos/1.13/installing/production/uninstalling/">卸载</a>.</p>
<p class="message--note"><strong>注意：</strong>脚本必须返回 <code>config.yaml</code>. 中所指定的相同 IP 地址。例如，如果将 <code>config.yaml</code> 中的专用管理节点 IP 指定为 <code>10.2.30.4</code>，您的脚本在管理节点上运行时应返回相同的值。</p>
<ol>
<li>
<p>为您的环境创建 IP 检测脚本，并另存为 <code>genconf/ip-detect</code>. 此脚本需要 <code>UTF-8</code> 编码并具备有效的 [shebang](https://en.wikipedia.org/wiki/Shebang_(Unix) 行。可以使用以下示例。</p>
<ul>
<li>
<h4 id="aws"><a class="content__anchor" href="#aws" aria-hidden="true"><i data-feather="bookmark"></i></a>使用 AWS 元数据服务器</h4>
<p>此方法使用 AWS 元数据服务获取 IP 地址：</p>
<pre><code class="language-bash">#!/bin/sh
# Example ip-detect script using an external authority
# Uses the AWS Metadata Service to get the node's internal
# ipv4 address
curl -fsSL http://169.254.169.254/latest/meta-data/local-ipv4
</code></pre>
</li>
<li>
<h4 id="gce"><a class="content__anchor" href="#gce" aria-hidden="true"><i data-feather="bookmark"></i></a>使用 GCE 元数据服务器</h4>
<p>此方法使用 GCE 元数据服务器获取 IP 地址：</p>
<pre><code class="language-bash">#!/bin/sh
# Example ip-detect script using an external authority
# Uses the GCE metadata server to get the node's internal
# ipv4 address

curl -fsSl -H &quot;Metadata-Flavor: Google&quot; http://169.254.169.254/computeMetadata/v1/instance/network-interfaces/0/ip
</code></pre>
</li>
<li>
<h4 id="ip-2"><a class="content__anchor" href="#ip-2" aria-hidden="true"><i data-feather="bookmark"></i></a>使用现有接口的 IP 地址</h4>
<p>此方法发现节点特定接口的 IP 地址。</p>
<p>如果有带有不同内部 IP 地址的多代硬件，可以在主机之间更改接口名称。IP 检测脚本必须考虑接口名称更改。如果将多个 IP 地址连接到同一个接口，或建立复杂的 Linux 网络等，则也会混淆示例脚本。</p>
<pre><code class="language-bash">#!/usr/bin/env bash
set -o nounset -o errexit
export PATH=/usr/sbin:/usr/bin:$PATH
echo $(ip addr show eth0 | grep -Eo '[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}' | head -1)
</code></pre>
</li>
<li>
<h4 id="mesos"><a class="content__anchor" href="#mesos" aria-hidden="true"><i data-feather="bookmark"></i></a>使用 Mesos 管理节点的网络路由</h4>
<p>此方法使用 Mesos 管理节点的路由查找源 IP 地址，然后与该节点通信。</p>
<p>在本示例中，我们假设 Mesos 管理节点具有 IP 地址 <code>172.28.128.3</code>. 可以在此脚本使用任何语言。Shebang 行必须指向所用语言的相应环境，且输出必须是正确的 IP 地址。</p>
<p><span class="badge__container badge__container--inline"><span class="badge badge--shortcode badge--small badge--inline badge--enterprise">Enterprise</span></span></p>
</li>
</ul>
</li>
</ol>
<pre><code class="language-bash">#!/usr/bin/env bash
set -o nounset -o errexit
MASTER_IP=&quot;172.28.128.3&quot;
echo $(ip route show to match $MASTER_IP | grep -Eo '[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}' | tail -1)
</code></pre>
<p><span class="badge__container badge__container--inline"><span class="badge badge--shortcode badge--small badge--inline badge--oss">Open Source</span></span></p>
<pre><code class="language-bash">#!/usr/bin/env bash
set -o nounset -o errexit -o pipefail
export PATH=/sbin:/usr/sbin:/bin:/usr/bin:$PATH
MASTER_IP=$(dig +short master.mesos || true)
MASTER_IP=${MASTER_IP:-172.28.128.3}
INTERFACE_IP=$(ip r g ${MASTER_IP} | \
awk -v master_ip=${MASTER_IP} '
BEGIN { ec = 1 }
 {
  if($1 == master_ip) {
        print $7
        ec = 0
 } else if($1 == &quot;local&quot;) {
        print $6
        ec = 0
 }
      if (ec == 0) exit;
    }
      END { exit ec }
    ')
    echo $INTERFACE_IP
</code></pre>
<h1 id="enterprise-2"><a class="content__anchor" href="#enterprise-2" aria-hidden="true"><i data-feather="bookmark"></i></a>创建故障域检测脚本 <span class="badge badge--shortcode badge--large badge--block badge--enterprise">Enterprise</span></h1>
<p>DC/OS 群集默认启用 <a href="/dcosdocs/mesosphere/dcos/cn/1.13/deploying-services/fault-domain-awareness/">故障域意识</a>，所以必须更改 <code>config.yaml</code> 才能使用此功能。但必须包含名为 <code>fault-domain-detect</code> 故障域检测脚本到您的 <code>./genconf</code> 目录。要选择禁用故障域感知，请将 <code>fault_domain_enabled</code> 文件中的 <code>config.yaml</code> 参数设置为 <code>false</code>.</p>
<ol>
<li>
<p>创建名为 <code>fault-domain-detect</code> 的故障域检测脚本，在每个节点上运行，以检测节点的故障域。安装过程中此脚本的输出被传递到 Mesos。</p>
<p>脚本输出的推荐格式为：</p>
<pre><code class="language-json">{
    &quot;fault_domain&quot;: {
        &quot;region&quot;: {
            &quot;name&quot;: &quot;&lt;region-name&gt;&quot;
        },
        &quot;zone&quot;: {
            &quot;name&quot;: &quot;&lt;zone-name&gt;&quot;
        }
    }
}
</code></pre>
<p>我们提供 <a href="https://github.com/dcos/dcos/tree/master/gen/fault-domain-detect">AWS 和 Azure 节点的故障域检测脚本</a>. 对于具有 aws 节点和 azure 节点的群集，可将两者组合为一个脚本。可以使用这些模型为本地群集创建故障域检测脚本。</p>
 <p class="message--important"><strong>重要信息：</strong>如果在环境中使用代理，此脚本将不起作用。如果使用代理，则必须进行修改。</p>
</li>
</ol>
<ol start="2">
<li>添加新创建的 <code>fault-domain-detect</code> 脚本到 bootstrap 节点的 <code>/genconf</code> 目录。</li>
</ol>
<h1 id="-4"><a class="content__anchor" href="#-4" aria-hidden="true"><i data-feather="bookmark"></i></a>创建配置文件</h1>
<p>在这一步，可以创建针对您的环境自定义的 YAML 配置文件。DC/OS 在安装期间使用此配置文件生成群集安装文件。</p>
<h2 id="enterprise-3"><a class="content__anchor" href="#enterprise-3" aria-hidden="true"><i data-feather="bookmark"></i></a>设置超级用户密码 <span class="badge badge--shortcode badge--large badge--block badge--enterprise">Enterprise</span></h2>
<p>在以下说明中，我们假定您正在使用 ZooKeeper 进行共享存储。</p>
<ol>
<li>
<p>在 bootstrap 节点运行此命令，创建用于超级用户身份认证的散列密码，其中 <code>&lt;superuser_password&gt;</code> 是超级用户密码。</p>
</li>
<li>
<p>保存散列密码密钥，用于<code>superuser_password_hash</code> 文件中的 <code>config.yaml</code> 参数 。</p>
<pre><code class="language-bash">sudo bash dcos_generate_config.ee.sh --hash-password &lt;superuser_password&gt;
</code></pre>
<p>以下是散列密码输出的示例。</p>
<pre><code>Extracting an image from this script and loading it into a docker daemon, can take a few minutes.
dcos-genconf.9eda4ae45de5488c0c-c40556fa73a00235f1.tar
Running mesosphere/dcos-genconf docker with BUILD_DIR set to /home/centos/genconf
00:42:10 dcos_installer.action_lib.prettyprint:: ====&gt; HASHING PASSWORD TO SHA512
00:42:11 root:: Hashed password for 'password' key:
$6$rounds=656000$v55tdnlMGNoSEgYH$1JAznj58MR.Bft2wd05KviSUUfZe45nsYsjlEl84w34pp48A9U2GoKzlycm3g6MBmg4cQW9k7iY4tpZdkWy9t1
</code></pre>
</li>
</ol>
<h2 id="-5"><a class="content__anchor" href="#-5" aria-hidden="true"><i data-feather="bookmark"></i></a>创建配置</h2>
<ol>
<li>创建配置文件并另存为 <code>genconf/config.yaml</code>. 可以使用此模板开始创建。</li>
</ol>
<p>Enterprise 指定三个Mesos 管理节点、静态管理节点发现列表、Exhibitor 的内部存储后端、一个自定义代理、指定的安全模式，以及云专用的 DNS 解析器。<span class="badge__container badge__container--inline"><span class="badge badge--shortcode badge--small badge--inline badge--enterprise">Enterprise</span></span></p>
<p>该开源模板指定三个 Mesos 管理节点、三个用于 Exhibitor 存储的 ZooKeeper 实例、静态管理节点发现列表、Exhibitor 的内部存储后端、一个自定义代理，以及云专用的 DNS 解析器。<span class="badge__container badge__container--inline"><span class="badge badge--shortcode badge--small badge--inline badge--oss">Open Source</span></span></p>
<p>如果服务器在您的 <code>/etc/resolv.conf</code> 中安装时带有域名，请添加 <code>dns_search</code> 参数。有关参数描述和配置示例，请参阅 <a href="/dcosdocs/mesosphere/dcos/cn/1.13/installing/production/advanced-configuration/configuration-reference/">文档</a>.</p>
<p class="message--note"><strong>注意：</strong>如果 AWS DNS IP 在您的国家/地区不可用，则可以使用本地 DNS 服务器替换 AWS DNS IP 服务器 <code>8.8.8.8</code> 和 <code></code></p>
<p class="message--note"><strong>注意：</strong>如果您指定 <code>master_discovery: static</code>，则还必须创建脚本，以将内部 IP 映射到 bootstrap 节点上的公共 IP（例如，<code>genconf/ip-detect-public</code>). 此脚本然后在 <code>ip_detect_public_filename: "relative-path-from-dcos-generate-config.sh"</code>. 中引用。</p>
<p class="message--note"><strong>注意：</strong>在 AWS 或任何其他无法控制节点的 IP 地址的环境中，都需要设置master_discovery<code> 才能使用</code> master_http_load_balancer，并且需要设置负载均衡器。</p>
<h2 id="enterprise-enterprise"><a class="content__anchor" href="#enterprise-enterprise" aria-hidden="true"><i data-feather="bookmark"></i></a>Enterprise 模板 <span class="badge badge--shortcode badge--large badge--block badge--enterprise">Enterprise</span></h2>
<pre><code class="language-bash">bootstrap_url: http://&lt;bootstrap_ip&gt;:80
cluster_name: &lt;cluster-name&gt;
superuser_username:
superuser_password_hash:
exhibitor_storage_backend: static
master_discovery: static
ip_detect_public_filename: &lt;relative-path-to-ip-script&gt;
master_list:
- &lt;master-private-ip-1&gt;
- &lt;master-private-ip-2&gt;
- &lt;master-private-ip-3&gt;
resolvers:
- 169.254.169.253
# Choose your security mode: permissive or strict
security: &lt;security-mode&gt;
superuser_password_hash: &lt;hashed-password&gt; # Generated above
superuser_username: &lt;username&gt; # This can be whatever you like
# A custom proxy is optional. For details, see the configuration documentation.
use_proxy: 'true'
http_proxy: http://&lt;user&gt;:&lt;pass&gt;@&lt;proxy_host&gt;:&lt;http_proxy_port&gt;
https_proxy: https://&lt;user&gt;:&lt;pass&gt;@&lt;proxy_host&gt;:&lt;https_proxy_port&gt;
no_proxy:
- 'foo.bar.com'
- '.baz.com'
fault_domain_enabled: false
#If IPv6 is disabled in your kernel, you must disable it in the config.yaml
enable_ipv6: 'false'
</code></pre>
<h2 id="open-source"><a class="content__anchor" href="#open-source" aria-hidden="true"><i data-feather="bookmark"></i></a>开源模板 <span class="badge badge--shortcode badge--large badge--block badge--oss">Open Source</span></h2>
<pre><code>bootstrap_url: http://&lt;bootstrap_ip&gt;:80
cluster_name: &lt;cluster-name&gt;
exhibitor_storage_backend: static
master_discovery: static
ip_detect_public_filename:&lt;relative-path-to-ip-script&gt;
master_list:
- &lt;master-private-ip-1&gt;
- &lt;master-private-ip-2&gt;
- &lt;master-private-ip-3&gt;
resolvers:
- 169.254.169.253
use_proxy: 'true'
http_proxy: http://&lt;user&gt;:&lt;pass&gt;@&lt;proxy_host&gt;:&lt;http_proxy_port&gt;
https_proxy: https://&lt;user&gt;:&lt;pass&gt;@&lt;proxy_host&gt;:&lt;https_proxy_port&gt;
no_proxy:
- 'foo.bar.com'
- '.baz.com'
</code></pre>
<p><a name="custom-build-file"></a></p>
<h1 id="dcos"><a class="content__anchor" href="#dcos" aria-hidden="true"><i data-feather="bookmark"></i></a>安装 DC/OS</h1>
<p>在这一步，您将在 bootstrap 节点上创建一个自定义 DC/OS 构建文件，然后在群集上安装 DC/OS。使用这种方法，您可以</p>
<ol>
<li>自行打包 DC/OS 分发版本</li>
<li>手动连接到每个服务器</li>
<li>运行命令</li>
</ol>
<p class="message--note"><strong>注意：</strong>由于覆盖网络存在群集配置问题，建议在升级或配置新群集时，在 <code>config.yaml</code> 中将 <code>enable_ipv6</code> 设置为 <code>false</code> 如果您已升级到 DC/OS 1.13.x 而没有配置 <code>enable_ipv6</code>，或者 <code>config.yaml</code> 文件设置为 <code>true</code>，则请不要添加新节点。</p>
<p>您可以在我们最新重要的 [产品咨询] 中找到更多信息和更详细的补救流程(https://support.mesosphere.com/s/login/?startURL=%2Fs%2Farticle%2FCritical-Issue-with-Overlay-Networking&amp;ec=302).<span class="badge__container badge__container--inline"><span class="badge badge--shortcode badge--small badge--inline badge--enterprise">Enterprise</span></span></p>
<p class="message--important"><strong>重要信息：</strong>必须让以下项目生效才能安装 DC/OS：所有 DC/OS 节点上的 <code>ip-detect script</code>、<code>DNS</code> 和 <code>NTP</code> 均已同步时间。参见<a href="/dcosdocs/mesosphere/dcos/1.13/installing/troubleshooting/">故障排除</a>，了解更多信息。</p>
<p class="message--note"><strong>注意：</strong>如果出现问题并且您想重新运行设置，请使用群集<a href="/dcosdocs/mesosphere/dcos/1.13/installing/production/uninstalling/">卸载</a>说明。</p>
<p><strong>前提条件</strong></p>
<ul>
<li>经过优化，可在节点上手动分发 DC/OS 的 <code>genconf/config.yaml</code> 文件。</li>
<li>包含 DC/OS Enterprise 许可证的 <code>genconf/license.txt</code> 文件。<span class="badge__container badge__container--inline"><span class="badge badge--shortcode badge--small badge--inline badge--enterprise">Enterprise</span></span></li>
<li><code>genconf/ip-detect</code> 脚本。</li>
</ul>
<p><code>dcos_generate_config file</code> 一词指的是 <code>dcos_generate_config.ee.sh</code> 文件或 <code>dcos_generate_config.sh</code> 文件，具体取决于您使用的是企业版还是开源版本的 DC/OS。</p>
<ul>
<li>
<p>下载 <a href="https://support.mesosphere.com/hc/en-us/articles/213198586-Mesosphere-Enterprise-DC-OS-Downloads">dcos_generate_config 文件</a> 并将其保存到 bootstrap 节点。此文件用于创建自定义的 DC/OS 构建文件。请联系销售代表或 <a href="mailto:sales@mesosphere.com">sales@mesosphere.com</a> 以访问此文件。<span class="badge__container badge__container--inline"><span class="badge badge--shortcode badge--small badge--inline badge--enterprise">Enterprise</span></span></p>
<p>或</p>
</li>
<li>
<p>下载 <a href="https://downloads.dcos.io/dcos/stable/dcos_generate_config.sh">dcos_generate_config 文件</a> 并将其保存到 bootstrap 节点。此文件用于创建自定义的 DC/OS 构建文件。<span class="badge__container badge__container--inline"><span class="badge badge--shortcode badge--small badge--inline badge--oss">Open Source</span></span></p>
<pre><code class="language-bash">curl -O https://downloads.dcos.io/dcos/stable/dcos_generate_config.sh
</code></pre>
</li>
</ul>
<ol>
<li>
<p>在 bootstrap 节点运行 DC/OS 安装工具 shell 脚本，生成自定义 DC/OS 构建文件。安装脚本提取 Docker 容器，该容器使用通用 DC/OS 安装工具文件为群集创建自定义 DC/OS 构建文件。构建文件会输出到 <code>./genconf/serve/</code>.</p>
<p>可以通过以下方式查看所有自动命令行安装工具选项：</p>
<ul>
<li><code>dcos_generate_config.ee.sh --help</code> 标记 <span class="badge__container badge__container--inline"><span class="badge badge--shortcode badge--small badge--inline badge--enterprise">Enterprise</span></span>
或</li>
<li><code>dcos_generate_config.sh --help</code> 标记。<span class="badge__container badge__container--inline"><span class="badge badge--shortcode badge--small badge--inline badge--oss">Open Source</span></span></li>
</ul>
</li>
</ol>
<p><span class="badge__container badge__container--inline"><span class="badge badge--shortcode badge--small badge--inline badge--enterprise">Enterprise</span></span></p>
<pre><code>sudo bash dcos_generate_config.ee.sh
</code></pre>
<p>此时，目录结构应类似于：</p>
<pre><code>├── dcos-genconf.c9722490f11019b692-cb6b6ea66f696912b0.tar
├── dcos_generate_config.ee.sh
├── genconf
│   ├── config.yaml
│   ├── ip-detect
│   ├── license.txt
</code></pre>
<p><span class="badge__container badge__container--inline"><span class="badge badge--shortcode badge--small badge--inline badge--oss">Open Source</span></span></p>
<pre><code>sudo bash dcos_generate_config.sh
</code></pre>
<p>此时，目录结构应类似于：</p>
<pre><code>    ├── dcos-genconf.&lt;HASH&gt;.tar
    ├── dcos_generate_config.sh
    ├── genconf
    │   ├── config.yaml
    │   ├── ip-detect
</code></pre>
<ul>
<li>要使安装脚本生效，必须首先创建 <code>genconf/config.yaml</code> 和 <code>genconf/ip-detect</code>.</li>
</ul>
<p><a name="nginx-cmd"></a></p>
<ol start="2">
<li>
<p>在主目录中运行以下命令，以通过 NGINX Docker 容器托管 DC/OS 安装包。对于 <code>&lt;your-port&gt;</code>，请指定 <code>bootstrap_url</code>. 中使用的端口值。</p>
<pre><code class="language-bash">sudo docker run -d -p &lt;your-port&gt;:80 -v $PWD/genconf/serve:/usr/share/nginx/html:ro nginx
</code></pre>
</li>
<li>
<p><a name="masterinstall"></a> <a href="/dcosdocs/mesosphere/dcos/1.13/overview/concepts/#public">1</a>在使用自定义生成文件安装 DC/OS 之后，继续在每个主节点上运行以下命令：</p>
<ul>
<li>
<p>SSH 连接到管理节点。</p>
<pre><code class="language-bash">ssh &lt;master-ip&gt;
</code></pre>
</li>
<li>
<p>创建并导航至新目录。</p>
<pre><code class="language-bash">mkdir /tmp/dcos &amp;&amp; cd /tmp/dcos
</code></pre>
</li>
<li>
<p>在 NGINX Docker 容器中下载 DC/OS 安装工具，其中 <code>&lt;bootstrap-ip&gt;</code> 和 <code>&lt;your_port&gt;</code> 在 <code>bootstrap_url</code>.中指定。</p>
<pre><code class="language-bash">curl -O http://&lt;bootstrap-ip&gt;:&lt;your_port&gt;/dcos_install.sh
</code></pre>
</li>
<li>
<p>运行以下命令，在管理节点上安装 DC/OS。</p>
<pre><code class="language-bash">sudo bash dcos_install.sh master
</code></pre>
</li>
</ul>
<p class="message--note"><strong>注意：</strong>直到所有管理节点都设置完毕，DC/OS 可能会发出多个错误消息，尽管这对群集 DC/OS 没有实际损害。</p>
</li>
<li>
<p><a name="slaveinstall"></a> 在每个代理节点上运行以下命令，使用自定义构建文件安装 DC / OS：</p>
<ul>
<li>
<p>SSH 连接到代理节点。</p>
<pre><code class="language-bash">ssh &lt;agent-ip&gt;
</code></pre>
</li>
<li>
<p>创建并导航至新目录。</p>
<pre><code class="language-bash">mkdir /tmp/dcos &amp;&amp; cd /tmp/dcos
</code></pre>
</li>
<li>
<p>在 NGINX Docker 容器中下载 DC/OS 安装工具，其中 <code>&lt;bootstrap-ip&gt;</code> 和 <code>&lt;your_port&gt;</code> 在 <code>bootstrap_url</code>.中指定。</p>
<pre><code class="language-bash">curl -O http://&lt;bootstrap-ip&gt;:&lt;your_port&gt;/dcos_install.sh
</code></pre>
</li>
<li>
<p>运行此命令，在代理节点上安装 DC/OS。您必须将代理节点指定为 <a href="/dcosdocs/mesosphere/dcos/1.13/overview/concepts/#public">公共代理节点</a> 或 <a href="/dcosdocs/mesosphere/dcos/1.13/overview/concepts/#private">专用代理节点</a>。</p>
<ul>
<li>
<p>专用代理节点：</p>
<pre><code class="language-bash">sudo bash dcos_install.sh slave
</code></pre>
</li>
<li>
<p>公共代理节点：</p>
<pre><code class="language-bash">sudo bash dcos_install.sh slave_public
</code></pre>
</li>
</ul>
</li>
</ul>
<p><strong>注意：</strong> 如果遇到错误（例如在 journald 中的 <code>Time is marked as bad</code>、<code>adjtimex</code> 或 <code>Time not in sync</code>），请验证是否在所有节点都启用了网络时间协议 (NTP)。如需更多信息，请参阅 <a href="/dcosdocs/mesosphere/dcos/cn/1.13/installing/production/system-requirements/ports/">系统要求</a> 文档。</p>
</li>
<li>
<p>监视 Exhibitor 并等待其在  中聚合。<code>http://&lt;master-ip&gt;:8181/exhibitor/v1/ui/index.html</code>.</p>
 <p class="message--note"><strong>注意：</strong>此过程可能需要大约 10 分钟。在此期间，您将看到管理节点在 Exhibitor 控制台上可见并上线，并且最后会显示一个绿灯图标。</p>
</li>
</ol>
<p><img src="/dcosdocs/mesosphere/dcos/cn/1.13/img/chef-zk-status.png" alt="Exhibitor for ZooKeeper"></p>
<p>图 2. Exhibitor for ZooKeeper</p>
<p>当状态图标为绿色时，可以访问 DC/OS Web 界面。</p>
<ol start="6">
<li>
<p>在以下链接启动 DC/OS Web 界面：<code>http://&lt;master-node-public-ip&gt;/</code>如果无法启动，请查看 <a href="/dcosdocs/mesosphere/dcos/1.13/installing/production/uninstalling/">故障排除</a> 文档。</p>
 <p class="message--note"><strong>注意：</strong>单击<strong>登录到 DC/OS</strong> 后，浏览器可能会显示您的连接不安全的警告。这是因为 DC/OS 使用自签名证书。可以忽略该错误，然后单击以继续。</p>
</li>
<li>
<p>输入您的管理员用户名和密码。</p>
</li>
</ol>
<p><img src="/dcosdocs/mesosphere/dcos/cn/1.13/img/ui-installer-auth2.png" alt="Login screen"></p>
<p>图 3. 登录对话</p>
<p>成功了！现在将显示 UI 仪表板。</p>
<p><img src="/dcosdocs/mesosphere/dcos/cn/1.13/img/dashboard-ee-1-12.png" alt="UI dashboard"></p>
<p>图 4. DC/OS UI 仪表板</p>
<p class="message--note"><strong>注意：</strong>您也可以在生产时使用 <a href="/dcosdocs/mesosphere/dcos/1.13/installing/evaluation/">Universal 安装工具</a>在 AWS、Azure 或 GCP 上部署 DC/OS。</p>
<h3 id="enterprise-4"><a class="content__anchor" href="#enterprise-4" aria-hidden="true"><i data-feather="bookmark"></i></a>后续步骤：Enterprise 和开源用户</h3>
<p>下列链接提供了后续步骤的信息：</p>
<ul>
<li><a href="/dcosdocs/mesosphere/dcos/1.13/security/ent/users-groups/">分配用户角色</a>。</li>
<li><a href="/dcosdocs/mesosphere/dcos/cn/1.13/installing/production/system-requirements/">系统要求</a></li>
<li><a href="/dcosdocs/mesosphere/dcos/1.13/overview/concepts/#public">公共代理节点</a></li>
<li><a href="/dcosdocs/mesosphere/dcos/1.13/overview/concepts/#private">专用代理节点</a></li>
<li><a href="/dcosdocs/mesosphere/dcos/1.13/cli/install/">安装 DC/OS 命令行界面 (CLI)</a></li>
<li><a href="/dcosdocs/mesosphere/dcos/1.13/installing/production/deploying-dcos/node-cluster-health-check/">使用节点和群集运行状况检查</a></li>
<li><a href="/dcosdocs/mesosphere/dcos/1.13/installing/troubleshooting/">DC/OS 安装故障排除</a></li>
<li><a href="/dcosdocs/mesosphere/dcos/1.13/installing/production/uninstalling/">卸载 DC/OS</a></li>
</ul>
</article></div><aside class="content__sections"><div class="content__sections-list-container"><ul class="content__sections-list"><li class="content__sections-item content__sections-item--h1"><a href="#生产安装流程">生产安装流程</a></li><li class="content__sections-item content__sections-item--h2"><a href="#-2">前提条件</a></li><li class="content__sections-item content__sections-item--h1"><a href="#-3">配置您的群集</a></li><li class="content__sections-item content__sections-item--h1"><a href="#enterprise">存储许可证文件 Enterprise</a></li><li class="content__sections-item content__sections-item--h1"><a href="#ip">创建 IP 检测脚本</a></li><li class="content__sections-item content__sections-item--h1"><a href="#enterprise-2">创建故障域检测脚本 Enterprise</a></li><li class="content__sections-item content__sections-item--h1"><a href="#-4">创建配置文件</a></li><li class="content__sections-item content__sections-item--h2"><a href="#enterprise-3">设置超级用户密码 Enterprise</a></li><li class="content__sections-item content__sections-item--h2"><a href="#-5">创建配置</a></li><li class="content__sections-item content__sections-item--h2"><a href="#enterprise-enterprise">Enterprise 模板 Enterprise</a></li><li class="content__sections-item content__sections-item--h2"><a href="#open-source">开源模板 Open Source</a></li><li class="content__sections-item content__sections-item--h1"><a href="#dcos">安装 DC/OS</a></li></ul></div></aside></main></div></div><script src="/assets/js/jquery-3.2.1.js"></script><script src="/assets/js/clipboard.js"></script><script src="/assets/js/prism.js"></script><script src="/js/main.js"></script></body></html>