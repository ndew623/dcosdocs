<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width" initial-scale="1" user-scalable="no"><title>Managing Percona Server for MongoDB - D2iQ Docs</title><meta name="description" content="Managing Percona Server for MongoDB"><link rel="apple-touch-icon" sizes="180x180" href="/dcosdocs/assets/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/dcosdocs/assets/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/dcosdocs/assets/favicon-16x16.png"><link rel="stylesheet" type="text/css" href="/dcosdocs/css/styles.css"><link rel="search" type="application/opensearchdescription+xml" href="/dcosdocs/assets/opensearch.xml" title="Search"><link href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,500,500i,700,700i" rel="stylesheet"><script src="https://unpkg.com/feather-icons/dist/feather.min.js"></script><script>window.analytics||(window.analytics=[]),window.analytics.methods=["identify","track","trackLink","trackForm","trackClick","trackSubmit","page","pageview","ab","alias","ready","group","on","once","off"],window.analytics.factory=function(t){return function(){var a=Array.prototype.slice.call(arguments);return a.unshift(t),window.analytics.push(a),window.analytics}};for(var i=0;i<window.analytics.methods.length;i++){var method=window.analytics.methods[i];window.analytics[method]=window.analytics.factory(method)}window.analytics.load=function(t){var a=document.createElement("script");a.type="text/javascript",a.async=!0,a.src=("https:"===document.location.protocol?"https://":"http://")+"d2dq2ahtl5zl1z.cloudfront.net/analytics.js/v1/"+t+"/analytics.min.js";var n=document.getElementsByTagName("script")[0];n.parentNode.insertBefore(a,n)},window.analytics.SNIPPET_VERSION="2.0.8",
window.analytics.load("7sgtwqvuai");
window.analytics.page();</script><noscript><iframe src="//www.googletagmanager.com/ns.html?id=GTM-PBJ84KX" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript><script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src='//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
})(window,document,'script','dataLayer','GTM-PBJ84KX');</script></head><body><div class="layout"><header class="header"><a class="header__drawer"><i class="header__icon" data-feather="menu"></i></a><a class="header__logo" href="/"><img class="header__logo--mobile" src="/dcosdocs/assets/D2iQ_Logotype_Color_Positive_Documentation.svg" alt="D2IQ"><img class="header__logo--desktop" src="/dcosdocs/assets/D2iQ_Logotype_Color_Positive_Documentation.svg" alt="D2IQ"></a><div class="header__main"><div class="header__dropdown"><img class="header__dropdown-icon" src="/dcosdocs/assets/D2IQ_Logotype_Color_Positive.png" alt="D2iQ"><strong>Percona Server Mongodb Documentation</strong><i data-feather="chevron-down"></i></div><nav class="header__menu"><ul class="header__menu-list"><li class="header__menu-item"><a href="https://support.d2iq.com">Support</a></li></ul></nav></div><div class="chooser" id="spherer"><div class="chooser-current"><a class="chooser-title">Mesosphere</a><svg class="chooser-svg" id="spherer-svg"><path class="pointer" d="m 13,6 -5,5 -5,-5 z" fill="#858585"></path></svg></div><ul class="chooser-list" id="spherer-list"><li class="chooser-list-item"><a href="/mesosphere/dcos">DC/OS</a></li><li class="chooser-list-item"><a href="/dcosdocs/mesosphere/dcos/services">DC/OS Services</a></li></ul></div><div class="chooser" id="ks"><div class="chooser-current"><a class="chooser-title">DKP</a><svg class="chooser-svg" id="kspherer-svg"><path class="pointer" d="m 13,6 -5,5 -5,-5 z" fill="#858585"></path></svg></div><ul class="chooser-list" id="kspherer-list"><li class="chooser-list-item"><a href="/dkp/konvoy">Konvoy</a></li><li class="chooser-list-item"><a href="/dkp/konvoy/partner-solutions">Partner Solutions</a></li><li class="chooser-list-item"><a href="/dkp/kommander">Kommander</a></li><li class="chooser-list-item"><a href="/dkp/dispatch">Dispatch</a></li><li class="chooser-list-item"><a href="/dkp/kaptain">Kaptain</a></li><li class="chooser-list-item"><a href="/dkp/conductor">Conductor</a></li></ul></div><div class="chooser" id="localizer"><div class="chooser-current"><a class="chooser-title">English</a><svg class="chooser-svg" id="localizer-svg"><path class="pointer" d="m 13,6 -5,5 -5,-5 z" fill="#858585"></path></svg></div><ul class="chooser-list" id="localizer-list"><li class="chooser-list-item"><a href="/dcosdocs/mesosphere/dcos/cn/services">中文 (简体)</a></li></ul></div><section class="header__search" role="search"><form class="header__search-form" action="/search/"><input class="header__search-input" id="header-search-input" tabindex="1" type="text" name="q" placeholder="Search"><input type="hidden" name="hFR[scope][0]" value="DC/OS Services"><label class="header__search-label" for="header-search-input"><i class="header__icon" data-feather="search"></i></label></form></section></header><div class="header-dropdown"><ul class="header-dropdown__list"><li class="header-dropdown__top-item"><div>DKP</div></li><li class="header-dropdown__item"><a href="/dkp/konvoy">Konvoy</a></li><li class="header-dropdown__item"><a href="/dkp/konvoy/partner-solutions">Partner Solutions</a></li><li class="header-dropdown__item"><a href="/dkp/kommander">Kommander</a></li><li class="header-dropdown__item"><a href="/dkp/dispatch">Dispatch</a></li><li class="header-dropdown__item"><a href="/dkp/kaptain">Kaptain</a></li><li class="header-dropdown__item"><a href="/dkp/conductor">Conductor</a></li><li class="header-dropdown__top-item"><div>Mesosphere</div></li><li class="header-dropdown__item header-dropdown__item--active"><a href="/mesosphere/dcos">DC/OS</a></li><li class="header-dropdown__item header-dropdown__item--active"><a href="/dcosdocs/mesosphere/dcos/services">DC/OS Services</a></li><li class="header-dropdown__item"><a href="https://support.d2iq.com">Support</a></li></ul></div><div class="layout__sidebar layout__drawer"><section class="sidebar"><header class="sidebar__header"><div class="sidebar__dropdown"><ul><li><a href="/dcosdocs/mesosphere/dcos/services/percona-server-mongodb/0.4.2-3.6.10/managing">Percona-Server-MongoDB 0.4.2-3.6.10</a></li><li><a href="/dcosdocs/mesosphere/dcos/services/percona-server-mongodb/0.4.1-3.6.8/managing">Percona-Server-MongoDB 0.4.1-3.6.8</a></li><li><a href="/dcosdocs/mesosphere/dcos/services/percona-server-mongodb/0.4.0-3.6.6/managing">Percona-Server-MongoDB 0.4.0-3.6.6</a></li></ul><div class="toggle"><p><span class="title">Percona Server Mongodb</span><span class="version"> 0.4.2-3.6.10</span></p><i data-feather="chevron-down"></i></div></div></header><nav class="sidebar_nav" role="navigation"><ul><li><a class="d0" href="/dcosdocs/mesosphere/dcos/services/percona-server-mongodb/0.4.2-3.6.10/release-notes/">Release Notes</a></li><li><a class="d0" href="/dcosdocs/mesosphere/dcos/services/percona-server-mongodb/0.4.2-3.6.10/getting-started/">Getting Started</a></li><li class="active active-on"><a class="d0" href="/dcosdocs/mesosphere/dcos/services/percona-server-mongodb/0.4.2-3.6.10/managing/">Operations</a></li><li><a class="d0" href="/dcosdocs/mesosphere/dcos/services/percona-server-mongodb/0.4.2-3.6.10/quick-start/">Quick Start</a></li><li><a class="d0" href="/dcosdocs/mesosphere/dcos/services/percona-server-mongodb/0.4.2-3.6.10/connecting-clients/">Connecting Clients</a></li><li><a class="d0" href="/dcosdocs/mesosphere/dcos/services/percona-server-mongodb/0.4.2-3.6.10/deploy-best-practice/">Deployment Best Practices</a></li><li><a class="d0" href="/dcosdocs/mesosphere/dcos/services/percona-server-mongodb/0.4.2-3.6.10/mongodb-administration/">Administration</a></li><li><a class="d0" href="/dcosdocs/mesosphere/dcos/services/percona-server-mongodb/0.4.2-3.6.10/disaster-recovery/">Disaster Recovery</a></li><li><a class="d0" href="/dcosdocs/mesosphere/dcos/services/percona-server-mongodb/0.4.2-3.6.10/uninstall/">Uninstall</a></li><li><a class="d0" href="/dcosdocs/mesosphere/dcos/services/percona-server-mongodb/0.4.2-3.6.10/known-issues/">Known Issues</a></li><li><a class="d0" href="/dcosdocs/mesosphere/dcos/services/percona-server-mongodb/0.4.2-3.6.10/troubleshooting/">Troubleshooting</a></li><li><a class="d0" href="/dcosdocs/mesosphere/dcos/services/percona-server-mongodb/0.4.2-3.6.10/limitations/">Limitations</a></li><li><a class="d0" href="/dcosdocs/mesosphere/dcos/services/percona-server-mongodb/0.4.2-3.6.10/support/">Supported Versions</a></li><li><a class="d0" href="/dcosdocs/mesosphere/dcos/services/percona-server-mongodb/0.4.2-3.6.10/terms-of-use/">Terms of Use</a></li><li><a class="d0" href="/dcosdocs/mesosphere/dcos/services/percona-server-mongodb/0.4.2-3.6.10/api-reference/">API Reference</a></li></ul></nav><footer class="sidebar__footer"><div class="sidebar__footer-links"><a href="https://d2iq.com/terms/">Terms of Service</a><a href="https://d2iq.com/privacy/">Privacy Policy</a></div><a class="sidebar__footer-copyright" href="https://d2iq.com/">&copy; 2021 D2iQ, Inc. All rights reserved.</a></footer></section></div><div class="layout__content" role="main"><main class="content"><div class="content__container content__container--with-sections"><div class="content__header"><div class="content__header__row"><h1 class="content__header-title">Managing Percona Server for MongoDB</h1></div><h4 class="content__header-description">Managing Percona Server for MongoDB</h4><div class="actions"><ul class="actions__list"><li class="actions__item"><button class="actions__link" onclick="javascript:window.print()"><i class="actions__icon" data-feather="printer"></i><span class="actions__text">Print</span></button></li><li class="actions__item"><a class="actions__link" href="https://github.com/mesosphere/dcos-docs-site/tree/main/pages/dcosdocs/mesosphere/dcos/services/percona-server-mongodb/0.4.2-3.6.10/managing/index.md" target="_blank"><i class="actions__icon" data-feather="github"></i><span class="actions__text">Contribute</span></a></li><li class="actions__item"><a class="actions__link" href="https://jira.d2iq.com/secure/CreateIssueDetails!init.jspa?pid=14105&amp;issuetype=1&amp;summary=Feedback+for+Managing+Percona+Server+for+MongoDB&amp;description=Source:%20https://docs.d2iq.com/dcosdocs/mesosphere/dcos/services/percona-server-mongodb/0.4.2-3.6.10/managing&amp;labels=documentation&amp;labels=needs_triage&amp;components=19804&amp;priority=3&amp;customfield_12300=44" target="_blank"><i class="actions__icon" data-feather="message-square"></i><span class="actions__text">Feedback</span></a></li></ul></div></div><article class="content__article"><h1 id="updating-your-configuration"><a class="content__anchor" href="#updating-your-configuration" aria-hidden="true"><i data-feather="bookmark"></i></a>Updating your configuration</h1>
<p>You can make changes to the Percona Server for MongoDB service after it has been launched. Configuration management is handled by the scheduler process, which in turn handles deploying Percona Server for MongoDB itself.</p>
<p>After making a change, the scheduler will be restarted, and it will automatically deploy any detected changes to the service, one node at a time. For example, a given change will first be applied to <code>mongo-rs-0</code>, then <code>mongo-rs-1</code>, and so on. Nodes are configured with a “Readiness check” to ensure that the underlying service appears to be in a healthy state before continuing with applying a given change to the next node in the sequence. However, this basic check is not foolproof and reasonable care should be taken to ensure that a given configuration change will not negatively affect the behavior of the service.</p>
<p>Some changes, such as decreasing the number of nodes or changing volume requirements, are not supported after initial deployment. See <a href="#limitations">Limitations</a>.</p>
<p>The instructions below describe how to update the configuration for a running DC/OS service.</p>
<h3 id="enterprise-dcos-110-and-later"><a class="content__anchor" href="#enterprise-dcos-110-and-later" aria-hidden="true"><i data-feather="bookmark"></i></a>Enterprise DC/OS 1.10 and later</h3>
<p>Enterprise DC/OS 1.10 introduced a convenient command line option that allows for easier updates to a service’s configuration, as well as allowing users to inspect the status of an update, to pause and resume updates, and to restart or complete steps if necessary.</p>
<h4 id="prerequisites"><a class="content__anchor" href="#prerequisites" aria-hidden="true"><i data-feather="bookmark"></i></a>Prerequisites</h4>
<ul>
<li>Enterprise DC/OS 1.10 or later</li>
<li>Service with a version greater than 2.0.0-x</li>
<li><a href="/dcosdocs/mesosphere/dcos/latest/cli/install/">The DC/OS CLI</a> installed and available</li>
<li>The service’s subcommand available and installed on your local machine
<ul>
<li>You can install just the subcommand CLI by running <code>dcos package install --cli percona-server-mongodb</code>.</li>
<li>If you are running an older version of the subcommand CLI that does not have the <code>update</code> command, uninstall and reinstall your CLI.<pre><code class="language-shell">dcos package uninstall --cli percona-server-mongodb
dcos package install --cli percona-server-mongodb
</code></pre>
</li>
</ul>
</li>
</ul>
<h4 id="preparing-configuration"><a class="content__anchor" href="#preparing-configuration" aria-hidden="true"><i data-feather="bookmark"></i></a>Preparing configuration</h4>
<p>If you installed this service with Enterprise DC/OS 1.10 or later, you can fetch the full configuration of a service (including any default values that were applied during installation). For example:</p>
<pre><code class="language-shell">dcos percona-server-mongodb describe &gt; options.json
</code></pre>
<p>Make any configuration changes to this <code>options.json</code> file.</p>
<p>If you installed this service with a prior version of DC/OS, this configuration will not have been persisted by the DC/OS package manager. You can instead use the <code>options.json</code> file that was used when <a href="#initial-service-configuration">installing the service</a>.</p>
<p class="message--important"><strong>IMPORTANT: </strong> You must specify all configuration values in the <tt>options.json</tt> file when performing a configuration update. Any unspecified values will be reverted to the default values specified by the DC/OS service. See the <tt>Recreating options.json</tt> section below for information on recovering these values.</pd> 
<h5 id="recreating-optionsjson-optional"><a class="content__anchor" href="#recreating-optionsjson-optional" aria-hidden="true"><i data-feather="bookmark"></i></a>Recreating <code>options.json</code> (optional)</h5>
<p>If the <code>options.json</code> from when the service was last installed or updated is not available, you will need to manually recreate it using the following steps.</p>
<ol>
<li>
<p>Fetch the default application’s environment, current application’s environment, and the actual template that maps config values to the environment:</p>
<ol>
<li>Ensure you have <a href="https://stedolan.github.io/jq/">jq</a> installed.</li>
<li>Set the service name that you are using, for example:<pre><code class="language-shell">SERVICE_NAME=percona-server-mongodb
</code></pre>
</li>
<li>Get the version of the package that is currently installed:<pre><code class="language-shell">PACKAGE_VERSION=$(dcos package list | grep $SERVICE_NAME | awk '{print $2}')
</code></pre>
</li>
<li>Fetch and save the environment variables that have been set for the service:<pre><code class="language-shell">dcos marathon app show $SERVICE_NAME | jq .env &gt; current_env.json
</code></pre>
</li>
<li>To identify those values that are custom, we will get the default environment variables for this version of the service:<pre><code class="language-shell">dcos package describe --package-version=$PACKAGE_VERSION --render --app $SERVICE_NAME | jq .env &gt; default_env.json
</code></pre>
</li>
<li>We will also get the entire application template:<pre><code class="language-shell">dcos package describe $SERVICE_NAME --app &gt; marathon.json.mustache
</code></pre>
</li>
</ol>
</li>
<li>
<p>Recreate the <code>options.json</code>.</p>
<ol>
<li>Use JQ and <code>diff</code> to compare the two:<pre><code class="language-shell">diff &lt;(jq -S . default_env.json) &lt;(jq -S . current_env.json)
</code></pre>
</li>
<li>Now compare these values to the values contained in the <code>env</code> section in application template:<pre><code class="language-shell">less marathon.json.mustache
</code></pre>
</li>
<li>Use the variable names (such as, ``) to create a new <code>options.json</code> file as described in <a href="#initial-service-configuration">Initial service configuration</a>.</li>
</ol>
</li>
</ol>
<h4 id="starting-the-update"><a class="content__anchor" href="#starting-the-update" aria-hidden="true"><i data-feather="bookmark"></i></a>Starting the update</h4>
<p>Once you are ready to begin, initiate an update using the DC/OS CLI, passing in the updated <code>options.json</code> file:</p>
<pre><code class="language-shell">dcos percona-server-mongodb update start --options=options.json
</code></pre>
<p>You will receive an acknowledgement message and the DC/OS package manager will restart the Scheduler in Marathon.</p>
<p>See <a href="#advanced-update-actions">Advanced update actions</a> for commands you can use to inspect and manipulate an update after it has started.</p>
<h3 id="open-source-dcos"><a class="content__anchor" href="#open-source-dcos" aria-hidden="true"><i data-feather="bookmark"></i></a>Open Source DC/OS</h3>
<p>If you do not have Enterprise DC/OS 1.10 or later, the CLI commands above are not available. For Open Source DC/OS of any version you can perform changes from the DC/OS web interface.</p>
<p>To make configuration changes via scheduler environment updates, perform the following steps:</p>
<ol>
<li>Visit <code>&lt;dcos-url&gt;</code> to access the DC/OS web interface.</li>
<li>Navigate to <code>Services</code> and click on the service to be configured (default <code>percona-server-mongodb</code>).</li>
<li>Click <code>Edit</code> in the upper right.</li>
<li>Navigate to <code>Environment</code> (or <code>Environment variables</code>) and search for the option to be updated.</li>
<li>Update the option value and click <code>Review and run</code> (or <code>Deploy changes</code>).</li>
<li>The Scheduler process will be restarted with the new configuration and will validate any detected changes.</li>
<li>If the detected changes pass validation, the relaunched Scheduler will deploy the changes by sequentially relaunching affected tasks as described above.</li>
</ol>
<p>To see a full listing of available options, run <code>dcos package describe --config percona-server-mongodb</code> in the CLI, or browse the DC/OS Percona Server for MongoDB Service install dialog in the DC/OS Dashboard.</p>
<p><a name="adding-a-node"></a></p>
<h3 id="adding-a-node"><a class="content__anchor" href="#adding-a-node" aria-hidden="true"><i data-feather="bookmark"></i></a>Adding a Node</h3>
<p>The service deploys 3 nodes by default, as 3 nodes is the minimum node requirement for a Highly-Available <a href="https://docs.mongodb.com/manual/replication/">MongoDB Replica Set</a>.</p>
<p class="message--note"><strong>NOTE: </strong>Only 1 (not recommended), 3, 5 or 7 nodes are recommended and supported.</p> 
<p>You can customize this value at initial deployment or after the cluster is already running. Shrinking the count is not supported. Modify the <code>NODE_COUNT</code> environment variable to update the node count. If you decrease this value, the scheduler will prevent the configuration change until it is reverted back to its original value or larger.</p>
<p><a name="resizing-a-node"></a></p>
<h3 id="resizing-a-node"><a class="content__anchor" href="#resizing-a-node" aria-hidden="true"><i data-feather="bookmark"></i></a>Resizing a Node</h3>
<p>The CPU and Memory requirements of each node can be increased or decreased as follows:</p>
<ul>
<li>CPU (1.0 = 1 core): <code>NODE_CPUS</code></li>
<li>Memory (in MB): <code>NODE_MEM</code></li>
</ul>
<p class="message--note"><strong>NOTE: </strong>Volume requirements (type and/or size) cannot be changed after initial deployment.</p>
<p><a name="updating-placement-constraints"></a></p>
<h3 id="updating-placement-constraints"><a class="content__anchor" href="#updating-placement-constraints" aria-hidden="true"><i data-feather="bookmark"></i></a>Updating Placement Constraints</h3>
<p>Placement constraints may be updated after initial deployment using the following procedure. See <a href="#service-settings">Service Settings</a> above for more information on placement constraints. Let’s say we have the following deployment of our nodes</p>
<ul>
<li>Placement constraint of: <code>hostname:LIKE:10.0.10.3|10.0.10.8|10.0.10.26|10.0.10.28|10.0.10.84</code></li>
<li>Tasks:</li>
</ul>
<pre><code>10.0.10.3: mongo-rs-0
10.0.10.8: mongo-rs-1
10.0.10.26: mongo-rs-2
10.0.10.28: empty
10.0.10.84: empty
</code></pre>
<p><code>10.0.10.8</code> is being decommissioned and we should move away from it.</p>
<ol>
<li>
<p>Remove the decommissioned IP and add a new IP to the placement rule whitelist by editing <code>NODE_PLACEMENT</code>:</p>
<pre><code>hostname:LIKE:10.0.10.3|10.0.10.26|10.0.10.28|10.0.10.84|10.0.10.123
</code></pre>
</li>
<li>
<p>Redeploy <code>mongo-rs-1</code> from the decommissioned node to somewhere within the new whitelist:</p>
<pre><code>dcos percona-server-mongodb pod replace mongo-rs-1
</code></pre>
</li>
<li>
<p>Wait for <code>mongo-rs-1</code> to be up and healthy before continuing with any other replacement operations.</p>
</li>
</ol>
<p><a name="restarting-a-node"></a></p>
<h2 id="restarting-a-node"><a class="content__anchor" href="#restarting-a-node" aria-hidden="true"><i data-feather="bookmark"></i></a>Restarting a Node</h2>
<p>This operation will restart a node, while keeping it at its current location and with its current persistent volume data. This may be thought of as similar to restarting a system process, but it deletes any data that is not on a persistent volume.</p>
<p>Replace <code>mongo-rs-&lt;NUM&gt;</code> with a variable such as <code>mongo-rs-2</code>.</p>
<pre><code>dcos percona-server-mongodb pod restart mongo-rs-&lt;NUM&gt;
</code></pre>
<p><a name="replacing-a-node"></a></p>
<h2 id="replacing-a-node"><a class="content__anchor" href="#replacing-a-node" aria-hidden="true"><i data-feather="bookmark"></i></a>Replacing a Node</h2>
<p>This operation will move a node to a new system and will discard the persistent volumes at the prior system to be rebuilt at the new system. Perform this operation if a given system is about to be offlined or has already been offlined.</p>
<p class="message--important"><strong>IMPORTANT: </strong>Nodes are not moved automatically. You must perform the following steps manually to move nodes to new systems. You can automate node replacement according to your own preferences.</p>
<p>For data safety, ensure that there is at least one healthy node in the replica set and a recent successful backup of MongoDB data. Ensure there is a <a href="https://docs.mongodb.com/manual/reference/write-concern/#writeconcern._dq_majority_dq_">“majority” in the MongoDB Replica Set</a> if you do not want the replica set to become read-only during the node replacement.</p>
<ol>
<li>Connect to the node and check if the node is the <a href="https://docs.mongodb.com/manual/core/replica-set-primary/">Replica Set Primary</a>. If the <code>rs.isMaster().ismaster</code> command returns a value of true`, the node is the PRIMARY member.<pre><code class="language-shell">$ mongo mongodb://useradmin:useradminpassword@mongo-rs-&lt;NUM&gt;-mongod.percona-server-mongodb.autoip.dcos.thisdcos.directory:27017/admin?replicaSet=rs
&gt; rs.isMaster().ismaster
true
</code></pre>
</li>
<li>If the node is the PRIMARY member, run a <a href="https://docs.mongodb.com/manual/reference/method/rs.stepDown/">Replica Set Step Down</a>. Skip this step if you received <code>false</code> from the last step.<pre><code class="language-shell">$ mongo mongodb://useradmin:useradminpassword@mongo-rs-&lt;NUM&gt;-mongod.percona-server-mongodb.autoip.dcos.thisdcos.directory:27017/admin?replicaSet=rs
&gt; rs.stepDown()
2018-04-03T13:58:29.166+0200 E QUERY    [thread1] Error: error doing query: failed: network error while attempting to run command 'replSetStepDown' on host '10.2.3.1:27017'  :
DB.prototype.runCommand@src/mongo/shell/db.js:132:1
DB.prototype.adminCommand@src/mongo/shell/db.js:150:16
rs.stepDown@src/mongo/shell/utils.js:1274:12
@(shell):1:1
2018-04-03T13:58:29.167+0200 I NETWORK  [thread1] trying reconnect to 10.2.3.1:27017 (10.2.3.1) failed
2018-04-03T13:58:29.168+0200 I NETWORK  [thread1] reconnect 10.2.3.1:27017 (10.2.3.1) ok
test1:SECONDARY&gt;
</code></pre>
</li>
<li>Run <code>dcos percona-server-mongodb pod replace mongo-rs-&lt;NUM&gt;</code> to halt the current instance with id <code>&lt;NUM&gt;</code> (if still running) and launch a new instance elsewhere.</li>
</ol>
<p>For example, let’s say <code>mongo-rs-2</code>'s host system has died and <code>mongo-rs-2</code> needs to be moved.</p>
<ol>
<li>Connect to the node and check if the node is the <a href="https://docs.mongodb.com/manual/core/replica-set-primary/">Replica Set Primary</a>. If the <code>rs.isMaster().ismaster</code> command returns a value of <code>true</code>, the node is the PRIMARY member.<pre><code class="language-shell">$ mongo mongodb://useradmin:useradminpassword@mongo-rs-2-mongod.percona-server-mongodb.autoip.dcos.thisdcos.directory:27017/admin?replicaSet=rs
&gt; rs.isMaster().ismaster
true
</code></pre>
</li>
<li>If the node is the PRIMARY member, run a <a href="https://docs.mongodb.com/manual/reference/method/rs.stepDown/">Replica Set Step Down</a>. Skip this step if you received a value of <code>false</code> from the last step.<pre><code class="language-shell">$ mongo mongodb://useradmin:useradminpassword@mongo-rs-&lt;NUM&gt;-mongod.percona-server-mongodb.autoip.dcos.thisdcos.directory:27017/admin?replicaSet=rs
&gt; rs.stepDown()
2018-04-03T13:58:29.166+0200 E QUERY    [thread1] Error: error doing query: failed: network error while attempting to run command 'replSetStepDown' on host '10.2.3.1:27017'  :
DB.prototype.runCommand@src/mongo/shell/db.js:132:1
DB.prototype.adminCommand@src/mongo/shell/db.js:150:16
rs.stepDown@src/mongo/shell/utils.js:1274:12
@(shell):1:1
2018-04-03T13:58:29.167+0200 I NETWORK  [thread1] trying reconnect to 10.2.3.1:27017 (10.2.3.1) failed
2018-04-03T13:58:29.168+0200 I NETWORK  [thread1] reconnect 10.2.3.1:27017 (10.2.3.1) ok
test1:SECONDARY&gt;
</code></pre>
</li>
<li>Now that the node has been decommissioned, start <code>mongo-rs-2</code> at a new location in the cluster.<pre><code class="language-shell">dcos percona-server-mongodb pod replace mongo-rs-2
</code></pre>
</li>
</ol>
<p><a name="upgrading"></a></p>
<h2 id="upgrading-service-version"><a class="content__anchor" href="#upgrading-service-version" aria-hidden="true"><i data-feather="bookmark"></i></a>Upgrading Service Version</h2>
<p>The instructions below show how to safely update one version of <code>percona-server-mongodb</code> to the next.</p>
<h5 id="viewing-available-versions"><a class="content__anchor" href="#viewing-available-versions" aria-hidden="true"><i data-feather="bookmark"></i></a>Viewing available versions</h5>
<p>The <code>update package-versions</code> command allows you to view the versions of a service that you can upgrade or downgrade to. These are specified by the service maintainer and depend on the semantics of the service (for example, whether or not upgrades are a reversal).</p>
<p>For example, run:</p>
<pre><code class="language-shell">dcos percona-server-mongodb update package-versions
</code></pre>
<h2 id="upgrading-or-downgrading-a-service"><a class="content__anchor" href="#upgrading-or-downgrading-a-service" aria-hidden="true"><i data-feather="bookmark"></i></a>Upgrading or downgrading a service</h2>
<ol>
<li>
<p>Before updating the service itself, update its CLI subcommand to the new version:</p>
<pre><code class="language-shell">dcos package uninstall --cli percona-server-mongodb
dcos package install --cli percona-server-mongodb -package-version=&quot;0.4.2-3.6.10&quot;
</code></pre>
</li>
<li>
<p>Once the CLI subcommand has been updated, call the update start command, passing in the version. For example, to update DC/OS Percona Server for MongoDB Service to version <code>0.4.2-3.6.10</code>:</p>
<pre><code class="language-shell">dcos percona-server-mongodb update start --package-version=&quot;0.4.2-3.6.10&quot;
</code></pre>
</li>
</ol>
<p>If you are missing mandatory configuration parameters, the <code>update</code> command will return an error. To supply missing values, you can also provide an <code>options.json</code> file (see <a href="#updating-configuration">Updating configuration</a>):</p>
<pre><code>```shell
dcos percona-server-mongodb update start --options=options.json --package-version=&quot;0.4.2-3.6.10&quot;
```
</code></pre>
<p>See <a href="#advanced-update-actions">Advanced update actions</a> for commands you can use to inspect and manipulate an update after it has started.</p>
<h2 id="advanced-update-actions"><a class="content__anchor" href="#advanced-update-actions" aria-hidden="true"><i data-feather="bookmark"></i></a>Advanced update actions</h2>
<p>The following sections describe advanced commands that be used to interact with an update in progress.</p>
<h3 id="monitoring-the-update"><a class="content__anchor" href="#monitoring-the-update" aria-hidden="true"><i data-feather="bookmark"></i></a>Monitoring the update</h3>
<p>Once the Scheduler has been restarted, it will begin a new deployment plan as individual pods are restarted with the new configuration. Depending on the high availability characteristics of the service being updated, you may experience a service disruption.</p>
<p>You can query the status of the update as follows:</p>
<pre><code class="language-shell">dcos percona-server-mongodb update status
</code></pre>
<p>If the Scheduler is still restarting, DC/OS will not be able to route to it and this command will return an error message. Wait a short while and try again. You can also go to the Services tab of the DC/OS web interface to check the status of the restart.</p>
<h3 id="pause"><a class="content__anchor" href="#pause" aria-hidden="true"><i data-feather="bookmark"></i></a>Pause</h3>
<p>To pause an ongoing update, issue a pause command:</p>
<pre><code class="language-shell">dcos percona-server-mongodb update pause
</code></pre>
<p>You will receive an error message if the plan has already completed or has been paused. Once completed, the plan will enter the <code>WAITING</code> state.</p>
<h3 id="resume"><a class="content__anchor" href="#resume" aria-hidden="true"><i data-feather="bookmark"></i></a>Resume</h3>
<p>If a plan is in a <code>WAITING</code> state, as a result of being paused or reaching a breakpoint that requires manual operator verification, you can use the <code>resume</code> command to continue the plan:</p>
<pre><code class="language-shell">dcos percona-server-mongodb update resume
</code></pre>
<p>You will receive an error message if you attempt to <code>resume</code> a plan that is already in progress or has already completed.</p>
<h3 id="force-complete"><a class="content__anchor" href="#force-complete" aria-hidden="true"><i data-feather="bookmark"></i></a>Force Complete</h3>
<p>In order to manually “complete” a step (such that the Scheduler stops attempting to launch a task), you can issue a <code>force-complete</code> command. This will instruct to Scheduler to mark a specific step within a phase as complete. You need to specify both the phase and the step, for example:</p>
<pre><code class="language-shell">dcos percona-server-mongodb update force-complete service-phase service-0:[node]
</code></pre>
<h3 id="force-restart"><a class="content__anchor" href="#force-restart" aria-hidden="true"><i data-feather="bookmark"></i></a>Force Restart</h3>
<p>Similar to force complete, you can also force a restart. This can either be done for an entire plan, a phase, or just for a specific step.</p>
<p>To restart the entire plan:</p>
<pre><code class="language-shell">dcos percona-server-mongodb update force-restart
</code></pre>
<p>Or for all steps in a single phase:</p>
<pre><code class="language-shell">dcos percona-server-mongodb update force-restart service-phase
</code></pre>
<p>Or for a specific step within a specific phase:</p>
<pre><code class="language-shell">dcos percona-server-mongodb update force-restart service-phase service-0:[node]
</code></pre>
</article></div><aside class="content__sections"><div class="content__sections-list-container"><ul class="content__sections-list"><li class="content__sections-item content__sections-item--h1"><a href="#updating-your-configuration">Updating your configuration</a></li><li class="content__sections-item content__sections-item--h2"><a href="#restarting-a-node">Restarting a Node</a></li><li class="content__sections-item content__sections-item--h2"><a href="#replacing-a-node">Replacing a Node</a></li><li class="content__sections-item content__sections-item--h2"><a href="#upgrading-service-version">Upgrading Service Version</a></li><li class="content__sections-item content__sections-item--h2"><a href="#upgrading-or-downgrading-a-service">Upgrading or downgrading a service</a></li><li class="content__sections-item content__sections-item--h2"><a href="#advanced-update-actions">Advanced update actions</a></li></ul></div></aside></main></div></div><script src="/dcosdocs/assets/js/jquery-3.2.1.js"></script><script src="/dcosdocs/assets/js/clipboard.js"></script><script src="/dcosdocs/assets/js/prism.js"></script><script src="/js/main.js"></script></body></html>