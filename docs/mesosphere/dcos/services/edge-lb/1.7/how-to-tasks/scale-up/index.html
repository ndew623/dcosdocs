<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width" initial-scale="1" user-scalable="no"><title>Scaling load-balancer instances - D2iQ Docs</title><meta name="description" content="How to scale up and scale down load balancer instances"><link rel="apple-touch-icon" sizes="180x180" href="/assets/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/favicon-16x16.png"><link rel="stylesheet" type="text/css" href="/css/styles.css"><link rel="search" type="application/opensearchdescription+xml" href="/assets/opensearch.xml" title="Search"><link href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,500,500i,700,700i" rel="stylesheet"><script src="https://unpkg.com/feather-icons/dist/feather.min.js"></script><script>window.analytics||(window.analytics=[]),window.analytics.methods=["identify","track","trackLink","trackForm","trackClick","trackSubmit","page","pageview","ab","alias","ready","group","on","once","off"],window.analytics.factory=function(t){return function(){var a=Array.prototype.slice.call(arguments);return a.unshift(t),window.analytics.push(a),window.analytics}};for(var i=0;i<window.analytics.methods.length;i++){var method=window.analytics.methods[i];window.analytics[method]=window.analytics.factory(method)}window.analytics.load=function(t){var a=document.createElement("script");a.type="text/javascript",a.async=!0,a.src=("https:"===document.location.protocol?"https://":"http://")+"d2dq2ahtl5zl1z.cloudfront.net/analytics.js/v1/"+t+"/analytics.min.js";var n=document.getElementsByTagName("script")[0];n.parentNode.insertBefore(a,n)},window.analytics.SNIPPET_VERSION="2.0.8",
window.analytics.load("7sgtwqvuai");
window.analytics.page();</script><noscript><iframe src="//www.googletagmanager.com/ns.html?id=GTM-PBJ84KX" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript><script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src='//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
})(window,document,'script','dataLayer','GTM-PBJ84KX');</script></head><body><div class="layout"><header class="header"><a class="header__drawer"><i class="header__icon" data-feather="menu"></i></a><a class="header__logo" href="/"><img class="header__logo--mobile" src="/assets/D2iQ_Logotype_Color_Positive_Documentation.svg" alt="D2IQ"><img class="header__logo--desktop" src="/assets/D2iQ_Logotype_Color_Positive_Documentation.svg" alt="D2IQ"></a><div class="header__main"><div class="header__dropdown"><img class="header__dropdown-icon" src="/assets/D2IQ_Logotype_Color_Positive.png" alt="D2iQ"><strong>Edge Lb Documentation</strong><i data-feather="chevron-down"></i></div><nav class="header__menu"><ul class="header__menu-list"><li class="header__menu-item"><a href="https://support.d2iq.com">Support</a></li></ul></nav></div><div class="chooser" id="spherer"><div class="chooser-current"><a class="chooser-title">Mesosphere</a><svg class="chooser-svg" id="spherer-svg"><path class="pointer" d="m 13,6 -5,5 -5,-5 z" fill="#858585"></path></svg></div><ul class="chooser-list" id="spherer-list"><li class="chooser-list-item"><a href="/mesosphere/dcos">DC/OS</a></li><li class="chooser-list-item"><a href="/dcosdocs/mesosphere/dcos/services">DC/OS Services</a></li></ul></div><div class="chooser" id="ks"><div class="chooser-current"><a class="chooser-title">DKP</a><svg class="chooser-svg" id="kspherer-svg"><path class="pointer" d="m 13,6 -5,5 -5,-5 z" fill="#858585"></path></svg></div><ul class="chooser-list" id="kspherer-list"><li class="chooser-list-item"><a href="/dkp/konvoy">Konvoy</a></li><li class="chooser-list-item"><a href="/dkp/konvoy/partner-solutions">Partner Solutions</a></li><li class="chooser-list-item"><a href="/dkp/kommander">Kommander</a></li><li class="chooser-list-item"><a href="/dkp/dispatch">Dispatch</a></li><li class="chooser-list-item"><a href="/dkp/kaptain">Kaptain</a></li><li class="chooser-list-item"><a href="/dkp/conductor">Conductor</a></li></ul></div><div class="chooser" id="localizer"><div class="chooser-current"><a class="chooser-title">English</a><svg class="chooser-svg" id="localizer-svg"><path class="pointer" d="m 13,6 -5,5 -5,-5 z" fill="#858585"></path></svg></div><ul class="chooser-list" id="localizer-list"><li class="chooser-list-item"><a href="/dcosdocs/mesosphere/dcos/cn/services/edge-lb">中文 (简体)</a></li></ul></div><section class="header__search" role="search"><form class="header__search-form" action="/search/"><input class="header__search-input" id="header-search-input" tabindex="1" type="text" name="q" placeholder="Search"><input type="hidden" name="hFR[scope][0]" value="DC/OS Services"><label class="header__search-label" for="header-search-input"><i class="header__icon" data-feather="search"></i></label></form></section></header><div class="header-dropdown"><ul class="header-dropdown__list"><li class="header-dropdown__top-item"><div>DKP</div></li><li class="header-dropdown__item"><a href="/dkp/konvoy">Konvoy</a></li><li class="header-dropdown__item"><a href="/dkp/konvoy/partner-solutions">Partner Solutions</a></li><li class="header-dropdown__item"><a href="/dkp/kommander">Kommander</a></li><li class="header-dropdown__item"><a href="/dkp/dispatch">Dispatch</a></li><li class="header-dropdown__item"><a href="/dkp/kaptain">Kaptain</a></li><li class="header-dropdown__item"><a href="/dkp/conductor">Conductor</a></li><li class="header-dropdown__top-item"><div>Mesosphere</div></li><li class="header-dropdown__item header-dropdown__item--active"><a href="/mesosphere/dcos">DC/OS</a></li><li class="header-dropdown__item header-dropdown__item--active"><a href="/dcosdocs/mesosphere/dcos/services">DC/OS Services</a></li><li class="header-dropdown__item"><a href="https://support.d2iq.com">Support</a></li></ul></div><div class="layout__sidebar layout__drawer"><section class="sidebar"><header class="sidebar__header"><div class="sidebar__dropdown"><ul><li><a href="/dcosdocs/mesosphere/dcos/services/edge-lb/1.7/how-to-tasks/scale-up">Edge-LB 1.7</a></li><li><a href="/dcosdocs/mesosphere/dcos/services/edge-lb/1.6/how-to-tasks/scale-up">Edge-LB 1.6</a></li><li><a href="/dcosdocs/mesosphere/dcos/services/edge-lb/1.5/how-to-tasks/scale-up">Edge-LB 1.5</a></li><li><a href="/dcosdocs/mesosphere/dcos/services/edge-lb/1.4">Edge-LB 1.4</a></li><li><a href="/dcosdocs/mesosphere/dcos/services/edge-lb/1.3">Edge-LB 1.3</a></li><li><a href="/dcosdocs/mesosphere/dcos/services/edge-lb/1.2">Edge-LB 1.2</a></li></ul><div class="toggle"><p><span class="title">Edge Lb</span><span class="version"> 1.7</span></p><i data-feather="chevron-down"></i></div></div></header><nav class="sidebar_nav" role="navigation"><ul><li><a class="d0" href="/dcosdocs/mesosphere/dcos/services/edge-lb/1.7/concepts/"><i data-feather="chevron-right"></i>Edge-LB concepts</a></li><li><a class="d0" href="/dcosdocs/mesosphere/dcos/services/edge-lb/1.7/getting-started/"><i data-feather="chevron-right"></i>Getting started with Edge-LB</a></li><li class="active"><a class="d0" href="/dcosdocs/mesosphere/dcos/services/edge-lb/1.7/how-to-tasks/"><i data-feather="chevron-right"></i>How-to guides for Edge-LB</a></li><ul><li><a class="d1" href="/dcosdocs/mesosphere/dcos/services/edge-lb/1.7/how-to-tasks/basic-configuration/">Basic configuration settings</a></li><li><a class="d1" href="/dcosdocs/mesosphere/dcos/services/edge-lb/1.7/how-to-tasks/configuring-security/">Security certificates and secrets</a></li><li><a class="d1" href="/dcosdocs/mesosphere/dcos/services/edge-lb/1.7/how-to-tasks/path-based-routing/">Path-based routing</a></li><li><a class="d1" href="/dcosdocs/mesosphere/dcos/services/edge-lb/1.7/how-to-tasks/predefined-ports/">Exposing tasks using pre-assigned ports</a></li><li><a class="d1" href="/dcosdocs/mesosphere/dcos/services/edge-lb/1.7/how-to-tasks/dynamic-frontend-ports/">Configuring a frontend port dynamically</a></li><li><a class="d1" href="/dcosdocs/mesosphere/dcos/services/edge-lb/1.7/how-to-tasks/dynamic-stats-frontend/">Configuring the statistics port</a></li><li class="active active-on"><a class="d1" href="/dcosdocs/mesosphere/dcos/services/edge-lb/1.7/how-to-tasks/scale-up/">Scaling load-balancer instances</a></li><li><a class="d1" href="/dcosdocs/mesosphere/dcos/services/edge-lb/1.7/how-to-tasks/weighted-backends/">Weighted backends</a></li><li><a class="d1" href="/dcosdocs/mesosphere/dcos/services/edge-lb/1.7/how-to-tasks/east-west-load-balancing/">Internal-only load balancing</a></li><li><a class="d1" href="/dcosdocs/mesosphere/dcos/services/edge-lb/1.7/how-to-tasks/reload-pools/">Reloading and restarting pools</a></li><li><a class="d1" href="/dcosdocs/mesosphere/dcos/services/edge-lb/1.7/how-to-tasks/updating-pool-config/">Updating the Edge-LB pool configuration</a></li><li><a class="d1" href="/dcosdocs/mesosphere/dcos/services/edge-lb/1.7/how-to-tasks/verify-version/">Verifying the Edge-LB installed version</a></li><li><a class="d1" href="/dcosdocs/mesosphere/dcos/services/edge-lb/1.7/how-to-tasks/upgrading/">Upgrading Edge-LB</a></li><li><a class="d1" href="/dcosdocs/mesosphere/dcos/services/edge-lb/1.7/how-to-tasks/uninstalling/">Uninstalling Edge-LB</a></li></ul><li><a class="d0" href="/dcosdocs/mesosphere/dcos/services/edge-lb/1.7/tutorials/"><i data-feather="chevron-right"></i>Tutorials</a></li><li><a class="d0" href="/dcosdocs/mesosphere/dcos/services/edge-lb/1.7/reference/"><i data-feather="chevron-right"></i>Reference information</a></li><li><a class="d0" href="/dcosdocs/mesosphere/dcos/services/edge-lb/1.7/related-documentation/"><i data-feather="chevron-right"></i>Related documentation</a></li></ul></nav><footer class="sidebar__footer"><div class="sidebar__footer-links"><a href="https://d2iq.com/terms/">Terms of Service</a><a href="https://d2iq.com/privacy/">Privacy Policy</a></div><a class="sidebar__footer-copyright" href="https://d2iq.com/">&copy; 2021 D2iQ, Inc. All rights reserved.</a></footer></section></div><div class="layout__content" role="main"><main class="content"><div class="content__container content__container--with-sections"><div class="content__header"><div class="content__header__row"><h1 class="content__header-title">Scaling load-balancer instances</h1></div><h4 class="content__header-description">How to scale up and scale down load balancer instances</h4><div class="actions"><ul class="actions__list"><li class="actions__item"><button class="actions__link" onclick="javascript:window.print()"><i class="actions__icon" data-feather="printer"></i><span class="actions__text">Print</span></button></li><li class="actions__item"><a class="actions__link" href="https://github.com/mesosphere/dcos-docs-site/tree/main/pages/dcosdocs/mesosphere/dcos/services/edge-lb/1.7/how-to-tasks/scale-up/index.md" target="_blank"><i class="actions__icon" data-feather="github"></i><span class="actions__text">Contribute</span></a></li><li class="actions__item"><a class="actions__link" href="https://jira.d2iq.com/secure/CreateIssueDetails!init.jspa?pid=14105&amp;issuetype=1&amp;summary=Feedback+for+Scaling+load-balancer+instances&amp;description=Source:%20https://docs.d2iq.com/dcosdocs/mesosphere/dcos/services/edge-lb/1.7/how-to-tasks/scale-up&amp;labels=documentation&amp;labels=needs_triage&amp;components=19804&amp;priority=3&amp;customfield_12300=44" target="_blank"><i class="actions__icon" data-feather="message-square"></i><span class="actions__text">Feedback</span></a></li></ul></div></div><article class="content__article"><p>As you refine the deployment of agent nodes and services for your DC/OS™ Enterprise cluster, you might find that you need to add or reduce the number of load balancing pool instances that are distributing workload to your backend servers.</p>
<h1 id="before-you-begin"><a class="content__anchor" href="#before-you-begin" aria-hidden="true"><i data-feather="bookmark"></i></a>Before you begin</h1>
<p>Before you create Edge-LB pools and pool configuration files, you should have DC/OS Enterprise cluster nodes installed and ready to use, and have previously downloaded and installed the latest Edge-LB packages.</p>
<p>You must have:</p>
<ul>
<li>Edge-LB installed as described in the Edge-LB <a href="/dcosdocs/mesosphere/dcos/services/edge-lb/1.7/getting-started/installing">installation instructions</a>.</li>
<li>The core DC/OS command-line interface (CLI) installed and configured to communicate with the DC/OS cluster.</li>
<li>The <code>edgelb</code> command-line interface (CLI) installed.</li>
<li>An active and properly-configured DC/OS Enterprise cluster, with at least one DC/OS <strong>private agent</strong> node to run the load-balanced service and at least one DC/OS <strong>public agent</strong> node for exposing the load-balanced service.</li>
</ul>
<p>For information about installing Edge-LB packages, see the <a href="/dcosdocs/mesosphere/dcos/services/edge-lb/1.7/getting-started/installing/">installation</a> instructions.</p>
<h1 id="scaling-edge-lb-pool-instances-up-or-down"><a class="content__anchor" href="#scaling-edge-lb-pool-instances-up-or-down" aria-hidden="true"><i data-feather="bookmark"></i></a>Scaling Edge-LB pool instances up or down</h1>
<p>You can achieve high availability for load-balancing application traffic by increasing, or decreasing, an Edge-LB pool’s HAProxy instances as needed. To do this, update the existing Edge-LB pool configuration <code>count</code> variable to change the number of HAProxy instances.</p>
<p>The following steps show how to create an Edge-LB pool configuration file to scale up the number of instances for a deployed NGINX™ service. You can use these same steps to “scale-down” the number of instances, as well.</p>
<h1 id="to-add-or-remove-edge-lb-load-balancer-instances"><a class="content__anchor" href="#to-add-or-remove-edge-lb-load-balancer-instances" aria-hidden="true"><i data-feather="bookmark"></i></a>To add (or remove) Edge-LB load balancer instances</h1>
<ol>
<li>
<p>Create a baseline pool configuration file, <code>scaleup-nginx-lb.json</code>:</p>
<pre><code>dcos edgelb create scaleup-nginx-lb.json
</code></pre>
</li>
<li>
<p>Open the pool configuration file, and copy and paste the following sample JSON settings to populate it:</p>
<pre><code class="language-json">{
  &quot;apiVersion&quot;: &quot;V2&quot;,
  &quot;name&quot;: &quot;scaleup-nginx-lb&quot;,
  &quot;count&quot;: 1,
  &quot;haproxy&quot;: {
    &quot;frontends&quot;: [
    {
      &quot;bindPort&quot;: 15002,
      &quot;protocol&quot;: &quot;HTTP&quot;,
      &quot;linkBackend&quot;: {
        &quot;defaultBackend&quot;: &quot;nginx-backend&quot;
      }
    }
  ],
    &quot;backends&quot;: [
    {
      &quot;name&quot;: &quot;nginx-backend&quot;,
      &quot;protocol&quot;: &quot;HTTP&quot;,
      &quot;services&quot;: [
        {
        &quot;marathon&quot;: {
          &quot;serviceID&quot;: &quot;/nginx&quot;
        },
        &quot;endpoint&quot;: {
          &quot;portName&quot;: &quot;nginx-port&quot;
        }
      }
    ]
    }
  ],
    &quot;stats&quot;: {
      &quot;bindPort&quot;: 0
    }
  }
}
</code></pre>
<p>In this sample baseline configuration, the <code>count</code> variable is set to 1. With this setting, the Edge-LB pool uses one load balancer instance from one of the public agents to distribute incoming traffic from all available public agent nodes. We can increase the count for now, and then use these same procedures to decrease the count later, if needed.</p>
</li>
<li>
<p>Modify <code>scaleup-nginx-lb.json</code> to scale up the number of Edge-LB pool instances, by changing the <code>count</code> setting from 1 to 3.</p>
<pre><code class="language-json">{
  &quot;apiVersion&quot;: &quot;V2&quot;,
  &quot;name&quot;: &quot;scaleup-nginx-lb&quot;,
  &quot;count&quot;: 3,
  &quot;haproxy&quot;: {
    &quot;frontends&quot;: [
    {
      &quot;bindPort&quot;: 15002,
      &quot;protocol&quot;: &quot;HTTP&quot;,
      &quot;linkBackend&quot;: {
        &quot;defaultBackend&quot;: &quot;nginx-backend&quot;
      }
    }
  ],
    &quot;backends&quot;: [
    {
      &quot;name&quot;: &quot;nginx-backend&quot;,
      &quot;protocol&quot;: &quot;HTTP&quot;,
      &quot;services&quot;: [
        {
        &quot;marathon&quot;: {
          &quot;serviceID&quot;: &quot;/nginx&quot;
        },
        &quot;endpoint&quot;: {
          &quot;portName&quot;: &quot;nginx-port&quot;
        }
      }
    ]
    }
  ],
    &quot;stats&quot;: {
      &quot;bindPort&quot;: 0
    }
  }
}
</code></pre>
</li>
<li>
<p>Update the Edge-LB pool to use the new configuration settings:</p>
<pre><code class="language-bash">dcos edgelb update scaleup-nginx-lb.json
</code></pre>
</li>
<li>
<p>Verify that the change to the number of load balancer instances was deployed successfully:</p>
<pre><code>dcos edgelb status scaleup-nginx-lb
</code></pre>
<p>You should now see three pools listed in the output. You can also see the Edge-LB endpoints with the <code>dcos edgelb endpoint</code> command.</p>
<pre><code>&gt; dcos edgelb status scaleup-nginx-lb
  NAME                  TASK ID                                                                                         STATE
  edgelb-pool-0-server  dcos-edgelb.pools.scaleup-nginx-lb__edgelb-pool-0-server__a65c5779-dad2-4727-8f2f-84f4be060835  TASK_RUNNING
  edgelb-pool-1-server  dcos-edgelb.pools.scaleup-nginx-lb__edgelb-pool-1-server__5112fb7c-1759-472a-97d3-d637b7b8eec8  TASK_RUNNING
  edgelb-pool-2-server  dcos-edgelb.pools.scaleup-nginx-lb__edgelb-pool-2-server__acea4d0b-09ba-4eeb-a6ea-84b82217bb8e  TASK_RUNNING
</code></pre>
<p>To view the output from the <code>endpoints</code> subcommand:</p>
<pre><code>dcos edgelb endpoints scaleup-nginx-lb
</code></pre>
<p>If it appears in the command output, the <code>count</code> column displays the number of load balancer instances you have specified in the Edge-LB pool configuration file.</p>
<pre><code>NAME                    PORT   INTERNAL IPS   EXTERNAL IPS
frontend_0.0.0.0_15002  15002  172.12.12.167  54.173.77.146
                               172.12.23.239  100.24.113.243  
                               172.12.42.163  18.212.166.130  
stats                   1027   172.12.12.167  54.173.77.146
                        1029   172.12.23.239  100.24.113.243  
                               172.12.42.163  18.212.166.130  
Public/private IPs metadata is inaccurate in case of pools that use virtual networks.
</code></pre>
</li>
</ol>
<p class="message--important"><strong>IMPORTANT: </strong>You can only scale up to the total number of public agents you have available in the DC/OS cluster. For example, if you have deployed five public agent nodes in your DC/OS cluster, you can scale up to a maximum of five Edge-LB load balancer instances. If you change the <code>count</code> setting to a number greater than the number of public agents you have deployed - for example, by setting the `count` to 6 - only the maximum of five Edge-LB load balancer instances will be available to handle the traffic from the five available public agents.</p>
<p>To scale down Edge-LB pool instances, you can change the <code>count</code> setting to a lower number. For example, if the previous count in the Edge-LB pool configuration file was 5, you could scale down the number of instances available by changing the <code>count</code> setting to 2.</p>
</article></div><aside class="content__sections"><div class="content__sections-list-container"><ul class="content__sections-list"><li class="content__sections-item content__sections-item--h1"><a href="#before-you-begin">Before you begin</a></li><li class="content__sections-item content__sections-item--h1"><a href="#scaling-edge-lb-pool-instances-up-or-down">Scaling Edge-LB pool instances up or down</a></li><li class="content__sections-item content__sections-item--h1"><a href="#to-add-or-remove-edge-lb-load-balancer-instances">To add (or remove) Edge-LB load balancer instances</a></li></ul></div></aside></main></div></div><script src="/assets/js/jquery-3.2.1.js"></script><script src="/assets/js/clipboard.js"></script><script src="/assets/js/prism.js"></script><script src="/js/main.js"></script></body></html>