<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width" initial-scale="1" user-scalable="no"><title>Uninstalling - D2iQ Docs</title><meta name="description" content="Uninstalling DC/OS Apache NiFi Services"><link rel="apple-touch-icon" sizes="180x180" href="/assets/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/favicon-16x16.png"><link rel="stylesheet" type="text/css" href="/css/styles.css"><link rel="search" type="application/opensearchdescription+xml" href="/assets/opensearch.xml" title="Search"><link href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,500,500i,700,700i" rel="stylesheet"><script src="https://unpkg.com/feather-icons/dist/feather.min.js"></script><script>window.analytics||(window.analytics=[]),window.analytics.methods=["identify","track","trackLink","trackForm","trackClick","trackSubmit","page","pageview","ab","alias","ready","group","on","once","off"],window.analytics.factory=function(t){return function(){var a=Array.prototype.slice.call(arguments);return a.unshift(t),window.analytics.push(a),window.analytics}};for(var i=0;i<window.analytics.methods.length;i++){var method=window.analytics.methods[i];window.analytics[method]=window.analytics.factory(method)}window.analytics.load=function(t){var a=document.createElement("script");a.type="text/javascript",a.async=!0,a.src=("https:"===document.location.protocol?"https://":"http://")+"d2dq2ahtl5zl1z.cloudfront.net/analytics.js/v1/"+t+"/analytics.min.js";var n=document.getElementsByTagName("script")[0];n.parentNode.insertBefore(a,n)},window.analytics.SNIPPET_VERSION="2.0.8",
window.analytics.load("7sgtwqvuai");
window.analytics.page();</script><noscript><iframe src="//www.googletagmanager.com/ns.html?id=GTM-PBJ84KX" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript><script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src='//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
})(window,document,'script','dataLayer','GTM-PBJ84KX');</script></head><body><div class="layout"><header class="header"><a class="header__drawer"><i class="header__icon" data-feather="menu"></i></a><a class="header__logo" href="/"><img class="header__logo--mobile" src="/assets/D2iQ_Logotype_Color_Positive_Documentation.svg" alt="D2IQ"><img class="header__logo--desktop" src="/assets/D2iQ_Logotype_Color_Positive_Documentation.svg" alt="D2IQ"></a><div class="header__main"><div class="header__dropdown"><img class="header__dropdown-icon" src="/assets/D2IQ_Logotype_Color_Positive.png" alt="D2iQ"><strong>Nifi Documentation</strong><i data-feather="chevron-down"></i></div><nav class="header__menu"><ul class="header__menu-list"><li class="header__menu-item"><a href="https://support.d2iq.com">Support</a></li></ul></nav></div><div class="chooser" id="localizer"><div class="chooser-current"><a class="chooser-title">English</a><svg class="chooser-svg" id="localizer-svg"><path class="pointer" d="m 13,6 -5,5 -5,-5 z" fill="#858585"></path></svg></div><ul class="chooser-list" id="localizer-list"><li class="chooser-list-item"><a href="/dcosdocs/mesosphere/dcos/cn/services">中文 (简体)</a></li></ul></div><section class="header__search" role="search"><form class="header__search-form" action="/search/"><input class="header__search-input" id="header-search-input" tabindex="1" type="text" name="q" placeholder="Search"><input type="hidden" name="hFR[scope][0]" value="DC/OS Services"><label class="header__search-label" for="header-search-input"><i class="header__icon" data-feather="search"></i></label></form></section></header><div class="header-dropdown"><ul class="header-dropdown__list"><li class="header-dropdown__top-item"><div>DKP</div></li><li class="header-dropdown__item"><a href="/dkp/konvoy">Konvoy</a></li><li class="header-dropdown__item"><a href="/dkp/kommander">Kommander</a></li><li class="header-dropdown__item"><a href="/dkp/dispatch">Dispatch</a></li><li class="header-dropdown__item"><a href="/dkp/kaptain">Kaptain</a></li><li class="header-dropdown__top-item"><div>Mesosphere</div></li><li class="header-dropdown__item header-dropdown__item--active"><a href="/mesosphere/dcos">DC/OS</a></li><li class="header-dropdown__item header-dropdown__item--active"><a href="/dcosdocs/mesosphere/dcos/services">DC/OS Services</a></li><li class="header-dropdown__item"><a href="https://support.d2iq.com">Support</a></li></ul></div><div class="layout__sidebar layout__drawer"><section class="sidebar"><header class="sidebar__header"><div class="sidebar__dropdown"><ul><li><a href="/dcosdocs/mesosphere/dcos/services/nifi/1.0.1-1.9.2/uninstall">NiFi 1.0.1-1.9.2</a></li><li><a href="/dcosdocs/mesosphere/dcos/services/nifi/1.0.0-1.9.2/uninstall">NiFi 1.0.0-1.9.2</a></li><li><a href="/dcosdocs/mesosphere/dcos/services/nifi/0.5.0-1.9.2/uninstall">NiFi 0.5.0-1.9.2</a></li><li><a href="/dcosdocs/mesosphere/dcos/services/nifi/0.4.1-1.8.0/uninstall">NiFi 0.4.1-1.8.0</a></li><li><a href="/dcosdocs/mesosphere/dcos/services/nifi/0.4.0-1.8.0/uninstall">NiFi 0.4.0-1.8.0</a></li><li><a href="/dcosdocs/mesosphere/dcos/services/nifi/0.3.0-1.7.1/uninstall">NiFi 0.3.0-1.7.1</a></li><li><a href="/dcosdocs/mesosphere/dcos/services/nifi/0.2.0-1.5.0/uninstall">NiFi 0.2.0-1.5.0</a></li><li><a href="/dcosdocs/mesosphere/dcos/services/nifi/0.1.0-1.5.0/uninstall">NiFi 0.1.0-1.5.0</a></li></ul><div class="toggle"><p><span class="title">Nifi</span><span class="version"> 0.2.0-1.5.0</span></p><i data-feather="chevron-down"></i></div></div></header><nav class="sidebar_nav" role="navigation"><ul><li><a class="d0" href="/dcosdocs/mesosphere/dcos/services/nifi/0.2.0-1.5.0/overview/">Overview</a></li><li><a class="d0" href="/dcosdocs/mesosphere/dcos/services/nifi/0.2.0-1.5.0/install/">Installing and Customizing</a></li><li><a class="d0" href="/dcosdocs/mesosphere/dcos/services/nifi/0.2.0-1.5.0/deploy-best-practice/">Deployment Best Practices</a></li><li class="active active-on"><a class="d0" href="/dcosdocs/mesosphere/dcos/services/nifi/0.2.0-1.5.0/uninstall/">Uninstalling</a></li><li><a class="d0" href="/dcosdocs/mesosphere/dcos/services/nifi/0.2.0-1.5.0/security/">Security</a></li><li><a class="d0" href="/dcosdocs/mesosphere/dcos/services/nifi/0.2.0-1.5.0/command-reference/"><i data-feather="chevron-right"></i>Command Reference</a></li><li><a class="d0" href="/dcosdocs/mesosphere/dcos/services/nifi/0.2.0-1.5.0/connecting-clients/">Connecting Clients</a></li><li><a class="d0" href="/dcosdocs/mesosphere/dcos/services/nifi/0.2.0-1.5.0/managing/">Managing</a></li><li><a class="d0" href="/dcosdocs/mesosphere/dcos/services/nifi/0.2.0-1.5.0/api-reference/">API Reference</a></li><li><a class="d0" href="/dcosdocs/mesosphere/dcos/services/nifi/0.2.0-1.5.0/troubleshooting/"><i data-feather="chevron-right"></i>Troubleshooting</a></li><li><a class="d0" href="/dcosdocs/mesosphere/dcos/services/nifi/0.2.0-1.5.0/limitations/">Limitations</a></li><li><a class="d0" href="/dcosdocs/mesosphere/dcos/services/nifi/0.2.0-1.5.0/supported-versions/">Supported Versions</a></li><li><a class="d0" href="/dcosdocs/mesosphere/dcos/services/nifi/0.2.0-1.5.0/release-notes/">Release Notes</a></li></ul></nav><footer class="sidebar__footer"><div class="sidebar__footer-links"><a href="https://d2iq.com/terms/">Terms of Service</a><a href="https://d2iq.com/privacy/">Privacy Policy</a></div><a class="sidebar__footer-copyright" href="https://d2iq.com/">&copy; 2022 D2iQ, Inc. All rights reserved.</a></footer></section></div><div class="layout__content" role="main"><main class="content"><div class="content__container content__container--with-sections"><div class="content__header"><div class="content__header__row"><h1 class="content__header-title">Uninstalling</h1></div><h4 class="content__header-description">Uninstalling DC/OS Apache NiFi Services</h4><div class="actions"><ul class="actions__list"><li class="actions__item"><button class="actions__link" onclick="javascript:window.print()"><i class="actions__icon" data-feather="printer"></i><span class="actions__text">Print</span></button></li><li class="actions__item"><a class="actions__link" href="https://github.com/mesosphere/dcos-docs-site/tree/main/pages/dcosdocs/mesosphere/dcos/services/nifi/0.2.0-1.5.0/uninstall/index.md" target="_blank"><i class="actions__icon" data-feather="github"></i><span class="actions__text">Contribute</span></a></li></ul></div></div><article class="content__article"><h2 id="dcos-110"><a class="content__anchor" href="#dcos-110" aria-hidden="true"><i data-feather="bookmark"></i></a>DC/OS 1.10</h2>
<p>If you are using DC/OS 1.10 :</p>
<p>Uninstall the service from the DC/OS CLI, by entering <code>dcos package uninstall &lt;package_name&gt; --app-id=&lt;app-id&gt;</code>.
For example, to uninstall the Apache NiFi instance named nifi-dev, run:</p>
<pre><code class="language-shell">dcos package uninstall --app-id=nifi-dev nifi
</code></pre>
<h3 id="uninstall-flow"><a class="content__anchor" href="#uninstall-flow" aria-hidden="true"><i data-feather="bookmark"></i></a>Uninstall Flow</h3>
<p>Uninstalling the service consists of the following steps:</p>
<p>The Scheduler is relaunched in Marathon with the environment variable SDK_UNINSTALL set to “true”. This puts the Scheduler in an uninstall mode.</p>
<pre><code>The Scheduler performs the uninstall with the following actions:

    1. All running tasks for the service are terminated so that Mesos will reoffer their resources.
    2. As the task resources are offered by Mesos, they are unreserved by the Scheduler.
</code></pre>
<p><strong>Warning:</strong> Any data stored in reserved disk resources will be irretrievably lost.
3. Once all known resources have been unreserved, the Scheduler’s persistent state in ZooKeeper is deleted.</p>
<pre><code>The cluster automatically removes the Scheduler task once it advertises the completion of the uninstall process.
</code></pre>
<p><strong>Warning</strong> Once the uninstall operation has begun, it cannot be cancelled because it can leave the service in an uncertain, half-destroyed state.</p>
<h3 id="debugging-an-uninstall"><a class="content__anchor" href="#debugging-an-uninstall" aria-hidden="true"><i data-feather="bookmark"></i></a>Debugging an uninstall</h3>
<p>In the vast majority of cases, this uninstall process goes off without a hitch. However, in certain situations, there can be snags along the way. For example, perhaps a machine in the cluster has permanently gone away, and the service being uninstalled had some resources allocated on that machine. This can result in the uninstall becoming stuck, because Mesos will never offer those resources to the uninstalling Scheduler. As such, the uninstalling Scheduler will not be able to successfully unreserve the resources it had reserved on that machine.</p>
<p>This situation is indicated by looking at deploy plan while the uninstall is proceeding. The deploy plan may be viewed using either of the following methods:</p>
<pre><code>1. CLI: dcos nifi --name=nifi plan show deploy (after running dcos package install --cli nifi if needed)
2. HTTP: https://yourcluster.com/service/nifi/v1/plans/deploy
</code></pre>
<p><strong>Deploy Plan in Progress</strong></p>
<pre><code class="language-shell">dcos nifi --name=nifi plan show deploy
deploy (serial strategy) (IN_PROGRESS)
└─ node (serial strategy) (IN_PROGRESS)
   ├─ nifi-0:[init] (COMPLETE)
   ├─ nifi-0:[node] (COMPLETE)
   ├─ nifi-0:[metrics] (STARTING)
   ├─ nifi-1:[node] (PENDING)
   └─ nifi-1:[metrics] (PENDING)   
</code></pre>
<p><strong>Deploy Plan after Completion</strong></p>
<pre><code class="language-shell">deploy (serial strategy) (COMPLETE)
└─ node (serial strategy) (COMPLETE)
   ├─ nifi-0:[init] (COMPLETE)
   ├─ nifi-0:[node] (COMPLETE)
   ├─ nifi-0:[metrics] (COMPLETE)
   ├─ nifi-1:[node] (COMPLETE)
   └─ nifi-1:[metrics] (COMPLETE)
</code></pre>
<p>As we can see above, some of the resources to unreserve are stuck in a PENDING state. We can force them into a COMPLETE state, and thereby allow the Scheduler to finish the uninstall operation. This may be done using either of the following methods:</p>
<pre><code>1. CLI: dcos nifi --name=nifi plan show deploy
2. HTTP: https://yourcluster.com/service/nifi/v1/plans/deploy/forceComplete?phase=unreserve-resources&amp;step=unreserve-&lt;UUID&gt;
</code></pre>
<p>At this point the Scheduler should show a COMPLETE state for these steps in the plan, allowing it to proceed normally with the uninstall operation:</p>
<pre><code class="language-shell">dcos nifi --name=nifi plan show deploy
deploy (serial strategy) (COMPLETE)
├─ kill-tasks (parallel strategy) (COMPLETE)
│  ├─ kill-task- (COMPLETE)
│  ├─ kill-task-nifi-0-init__4ea667b6-e784-4982-9c68-61af8732f552 (COMPLETE)
│  ├─ kill-task-nifi-0-metrics__d438f4b5-d6d1-480c-8fd7-439943f5cba9 (COMPLETE)
│  ├─ kill-task-nifi-0-node__3e16d999-0b72-4ca2-bee4-74c910acd8a3 (COMPLETE)
│  ├─ kill-task- (COMPLETE)
│  ├─ kill-task- (COMPLETE)
│  ├─ kill-task-nifi-1-metrics__d0d1b9ca-e803-4392-9210-8088ee234df4 (COMPLETE)
│  ├─ kill-task-nifi-1-node__a7704212-ce1f-4150-aa75-5f08a5fabbab (COMPLETE)
│  └─ kill-task- (COMPLETE)
├─ unreserve-resources (parallel strategy) (COMPLETE)
│  ├─ unreserve-91283d5b-2b0a-440e-a30d-f992f75320db (COMPLETE)
│  ├─ unreserve-70747305-1e3d-4792-b20d-07340f616e93 (COMPLETE)
│  ├─ unreserve-d42be42d-19e8-40ab-9635-48f70635c85f (COMPLETE)
│  ├─ unreserve-d35dd634-0476-4304-a198-66394f51621b (COMPLETE)
│  ├─ unreserve-66813bfa-9388-4ae2-bf77-78e409bf2551 (COMPLETE)
│  ├─ unreserve-2c50d053-bfdd-45f7-a5dc-4f525cc3339b (COMPLETE)
│  ├─ unreserve-45fe3b63-7182-4169-a44d-0d858085587e (COMPLETE)
│  ├─ unreserve-6ce13249-080d-4313-b3d6-a5e52cef9ab3 (COMPLETE)
│  ├─ unreserve-8673c61d-ad4d-43dc-bd6f-7ca0af45a531 (COMPLETE)
│  ├─ unreserve-04c83dd6-530f-4d52-a605-7658b8d90886 (COMPLETE)
│  ├─ unreserve-0eebd063-b804-455d-a066-8fd376d2feb5 (COMPLETE)
│  ├─ unreserve-523ce9e8-a467-4a5d-8b8e-ca7b09059982 (COMPLETE)
│  ├─ unreserve-1e540d1b-34d3-4e09-b9e5-5d66435c5f79 (COMPLETE)
│  ├─ unreserve-9b73d19f-67bc-4f10-8f44-b7e80c93d81f (COMPLETE)
│  ├─ unreserve-66a115e8-2249-4f65-8116-6984bf6e1bf2 (COMPLETE)
│  ├─ unreserve-ce0f4ba7-daf2-437c-aa2d-c786e77ba5c5 (COMPLETE)
│  ├─ unreserve-ad4a5977-c69d-4d9b-bbe0-0d12b69da414 (COMPLETE)
│  ├─ unreserve-a30655dd-2830-4b04-a0b2-865d6fb59c2e (COMPLETE)
│  ├─ unreserve-75861ac7-795a-45e9-8d2b-498a43597884 (COMPLETE)
│  ├─ unreserve-4698fdb8-0299-4db9-bd85-26416bad78b4 (COMPLETE)
│  ├─ unreserve-4007049a-9f6c-44cb-9433-ad1a24061749 (COMPLETE)
│  ├─ unreserve-9cf96948-28e6-4829-872a-58a0175459ef (COMPLETE)
│  ├─ unreserve-eeae0a40-8ae5-4bd2-ac31-9258cf5486ad (COMPLETE)
│  ├─ unreserve-c894002c-3559-4a01-bd50-01de1adfa2e6 (COMPLETE)
│  ├─ unreserve-887598ea-d9ec-4735-91c8-6a6998da0b5a (COMPLETE)
│  ├─ unreserve-bbb7a239-a36e-4443-b3a5-ff5a94545781 (COMPLETE)
│  ├─ unreserve-c35b60ed-7ad4-4c80-bd9a-2ceecf8f58e6 (COMPLETE)
│  ├─ unreserve-333a7c31-d637-482a-9c29-8e2aa2d5bdda (COMPLETE)
│  ├─ unreserve-3b2d0928-884d-41c4-a09c-369b310f9d0b (COMPLETE)
│  ├─ unreserve-c8eb2502-c14d-4365-863a-38081bd29dc5 (COMPLETE)
│  ├─ unreserve-39cca304-3cdc-4d52-a9d9-9253fc85ab26 (COMPLETE)
│  ├─ unreserve-dcc3bf75-45e9-484b-baac-8d5bae1d203f (COMPLETE)
│  ├─ unreserve-f3a60859-20de-4f81-a57f-6133ab3cfee5 (COMPLETE)
│  ├─ unreserve-79c62a5e-1ce2-40eb-9fb7-5896c2e324e3 (COMPLETE)
│  ├─ unreserve-6f33bb34-07bd-44cd-95c7-650cd19dcc4f (COMPLETE)
│  └─ unreserve-223dfa31-d221-4401-b9f1-cee1683a6b20 (COMPLETE)
└─ deregister-service (serial strategy) (COMPLETE)
   └─ deregister (COMPLETE)
</code></pre>
<h3 id="manual-uninstall"><a class="content__anchor" href="#manual-uninstall" aria-hidden="true"><i data-feather="bookmark"></i></a>Manual uninstall</h3>
<p>If all else fails, one can simply manually perform the uninstall themselves. To do this, perform the following steps:</p>
<pre><code>1. Delete the uninstalling Scheduler from Marathon.
2. Unregister the service from Mesos using its UUID as follows:
</code></pre>
<pre><code class="language-shell">dcos service --inactive | grep nifi
nifi     False     3    3.3  6240.0  15768.0  97a0fd27-8f27-4e14-b2f2-fb61c36972d7-0096
dcos service shutdown 97a0fd27-8f27-4e14-b2f2-fb61c36972d7-0096
</code></pre>
<h3 id="un-install-operation-in-dcos-19"><a class="content__anchor" href="#un-install-operation-in-dcos-19" aria-hidden="true"><i data-feather="bookmark"></i></a>Un-install Operation in DC/OS 1.9</h3>
<p>If you are running DC/OS 1.9, follow these steps:</p>
<pre><code>1. Stop the service. From the DC/OS CLI, enter
</code></pre>
<pre><code class="language-shell">       dcos package uninstall --app-id=&lt;service_name&gt;  &lt;package_name&gt;
</code></pre>
<pre><code>   For example:
</code></pre>
<pre><code class="language-shell">       dcos package uninstall --app-id=/test/nifi nifi
</code></pre>
<pre><code> 2. Clean up remaining reserved resources with the framework cleaner script, janitor.py. See [DC/OS documentation](/dcosdocs/mesosphere/dcos/1.11/deploying-services/uninstall/#framework-cleaner) for more information about the framework cleaner script.
</code></pre>
<pre><code class="language-shell">       dcos package uninstall --app-id=/test/nifi nifi
       dcos node ssh --master-proxy --leader &quot;docker run mesosphere/janitor /janitor.py \
       -r /test/nifi-role \
       -p /test/nifi-principal \
       -z dcos-service-/test/nifi&quot;
</code></pre>
</article></div><aside class="content__sections"><div class="content__sections-list-container"><ul class="content__sections-list"><li class="content__sections-item content__sections-item--h2"><a href="#dcos-110">DC/OS 1.10</a></li></ul></div></aside></main></div></div><script src="/assets/js/jquery-3.2.1.js"></script><script src="/assets/js/clipboard.js"></script><script src="/assets/js/prism.js"></script><script src="/js/main.js"></script></body></html>