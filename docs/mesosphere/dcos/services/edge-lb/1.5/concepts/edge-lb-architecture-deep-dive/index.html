<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width" initial-scale="1" user-scalable="no"><title>Architectural deep-dive - D2iQ Docs</title><meta name="description" content="Provides a more detailed view of Edge-LB components within the network topology for a cluster"><link rel="apple-touch-icon" sizes="180x180" href="/assets/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/favicon-16x16.png"><link rel="stylesheet" type="text/css" href="/css/styles.css"><link rel="search" type="application/opensearchdescription+xml" href="/assets/opensearch.xml" title="Search"><link href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,500,500i,700,700i" rel="stylesheet"><script src="https://unpkg.com/feather-icons/dist/feather.min.js"></script><script>window.analytics||(window.analytics=[]),window.analytics.methods=["identify","track","trackLink","trackForm","trackClick","trackSubmit","page","pageview","ab","alias","ready","group","on","once","off"],window.analytics.factory=function(t){return function(){var a=Array.prototype.slice.call(arguments);return a.unshift(t),window.analytics.push(a),window.analytics}};for(var i=0;i<window.analytics.methods.length;i++){var method=window.analytics.methods[i];window.analytics[method]=window.analytics.factory(method)}window.analytics.load=function(t){var a=document.createElement("script");a.type="text/javascript",a.async=!0,a.src=("https:"===document.location.protocol?"https://":"http://")+"d2dq2ahtl5zl1z.cloudfront.net/analytics.js/v1/"+t+"/analytics.min.js";var n=document.getElementsByTagName("script")[0];n.parentNode.insertBefore(a,n)},window.analytics.SNIPPET_VERSION="2.0.8",
window.analytics.load("7sgtwqvuai");
window.analytics.page();</script><noscript><iframe src="//www.googletagmanager.com/ns.html?id=GTM-PBJ84KX" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript><script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src='//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
})(window,document,'script','dataLayer','GTM-PBJ84KX');</script></head><body><div class="layout"><header class="header"><a class="header__drawer"><i class="header__icon" data-feather="menu"></i></a><a class="header__logo" href="/"><img class="header__logo--mobile" src="/assets/D2iQ_Logotype_Color_Positive_Documentation.svg" alt="D2IQ"><img class="header__logo--desktop" src="/assets/D2iQ_Logotype_Color_Positive_Documentation.svg" alt="D2IQ"></a><div class="header__main"><div class="header__dropdown"><img class="header__dropdown-icon" src="/assets/D2IQ_Logotype_Color_Positive.png" alt="D2iQ"><strong>Edge Lb Documentation</strong><i data-feather="chevron-down"></i></div><nav class="header__menu"><ul class="header__menu-list"><li class="header__menu-item"><a href="https://support.d2iq.com">Support</a></li></ul></nav></div><div class="chooser" id="spherer"><div class="chooser-current"><a class="chooser-title">Mesosphere</a><svg class="chooser-svg" id="spherer-svg"><path class="pointer" d="m 13,6 -5,5 -5,-5 z" fill="#858585"></path></svg></div><ul class="chooser-list" id="spherer-list"><li class="chooser-list-item"><a href="/mesosphere/dcos">DC/OS</a></li><li class="chooser-list-item"><a href="/dcosdocs/mesosphere/dcos/services">DC/OS Services</a></li></ul></div><div class="chooser" id="ks"><div class="chooser-current"><a class="chooser-title">DKP</a><svg class="chooser-svg" id="kspherer-svg"><path class="pointer" d="m 13,6 -5,5 -5,-5 z" fill="#858585"></path></svg></div><ul class="chooser-list" id="kspherer-list"><li class="chooser-list-item"><a href="/dkp/konvoy">Konvoy</a></li><li class="chooser-list-item"><a href="/dkp/konvoy/partner-solutions">Partner Solutions</a></li><li class="chooser-list-item"><a href="/dkp/kommander">Kommander</a></li><li class="chooser-list-item"><a href="/dkp/dispatch">Dispatch</a></li><li class="chooser-list-item"><a href="/dkp/kaptain">Kaptain</a></li><li class="chooser-list-item"><a href="/dkp/conductor">Conductor</a></li></ul></div><div class="chooser" id="localizer"><div class="chooser-current"><a class="chooser-title">English</a><svg class="chooser-svg" id="localizer-svg"><path class="pointer" d="m 13,6 -5,5 -5,-5 z" fill="#858585"></path></svg></div><ul class="chooser-list" id="localizer-list"><li class="chooser-list-item"><a href="/dcosdocs/mesosphere/dcos/cn/services/edge-lb">中文 (简体)</a></li></ul></div><section class="header__search" role="search"><form class="header__search-form" action="/search/"><input class="header__search-input" id="header-search-input" tabindex="1" type="text" name="q" placeholder="Search"><input type="hidden" name="hFR[scope][0]" value="DC/OS Services"><label class="header__search-label" for="header-search-input"><i class="header__icon" data-feather="search"></i></label></form></section></header><div class="header-dropdown"><ul class="header-dropdown__list"><li class="header-dropdown__top-item"><div>DKP</div></li><li class="header-dropdown__item"><a href="/dkp/konvoy">Konvoy</a></li><li class="header-dropdown__item"><a href="/dkp/konvoy/partner-solutions">Partner Solutions</a></li><li class="header-dropdown__item"><a href="/dkp/kommander">Kommander</a></li><li class="header-dropdown__item"><a href="/dkp/dispatch">Dispatch</a></li><li class="header-dropdown__item"><a href="/dkp/kaptain">Kaptain</a></li><li class="header-dropdown__item"><a href="/dkp/conductor">Conductor</a></li><li class="header-dropdown__top-item"><div>Mesosphere</div></li><li class="header-dropdown__item header-dropdown__item--active"><a href="/mesosphere/dcos">DC/OS</a></li><li class="header-dropdown__item header-dropdown__item--active"><a href="/dcosdocs/mesosphere/dcos/services">DC/OS Services</a></li><li class="header-dropdown__item"><a href="https://support.d2iq.com">Support</a></li></ul></div><div class="layout__sidebar layout__drawer"><section class="sidebar"><header class="sidebar__header"><div class="sidebar__dropdown"><ul><li><a href="/dcosdocs/mesosphere/dcos/services/edge-lb/1.7/concepts/edge-lb-architecture-deep-dive">Edge-LB 1.7</a></li><li><a href="/dcosdocs/mesosphere/dcos/services/edge-lb/1.6/concepts/edge-lb-architecture-deep-dive">Edge-LB 1.6</a></li><li><a href="/dcosdocs/mesosphere/dcos/services/edge-lb/1.5/concepts/edge-lb-architecture-deep-dive">Edge-LB 1.5</a></li><li><a href="/dcosdocs/mesosphere/dcos/services/edge-lb/1.4/concepts">Edge-LB 1.4</a></li><li><a href="/dcosdocs/mesosphere/dcos/services/edge-lb/1.3">Edge-LB 1.3</a></li><li><a href="/dcosdocs/mesosphere/dcos/services/edge-lb/1.2">Edge-LB 1.2</a></li></ul><div class="toggle"><p><span class="title">Edge Lb</span><span class="version"> 1.5</span></p><i data-feather="chevron-down"></i></div></div></header><nav class="sidebar_nav" role="navigation"><ul><li class="active"><a class="d0" href="/dcosdocs/mesosphere/dcos/services/edge-lb/1.5/concepts/"><i data-feather="chevron-right"></i>Edge-LB concepts</a></li><ul><li><a class="d1" href="/dcosdocs/mesosphere/dcos/services/edge-lb/1.5/concepts/what-is-edge-lb/">What is Edge-LB?</a></li><li><a class="d1" href="/dcosdocs/mesosphere/dcos/services/edge-lb/1.5/concepts/how-edge-lb-works/">How Edge-LB works</a></li><li><a class="d1" href="/dcosdocs/mesosphere/dcos/services/edge-lb/1.5/concepts/edge-lb-pool-high-availability/">Edge-LB pools for high-availability</a></li><li><a class="d1" href="/dcosdocs/mesosphere/dcos/services/edge-lb/1.5/concepts/cloud-connector/">Integrating with cloud providers</a></li><li class="active active-on"><a class="d1" href="/dcosdocs/mesosphere/dcos/services/edge-lb/1.5/concepts/edge-lb-architecture-deep-dive/">Architectural deep-dive</a></li></ul><li><a class="d0" href="/dcosdocs/mesosphere/dcos/services/edge-lb/1.5/getting-started/"><i data-feather="chevron-right"></i>Getting started with Edge-LB</a></li><li><a class="d0" href="/dcosdocs/mesosphere/dcos/services/edge-lb/1.5/how-to-tasks/"><i data-feather="chevron-right"></i>How-to guides for Edge-LB</a></li><li><a class="d0" href="/dcosdocs/mesosphere/dcos/services/edge-lb/1.5/tutorials/"><i data-feather="chevron-right"></i>Tutorials</a></li><li><a class="d0" href="/dcosdocs/mesosphere/dcos/services/edge-lb/1.5/reference/"><i data-feather="chevron-right"></i>Reference information</a></li><li><a class="d0" href="/dcosdocs/mesosphere/dcos/services/edge-lb/1.5/related-documentation/"><i data-feather="chevron-right"></i>Related documentation</a></li></ul></nav><footer class="sidebar__footer"><div class="sidebar__footer-links"><a href="https://d2iq.com/terms/">Terms of Service</a><a href="https://d2iq.com/privacy/">Privacy Policy</a></div><a class="sidebar__footer-copyright" href="https://d2iq.com/">&copy; 2021 D2iQ, Inc. All rights reserved.</a></footer></section></div><div class="layout__content" role="main"><main class="content"><div class="content__container content__container--with-sections"><div class="content__header"><div class="content__header__row"><h1 class="content__header-title">Architectural deep-dive</h1><p class="badge badge--content-header badge--enterprise">ENTERPRISE</p></div><h4 class="content__header-description">Provides a more detailed view of Edge-LB components within the network topology for a cluster</h4><div class="actions"><ul class="actions__list"><li class="actions__item"><button class="actions__link" onclick="javascript:window.print()"><i class="actions__icon" data-feather="printer"></i><span class="actions__text">Print</span></button></li><li class="actions__item"><a class="actions__link" href="https://github.com/mesosphere/dcos-docs-site/tree/main/pages/dcosdocs/mesosphere/dcos/services/edge-lb/1.5/concepts/edge-lb-architecture-deep-dive/index.md" target="_blank"><i class="actions__icon" data-feather="github"></i><span class="actions__text">Contribute</span></a></li><li class="actions__item"><a class="actions__link" href="https://jira.d2iq.com/secure/CreateIssueDetails!init.jspa?pid=14105&amp;issuetype=1&amp;summary=Feedback+for+Architectural+deep-dive&amp;description=Source:%20https://docs.d2iq.com/dcosdocs/mesosphere/dcos/services/edge-lb/1.5/concepts/edge-lb-architecture-deep-dive&amp;labels=documentation&amp;labels=needs_triage&amp;components=19804&amp;priority=3&amp;customfield_12300=44" target="_blank"><i class="actions__icon" data-feather="message-square"></i><span class="actions__text">Feedback</span></a></li></ul></div></div><article class="content__article"><p>Edge-LB provides layer-7 inbound load balancing and proxying through the Edge-LB API server and Edge-LB pools. This section provides a deeper view into the details of the Edge-LB architecture and how it works.</p>
<p>The following diagram provides a more detailed representation of the Edge-LB architecture.</p>
<p><img src="/dcosdocs/mesosphere/dcos/services/edge-lb/1.5/img/Edge-LB-detail-arch.png" alt="Detail view of Edge-LB components"></p>
<h1 id="a-closer-look-at-the-edge-lb-api-server"><a class="content__anchor" href="#a-closer-look-at-the-edge-lb-api-server" aria-hidden="true"><i data-feather="bookmark"></i></a>A closer look at the Edge-LB API server</h1>
<p>The Edge-LB API receives incoming client requests and, based on the action requested, creates, deletes, or updates Edge-LB pool instances. The API server also serves API endpoint requests for Edge-LB pool(s) instances.</p>
<p>The Edge-LB API server uses the DC/OS ZooKeeper persistent storage to store the configuration file for the load balancer and communicates to the Edge-LB pool instances through ZooKeeper™ transactions. The interaction between ZooKeeper and the Edge-LB API server enables Edge-LB to be fault tolerant. In the event of an API server failure, the Edge-LB pool instances continue to load-balance traffic to the proper backend. When the Edge-LB API server comes back online, it re-establishes the communication between itself and the pool instances.</p>
<p>The Edge-LB API server has two sub-components:</p>
<ul>
<li>Apache® Mesos® listener</li>
<li>DC/OS template</li>
</ul>
<h2 id="mesos-listener"><a class="content__anchor" href="#mesos-listener" aria-hidden="true"><i data-feather="bookmark"></i></a>Mesos listener</h2>
<p>The <code>mesos-listener</code> sub-component is always up by default. It subscribes to the Mesos event stream, translates the event stream data into an internal data structure, and serves metadata from the data structure through the API server. It also runs a gRPC server to serve the Mesos task information to other Edge-LB components like <code>dcos-template</code> and <code>cloud controller</code>.</p>
<h2 id="dcos-template"><a class="content__anchor" href="#dcos-template" aria-hidden="true"><i data-feather="bookmark"></i></a>DC/OS template</h2>
<p>The <code>dcos-template</code> sub-component dynamically renders the load balancer configuration information for HAProxy® by combining the <code>mesos-listener</code> output and the Edge-LB pool configuration provided by the Edge-LB CLI client. The template then signals the <code>lbmgr</code> sub-component to take appropriate action on the HAProxy load balancer instance.</p>
<p>In the event of Edge-LB pool update, the <code>dcos-template</code> re-generates the HAProxy load balancer configuration from the Edge-LB pool configuration file and signals <code>lbmgr</code> to reload the existing HAProxy configuration in real-time.</p>
<h1 id="a-closer-look-at-edge-lb-pools"><a class="content__anchor" href="#a-closer-look-at-edge-lb-pools" aria-hidden="true"><i data-feather="bookmark"></i></a>A closer look at Edge-LB pools</h1>
<p>The Edge-LB pool provides the core load balancing functionality for Edge-LB software. Edge-LB automatically provisions pools using pool templates. A default pool template is created at the time of Edge-LB installation.</p>
<p>To create a pool instance, you must define configuration settings in a pool configuration file. You can set up load balancing for one service or for multiple services using the same pool configuration file, depending on your application and network requirements.</p>
<p>Edge-LB pool has two sub-components:</p>
<ul>
<li>Load balancing manager (lbmgr)</li>
<li>HAProxy</li>
</ul>
<h2 id="load-balancing-manager-lbmgr"><a class="content__anchor" href="#load-balancing-manager-lbmgr" aria-hidden="true"><i data-feather="bookmark"></i></a>Load balancing manager (lbmgr)</h2>
<p>The load balancing manager (<code>lbmgr</code>) in Edge-LB pool instances is a non-distributed process that runs along with the HAProxy load balancer on an agent. <code>lbmgr</code> takes the appropriate action for the pool when it receives requests from the API server.</p>
<p>The <code>lbmgr</code> component monitors the HAProxy instances for the Edge-LB pool and restarts HAProxy in a single container, when needed. If an HAProxy instance goes down because an agent is disconnected, the SDK scheduler restarts the HAProxy instance on another available agent.</p>
<p>The <code>lbmgr</code> component also validates new HAProxy configuration settings and reloads HAProxy load balancer instances, when necessary. For example, the <code>lbmgr</code> component manages the timeout interval for reloading the HAProxy instance.</p>
<h2 id="haproxy-instances"><a class="content__anchor" href="#haproxy-instances" aria-hidden="true"><i data-feather="bookmark"></i></a>HAProxy instances</h2>
<p>Individual HAProxy instances provide the proxying and load balancing functionality for Edge-LB to the proper backend services.</p>
</article></div><aside class="content__sections"><div class="content__sections-list-container"><ul class="content__sections-list"><li class="content__sections-item content__sections-item--h1"><a href="#a-closer-look-at-the-edge-lb-api-server">A closer look at the Edge-LB API server</a></li><li class="content__sections-item content__sections-item--h2"><a href="#mesos-listener">Mesos listener</a></li><li class="content__sections-item content__sections-item--h2"><a href="#dcos-template">DC/OS template</a></li><li class="content__sections-item content__sections-item--h1"><a href="#a-closer-look-at-edge-lb-pools">A closer look at Edge-LB pools</a></li><li class="content__sections-item content__sections-item--h2"><a href="#load-balancing-manager-lbmgr">Load balancing manager (lbmgr)</a></li><li class="content__sections-item content__sections-item--h2"><a href="#haproxy-instances">HAProxy instances</a></li></ul></div></aside></main></div></div><script src="/assets/js/jquery-3.2.1.js"></script><script src="/assets/js/clipboard.js"></script><script src="/assets/js/prism.js"></script><script src="/js/main.js"></script></body></html>