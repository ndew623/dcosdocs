<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width" initial-scale="1" user-scalable="no"><title>DC/OS Enterprise 安全性 - D2iQ Docs</title><meta name="description" content="了解 DC/OS Enterprise 安全功能"><link rel="apple-touch-icon" sizes="180x180" href="/dcosdocs/assets/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/dcosdocs/assets/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/dcosdocs/assets/favicon-16x16.png"><link rel="stylesheet" type="text/css" href="/dcosdocs/css/styles.css"><link rel="search" type="application/opensearchdescription+xml" href="/dcosdocs/assets/opensearch.xml" title="Search"><link href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,500,500i,700,700i" rel="stylesheet"><script src="https://unpkg.com/feather-icons/dist/feather.min.js"></script><script>window.analytics||(window.analytics=[]),window.analytics.methods=["identify","track","trackLink","trackForm","trackClick","trackSubmit","page","pageview","ab","alias","ready","group","on","once","off"],window.analytics.factory=function(t){return function(){var a=Array.prototype.slice.call(arguments);return a.unshift(t),window.analytics.push(a),window.analytics}};for(var i=0;i<window.analytics.methods.length;i++){var method=window.analytics.methods[i];window.analytics[method]=window.analytics.factory(method)}window.analytics.load=function(t){var a=document.createElement("script");a.type="text/javascript",a.async=!0,a.src=("https:"===document.location.protocol?"https://":"http://")+"d2dq2ahtl5zl1z.cloudfront.net/analytics.js/v1/"+t+"/analytics.min.js";var n=document.getElementsByTagName("script")[0];n.parentNode.insertBefore(a,n)},window.analytics.SNIPPET_VERSION="2.0.8",
window.analytics.load("7sgtwqvuai");
window.analytics.page();</script><noscript><iframe src="//www.googletagmanager.com/ns.html?id=GTM-PBJ84KX" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript><script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src='//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
})(window,document,'script','dataLayer','GTM-PBJ84KX');</script></head><body><div class="layout"><header class="header"><a class="header__drawer"><i class="header__icon" data-feather="menu"></i></a><a class="header__logo" href="/"><img class="header__logo--mobile" src="/dcosdocs/assets/D2iQ_Logotype_Color_Positive_Documentation.svg" alt="D2IQ"><img class="header__logo--desktop" src="/dcosdocs/assets/D2iQ_Logotype_Color_Positive_Documentation.svg" alt="D2IQ"></a><div class="header__main"><div class="header__dropdown"><img class="header__dropdown-icon" src="/dcosdocs/assets/D2IQ_Logotype_Color_Positive.png" alt="D2iQ"><strong>DC/OS文档</strong><i data-feather="chevron-down"></i></div><nav class="header__menu"><ul class="header__menu-list"><li class="header__menu-item"><a href="https://support.d2iq.com">Support</a></li></ul></nav></div><div class="chooser" id="localizer"><div class="chooser-current"><a class="chooser-title">中文 (简体)</a><svg class="chooser-svg" id="localizer-svg"><path class="pointer" d="m 13,6 -5,5 -5,-5 z" fill="#858585"></path></svg></div><ul class="chooser-list" id="localizer-list"><li class="chooser-list-item"><a href="/dcosdocs/mesosphere/dcos/2.0/security/ent">English</a></li></ul></div><section class="header__search" role="search"><form class="header__search-form" action="/search/"><input class="header__search-input" id="header-search-input" tabindex="1" type="text" name="q" placeholder="Search"><input type="hidden" name="hFR[scope][0]" value="DC/OS 2.0"><label class="header__search-label" for="header-search-input"><i class="header__icon" data-feather="search"></i></label></form></section></header><div class="header-dropdown"><ul class="header-dropdown__list"><li class="header-dropdown__top-item"><div>DKP</div></li><li class="header-dropdown__item"><a href="/dkp/konvoy">Konvoy</a></li><li class="header-dropdown__item"><a href="/dkp/kommander">Kommander</a></li><li class="header-dropdown__item"><a href="/dkp/dispatch">Dispatch</a></li><li class="header-dropdown__item"><a href="/dkp/kaptain">Kaptain</a></li><li class="header-dropdown__top-item"><div>Mesosphere</div></li><li class="header-dropdown__item header-dropdown__item--active"><a href="/mesosphere/dcos">DC/OS</a></li><li class="header-dropdown__item"><a href="/dcosdocs/mesosphere/dcos/services">DC/OS Services</a></li><li class="header-dropdown__item"><a href="https://support.d2iq.com">Support</a></li></ul></div><div class="layout__sidebar layout__drawer"><section class="sidebar"><header class="sidebar__header"><div class="sidebar__dropdown"><ul><li><a href="/dcosdocs/mesosphere/dcos/cn/2.1/security/ent">Mesosphere DC/OS 2.1.0</a></li><li><a href="/dcosdocs/mesosphere/dcos/cn/2.0/security/ent">Mesosphere DC/OS 2.0</a></li><li><a href="/dcosdocs/mesosphere/dcos/cn/1.13/security/ent">Mesosphere DC/OS 1.13</a></li></ul><div class="toggle"><p><span class="title">DC/OS</span><span class="version"> 2.0</span></p><i data-feather="chevron-down"></i></div></div></header><nav class="sidebar_nav" role="navigation"><ul><li><a class="d0" href="/dcosdocs/mesosphere/dcos/cn/2.0/release-notes/"><i data-feather="chevron-right"></i>版本注释</a></li><li><a class="d0" href="/dcosdocs/mesosphere/dcos/cn/2.0/overview/"><i data-feather="chevron-right"></i>概述</a></li><li><a class="d0" href="/dcosdocs/mesosphere/dcos/cn/2.0/installing/"><i data-feather="chevron-right"></i>安装</a></li><li><a class="d0" href="/dcosdocs/mesosphere/dcos/cn/2.0/gui/"><i data-feather="chevron-right"></i>GUI</a></li><li><a class="d0" href="/dcosdocs/mesosphere/dcos/cn/2.0/cli/"><i data-feather="chevron-right"></i>CLI</a></li><li><a class="d0" href="/dcosdocs/mesosphere/dcos/cn/2.0/administering-clusters/"><i data-feather="chevron-right"></i>管理群集</a></li><li><a class="d0" href="/dcosdocs/mesosphere/dcos/cn/2.0/networking/"><i data-feather="chevron-right"></i>网络</a></li><li class="active"><a class="d0" href="/dcosdocs/mesosphere/dcos/cn/2.0/security/"><i data-feather="chevron-right"></i>安全</a></li><ul><li class="active active-on"><a class="d1" href="/dcosdocs/mesosphere/dcos/cn/2.0/security/ent/"><i data-feather="chevron-right"></i>DC/OS Enterprise 安全性</a></li><ul><li><a class="d2" href="/dcosdocs/mesosphere/dcos/cn/2.0/security/ent/users-groups/"><i data-feather="chevron-right"></i>管理用户和组</a></li><li><a class="d2" href="/dcosdocs/mesosphere/dcos/cn/2.0/security/ent/gui-permissions/"><i data-feather="chevron-right"></i>授予访问 UI 的权限</a></li><li><a class="d2" href="/dcosdocs/mesosphere/dcos/cn/2.0/security/ent/perms-management/">权限管理</a></li><li><a class="d2" href="/dcosdocs/mesosphere/dcos/cn/2.0/security/ent/perms-reference/">权限参考</a></li><li><a class="d2" href="/dcosdocs/mesosphere/dcos/cn/2.0/security/ent/ldap/"><i data-feather="chevron-right"></i>LDAP 身份认证</a></li><li><a class="d2" href="/dcosdocs/mesosphere/dcos/cn/2.0/security/ent/secrets/"><i data-feather="chevron-right"></i>密钥</a></li><li><a class="d2" href="/dcosdocs/mesosphere/dcos/cn/2.0/security/ent/sso/"><i data-feather="chevron-right"></i>基于身份提供程序的身份认证</a></li><li><a class="d2" href="/dcosdocs/mesosphere/dcos/cn/2.0/security/ent/service-auth/"><i data-feather="chevron-right"></i>服务认证</a></li><li><a class="d2" href="/dcosdocs/mesosphere/dcos/cn/2.0/security/ent/restrict-service-access/">限制对 DC/OS 服务组的访问</a></li><li><a class="d2" href="/dcosdocs/mesosphere/dcos/cn/2.0/security/ent/hardening/">强化</a></li><li><a class="d2" href="/dcosdocs/mesosphere/dcos/cn/2.0/security/ent/iam-api/">身份和访问管理 API</a></li><li><a class="d2" href="/dcosdocs/mesosphere/dcos/cn/2.0/security/ent/tls-ssl/"><i data-feather="chevron-right"></i>确保与 TLS 通信的安全</a></li></ul><li><a class="d1" href="/dcosdocs/mesosphere/dcos/cn/2.0/security/oss/"><i data-feather="chevron-right"></i>DC/OS 开源安全</a></li></ul><li><a class="d0" href="/dcosdocs/mesosphere/dcos/cn/2.0/storage/"><i data-feather="chevron-right"></i>存储</a></li><li><a class="d0" href="/dcosdocs/mesosphere/dcos/cn/2.0/metrics/"><i data-feather="chevron-right"></i>度量标准</a></li><li><a class="d0" href="/dcosdocs/mesosphere/dcos/cn/2.0/monitoring/"><i data-feather="chevron-right"></i>监控、日志记录和调试</a></li><li><a class="d0" href="/dcosdocs/mesosphere/dcos/cn/2.0/multi-tenancy/"><i data-feather="chevron-right"></i>DC/OS 群集的多租户</a></li><li><a class="d0" href="/dcosdocs/mesosphere/dcos/cn/2.0/hybrid-cloud/"><i data-feather="chevron-right"></i>混合云</a></li><li><a class="d0" href="/dcosdocs/mesosphere/dcos/cn/2.0/deploying-jobs/"><i data-feather="chevron-right"></i>部署作业</a></li><li><a class="d0" href="/dcosdocs/mesosphere/dcos/cn/2.0/deploying-services/"><i data-feather="chevron-right"></i>部署服务和 Pod</a></li><li><a class="d0" href="/dcosdocs/mesosphere/dcos/cn/2.0/tutorials/"><i data-feather="chevron-right"></i>教程</a></li><li><a class="d0" href="/dcosdocs/mesosphere/dcos/cn/2.0/api/"><i data-feather="chevron-right"></i>API 参考</a></li><li><a class="d0" href="/dcosdocs/mesosphere/dcos/cn/2.0/developing-services/"><i data-feather="chevron-right"></i>开发 DC/OS 服务</a></li></ul></nav><footer class="sidebar__footer"><div class="sidebar__footer-links"><a href="https://d2iq.com/terms/">Terms of Service</a><a href="https://d2iq.com/privacy/">Privacy Policy</a></div><a class="sidebar__footer-copyright" href="https://d2iq.com/">&copy; 2022 D2iQ, Inc. All rights reserved.</a></footer></section></div><div class="layout__content" role="main"><main class="content"><div class="content__container content__container--with-sections"><div class="content__header"><div class="content__header__row"><h1 class="content__header-title">DC/OS Enterprise 安全性</h1><p class="badge badge--content-header badge--enterprise">ENTERPRISE</p></div><h4 class="content__header-description">了解 DC/OS Enterprise 安全功能</h4><div class="actions"><ul class="actions__list"><li class="actions__item"><button class="actions__link" onclick="javascript:window.print()"><i class="actions__icon" data-feather="printer"></i><span class="actions__text">Print</span></button></li><li class="actions__item"><a class="actions__link" href="https://github.com/mesosphere/dcos-docs-site/tree/main/pages/dcosdocs/mesosphere/dcos/cn/2.0/security/ent/index.md" target="_blank"><i class="actions__icon" data-feather="github"></i><span class="actions__text">Contribute</span></a></li></ul></div></div><article class="content__article"><!-- The source repository for this topic is https://github.com/dcos/dcos-docs-site -->
<p>Mesosphere® DC/OS™ Enterprise 提供一系列功能，允许您保护群集并防止破坏和其他攻击。本节概述了强化群集的安全功能和建议。</p>
<p>DC/OS 安全性的目标是：</p>
<ul>
<li>通过所有接口的重要身份认证和授权隔离群集周边。</li>
<li>严密保护内部群集通信、容器和沙盒。</li>
<li>通过支持第三方安全集成来增强集群安全性。</li>
</ul>
<p>DC/OS 基于 Linux® 内核和 userspace。保护任何 Linux 系统的最佳实践同样适用于保护 DC/OS，包括设置正确的文件权限、限制根用户和普通用户帐户、使用 <code>iptables</code> 或其他防火墙保护网络接口以及定期应用与 DC/OS 配合使用的 Linux 发行版的更新，以确保 <code>systemd</code> 和 OpenSSH 等系统库、实用程序和核心服务是安全的。</p>
<h1 id=""><a class="content__anchor" href="#" aria-hidden="true"><i data-feather="bookmark"></i></a>安全区</h1>
<p>在最高级别上，我们可以区分 DC/OS 部署的三个安全区域，即管理、专用和公共安全区。</p>
<h2 id="-2"><a class="content__anchor" href="#-2" aria-hidden="true"><i data-feather="bookmark"></i></a>管理区</h2>
<p><strong>管理</strong> 区可通过 HTTP/HTTPS 和 SSH 连接访问，并提供对主节点的访问。它还可通过 URL 路由向群集中的其他节点提供反向代理访问。为了安全起见，DC/OS 云模板允许配置白名单，以便只允许特定的 IP 地址范围访问管理区。</p>
<h3 id="admin-router"><a class="content__anchor" href="#admin-router" aria-hidden="true"><i data-feather="bookmark"></i></a>Admin Router</h3>
<p>对管理区的访问由 [Admin Router] 控制。(/dcosdocs/mesosphere/dcos/cn/2.0/overview/architecture/components/#admin-router).</p>
<p>传入 DC/OS 群集的 HTTP 请求通过 Admin Router 代理（使用 <a href="http://nginx.org">Nginx™</a> ，其核心是 <a href="https://openresty.org">OpenResty®</a>）。Admin Router 拒绝访问大多数 HTTP 端点以获取未经身份认证的请求。为了请求进行身份认证，它需要在其 <code>Authorization</code> 标头中提供有效的认证令牌。可通过验证流程获得令牌。</p>
<h2 id="-3"><a class="content__anchor" href="#-3" aria-hidden="true"><i data-feather="bookmark"></i></a>专用区</h2>
<p><strong>专用</strong>区是非可路由网络，仅可从管理区或通过公共区的边缘路由器访问。部署的服务在专用区运行。此区域是运行大多数代理节点的位置。</p>
<h2 id="-4"><a class="content__anchor" href="#-4" aria-hidden="true"><i data-feather="bookmark"></i></a>公共区</h2>
<p>可选的<strong>公共</strong>区是运行公共可访问的应用程序的地方。通常，此区域只运行少量代理节点。边缘路由器将流量转发给专用区中运行的应用程序。公共区中的代理节点被标记为特殊角色，以便只能在此处安排特定任务。这些代理节点具有公共和专用 IP 地址，也只能在其 <code>iptables</code> 防火墙中打开特定端口。</p>
<p>典型部署（包括负载均衡器）如下所示：</p>
<p><img src="/dcosdocs/mesosphere/dcos/cn/2.0/img/security-zones.png" alt="安全区"></p>
<p>图 1. 安全区典型部署</p>
<h1 id="-5"><a class="content__anchor" href="#-5" aria-hidden="true"><i data-feather="bookmark"></i></a><a name="security-modes"></a>安全模式</h1>
<p>您可以通过资源和操作（创建、读取、更新、删除）来控制 DC/OS Enterprise 访问。可用的安全模式为宽容和严格。严格的模式提供了最好的细粒度控制。根据您的安全模式执行 DC/OS 权限。安全模式在 <a href="/dcosdocs/mesosphere/dcos/cn/2.0/installing/production/deploying-dcos/installation/">DC/OS 安装</a> 过程中设置，并且只能通过执行升级进行更改。</p>
<table>
<thead>
<tr>
<th>权限类别</th>
<th style="text-align:center">宽容</th>
<th style="text-align:center">严格</th>
</tr>
</thead>
<tbody>
<tr>
<td>Admin Router 权限 (<code>dcos:adminrouter</code>)</td>
<td style="text-align:center">x</td>
<td style="text-align:center">x</td>
</tr>
<tr>
<td>Apache® Mesos® 权限 (<code>dcos:mesos</code>) (<code>dcos:mesos</code>)</td>
<td style="text-align:center"></td>
<td style="text-align:center">x</td>
</tr>
<tr>
<td>Marathon™ 和 Metronome 权限 (<code>dcos:service</code>)</td>
<td style="text-align:center">x</td>
<td style="text-align:center">x</td>
</tr>
<tr>
<td>密钥存储库权限 (<code>dcos:secrets</code>)</td>
<td style="text-align:center">x</td>
<td style="text-align:center">x</td>
</tr>
</tbody>
</table>
<p>有关完整说明，请参阅<a href="/dcosdocs/mesosphere/dcos/cn/2.0/security/ent/perms-reference/">权限参考</a></p>
<h3 id="-6"><a class="content__anchor" href="#-6" aria-hidden="true"><i data-feather="bookmark"></i></a>宽容</h3>
<p>此模式提供了一些安全功能，但不包括 Mesos 权限。</p>
<h3 id="-7"><a class="content__anchor" href="#-7" aria-hidden="true"><i data-feather="bookmark"></i></a>严格</h3>
<p>此模式提供最强大的安全状态，需要大量配置。</p>
<h2 id="-8"><a class="content__anchor" href="#-8" aria-hidden="true"><i data-feather="bookmark"></i></a><a name="set"></a>设置安全模式</h2>
<p>安全模式在 <a href="/dcosdocs/mesosphere/dcos/cn/2.0/installing/production/advanced-configuration/">DC/OS 安装</a> 过程中设置，并且只能通过执行<a href="/dcosdocs/mesosphere/dcos/cn/2.0/installing/production/upgrading/">升级</a>. 进行更改。安全模式在安装配置文件中使用 <a href="/dcosdocs/mesosphere/dcos/cn/2.0/installing/production/advanced-configuration/configuration-reference/#security-and-authentication"><code>security</code> 参数</a>.进行设置。</p>
<p class="message--important"><strong>重要信息：</strong>升级期间，权限只能从“宽容”变为“严格”。</p>
<h2 id="-9"><a class="content__anchor" href="#-9" aria-hidden="true"><i data-feather="bookmark"></i></a><a name="discover"></a>了解您的安全模式</h2>
<p>您可以使用以下任一方法来确定现有群集的安全模式。</p>
<ul>
<li>
<p>向以下端点发送 <code>GET</code> 请求：<code>http[s]: /dcosdocs/mesosphere/dcos//&lt;cluster-url&gt;/dcos-metadata/bootstrap-config.json</code>.
**要求：**您的用户帐户必须具有 <code>dcos:adminrouter:ops:metadata full</code> 或 <code>dcos:superuser</code> 权限。在 <code>permissive</code> 或 <code>strict</code> 模式下，您必须使用 HTTPS。查看 <a href="/dcosdocs/mesosphere/dcos/cn/2.0/security/ent/tls-ssl/">保护 TLS 通信的安全</a>，了解如何获取 DC/OS CA 的根证书，并将其置备到首选客户端。</p>
</li>
<li>
<p><a href="/dcosdocs/mesosphere/dcos/cn/2.0/administering-clusters/sshcluster/">SSH</a> 进入主服务器并查看 <code>/opt/mesosphere/etc/bootstrap-config.json</code>. 内容。</p>
</li>
</ul>
<h1 id="-10"><a class="content__anchor" href="#-10" aria-hidden="true"><i data-feather="bookmark"></i></a><a name="authentication"></a>身份认证</h1>
<p>DC/OS 群集外部的所有请求都需要认证令牌。根据您的安全模式，可能需要群集内认证令牌。如需更多信息，请参阅 <a href="/dcosdocs/mesosphere/dcos/cn/2.0/security/ent/service-auth/">服务账户文档</a>.</p>
<p>DC/OS 认证令牌是 <a href="https://jwt.io/introduction/">JSON Web 令牌 (JWT)</a>，默认情况下，在发布后五天到期。默认到期时间可在 [自定义安装或升级]期间进行修改。(/dcosdocs/mesosphere/dcos/cn/2.0/installing/production/advanced-configuration/configuration-reference/#bouncer-expiration-auth-token-days-enterprise).</p>
<p>在  bootstrap 序列期间，DC/OS 使用 ZooKeeper 凭据提供主节点。这使得主节点可以将自己指定未潜在的 Mesos 主节点。</p>
<p class="message--important"><strong>重要信息：</strong>除非在安装或升级期间进行了更改，否则每个群集将使用相同的默认 ZooKeeper 凭据（强烈建议）。参见<a href="/dcosdocs/mesosphere/dcos/2.0/security/ent/hardening/#zk">强化</a>，了解更多信息。</p>
<h2 id="-11"><a class="content__anchor" href="#-11" aria-hidden="true"><i data-feather="bookmark"></i></a><a name="user"></a>用户登录</h2>
<p>您可以使用 DC/OS GUI、DC/OS CLI 或编程式客户端登录。</p>
<ul>
<li>如果已配置 LDAP 目录服务器，则 DC/OS 会将您的凭据传递到 LDAP 目录服务器进行验证。</li>
<li>如果您已配置 SAML 或 OpenID Connect 身份提供程序 (Idp)，则会将凭据直接传递给 IdP。</li>
</ul>
<p class="message--note"><strong>注意：</strong>如果您使用 DC/OS GUI、SAML 和 OpenID Connect 提供程序登录，则他们可能会在浏览器 Cookie 中发现必要的登录详细信息。在这种情况下，您无需传递凭据。</p>
<p>下图详细说明了顺序。</p>
<p><img src="/dcosdocs/mesosphere/dcos/cn/2.0/img/authn-user.png" alt="用户身份认证"></p>
<p>图 2. 用户身份认证顺序</p>
<p>认证令牌到期后，您可以重新验证以接收另一个认证令牌。</p>
<p>使用 DC/OS GUI 登录时，Identity 和 Access Manager 会生成包含认证令牌的 Cookie。虽然它收到 <a href="https://owasp.org/www-community/HttpOnly"><code>HttpOnly</code></a> 标志的保护，但您应在浏览器会话结束时<strong>注销</strong>以清除此 Cookie。</p>
<p>请注意，清除 Cookie 不会使认证失效。如果监测到未加密的连接或从 cookie 中提取，则可能有人使用认证令牌登录了 DC/OS。为降低此风险，我们建议在 <code>permissive</code> 和 <code>strict</code> 模式下设置 <a href="https://www.owasp.org/index.php/SecureFlag">安全标志</a>，如 <a href="/dcosdocs/mesosphere/dcos/cn/2.0/security/ent/hardening/#secure-flag">强化</a> 中所述。</p>
<h2 id="-12"><a class="content__anchor" href="#-12" aria-hidden="true"><i data-feather="bookmark"></i></a><a name="passwords"></a>密码</h2>
<p>群集本地用户帐户（不使用 LDAP、SAML 或 OpenID Connect® 的账户）的凭据包含用户名和密码，可用于验证但不能复制用户密码。使用 <a href="http://man7.org/linux/man-pages/man3/crypt.3.html">crypt(3)</a> SHA-512 对密码进行单独加盐和加密散列。这会导致单向散列，可用于验证但不能复制用户密码。为了进一步阻止暴力攻击并达到或超过 NIST FIPS 安全要求，散列函数使用 128 位盐长度执行多次迭代。</p>
<p>在 DC/OS IAM 验证了您的凭据后，就会将认证令牌返回给您。然后，认证令牌将用于会话期间进一步请求身份认证。这样，密码不需要存储在客户端，并且只能在输入后立即通过电报发送。通过电报，使用 TLS 加密身份认证请求。TLS 是必需的，并以严格模式执行，但在宽容模式下可选。有关更多信息，请参阅<a href="/dcosdocs/mesosphere/dcos/cn/2.0/security/ent/#security-modes">安全模式</a>.</p>
<h2 id="-13"><a class="content__anchor" href="#-13" aria-hidden="true"><i data-feather="bookmark"></i></a><a name="service"></a>服务身份认证</h2>
<p>服务帐户为 <a href="/dcosdocs/mesosphere/dcos/cn/2.0/overview/concepts/#dcos-service">服务</a> 提供身份，以使用 DC/OS 进行身份认证。服务帐户控制服务与 DC/OS 组件之间的通信。DC/OS 服务可能需要 <a href="/dcosdocs/mesosphere/dcos/cn/2.0/security/ent/service-auth/">服务帐户</a>，这取决于您的安全模式。</p>
<h2 id="-14"><a class="content__anchor" href="#-14" aria-hidden="true"><i data-feather="bookmark"></i></a><a name="sysd"></a>组件身份认证</h2>
<p>DC/OS 在 bootstrap 序列期间使用服务账户自动配置 DC/OS 组件（<a href="/dcosdocs/mesosphere/dcos/cn/2.0/overview/concepts/#systemd-service">DC/OS 节点上的系统服务</a></p>
<p>例如，Mesos 代理节点配置了用于向 Mesos 主节点进行身份认证的服务帐户。这确保仅授权代理节点可加入 Mesos 群集、宣传资源并被要求启动任务。</p>
<p>您可以从 DC/OS GUI 的 <strong>Organization -&gt; Service Accounts</strong> 选项卡查看 <code>systemd</code> 服务帐户。这些服务帐户以  为前缀。<code>dcos_</code>.</p>
<p class="message--warning"><strong>警告：</strong>修改任何自动配置服务账户的权限可能会导致服务失败。</p>
<h1 id="-15"><a class="content__anchor" href="#-15" aria-hidden="true"><i data-feather="bookmark"></i></a><a name="authorization"></a>授权</h1>
<p>除了对请求进行身份认证之外，DC/OS 还会检查与该帐户关联的权限，以确定请求者是否有权访问所请求的资源。</p>
<p>下图说明了授权顺序。</p>
<p><img src="/dcosdocs/mesosphere/dcos/cn/2.0/img/authz.png" alt="授权顺序"></p>
<p>图 3. 授权顺序</p>
<p>图中的 <code>OPT</code> 序列说明了权限执行如何因安全模式而异。</p>
<ul>
<li>
<p>Admin Router 和密钥存储库在所有安全模式下执行其权限。</p>
</li>
<li>
<p>Metronome 和 Marathon 在 <code>permissive</code> 和 <code>strict</code> 模式执行其权限。但是，只有在请求者提供认证令牌时才会执行 <code>permissive</code> 模式，这在 <code>permissive</code> 模式下是可选的。如果群集中的请求者未提供认证令牌，Metronome 和 Marathon 则将按照具有 <code>dcos:superuser</code> 权限的用户所作请求进行操作。</p>
</li>
<li>
<p>Mesos 主节点的和代理节点仅在 <code>strict</code> 安全模式下执行其权限。</p>
</li>
</ul>
<p>该图未显示密钥存储库序列。Admin Router 不会检查向密钥存储库请求的权限。它将这些请求发送给密钥存储库，后者会针对每个请求执行自己的权限。</p>
<p>有关权限的更多信息，请参阅<a href="/dcosdocs/mesosphere/dcos/cn/2.0/security/ent/perms-reference/">管理权限</a>.</p>
<h1 id="tls"><a class="content__anchor" href="#tls" aria-hidden="true"><i data-feather="bookmark"></i></a><a name="encryption"></a>传输层安全性 (TLS) 加密</h1>
<p>DC/OS 通信的加密因[安全模式]而异。(/dcosdocs/mesosphere/dcos/cn/2.0/security/ent/#security-modes).</p>
<table>
<thead>
<tr>
<th>安全模式</th>
<th>外部通信*</th>
<th>节点间通信</th>
</tr>
</thead>
<tbody>
<tr>
<td>宽容</td>
<td>支持 HTTP 和 HTTPS。根路径的 HTTP 请求（例如， <code>http://example.com/</code>）重定向到 HTTPS。具有与根路径不同的目标的 HTTP 请求（例如，<code>http://example.com/foo</code>）不会重定向到 HTTPS。如果使用密码登录 DC/OS，则可以选择是不安全地还是安全地传输密码（需要正确的证书验证，包括客户端上的主机名验证）。</td>
<td>启用加密</td>
</tr>
<tr>
<td>严格</td>
<td>仅支持 HTTPS。所有 HTTP 连接都重定向到 HTTPS。如果使用密码登录 DC/OS，则将安全地传输密码（需要正确的证书验证，包括客户端上的主机名验证）。如果一个或多个 HTTP 代理或负载均衡器在用户代理程序和 Admin Router 之间，则安全密码传输适用于 Admin Router 和先前代理或负载均衡器之间的最终通信。</td>
<td>执行加密**</td>
</tr>
</tbody>
</table>
<p>* 与群集以外的客户端的通信。例如，浏览器和 DC/OS CLI。</p>
<p>** 在任何安全模式下未加密的 ZooKeeper 实例之间的节点间通信除外。每个主节点都有 ZooKeeper 实例。这些 ZooKeeper 实例定期通信，以保持其内存数据库同步。您可以使用 <a href="https://datatracker.ietf.org/wg/ipsec/documents/">IPsec</a> 对这些通信进行手动加密。</p>
<p>目前，并非所有现有用户服务都支持加密。如果服务支持加密，则可以在 <code>permissive</code> 模式下启用它。在 <code>strict</code> 模式下，执行用户服务通信加密。因此，只能在 <code>strict</code> 模式下部署支持加密的用户服务。</p>
<p>节点间通信通过 TLS 1.2 进行。为确保浏览器支持，外部通信目前接受 TLS 1.0、1.1 和 1.2。这些设置是可配置的。</p>
<p>有关更多信息，请参阅<a href="/dcosdocs/mesosphere/dcos/cn/2.0/security/ent/tls-ssl/">使用 TLS 确保通信安全</a>.</p>
<h1 id="-16"><a class="content__anchor" href="#-16" aria-hidden="true"><i data-feather="bookmark"></i></a><a name="spaces"></a>空间</h1>
<p>空间允许您：</p>
<ul>
<li>
<p><a href="#serv-job">限制用户对服务和作业的访问</a> 。</p>
</li>
<li>
<p><a href="#secrets">限制对密钥的服务访问</a>。</p>
</li>
</ul>
<p>我们建议至少使用空间来限制对密钥的服务访问。</p>
<h2 id="-17"><a class="content__anchor" href="#-17" aria-hidden="true"><i data-feather="bookmark"></i></a><a name="serv-job"></a>服务和作业空间</h2>
<p>空间的一个方面涉及服务和作业组。您可以在任何安全模式下将服务和作业放入组中。这可帮助用户找到与其相关的作业或服务。</p>
<p>您可以使用<a href="/dcosdocs/mesosphere/dcos/cn/2.0/security/ent/perms-reference/#marathon-metronome">权限</a>来限制用户对每个服务/作业或服务/作业组的访问。</p>
<p>若要了解如何执行此操作，请参阅[控制用户对服务(/dcosdocs/mesosphere/dcos/cn/2.0/deploying-services/service-groups/)的访问]和<a href="/dcosdocs/mesosphere/dcos/cn/2.0/deploying-jobs/job-groups/">控制用户对作业的访问</a>.</p>
<h2 id="-18"><a class="content__anchor" href="#-18" aria-hidden="true"><i data-feather="bookmark"></i></a><a name="secrets"></a>密钥空间</h2>
<p>密钥路径控制哪些服务可以访问它。如果在存储密钥时未指定路径，则任何服务均可访问它。</p>
<p>密钥路径与服务组配合使用，以控制访问。但是，您无需让服务组控制对密钥的访问，您也可以使用服务的名称。下表提供了一些示例，以说明其工作方式。</p>
<table>
<thead>
<tr>
<th>密匙</th>
<th>服务</th>
<th>服务是否能访问密钥？</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>group/secret</code></td>
<td><code>/marathon-user/service</code></td>
<td>否</td>
</tr>
<tr>
<td><code>group/secret</code></td>
<td><code>/group/hdfs/service</code></td>
<td>是</td>
</tr>
<tr>
<td><code>group/hdfs/secret</code></td>
<td><code>/group/spark/service</code></td>
<td>否</td>
</tr>
<tr>
<td><code>hdfs/secret</code></td>
<td><code>/hdfs</code></td>
<td>是</td>
</tr>
</tbody>
</table>
<h3 id="notes"><a class="content__anchor" href="#notes" aria-hidden="true"><i data-feather="bookmark"></i></a>Notes</h3>
<ul>
<li>如果只有单个服务需要访问密钥，则将密钥存储在与服务名称匹配的路径中（例如， <code>hdfs/secret</code>). 这可防止其他服务访问。</li>
<li>服务组以 <code>/</code> 开头，而密钥路径则不是。</li>
</ul>
<h2 id="-19"><a class="content__anchor" href="#-19" aria-hidden="true"><i data-feather="bookmark"></i></a>密钥</h2>
<p>为了保护私钥、API 令牌和数据库密码等敏感值，DC/OS提供：</p>
<ul>
<li><a href="#storage-transport">安全存储和传输</a></li>
<li><a href="#access">细粒度访问控制</a></li>
</ul>
<h2 id="-20"><a class="content__anchor" href="#-20" aria-hidden="true"><i data-feather="bookmark"></i></a><a name="storage-transport"></a>密钥的安全存储和传输</h2>
<p>DC/OS 使用 Galois 计数器模式 (GCM) 中的高级加密标准 (AES) 算法将密钥存储库数据存储在 ZooKeeper 中。密钥存储库将密钥发送到 ZooKeeper™ 之前使用开封密钥加密密钥，并在从 ZooKeeper 收到密钥后解密密钥。这可确保密钥在休息和传输时都被加密。TLS 为从 ZooKeeper 传输到密钥存储库的密钥提供了额外的加密层。</p>
<p>开封密钥在公共 GPG 密钥下加密。对 <a href="/dcosdocs/mesosphere/dcos/cn/2.0/security/ent/secrets/secrets-api/">Secrets API</a> 的请求仅返回加密的开封密钥。当密钥存储库被手动或由于故障而被密封时，必须使用专用 GPG 密钥解密开封密钥并开启密钥存储库。为方便起见，DC/OS 在 bootstrap 序列期间自动生成新的 4096-bit GPG 密钥对。它使用此密钥对初始化密钥存储库，并将密钥对存储在 ZooKeeper 中。</p>
<p>密钥存储库适用于所有安全模式。默认情况下，您不能存储大于一兆字节的密钥。如果您需要超过此限制，请联系 Mesosphere 支持中心。我们目前不支持替代或额外的密钥存储库。您应只使用 Mesosphere 提供的 <code>default</code> 密钥存储库。</p>
<h2 id="-21"><a class="content__anchor" href="#-21" aria-hidden="true"><i data-feather="bookmark"></i></a><a name="access"></a>密钥的细粒度访问控制</h2>
<p>DC/OS 允许您限制：</p>
<ul>
<li>
<p>**用户对密钥的访问：**使用 <a href="/dcosdocs/mesosphere/dcos/cn/2.0/security/ent/perms-reference/#secrets">权限</a>控制哪些用户可以访问哪些密钥及其可执行的操作。</p>
</li>
<li>
<p>**应用程序对密钥的访问：**使用 <a href="/dcosdocs/mesosphere/dcos/cn/2.0/security/ent/#spaces">空间</a>以控制哪些应用程序可以检索哪些密钥。</p>
</li>
</ul>
<h1 id="linux"><a class="content__anchor" href="#linux" aria-hidden="true"><i data-feather="bookmark"></i></a><a name="linux-users"></a>Linux 用户帐户</h1>
<p>任务和沙盒文件的默认 Linux 用户根据您的<a href="/dcosdocs/mesosphere/dcos/cn/2.0/security/ent/#security-modes">安全模式</a>和任务在其中运行的<a href="/dcosdocs/mesosphere/dcos/cn/2.0/deploying-services/containerizers/">容器类型</a>而有所不同。</p>
<p>默认情况下，所有任务将在 Docker® 容器内运行。有关示例，请参阅<a href="/dcosdocs/mesosphere/dcos/cn/2.0/deploying-services/creating-services/deploy-docker-app/">将基于 Docker 的服务部署到 Marathon</a></p>
<p>下表列出了每种情况下的默认 Linux 用户。</p>
<table>
<thead>
<tr>
<th>容器类型</th>
<th>宽容</th>
<th>严格</th>
</tr>
</thead>
<tbody>
<tr>
<td>Mesos (UCR)</td>
<td>任务在 <code>root</code> 下运行。提取和创建的文件归  所有。<code>root</code>.</td>
<td>任务在  下运行。<code>nobody</code>. 提取和创建的文件归  所有。<code>nobody</code>.</td>
</tr>
<tr>
<td>Docker</td>
<td>任务在 <code>root</code> 下运行。提取和创建的文件归  所有。<code>root</code>.</td>
<td>任务在  下运行。<code>root</code>. 提取和创建的文件归  所有。<code>nobody</code>.</td>
</tr>
</tbody>
</table>
<p>默认情况下，Docker 任务在 <code>root</code> 下运行，但 Docker 用户权限仅限于 Docker 容器。如果您希望更改默认任务用户，请修改 Docker 容器。有关更多信息，请参考 <a href="https://docs.docker.com/engine/tutorials/dockerimages/">Docker 文档</a>以及用户服务<a href="/dcosdocs/mesosphere/dcos/cn/services/">文档</a>.</p>
<p class="message--note"><strong>注意：</strong>如果压缩了提取的文件，内部的单个文件将保留文件压缩时分配的权限和所有权，并且不受任何其他配置或设置的影响。
</p>
<p>请参阅 <a href="/dcosdocs/mesosphere/dcos/cn/2.0/security/ent/users-groups/config-linux-user/">覆盖默认 Linux 用户</a>.</p>
<div class="grid"><a class="grid__item" href="/dcosdocs/mesosphere/dcos/cn/2.0/security/ent/users-groups"><div class="grid__header__wrapper"><h3 class="grid__header">管理用户和组</h3><div class="grid__label__wrapper"><h6 class="grid__label grid__label--enterprise">ENTERPRISE</h6></div></div><div class="grid__desc__wrapper"><p class="grid__desc">管理用户和组<span class="grid__desc__ellipsis">&#8230;Read More</span></p></div><div class="grid__link"><i data-feather="arrow-right"></i></div></a><a class="grid__item" href="/dcosdocs/mesosphere/dcos/cn/2.0/security/ent/gui-permissions"><div class="grid__header__wrapper"><h3 class="grid__header">授予访问 UI 的权限</h3><div class="grid__label__wrapper"><h6 class="grid__label grid__label--enterprise">ENTERPRISE</h6></div></div><div class="grid__desc__wrapper"><p class="grid__desc">授予访问 DC/OS UI 的权限<span class="grid__desc__ellipsis">&#8230;Read More</span></p></div><div class="grid__link"><i data-feather="arrow-right"></i></div></a><a class="grid__item" href="/dcosdocs/mesosphere/dcos/cn/2.0/security/ent/perms-management"><div class="grid__header__wrapper"><h3 class="grid__header">权限管理</h3><div class="grid__label__wrapper"><h6 class="grid__label grid__label--enterprise">ENTERPRISE</h6></div></div><div class="grid__desc__wrapper"><p class="grid__desc">管理权限<span class="grid__desc__ellipsis">&#8230;Read More</span></p></div><div class="grid__link"><i data-feather="arrow-right"></i></div></a><a class="grid__item" href="/dcosdocs/mesosphere/dcos/cn/2.0/security/ent/perms-reference"><div class="grid__header__wrapper"><h3 class="grid__header">权限参考</h3><div class="grid__label__wrapper"><h6 class="grid__label grid__label--enterprise">ENTERPRISE</h6></div></div><div class="grid__desc__wrapper"><p class="grid__desc">了解 DC/OS 访问和权限参考<span class="grid__desc__ellipsis">&#8230;Read More</span></p></div><div class="grid__link"><i data-feather="arrow-right"></i></div></a><a class="grid__item" href="/dcosdocs/mesosphere/dcos/cn/2.0/security/ent/ldap"><div class="grid__header__wrapper"><h3 class="grid__header">LDAP 身份认证</h3><div class="grid__label__wrapper"><h6 class="grid__label grid__label--enterprise">ENTERPRISE</h6></div></div><div class="grid__desc__wrapper"><p class="grid__desc">通过 LDAP 设置基于目录的身份认证服务器<span class="grid__desc__ellipsis">&#8230;Read More</span></p></div><div class="grid__link"><i data-feather="arrow-right"></i></div></a><a class="grid__item" href="/dcosdocs/mesosphere/dcos/cn/2.0/security/ent/secrets"><div class="grid__header__wrapper"><h3 class="grid__header">密钥</h3><div class="grid__label__wrapper"><h6 class="grid__label grid__label--enterprise">ENTERPRISE</h6></div></div><div class="grid__desc__wrapper"><p class="grid__desc">了解密钥存储库<span class="grid__desc__ellipsis">&#8230;Read More</span></p></div><div class="grid__link"><i data-feather="arrow-right"></i></div></a><a class="grid__item" href="/dcosdocs/mesosphere/dcos/cn/2.0/security/ent/sso"><div class="grid__header__wrapper"><h3 class="grid__header">基于身份提供程序的身份认证</h3><div class="grid__label__wrapper"><h6 class="grid__label grid__label--enterprise">ENTERPRISE</h6></div></div><div class="grid__desc__wrapper"><p class="grid__desc">配置基于身份提供程序的身份认证<span class="grid__desc__ellipsis">&#8230;Read More</span></p></div><div class="grid__link"><i data-feather="arrow-right"></i></div></a><a class="grid__item" href="/dcosdocs/mesosphere/dcos/cn/2.0/security/ent/service-auth"><div class="grid__header__wrapper"><h3 class="grid__header">服务认证</h3><div class="grid__label__wrapper"><h6 class="grid__label grid__label--enterprise">ENTERPRISE</h6></div></div><div class="grid__desc__wrapper"><p class="grid__desc">认证服务帐户<span class="grid__desc__ellipsis">&#8230;Read More</span></p></div><div class="grid__link"><i data-feather="arrow-right"></i></div></a><a class="grid__item" href="/dcosdocs/mesosphere/dcos/cn/2.0/security/ent/restrict-service-access"><div class="grid__header__wrapper"><h3 class="grid__header">限制对 DC/OS 服务组的访问</h3><div class="grid__label__wrapper"><h6 class="grid__label grid__label--enterprise">ENTERPRISE</h6></div></div><div class="grid__desc__wrapper"><p class="grid__desc">使用 DC/OS UI 在宽容模式下实现多租户<span class="grid__desc__ellipsis">&#8230;Read More</span></p></div><div class="grid__link"><i data-feather="arrow-right"></i></div></a><a class="grid__item" href="/dcosdocs/mesosphere/dcos/cn/2.0/security/ent/hardening"><div class="grid__header__wrapper"><h3 class="grid__header">强化</h3><div class="grid__label__wrapper"><h6 class="grid__label grid__label--enterprise">ENTERPRISE</h6></div></div><div class="grid__desc__wrapper"><p class="grid__desc">增加群集的安全性<span class="grid__desc__ellipsis">&#8230;Read More</span></p></div><div class="grid__link"><i data-feather="arrow-right"></i></div></a><a class="grid__item" href="/dcosdocs/mesosphere/dcos/cn/2.0/security/ent/iam-api"><div class="grid__header__wrapper"><h3 class="grid__header">身份和访问管理 API</h3><div class="grid__label__wrapper"><h6 class="grid__label grid__label--enterprise">ENTERPRISE</h6></div></div><div class="grid__desc__wrapper"><p class="grid__desc">使用 IAM API 管理用户和权限<span class="grid__desc__ellipsis">&#8230;Read More</span></p></div><div class="grid__link"><i data-feather="arrow-right"></i></div></a><a class="grid__item" href="/dcosdocs/mesosphere/dcos/cn/2.0/security/ent/tls-ssl"><div class="grid__header__wrapper"><h3 class="grid__header">确保与 TLS 通信的安全</h3><div class="grid__label__wrapper"><h6 class="grid__label grid__label--enterprise">ENTERPRISE</h6></div></div><div class="grid__desc__wrapper"><p class="grid__desc">使用 TLS 证书确保加密通信的安全<span class="grid__desc__ellipsis">&#8230;Read More</span></p></div><div class="grid__link"><i data-feather="arrow-right"></i></div></a></div></article></div><aside class="content__sections"><div class="content__sections-list-container"><ul class="content__sections-list"><li class="content__sections-item content__sections-item--h1"><a href="#安全区">安全区</a></li><li class="content__sections-item content__sections-item--h2"><a href="#-2">管理区</a></li><li class="content__sections-item content__sections-item--h2"><a href="#-3">专用区</a></li><li class="content__sections-item content__sections-item--h2"><a href="#-4">公共区</a></li><li class="content__sections-item content__sections-item--h1"><a href="#-5">安全模式</a></li><li class="content__sections-item content__sections-item--h2"><a href="#-8">设置安全模式</a></li><li class="content__sections-item content__sections-item--h2"><a href="#-9">了解您的安全模式</a></li><li class="content__sections-item content__sections-item--h1"><a href="#-10">身份认证</a></li><li class="content__sections-item content__sections-item--h2"><a href="#-11">用户登录</a></li><li class="content__sections-item content__sections-item--h2"><a href="#-12">密码</a></li><li class="content__sections-item content__sections-item--h2"><a href="#-13">服务身份认证</a></li><li class="content__sections-item content__sections-item--h2"><a href="#-14">组件身份认证</a></li><li class="content__sections-item content__sections-item--h1"><a href="#-15">授权</a></li><li class="content__sections-item content__sections-item--h1"><a href="#tls">传输层安全性 (TLS) 加密</a></li><li class="content__sections-item content__sections-item--h1"><a href="#-16">空间</a></li><li class="content__sections-item content__sections-item--h2"><a href="#-17">服务和作业空间</a></li><li class="content__sections-item content__sections-item--h2"><a href="#-18">密钥空间</a></li><li class="content__sections-item content__sections-item--h2"><a href="#-19">密钥</a></li><li class="content__sections-item content__sections-item--h2"><a href="#-20">密钥的安全存储和传输</a></li><li class="content__sections-item content__sections-item--h2"><a href="#-21">密钥的细粒度访问控制</a></li><li class="content__sections-item content__sections-item--h1"><a href="#linux">Linux 用户帐户</a></li></ul></div></aside></main></div></div><script src="/dcosdocs/assets/js/jquery-3.2.1.js"></script><script src="/dcosdocs/assets/js/clipboard.js"></script><script src="/dcosdocs/assets/js/prism.js"></script><script src="/js/main.js"></script></body></html>