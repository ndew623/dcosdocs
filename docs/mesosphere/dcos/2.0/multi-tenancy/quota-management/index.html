<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width" initial-scale="1" user-scalable="no"><title>Quota Management - D2iQ Docs</title><meta name="description" content="Using groups and quota management for multi-tenancy"><link rel="apple-touch-icon" sizes="180x180" href="/dcosdocs/assets/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/dcosdocs/assets/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/dcosdocs/assets/favicon-16x16.png"><link rel="stylesheet" type="text/css" href="/dcosdocs/css/styles.css"><link rel="search" type="application/opensearchdescription+xml" href="/dcosdocs/assets/opensearch.xml" title="Search"><link href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,500,500i,700,700i" rel="stylesheet"><script src="https://unpkg.com/feather-icons/dist/feather.min.js"></script><script>window.analytics||(window.analytics=[]),window.analytics.methods=["identify","track","trackLink","trackForm","trackClick","trackSubmit","page","pageview","ab","alias","ready","group","on","once","off"],window.analytics.factory=function(t){return function(){var a=Array.prototype.slice.call(arguments);return a.unshift(t),window.analytics.push(a),window.analytics}};for(var i=0;i<window.analytics.methods.length;i++){var method=window.analytics.methods[i];window.analytics[method]=window.analytics.factory(method)}window.analytics.load=function(t){var a=document.createElement("script");a.type="text/javascript",a.async=!0,a.src=("https:"===document.location.protocol?"https://":"http://")+"d2dq2ahtl5zl1z.cloudfront.net/analytics.js/v1/"+t+"/analytics.min.js";var n=document.getElementsByTagName("script")[0];n.parentNode.insertBefore(a,n)},window.analytics.SNIPPET_VERSION="2.0.8",
window.analytics.load("7sgtwqvuai");
window.analytics.page();</script><noscript><iframe src="//www.googletagmanager.com/ns.html?id=GTM-PBJ84KX" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript><script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src='//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
})(window,document,'script','dataLayer','GTM-PBJ84KX');</script></head><body><div class="layout"><header class="header"><a class="header__drawer"><i class="header__icon" data-feather="menu"></i></a><a class="header__logo" href="/"><img class="header__logo--mobile" src="/dcosdocs/assets/D2iQ_Logotype_Color_Positive_Documentation.svg" alt="D2IQ"><img class="header__logo--desktop" src="/dcosdocs/assets/D2iQ_Logotype_Color_Positive_Documentation.svg" alt="D2IQ"></a><div class="header__main"><div class="header__dropdown"><img class="header__dropdown-icon" src="/dcosdocs/assets/D2IQ_Logotype_Color_Positive.png" alt="D2iQ"><strong>DC/OS Documentation</strong><i data-feather="chevron-down"></i></div><nav class="header__menu"><ul class="header__menu-list"><li class="header__menu-item"><a href="/mesosphere/dcos">DC/OS</a></li><li class="header__menu-item"><a href="/dcosdocs/mesosphere/dcos/services">Services</a></li><li class="header__menu-item"><a href="https://support.d2iq.com">Support</a></li></ul></nav></div><div class="chooser" id="localizer"><div class="chooser-current"><a class="chooser-title">English</a><svg class="chooser-svg" id="localizer-svg"><path class="pointer" d="m 13,6 -5,5 -5,-5 z" fill="#858585"></path></svg></div><ul class="chooser-list" id="localizer-list"><li class="chooser-list-item"><a href="/dcosdocs/mesosphere/dcos/cn/2.0/multi-tenancy/quota-management">中文 (简体)</a></li></ul></div><section class="header__search" role="search"><form class="header__search-form" action="/search/"><input class="header__search-input" id="header-search-input" tabindex="1" type="text" name="q" placeholder="Search"><input type="hidden" name="hFR[scope][0]" value="DC/OS 2.0"><label class="header__search-label" for="header-search-input"><i class="header__icon" data-feather="search"></i></label></form></section></header><div class="header-dropdown"><ul class="header-dropdown__list"><li class="header-dropdown__top-item"><div>DKP</div></li><li class="header-dropdown__item"><a href="/dkp/konvoy">Konvoy</a></li><li class="header-dropdown__item"><a href="/dkp/kommander">Kommander</a></li><li class="header-dropdown__item"><a href="/dkp/dispatch">Dispatch</a></li><li class="header-dropdown__item"><a href="/dkp/kaptain">Kaptain</a></li><li class="header-dropdown__top-item"><div>Mesosphere</div></li><li class="header-dropdown__item header-dropdown__item--active"><a href="/mesosphere/dcos">DC/OS</a></li><li class="header-dropdown__item"><a href="/dcosdocs/mesosphere/dcos/services">DC/OS Services</a></li><li class="header-dropdown__item"><a href="https://support.d2iq.com">Support</a></li></ul></div><div class="layout__sidebar layout__drawer"><section class="sidebar"><header class="sidebar__header"><div class="sidebar__dropdown"><ul><li><a href="/dcosdocs/mesosphere/dcos/2.2/multi-tenancy/quota-management">Mesosphere DC/OS 2.2.0</a></li><li><a href="/dcosdocs/mesosphere/dcos/2.1/multi-tenancy/quota-management">Mesosphere DC/OS 2.1.0</a></li><li><a href="/dcosdocs/mesosphere/dcos/2.0/multi-tenancy/quota-management">Mesosphere DC/OS 2.0</a></li><li><a href="/dcosdocs/mesosphere/dcos/1.13">Mesosphere DC/OS 1.13</a></li></ul><div class="toggle"><p><span class="title">DC/OS</span><span class="version"> 2.0</span></p><i data-feather="chevron-down"></i></div></div></header><nav class="sidebar_nav" role="navigation"><ul><li><a class="d0" href="/dcosdocs/mesosphere/dcos/2.0/release-notes/"><i data-feather="chevron-right"></i>Release Notes</a></li><li><a class="d0" href="/dcosdocs/mesosphere/dcos/2.0/overview/"><i data-feather="chevron-right"></i>Overview</a></li><li><a class="d0" href="/dcosdocs/mesosphere/dcos/2.0/installing/"><i data-feather="chevron-right"></i>Installing</a></li><li><a class="d0" href="/dcosdocs/mesosphere/dcos/2.0/gui/"><i data-feather="chevron-right"></i>GUI</a></li><li><a class="d0" href="/dcosdocs/mesosphere/dcos/2.0/cli/"><i data-feather="chevron-right"></i>CLI</a></li><li><a class="d0" href="/dcosdocs/mesosphere/dcos/2.0/administering-clusters/"><i data-feather="chevron-right"></i>Administering Clusters</a></li><li><a class="d0" href="/dcosdocs/mesosphere/dcos/2.0/networking/"><i data-feather="chevron-right"></i>Networking</a></li><li><a class="d0" href="/dcosdocs/mesosphere/dcos/2.0/security/"><i data-feather="chevron-right"></i>Security</a></li><li><a class="d0" href="/dcosdocs/mesosphere/dcos/2.0/storage/"><i data-feather="chevron-right"></i>Storage</a></li><li><a class="d0" href="/dcosdocs/mesosphere/dcos/2.0/metrics/"><i data-feather="chevron-right"></i>Metrics</a></li><li><a class="d0" href="/dcosdocs/mesosphere/dcos/2.0/monitoring/"><i data-feather="chevron-right"></i>Monitoring, Logging, and Debugging</a></li><li class="active"><a class="d0" href="/dcosdocs/mesosphere/dcos/2.0/multi-tenancy/"><i data-feather="chevron-right"></i>Multi-Tenancy for DC/OS Clusters</a></li><ul><li class="active active-on"><a class="d1" href="/dcosdocs/mesosphere/dcos/2.0/multi-tenancy/quota-management/">Quota Management</a></li><li><a class="d1" href="/dcosdocs/mesosphere/dcos/2.0/multi-tenancy/resource-mgmt-primitives/">Resource Management Primitives</a></li></ul><li><a class="d0" href="/dcosdocs/mesosphere/dcos/2.0/hybrid-cloud/"><i data-feather="chevron-right"></i>Hybrid Cloud</a></li><li><a class="d0" href="/dcosdocs/mesosphere/dcos/2.0/deploying-jobs/"><i data-feather="chevron-right"></i>Deploying Jobs</a></li><li><a class="d0" href="/dcosdocs/mesosphere/dcos/2.0/deploying-services/"><i data-feather="chevron-right"></i>Deploying Services and Pods</a></li><li><a class="d0" href="/dcosdocs/mesosphere/dcos/2.0/tutorials/"><i data-feather="chevron-right"></i>Tutorials</a></li><li><a class="d0" href="/dcosdocs/mesosphere/dcos/2.0/api/"><i data-feather="chevron-right"></i>API Reference</a></li><li><a class="d0" href="/dcosdocs/mesosphere/dcos/2.0/developing-services/"><i data-feather="chevron-right"></i>Developing DC/OS Services</a></li></ul></nav><footer class="sidebar__footer"><div class="sidebar__footer-links"><a href="https://d2iq.com/terms/">Terms of Service</a><a href="https://d2iq.com/privacy/">Privacy Policy</a></div><a class="sidebar__footer-copyright" href="https://d2iq.com/">&copy; 2022 D2iQ, Inc. All rights reserved.</a></footer></section></div><div class="layout__content" role="main"><main class="content"><div class="content__container content__container--with-sections"><div class="content__header"><div class="content__header__row"><h1 class="content__header-title">Quota Management</h1></div><h4 class="content__header-description">Using groups and quota management for multi-tenancy</h4><div class="actions"><ul class="actions__list"><li class="actions__item"><button class="actions__link" onclick="javascript:window.print()"><i class="actions__icon" data-feather="printer"></i><span class="actions__text">Print</span></button></li><li class="actions__item"><a class="actions__link" href="https://github.com/mesosphere/dcos-docs-site/tree/main/pages/dcosdocs/mesosphere/dcos/2.0/multi-tenancy/quota-management/index.md" target="_blank"><i class="actions__icon" data-feather="github"></i><span class="actions__text">Contribute</span></a></li></ul></div></div><article class="content__article"><p>Groups provide the foundation for supporting multi-tenant clusters using Mesosphere® DC/OS™. Groups enable you to create logical collections of services, permissions, secrets, and quotas. You can then use these logical collections to map a group to a specific team, project, or Line of Business.</p>
<p>The topics in this section discuss how you can use <strong>groups</strong> to manage resources by setting quota restrictions to support multi-tenancy.</p>
<h1 id="quotas"><a class="content__anchor" href="#quotas" aria-hidden="true"><i data-feather="bookmark"></i></a>Quotas</h1>
<p>You can define a <strong>quota</strong> to specify the maximum resources that the services in a group can use. After the limit is reached, no new services or scaling up of existing services is allowed.</p>
<p>Quota in DC/OS is built on top of the <a href="https://mesos.apache.org/documentation/latest/quota/">Quota Limits</a> primitive in Apache® Mesos®.
Specifically, the quota set on a top-level DC/OS group (for example, “/dev”) is translated to setting the quota limit on the corresponding resource role in Mesos (for example, “dev”).
Additionally, services launched inside a given group are configured to use the resources allocated to the <strong>group role</strong> (for example, “dev”), so that their resource consumption can be limited by the quota defined.</p>
<p>Quota in DC/OS 2.0 affects how public services are deployed. Please see the section below, “Deploying Services to Public Nodes”.</p>
<h1 id="prerequisites"><a class="content__anchor" href="#prerequisites" aria-hidden="true"><i data-feather="bookmark"></i></a>Prerequisites</h1>
<ul>
<li>
<p><a href="/dcosdocs/mesosphere/dcos/2.0/cli/">DC/OS CLI installed and configured</a>.</p>
</li>
<li>
<p>Sufficient <a href="/dcosdocs/mesosphere/dcos/2.0/security/ent/perms-reference">permissions</a> to manage quota (Enterprise DC/OS only).</p>
<p>Quota management operations are typically done by the cluster administrator.</p>
</li>
</ul>
<h1 id="creating-a-group"><a class="content__anchor" href="#creating-a-group" aria-hidden="true"><i data-feather="bookmark"></i></a>Creating a group</h1>
<p>To create a new group, dev, use the following command:</p>
<pre><code class="language-bash">dcos marathon group add --id /dev. # If the group doesn't exist
</code></pre>
<h1 id="setting-quota"><a class="content__anchor" href="#setting-quota" aria-hidden="true"><i data-feather="bookmark"></i></a>Setting quota</h1>
<p>To set quota for the first time on a group, use the following command:</p>
<pre><code class="language-bash">dcos quota create dev --cpu 10 --mem 1024
</code></pre>
<h1 id="viewing-quota"><a class="content__anchor" href="#viewing-quota" aria-hidden="true"><i data-feather="bookmark"></i></a>Viewing quota</h1>
<p>To view quota limits and consumption of a group, use the following command:</p>
<pre><code class="language-bash">dcos quota get dev
</code></pre>
<p>You can also view quota information in the DC/OS UI by going to the Quota tab in the <strong>Services</strong> view.</p>
<h1 id="updating-quota"><a class="content__anchor" href="#updating-quota" aria-hidden="true"><i data-feather="bookmark"></i></a>Updating quota</h1>
<p>For updating existing quota on a group, use the following command:</p>
<pre><code class="language-bash">dcos quota update dev --cpu 20 --mem 2048
</code></pre>
<h1 id="deleting-quota"><a class="content__anchor" href="#deleting-quota" aria-hidden="true"><i data-feather="bookmark"></i></a>Deleting quota</h1>
<p>To delete existing quota from a group, use the following command:</p>
<pre><code class="language-bash">dcos quota delete dev
</code></pre>
<p>Note that deleting quota doesn’t affect any running services inside the group. Services will keep running, but they won’t be limited by quota anymore.</p>
<h1 id="deploying-services"><a class="content__anchor" href="#deploying-services" aria-hidden="true"><i data-feather="bookmark"></i></a>Deploying services</h1>
<p>After a quota is set on a group by an administrator, regular users can deploy their services in a group as usual. If the <code>enforceRole</code> property is set on the group, the service will be automatically configured to use the group role and hence limited by the quota. If the property is not set, but users want their service be limited by a quota, they can configure their service with the group role manually.</p>
<h1 id="migrating-services"><a class="content__anchor" href="#migrating-services" aria-hidden="true"><i data-feather="bookmark"></i></a>Migrating services</h1>
<p>For backwards compatibility, any existing top-level groups will have <code>enforceRole</code> property set to false. Consequently, existing and new services launched in such groups continue to use their legacy role instead of the group role. To modify this and cause new services to consume quota, run:</p>
<pre><code class="language-bash">dcos marathon group update /dev enforeceRole=true # only needed for groups created before DC/OS 2.0
</code></pre>
<p>Existing services will continue to not consume quota and must be migrated. To migrate a stateless service that uses a legacy role to a group role, a user can update the role field of the service through an app or pod update:</p>
<pre><code class="language-bash">dcos marathon app update /dev/my-app role=dev
</code></pre>
<p>To migrate a stateful service (for example, DC/OS service for Kafka®, DC/OS service for Cassandra®), a user has to update the role of the service and run a <code>pod replace</code> command for each of the corresponding pods. Note that the <code>pod replace</code> command causes local persistent data to be lost.</p>
<p>Before running the <code>pod replace</code> command:</p>
<ol>
<li>
<p>Create a backup of the cluster state.</p>
</li>
<li>
<p>Ensure replication of underlying service can handle data loss of one node at a time.</p>
</li>
<li>
<p>Update the service role by running the following command:</p>
<pre><code class="language-bash">dcos kafka --name=/&lt;group&gt;/kafka update start --package-version=&quot;&lt;version-supporting-group-role&gt;&quot;
</code></pre>
</li>
</ol>
<p>After you complete the previous steps, run the following command for each pod:</p>
<pre><code class="language-bash">dcos kafka --name=/&lt;group&gt;/kafka pod replace &lt;pod-name&gt;
</code></pre>
<h1 id="deploying-services-to-public-nodes"><a class="content__anchor" href="#deploying-services-to-public-nodes" aria-hidden="true"><i data-feather="bookmark"></i></a>Deploying Services to Public Nodes</h1>
<p>Deploying services to public nodes requires two things:</p>
<ul>
<li>The service is run as role slave_public</li>
<li>The service has <code>{&quot;acceptedResourceRoles&quot;: [&quot;slave_public&quot;]}</code>.</li>
</ul>
<p>Services deployed in the root of Marathon will deploy as <code>slave_public</code>, by default. However:</p>
<ul>
<li>Services deployed in groups with <code>enforceRole</code> enabled <strong>WILL NOT</strong> use the role <code>slave_public</code> and therefore will not be able to be deployed to public nodes</li>
<li>Newly created groups (either explicitly or implicitly by posting a service to a group that does not yet exist) will have <code>enforceRole</code> enabled automatically.</li>
</ul>
<p>It is recommended to create a top-level group named <code>/public</code>, and disable enforceRole for it, and to place all of your public facing services in that folder.
Avoid mixing public and non-public services in the same top-level group.</p>
<pre><code>```
dcos marathon group add --id /public
dcos marathon group update /public enforceRole=false
```
</code></pre>
<h1 id="limitations"><a class="content__anchor" href="#limitations" aria-hidden="true"><i data-feather="bookmark"></i></a>Limitations</h1>
<ul>
<li>You can only set quota on top-level groups (for example, “/dev”) but not on nested groups (&quot;/dev/foo&quot;).</li>
<li>Services running in the root group (for example, /app) are not enforced by quota.</li>
<li>Not all of the Catalog services are enforced by quota. Refer to the specific service documentation for details.</li>
<li>Jobs are not enforced by quota.</li>
<li>Migrating stateful services cannot be done without incurring data loss.</li>
</ul>
<h1 id="additional-resources"><a class="content__anchor" href="#additional-resources" aria-hidden="true"><i data-feather="bookmark"></i></a>Additional resources</h1>
<p>You can use the following additional resources to learn more about using quota limits:</p>
<ul>
<li><a href="https://mesos.apache.org/documentation/latest/quota/">Mesos API</a></li>
</ul>
</article></div><aside class="content__sections"><div class="content__sections-list-container"><ul class="content__sections-list"><li class="content__sections-item content__sections-item--h1"><a href="#quotas">Quotas</a></li><li class="content__sections-item content__sections-item--h1"><a href="#prerequisites">Prerequisites</a></li><li class="content__sections-item content__sections-item--h1"><a href="#creating-a-group">Creating a group</a></li><li class="content__sections-item content__sections-item--h1"><a href="#setting-quota">Setting quota</a></li><li class="content__sections-item content__sections-item--h1"><a href="#viewing-quota">Viewing quota</a></li><li class="content__sections-item content__sections-item--h1"><a href="#updating-quota">Updating quota</a></li><li class="content__sections-item content__sections-item--h1"><a href="#deleting-quota">Deleting quota</a></li><li class="content__sections-item content__sections-item--h1"><a href="#deploying-services">Deploying services</a></li><li class="content__sections-item content__sections-item--h1"><a href="#migrating-services">Migrating services</a></li><li class="content__sections-item content__sections-item--h1"><a href="#deploying-services-to-public-nodes">Deploying Services to Public Nodes</a></li><li class="content__sections-item content__sections-item--h1"><a href="#limitations">Limitations</a></li><li class="content__sections-item content__sections-item--h1"><a href="#additional-resources">Additional resources</a></li></ul></div></aside></main></div></div><script src="/dcosdocs/assets/js/jquery-3.2.1.js"></script><script src="/dcosdocs/assets/js/clipboard.js"></script><script src="/dcosdocs/assets/js/prism.js"></script><script src="/js/main.js"></script></body></html>