<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width" initial-scale="1" user-scalable="no"><title>Mount Disk Resources - D2iQ Docs</title><meta name="description" content="Using Mesos to mount storage resources"><link rel="apple-touch-icon" sizes="180x180" href="/assets/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/favicon-16x16.png"><link rel="stylesheet" type="text/css" href="/css/styles.css"><link rel="search" type="application/opensearchdescription+xml" href="/assets/opensearch.xml" title="Search"><link href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,500,500i,700,700i" rel="stylesheet"><script src="https://unpkg.com/feather-icons/dist/feather.min.js"></script><script>window.analytics||(window.analytics=[]),window.analytics.methods=["identify","track","trackLink","trackForm","trackClick","trackSubmit","page","pageview","ab","alias","ready","group","on","once","off"],window.analytics.factory=function(t){return function(){var a=Array.prototype.slice.call(arguments);return a.unshift(t),window.analytics.push(a),window.analytics}};for(var i=0;i<window.analytics.methods.length;i++){var method=window.analytics.methods[i];window.analytics[method]=window.analytics.factory(method)}window.analytics.load=function(t){var a=document.createElement("script");a.type="text/javascript",a.async=!0,a.src=("https:"===document.location.protocol?"https://":"http://")+"d2dq2ahtl5zl1z.cloudfront.net/analytics.js/v1/"+t+"/analytics.min.js";var n=document.getElementsByTagName("script")[0];n.parentNode.insertBefore(a,n)},window.analytics.SNIPPET_VERSION="2.0.8",
window.analytics.load("7sgtwqvuai");
window.analytics.page();</script><noscript><iframe src="//www.googletagmanager.com/ns.html?id=GTM-PBJ84KX" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript><script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src='//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
})(window,document,'script','dataLayer','GTM-PBJ84KX');</script></head><body><div class="layout"><header class="header"><a class="header__drawer"><i class="header__icon" data-feather="menu"></i></a><a class="header__logo" href="/"><img class="header__logo--mobile" src="/assets/D2iQ_Logotype_Color_Positive_Documentation.svg" alt="D2IQ"><img class="header__logo--desktop" src="/assets/D2iQ_Logotype_Color_Positive_Documentation.svg" alt="D2IQ"></a><div class="header__main"><div class="header__dropdown"><img class="header__dropdown-icon" src="/assets/D2IQ_Logotype_Color_Positive.png" alt="D2iQ"><strong>DC/OS Documentation</strong><i data-feather="chevron-down"></i></div><nav class="header__menu"><ul class="header__menu-list"><li class="header__menu-item"><a href="/mesosphere/dcos">DC/OS</a></li><li class="header__menu-item"><a href="/dcosdocs/mesosphere/dcos/services">Services</a></li><li class="header__menu-item"><a href="https://support.d2iq.com">Support</a></li></ul></nav></div><div class="chooser" id="localizer"><div class="chooser-current"><a class="chooser-title">English</a><svg class="chooser-svg" id="localizer-svg"><path class="pointer" d="m 13,6 -5,5 -5,-5 z" fill="#858585"></path></svg></div><ul class="chooser-list" id="localizer-list"><li class="chooser-list-item"><a href="/dcosdocs/mesosphere/dcos/cn/2.0/storage/mount-disk-resources">中文 (简体)</a></li></ul></div><section class="header__search" role="search"><form class="header__search-form" action="/search/"><input class="header__search-input" id="header-search-input" tabindex="1" type="text" name="q" placeholder="Search"><input type="hidden" name="hFR[scope][0]" value="DC/OS 2.0"><label class="header__search-label" for="header-search-input"><i class="header__icon" data-feather="search"></i></label></form></section></header><div class="header-dropdown"><ul class="header-dropdown__list"><li class="header-dropdown__top-item"><div>DKP</div></li><li class="header-dropdown__item"><a href="/dkp/konvoy">Konvoy</a></li><li class="header-dropdown__item"><a href="/dkp/kommander">Kommander</a></li><li class="header-dropdown__item"><a href="/dkp/dispatch">Dispatch</a></li><li class="header-dropdown__item"><a href="/dkp/kaptain">Kaptain</a></li><li class="header-dropdown__top-item"><div>Mesosphere</div></li><li class="header-dropdown__item header-dropdown__item--active"><a href="/mesosphere/dcos">DC/OS</a></li><li class="header-dropdown__item"><a href="/dcosdocs/mesosphere/dcos/services">DC/OS Services</a></li><li class="header-dropdown__item"><a href="https://support.d2iq.com">Support</a></li></ul></div><div class="layout__sidebar layout__drawer"><section class="sidebar"><header class="sidebar__header"><div class="sidebar__dropdown"><ul><li><a href="/dcosdocs/mesosphere/dcos/2.2/storage/mount-disk-resources">Mesosphere DC/OS 2.2.0</a></li><li><a href="/dcosdocs/mesosphere/dcos/2.1/storage/mount-disk-resources">Mesosphere DC/OS 2.1.0</a></li><li><a href="/dcosdocs/mesosphere/dcos/2.0/storage/mount-disk-resources">Mesosphere DC/OS 2.0</a></li><li><a href="/dcosdocs/mesosphere/dcos/1.13/storage/mount-disk-resources">Mesosphere DC/OS 1.13</a></li></ul><div class="toggle"><p><span class="title">DC/OS</span><span class="version"> 2.0</span></p><i data-feather="chevron-down"></i></div></div></header><nav class="sidebar_nav" role="navigation"><ul><li><a class="d0" href="/dcosdocs/mesosphere/dcos/2.0/release-notes/"><i data-feather="chevron-right"></i>Release Notes</a></li><li><a class="d0" href="/dcosdocs/mesosphere/dcos/2.0/overview/"><i data-feather="chevron-right"></i>Overview</a></li><li><a class="d0" href="/dcosdocs/mesosphere/dcos/2.0/installing/"><i data-feather="chevron-right"></i>Installing</a></li><li><a class="d0" href="/dcosdocs/mesosphere/dcos/2.0/gui/"><i data-feather="chevron-right"></i>GUI</a></li><li><a class="d0" href="/dcosdocs/mesosphere/dcos/2.0/cli/"><i data-feather="chevron-right"></i>CLI</a></li><li><a class="d0" href="/dcosdocs/mesosphere/dcos/2.0/administering-clusters/"><i data-feather="chevron-right"></i>Administering Clusters</a></li><li><a class="d0" href="/dcosdocs/mesosphere/dcos/2.0/networking/"><i data-feather="chevron-right"></i>Networking</a></li><li><a class="d0" href="/dcosdocs/mesosphere/dcos/2.0/security/"><i data-feather="chevron-right"></i>Security</a></li><li class="active"><a class="d0" href="/dcosdocs/mesosphere/dcos/2.0/storage/"><i data-feather="chevron-right"></i>Storage</a></li><ul><li class="active active-on"><a class="d1" href="/dcosdocs/mesosphere/dcos/2.0/storage/mount-disk-resources/">Mount Disk Resources</a></li><li><a class="d1" href="/dcosdocs/mesosphere/dcos/2.0/storage/nfs/">NFS Server</a></li><li><a class="d1" href="/dcosdocs/mesosphere/dcos/2.0/storage/persistent-volume/">Local Persistent Volumes</a></li><li><a class="d1" href="/dcosdocs/mesosphere/dcos/2.0/storage/external-storage/">External Persistent Volumes</a></li></ul><li><a class="d0" href="/dcosdocs/mesosphere/dcos/2.0/metrics/"><i data-feather="chevron-right"></i>Metrics</a></li><li><a class="d0" href="/dcosdocs/mesosphere/dcos/2.0/monitoring/"><i data-feather="chevron-right"></i>Monitoring, Logging, and Debugging</a></li><li><a class="d0" href="/dcosdocs/mesosphere/dcos/2.0/multi-tenancy/"><i data-feather="chevron-right"></i>Multi-Tenancy for DC/OS Clusters</a></li><li><a class="d0" href="/dcosdocs/mesosphere/dcos/2.0/hybrid-cloud/"><i data-feather="chevron-right"></i>Hybrid Cloud</a></li><li><a class="d0" href="/dcosdocs/mesosphere/dcos/2.0/deploying-jobs/"><i data-feather="chevron-right"></i>Deploying Jobs</a></li><li><a class="d0" href="/dcosdocs/mesosphere/dcos/2.0/deploying-services/"><i data-feather="chevron-right"></i>Deploying Services and Pods</a></li><li><a class="d0" href="/dcosdocs/mesosphere/dcos/2.0/tutorials/"><i data-feather="chevron-right"></i>Tutorials</a></li><li><a class="d0" href="/dcosdocs/mesosphere/dcos/2.0/api/"><i data-feather="chevron-right"></i>API Reference</a></li><li><a class="d0" href="/dcosdocs/mesosphere/dcos/2.0/developing-services/"><i data-feather="chevron-right"></i>Developing DC/OS Services</a></li></ul></nav><footer class="sidebar__footer"><div class="sidebar__footer-links"><a href="https://d2iq.com/terms/">Terms of Service</a><a href="https://d2iq.com/privacy/">Privacy Policy</a></div><a class="sidebar__footer-copyright" href="https://d2iq.com/">&copy; 2022 D2iQ, Inc. All rights reserved.</a></footer></section></div><div class="layout__content" role="main"><main class="content"><div class="content__container content__container--with-sections"><div class="content__header"><div class="content__header__row"><h1 class="content__header-title">Mount Disk Resources</h1></div><h4 class="content__header-description">Using Mesos to mount storage resources</h4><div class="actions"><ul class="actions__list"><li class="actions__item"><button class="actions__link" onclick="javascript:window.print()"><i class="actions__icon" data-feather="printer"></i><span class="actions__text">Print</span></button></li><li class="actions__item"><a class="actions__link" href="https://github.com/mesosphere/dcos-docs-site/tree/main/pages/dcosdocs/mesosphere/dcos/2.0/storage/mount-disk-resources/index.md" target="_blank"><i class="actions__icon" data-feather="github"></i><span class="actions__text">Contribute</span></a></li></ul></div></div><article class="content__article"><p>With Mesosphere® DC/OS™, you can configure Apache® Mesos® <a href="http://mesos.apache.org/documentation/latest/multiple-disk/"><code>Mount</code> disk resources</a> across your cluster by mounting storage resources on agents using a well-known path.</p>
<p>When a DC/OS agent starts, it scans for volumes that match the pattern <code>/dcos/volume&lt;N&gt;</code>, where <code>&lt;N&gt;</code> is an integer. The agent is then automatically configured to offer these disk resources to other services.</p>
<h1 id="example-using-loopback-device"><a class="content__anchor" href="#example-using-loopback-device" aria-hidden="true"><i data-feather="bookmark"></i></a>Example using loopback device</h1>
<p>In this example, a disk resource is added to a DC/OS agent post-install on a running cluster. These same steps can be used pre-install without having to stop services or clear the agent state.</p>
<p>Please note that this example handles <strong>adding</strong> resources exclusively and can not get applied the same way when removing resources.</p>
<p class="message--warning"><strong>WARNING: </strong> This will terminate any running tasks or services on the node.<p>
<ol>
<li>
<p>Connect to an agent in the cluster with SSH.</p>
</li>
<li>
<p>Examine the current agent resource state.</p>
<pre><code class="language-bash">cat /var/lib/dcos/mesos-resources
# Generated by make_disk_resources.py on 2016-05-05 17:04:29.868595
#

MESOS_RESOURCES='[{&quot;ranges&quot;: {&quot;range&quot;: [{&quot;end&quot;: 21, &quot;begin&quot;: 1}, {&quot;end&quot;: 5050, &quot;begin&quot;: 23}, {&quot;end&quot;: 32000, &quot;begin&quot;: 5052}]}, &quot;type&quot;:  &quot;RANGES&quot;, &quot;name&quot;: &quot;ports&quot;}, {&quot;role&quot;: &quot;*&quot;, &quot;type&quot;: &quot;SCALAR&quot;, &quot;name&quot;: &quot;disk&quot;, &quot;scalar&quot;: {&quot;value&quot;: 47540}}]'
</code></pre>
<p>Note there are no references yet for <code>/dcos/volume0</code>.</p>
</li>
<li>
<p>Stop the agent.</p>
<ul>
<li>
<p>On a <a href="/dcosdocs/mesosphere/dcos/2.0/overview/concepts/#private-agent-node">private</a> agent:</p>
<pre><code class="language-bash">sudo systemctl stop dcos-mesos-slave.service
</code></pre>
</li>
<li>
<p>On a <a href="/dcosdocs/mesosphere/dcos/2.0/overview/concepts/#public-agent-node">public</a> agent:</p>
<pre><code class="language-bash">sudo systemctl stop dcos-mesos-slave-public.service
</code></pre>
</li>
</ul>
</li>
<li>
<p>Clear agent state.</p>
<ol>
<li>
<p>Cache volume mount discovery resource state with this command:</p>
<pre><code class="language-bash">sudo mv -f /var/lib/dcos/mesos-resources /var/lib/dcos/mesos-resources.cache
</code></pre>
<p>DC/OS will check this file later to generate a new resource state for the agent.</p>
</li>
<li>
<p>Remove agent checkpoint state with this command:</p>
<pre><code class="language-bash">sudo rm -f /var/lib/mesos/slave/meta/slaves/latest
</code></pre>
</li>
</ol>
</li>
<li>
<p>Create a 200 MB loopback device.</p>
<pre><code class="language-bash">sudo mkdir -p /dcos/volume0
sudo dd if=/dev/zero of=/root/volume0.img bs=1M count=200
sudo losetup /dev/loop0 /root/volume0.img
sudo mkfs -t ext4 /dev/loop0
sudo losetup -d /dev/loop0
</code></pre>
<p>This is suitable for testing purposes only. Mount volumes must have at least 200 MB of free space available. 100 MB on each volume is reserved by DC/OS and is not available for other services.</p>
</li>
<li>
<p>Create <code>fstab</code> entry and mount.</p>
<p>Ensure the volume is mounted automatically at boot time. Something similar could also be done with a <code>systemd</code> mount unit.</p>
<pre><code class="language-bash">echo &quot;/root/volume0.img /dcos/volume0 auto loop 0 2&quot; | sudo tee -a /etc/fstab
sudo mount /dcos/volume0
</code></pre>
</li>
<li>
<p>Reboot.</p>
<pre><code class="language-bash">sudo reboot
</code></pre>
</li>
<li>
<p>SSH to the agent and review the <code>journald</code> logs for references to the new volume <code>/dcos/volume0</code>.</p>
<pre><code class="language-bash">journalctl -b | grep '/dcos/volume0'
</code></pre>
<p>In particular, there should be an entry for the agent starting up and the new volume0 <code>Mount</code> disk resource:</p>
<pre><code class="language-bash">May 05 19:18:40 dcos-agent-public-01234567000001 systemd[1]: Mounting /dcos/volume0...
May 05 19:18:42 dcos-agent-public-01234567000001 systemd[1]: Mounted /dcos/volume0.
May 05 19:18:46 dcos-agent-public-01234567000001 make_disk_resources.py[888]: Found matching mounts : [('/dcos/volume0', 74)]
May 05 19:18:46 dcos-agent-public-01234567000001 make_disk_resources.py[888]: Generated disk resources map: [{'name': 'disk', 'type': 'SCALAR', 'disk': {'source': {'mount': {'root': '/dcos/volume0'}, 'type': 'MOUNT'}}, 'role': '*', 'scalar': {'value': 74}}, {'name': 'disk', 'type': 'SCALAR', 'role': '*', 'scalar': {'value': 47540}}]
May 05 19:18:58 dcos-agent-public-01234567000001 mesos-slave[1891]: &quot; --oversubscribed_resources_interval=&quot;15secs&quot; --perf_duration=&quot;10secs&quot; --perf_interval=&quot;1mins&quot; --port=&quot;5051&quot; --qos_correction_interval_min=&quot;0ns&quot; --quiet=&quot;false&quot; --recover=&quot;reconnect&quot; --recovery_timeout=&quot;15mins&quot; --registration_backoff_factor=&quot;1secs&quot; --resources=&quot;[{&quot;name&quot;: &quot;ports&quot;, &quot;type&quot;: &quot;RANGES&quot;, &quot;ranges&quot;: {&quot;range&quot;: [{&quot;end&quot;: 21, &quot;begin&quot;: 1}, {&quot;end&quot;: 5050, &quot;begin&quot;: 23}, {&quot;end&quot;: 32000, &quot;begin&quot;: 5052}]}}, {&quot;name&quot;: &quot;disk&quot;, &quot;type&quot;: &quot;SCALAR&quot;, &quot;disk&quot;: {&quot;source&quot;: {&quot;mount&quot;: {&quot;root&quot;: &quot;/dcos/volume0&quot;}, &quot;type&quot;: &quot;&quot;}}, &quot;role&quot;: &quot;*&quot;, &quot;scalar&quot;: {&quot;value&quot;: 74}}, {&quot;name&quot;: &quot;disk&quot;, &quot;type&quot;: &quot;SCALAR&quot;, &quot;role&quot;: &quot;*&quot;, &quot;scalar&quot;: {&quot;value&quot;: 47540}}]&quot; --revocable_cpu_low_priority=&quot;true&quot; --sandbox_directory=&quot;/mnt/mesos/sandbox&quot; --slave_subsystems=&quot;cpu,memory&quot; --strict=&quot;true&quot; --switch_user=&quot;true&quot; --systemd_enable_support=&quot;true&quot; --systemd_runtime_directory=&quot;/run/systemd/system&quot; --version=&quot;false&quot; --work_dir=&quot;/var/lib/mesos/slave&quot;
</code></pre>
</li>
</ol>
<h1 id="example-using-a-mount-volume-within-a-marathon-app"><a class="content__anchor" href="#example-using-a-mount-volume-within-a-marathon-app" aria-hidden="true"><i data-feather="bookmark"></i></a>Example using a mount volume within a Marathon™ app</h1>
<pre><code class="language-json">{
  &quot;id&quot;: &quot;/mount-test-svc1&quot;,
  &quot;instances&quot;: 1,
  &quot;cpus&quot;: 0.1,
  &quot;mem&quot;: 128,
  &quot;networks&quot;: [
    {
      &quot;mode&quot;: &quot;container/bridge&quot;
    }
  ],
  &quot;disk&quot;: 0,
  &quot;gpus&quot;: 0,
  &quot;backoffSeconds&quot;: 1,
  &quot;backoffFactor&quot;: 1.15,
  &quot;maxLaunchDelaySeconds&quot;: 300,
  &quot;container&quot;: {
    &quot;type&quot;: &quot;DOCKER&quot;,
    &quot;volumes&quot;: [
      {
        &quot;persistent&quot;: {
          &quot;size&quot;: 25,
          &quot;type&quot;: &quot;mount&quot;
        },
        &quot;mode&quot;: &quot;RW&quot;,
        &quot;containerPath&quot;: &quot;volume0&quot;
      }
    ],
    &quot;docker&quot;: {
      &quot;image&quot;: &quot;nginx&quot;,
      &quot;privileged&quot;: false,
      &quot;forcePullImage&quot;: false
    },
    &quot;portMappings&quot;: [
      {
        &quot;containerPort&quot;: 80,
        &quot;hostPort&quot;: 0,
        &quot;servicePort&quot;: 10101,
        &quot;protocol&quot;: &quot;tcp&quot;,
        &quot;name&quot;: &quot;httpport&quot;,
        &quot;labels&quot;: {
          &quot;VIP_0&quot;: &quot;/mount-test-svc1:80&quot;
        }
      }
    ]
  },
  &quot;healthChecks&quot;: [
    {
      &quot;gracePeriodSeconds&quot;: 300,
      &quot;intervalSeconds&quot;: 60,
      &quot;timeoutSeconds&quot;: 20,
      &quot;maxConsecutiveFailures&quot;: 3,
      &quot;portIndex&quot;: 0,
      &quot;path&quot;: &quot;/&quot;,
      &quot;protocol&quot;: &quot;MESOS_HTTP&quot;,
      &quot;delaySeconds&quot;: 15
    }
  ],
  &quot;upgradeStrategy&quot;: {
    &quot;minimumHealthCapacity&quot;: 0.5,
    &quot;maximumOverCapacity&quot;: 0
  },
  &quot;unreachableStrategy&quot;: &quot;disabled&quot;,
  &quot;killSelection&quot;: &quot;YOUNGEST_FIRST&quot;,
  &quot;requirePorts&quot;: true,
  &quot;labels&quot;: {
    &quot;HAPROXY_GROUP&quot;: &quot;external&quot;
  }
}
</code></pre>
<p>After running this service, navigate to the <strong>Services &gt; Volumes</strong> tab in the web interface:</p>
<p><img src="/dcosdocs/mesosphere/dcos/2.0/img/mount-disk.png" alt="Mount disk"></p>
<p>Figure 1. Services &gt; Volumes tab</p>
<h1 id="cloud-provider-resources"><a class="content__anchor" href="#cloud-provider-resources" aria-hidden="true"><i data-feather="bookmark"></i></a>Cloud provider resources</h1>
<p>Cloud provider storage services are typically used to back DC/OS mount volumes. This reference material can be useful when designing a production DC/OS deployment:</p>
<ul>
<li><a href="http://docs.aws.amazon.com/AWSEC2/latest/UserGuide/AmazonEBS.html">Amazon: EBS®</a></li>
<li><a href="https://azure.microsoft.com/en-us/documentation/articles/virtual-machines-linux-about-disks-vhds/">Azure®: About disks and VHDs for Azure virtual machines</a></li>
<li><a href="https://azure.microsoft.com/en-us/documentation/articles/storage-introduction/#blob-storage">Azure: Introduction to Microsoft® Azure storage</a></li>
</ul>
<h1 id="best-practices"><a class="content__anchor" href="#best-practices" aria-hidden="true"><i data-feather="bookmark"></i></a>Best practices</h1>
<p><code>Mount</code> disk resources are primarily for stateful services like Kafka® and Cassandra® which can benefit from having dedicated storage available throughout the cluster. Any service that uses a <code>Mount</code> disk resource has exclusive access to the reserved resource. However, it is still important to consider the performance and reliability requirements for the service. The performance of a <code>Mount</code> disk resource is based on the characteristic of the underlying storage and DC/OS does not provide any data replication services. Consider the following:</p>
<ul>
<li>Use <code>Mount</code> disk resources with stateful services that have strict storage requirements.</li>
<li>Carefully consider the filesystem type, storage media (network attached, SSD, and so forth), and volume characteristics (RAID levels, sizing, and so forth) based on the storage needs and requirements of the stateful service.</li>
<li>Label Mesos agents using a Mesos attribute that reflects the characteristics of the agent’s disk mounts, e.g. IOPS200, RAID1, etc.</li>
<li>Associate stateful services with storage agents using Mesos Attribute constraints.</li>
<li>Consider isolating demanding storage services to dedicated storage agents, since the filesystem page cache is a host-level shared resource.</li>
<li>Ensure that all services using <code>Mount</code> disk resources are designed to handle the permanent loss of one or more <code>Mount</code> disk resources. Services are still responsible for managing data replication and retention, graceful recovery from failed agents, and backups of critical service state.</li>
</ul>
</article></div><aside class="content__sections"><div class="content__sections-list-container"><ul class="content__sections-list"><li class="content__sections-item content__sections-item--h1"><a href="#example-using-loopback-device">Example using loopback device</a></li><li class="content__sections-item content__sections-item--h1"><a href="#example-using-a-mount-volume-within-a-marathon-app">Example using a mount volume within a Marathon™ app</a></li><li class="content__sections-item content__sections-item--h1"><a href="#cloud-provider-resources">Cloud provider resources</a></li><li class="content__sections-item content__sections-item--h1"><a href="#best-practices">Best practices</a></li></ul></div></aside></main></div></div><script src="/assets/js/jquery-3.2.1.js"></script><script src="/assets/js/clipboard.js"></script><script src="/assets/js/prism.js"></script><script src="/js/main.js"></script></body></html>