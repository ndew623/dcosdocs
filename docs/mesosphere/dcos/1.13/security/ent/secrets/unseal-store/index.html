<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width" initial-scale="1" user-scalable="no"><title>Unsealing the Secret Store - D2iQ Docs</title><meta name="description" content="Understanding how to unseal the Secret Store"><link rel="apple-touch-icon" sizes="180x180" href="/assets/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/favicon-16x16.png"><link rel="stylesheet" type="text/css" href="/css/styles.css"><link rel="search" type="application/opensearchdescription+xml" href="/assets/opensearch.xml" title="Search"><link href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,500,500i,700,700i" rel="stylesheet"><script src="https://unpkg.com/feather-icons/dist/feather.min.js"></script><script>window.analytics||(window.analytics=[]),window.analytics.methods=["identify","track","trackLink","trackForm","trackClick","trackSubmit","page","pageview","ab","alias","ready","group","on","once","off"],window.analytics.factory=function(t){return function(){var a=Array.prototype.slice.call(arguments);return a.unshift(t),window.analytics.push(a),window.analytics}};for(var i=0;i<window.analytics.methods.length;i++){var method=window.analytics.methods[i];window.analytics[method]=window.analytics.factory(method)}window.analytics.load=function(t){var a=document.createElement("script");a.type="text/javascript",a.async=!0,a.src=("https:"===document.location.protocol?"https://":"http://")+"d2dq2ahtl5zl1z.cloudfront.net/analytics.js/v1/"+t+"/analytics.min.js";var n=document.getElementsByTagName("script")[0];n.parentNode.insertBefore(a,n)},window.analytics.SNIPPET_VERSION="2.0.8",
window.analytics.load("7sgtwqvuai");
window.analytics.page();</script><noscript><iframe src="//www.googletagmanager.com/ns.html?id=GTM-PBJ84KX" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript><script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src='//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
})(window,document,'script','dataLayer','GTM-PBJ84KX');</script></head><body><div class="layout"><header class="header"><a class="header__drawer"><i class="header__icon" data-feather="menu"></i></a><a class="header__logo" href="/"><img class="header__logo--mobile" src="/assets/D2iQ_Logotype_Color_Positive_Documentation.svg" alt="D2IQ"><img class="header__logo--desktop" src="/assets/D2iQ_Logotype_Color_Positive_Documentation.svg" alt="D2IQ"></a><div class="header__main"><div class="header__dropdown"><img class="header__dropdown-icon" src="/assets/D2IQ_Logotype_Color_Positive.png" alt="D2iQ"><strong>DC/OS Documentation</strong><i data-feather="chevron-down"></i></div><nav class="header__menu"><ul class="header__menu-list"><li class="header__menu-item"><a href="/mesosphere/dcos">DC/OS</a></li><li class="header__menu-item"><a href="/dcosdocs/mesosphere/dcos/services">Services</a></li><li class="header__menu-item"><a href="https://support.d2iq.com">Support</a></li></ul></nav></div><div class="chooser" id="localizer"><div class="chooser-current"><a class="chooser-title">English</a><svg class="chooser-svg" id="localizer-svg"><path class="pointer" d="m 13,6 -5,5 -5,-5 z" fill="#858585"></path></svg></div><ul class="chooser-list" id="localizer-list"><li class="chooser-list-item"><a href="/dcosdocs/mesosphere/dcos/cn/1.13/security/ent/secrets/unseal-store">中文 (简体)</a></li></ul></div><section class="header__search" role="search"><form class="header__search-form" action="/search/"><input class="header__search-input" id="header-search-input" tabindex="1" type="text" name="q" placeholder="Search"><input type="hidden" name="hFR[scope][0]" value="DC/OS 1.13"><label class="header__search-label" for="header-search-input"><i class="header__icon" data-feather="search"></i></label></form></section></header><div class="header-dropdown"><ul class="header-dropdown__list"><li class="header-dropdown__top-item"><div>DKP</div></li><li class="header-dropdown__item"><a href="/dkp/konvoy">Konvoy</a></li><li class="header-dropdown__item"><a href="/dkp/kommander">Kommander</a></li><li class="header-dropdown__item"><a href="/dkp/dispatch">Dispatch</a></li><li class="header-dropdown__item"><a href="/dkp/kaptain">Kaptain</a></li><li class="header-dropdown__top-item"><div>Mesosphere</div></li><li class="header-dropdown__item header-dropdown__item--active"><a href="/mesosphere/dcos">DC/OS</a></li><li class="header-dropdown__item"><a href="/dcosdocs/mesosphere/dcos/services">DC/OS Services</a></li><li class="header-dropdown__item"><a href="https://support.d2iq.com">Support</a></li></ul></div><div class="layout__sidebar layout__drawer"><section class="sidebar"><header class="sidebar__header"><div class="sidebar__dropdown"><ul><li><a href="/dcosdocs/mesosphere/dcos/2.2/security/ent/secrets/unseal-store">Mesosphere DC/OS 2.2.0</a></li><li><a href="/dcosdocs/mesosphere/dcos/2.1/security/ent/secrets/unseal-store">Mesosphere DC/OS 2.1.0</a></li><li><a href="/dcosdocs/mesosphere/dcos/2.0/security/ent/secrets/unseal-store">Mesosphere DC/OS 2.0</a></li><li><a href="/dcosdocs/mesosphere/dcos/1.13/security/ent/secrets/unseal-store">Mesosphere DC/OS 1.13</a></li></ul><div class="toggle"><p><span class="title">DC/OS</span><span class="version"> 1.13</span></p><i data-feather="chevron-down"></i></div></div></header><nav class="sidebar_nav" role="navigation"><ul><li><a class="d0" href="/dcosdocs/mesosphere/dcos/1.13/release-notes/"><i data-feather="chevron-right"></i>Release Notes</a></li><li><a class="d0" href="/dcosdocs/mesosphere/dcos/1.13/overview/"><i data-feather="chevron-right"></i>Overview</a></li><li><a class="d0" href="/dcosdocs/mesosphere/dcos/1.13/installing/"><i data-feather="chevron-right"></i>Installing</a></li><li><a class="d0" href="/dcosdocs/mesosphere/dcos/1.13/gui/"><i data-feather="chevron-right"></i>GUI</a></li><li><a class="d0" href="/dcosdocs/mesosphere/dcos/1.13/cli/"><i data-feather="chevron-right"></i>CLI</a></li><li><a class="d0" href="/dcosdocs/mesosphere/dcos/1.13/administering-clusters/"><i data-feather="chevron-right"></i>Administering Clusters</a></li><li><a class="d0" href="/dcosdocs/mesosphere/dcos/1.13/networking/"><i data-feather="chevron-right"></i>Networking</a></li><li class="active"><a class="d0" href="/dcosdocs/mesosphere/dcos/1.13/security/"><i data-feather="chevron-right"></i>Security</a></li><ul><li class="active"><a class="d1" href="/dcosdocs/mesosphere/dcos/1.13/security/ent/"><i data-feather="chevron-right"></i>DC/OS Enterprise Security</a></li><ul><li><a class="d2" href="/dcosdocs/mesosphere/dcos/1.13/security/ent/users-groups/"><i data-feather="chevron-right"></i>Managing users and groups</a></li><li><a class="d2" href="/dcosdocs/mesosphere/dcos/1.13/security/ent/gui-permissions/"><i data-feather="chevron-right"></i>Granting Access to the UI</a></li><li><a class="d2" href="/dcosdocs/mesosphere/dcos/1.13/security/ent/perms-management/">Permissions Management</a></li><li><a class="d2" href="/dcosdocs/mesosphere/dcos/1.13/security/ent/perms-reference/">Permissions Reference</a></li><li><a class="d2" href="/dcosdocs/mesosphere/dcos/1.13/security/ent/ldap/"><i data-feather="chevron-right"></i>LDAP authentication</a></li><li class="active"><a class="d2" href="/dcosdocs/mesosphere/dcos/1.13/security/ent/secrets/"><i data-feather="chevron-right"></i>Secrets</a></li><ul><li><a class="d3" href="/dcosdocs/mesosphere/dcos/1.13/security/ent/secrets/create-secrets/">Creating secrets</a></li><li><a class="d3" href="/dcosdocs/mesosphere/dcos/1.13/security/ent/secrets/use-secrets/">Configuring services and pods</a></li><li><a class="d3" href="/dcosdocs/mesosphere/dcos/1.13/security/ent/secrets/seal-store/">Sealing the Secret Store</a></li><li class="active active-on"><a class="d3" href="/dcosdocs/mesosphere/dcos/1.13/security/ent/secrets/unseal-store/">Unsealing the Secret Store</a></li><li><a class="d3" href="/dcosdocs/mesosphere/dcos/1.13/security/ent/secrets/secrets-api/">Secrets API</a></li></ul><li><a class="d2" href="/dcosdocs/mesosphere/dcos/1.13/security/ent/sso/"><i data-feather="chevron-right"></i>Identity provider-based authentication</a></li><li><a class="d2" href="/dcosdocs/mesosphere/dcos/1.13/security/ent/service-auth/"><i data-feather="chevron-right"></i>Service Authentication</a></li><li><a class="d2" href="/dcosdocs/mesosphere/dcos/1.13/security/ent/restrict-service-access/">Restricting Access to DC/OS Service Groups</a></li><li><a class="d2" href="/dcosdocs/mesosphere/dcos/1.13/security/ent/hardening/">Hardening</a></li><li><a class="d2" href="/dcosdocs/mesosphere/dcos/1.13/security/ent/iam-api/">Identity and Access Management API</a></li><li><a class="d2" href="/dcosdocs/mesosphere/dcos/1.13/security/ent/tls-ssl/"><i data-feather="chevron-right"></i>Securing Communication with TLS</a></li></ul><li><a class="d1" href="/dcosdocs/mesosphere/dcos/1.13/security/oss/"><i data-feather="chevron-right"></i>DC/OS Open Source Security</a></li></ul><li><a class="d0" href="/dcosdocs/mesosphere/dcos/1.13/storage/"><i data-feather="chevron-right"></i>Storage</a></li><li><a class="d0" href="/dcosdocs/mesosphere/dcos/1.13/metrics/"><i data-feather="chevron-right"></i>Metrics</a></li><li><a class="d0" href="/dcosdocs/mesosphere/dcos/1.13/monitoring/"><i data-feather="chevron-right"></i>Monitoring, Logging, and Debugging</a></li><li><a class="d0" href="/dcosdocs/mesosphere/dcos/1.13/hybrid-cloud/"><i data-feather="chevron-right"></i>Hybrid Cloud</a></li><li><a class="d0" href="/dcosdocs/mesosphere/dcos/1.13/deploying-jobs/"><i data-feather="chevron-right"></i>Deploying Jobs</a></li><li><a class="d0" href="/dcosdocs/mesosphere/dcos/1.13/deploying-services/"><i data-feather="chevron-right"></i>Deploying Services and Pods</a></li><li><a class="d0" href="/dcosdocs/mesosphere/dcos/1.13/tutorials/"><i data-feather="chevron-right"></i>Tutorials</a></li><li><a class="d0" href="/dcosdocs/mesosphere/dcos/1.13/api/"><i data-feather="chevron-right"></i>API Reference</a></li><li><a class="d0" href="/dcosdocs/mesosphere/dcos/1.13/developing-services/"><i data-feather="chevron-right"></i>Developing DC/OS Services</a></li></ul></nav><footer class="sidebar__footer"><div class="sidebar__footer-links"><a href="https://d2iq.com/terms/">Terms of Service</a><a href="https://d2iq.com/privacy/">Privacy Policy</a></div><a class="sidebar__footer-copyright" href="https://d2iq.com/">&copy; 2022 D2iQ, Inc. All rights reserved.</a></footer></section></div><div class="layout__content" role="main"><main class="content"><div class="content__container content__container--with-sections"><div class="content__header"><div class="content__header__row"><h1 class="content__header-title">Unsealing the Secret Store</h1><p class="badge badge--content-header badge--enterprise">ENTERPRISE</p></div><h4 class="content__header-description">Understanding how to unseal the Secret Store</h4><div class="actions"><ul class="actions__list"><li class="actions__item"><button class="actions__link" onclick="javascript:window.print()"><i class="actions__icon" data-feather="printer"></i><span class="actions__text">Print</span></button></li><li class="actions__item"><a class="actions__link" href="https://github.com/mesosphere/dcos-docs-site/tree/main/pages/dcosdocs/mesosphere/dcos/1.13/security/ent/secrets/unseal-store/index.md" target="_blank"><i class="actions__icon" data-feather="github"></i><span class="actions__text">Contribute</span></a></li></ul></div></div><article class="content__article"><h1 id="about-unsealing-the-secret-store"><a class="content__anchor" href="#about-unsealing-the-secret-store" aria-hidden="true"><i data-feather="bookmark"></i></a>About unsealing the Secret Store</h1>
<p>The Secret Store can become sealed under the following circumstances:</p>
<ul>
<li><a href="/dcosdocs/mesosphere/dcos/1.13/security/ent/secrets/seal-store/">After being manually sealed.</a></li>
<li>After a power outage.</li>
<li>Due to inability to access underlying storage (such as ZooKeeper) by the Vault instance.</li>
</ul>
<p>A sealed Secret Store cannot be accessed from the web interface. Secret values cannot be retrieved using the <a href="/dcosdocs/mesosphere/dcos/1.13/security/ent/secrets/secrets-api/">Secrets API</a>. Services that depend on values provisioned to them via environment variables may fail to deploy.</p>
<p>To unseal the Secret Store, complete the following steps. They will unseal just a single instance of <code>dcos-secrets</code>. If the cluster URL obtained through <code>dcos config show core.dcos_url</code> points to a load balancer and there is more than one master node in the cluster, then these steps should be issued against each master node instead, and the cluster URL should be changed to the address of individual master nodes.</p>
<p>The intended status of the seal is persisted, so if one of the prerequisites for sealing the store occurs, <code>dcos-secrets</code> will unseal it again automatically even after being restarted. Only the steps depicted in <a href="/dcosdocs/mesosphere/dcos/1.13/security/ent/secrets/seal-store/">sealing the store</a> will seal it back.</p>
<p><strong>Prerequisites:</strong></p>
<ul>
<li><a href="/dcosdocs/mesosphere/dcos/1.13/cli/install/">DC/OS CLI installed</a></li>
<li>Logged into the DC/OS CLI as a superuser via <code>dcos auth login</code></li>
<li>You must follow the steps in <a href="/dcosdocs/mesosphere/dcos/1.13/security/ent/tls-ssl/get-cert/">Downloading the Root Cert</a> before issuing the <code>curl</code> commands in this section.</li>
</ul>
<h1 id="unsealing-a-secret-store-sealed-with-default-keys"><a class="content__anchor" href="#unsealing-a-secret-store-sealed-with-default-keys" aria-hidden="true"><i data-feather="bookmark"></i></a><a name="unseal-def-keys"></a>Unsealing a Secret Store sealed with default keys</h1>
<ol>
<li>
<p>From a terminal prompt, check the status of the Secret Store:</p>
<pre><code class="language-bash">curl --cacert dcos-ca.crt -H &quot;Authorization: token=$(dcos config show core.dcos_acs_token)&quot; $(dcos config show core.dcos_url)/secrets/v1/seal-status/default
</code></pre>
</li>
<li>
<p>The Secret Store service should return a response like the following.</p>
<pre><code class="language-json">{&quot;sealed&quot;:true,&quot;threshold&quot;:1,&quot;shares&quot;:1,&quot;progress&quot;:0}
</code></pre>
<p>If the value of <code>&quot;sealed&quot;</code> is <code>false</code>, stop now. If the Secret Store is not sealed, you cannot unseal it.</p>
</li>
<li>
<p>Use the following <code>curl</code> command to unseal the store.</p>
<pre><code class="language-bash">curl -X PUT --cacert dcos-ca.crt -H &quot;Authorization: token=$(dcos config show core.dcos_acs_token)&quot; $(dcos config show core.dcos_url)/secrets/v1/auto-unseal/default
</code></pre>
</li>
<li>
<p>Confirm that the Secret Store was unsealed with this command.</p>
<pre><code class="language-bash">curl --cacert dcos-ca.crt -H &quot;Authorization: token=$(dcos config show core.dcos_acs_token)&quot; $(dcos config show core.dcos_url)/secrets/v1/seal-status/default
</code></pre>
<p>The Secret Store service returns the following JSON response, indicating success.</p>
<pre><code class="language-json">{&quot;sealed&quot;:false,&quot;threshold&quot;:1,&quot;shares&quot;:1,&quot;progress&quot;:0}
</code></pre>
</li>
</ol>
</article></div><aside class="content__sections"><div class="content__sections-list-container"><ul class="content__sections-list"><li class="content__sections-item content__sections-item--h1"><a href="#about-unsealing-the-secret-store">About unsealing the Secret Store</a></li><li class="content__sections-item content__sections-item--h1"><a href="#unsealing-a-secret-store-sealed-with-default-keys">Unsealing a Secret Store sealed with default keys</a></li></ul></div></aside></main></div></div><script src="/assets/js/jquery-3.2.1.js"></script><script src="/assets/js/clipboard.js"></script><script src="/assets/js/prism.js"></script><script src="/js/main.js"></script></body></html>