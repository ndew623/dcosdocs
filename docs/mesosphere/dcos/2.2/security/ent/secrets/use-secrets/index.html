<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width" initial-scale="1" user-scalable="no"><title>Configuring services and pods - D2iQ Docs</title><meta name="description" content="Configuring services and pods to use secrets"><link rel="apple-touch-icon" sizes="180x180" href="/dcosdocs/assets/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/dcosdocs/assets/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/dcosdocs/assets/favicon-16x16.png"><link rel="stylesheet" type="text/css" href="/dcosdocs/css/styles.css"><link rel="search" type="application/opensearchdescription+xml" href="/dcosdocs/assets/opensearch.xml" title="Search"><link href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,500,500i,700,700i" rel="stylesheet"><script src="https://unpkg.com/feather-icons/dist/feather.min.js"></script><script>window.analytics||(window.analytics=[]),window.analytics.methods=["identify","track","trackLink","trackForm","trackClick","trackSubmit","page","pageview","ab","alias","ready","group","on","once","off"],window.analytics.factory=function(t){return function(){var a=Array.prototype.slice.call(arguments);return a.unshift(t),window.analytics.push(a),window.analytics}};for(var i=0;i<window.analytics.methods.length;i++){var method=window.analytics.methods[i];window.analytics[method]=window.analytics.factory(method)}window.analytics.load=function(t){var a=document.createElement("script");a.type="text/javascript",a.async=!0,a.src=("https:"===document.location.protocol?"https://":"http://")+"d2dq2ahtl5zl1z.cloudfront.net/analytics.js/v1/"+t+"/analytics.min.js";var n=document.getElementsByTagName("script")[0];n.parentNode.insertBefore(a,n)},window.analytics.SNIPPET_VERSION="2.0.8",
window.analytics.load("7sgtwqvuai");
window.analytics.page();</script><noscript><iframe src="//www.googletagmanager.com/ns.html?id=GTM-PBJ84KX" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript><script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src='//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
})(window,document,'script','dataLayer','GTM-PBJ84KX');</script></head><body><div class="layout"><header class="header"><a class="header__drawer"><i class="header__icon" data-feather="menu"></i></a><a class="header__logo" href="/"><img class="header__logo--mobile" src="/dcosdocs/assets/D2iQ_Logotype_Color_Positive_Documentation.svg" alt="D2IQ"><img class="header__logo--desktop" src="/dcosdocs/assets/D2iQ_Logotype_Color_Positive_Documentation.svg" alt="D2IQ"></a><div class="header__main"><div class="header__dropdown"><img class="header__dropdown-icon" src="/dcosdocs/assets/D2IQ_Logotype_Color_Positive.png" alt="D2iQ"><strong>DC/OS Documentation</strong><i data-feather="chevron-down"></i></div><nav class="header__menu"><ul class="header__menu-list"><li class="header__menu-item"><a href="/mesosphere/dcos">DC/OS</a></li><li class="header__menu-item"><a href="/dcosdocs/mesosphere/dcos/services">Services</a></li><li class="header__menu-item"><a href="https://support.d2iq.com">Support</a></li></ul></nav></div><div class="chooser" id="spherer"><div class="chooser-current"><a class="chooser-title">Mesosphere</a><svg class="chooser-svg" id="spherer-svg"><path class="pointer" d="m 13,6 -5,5 -5,-5 z" fill="#858585"></path></svg></div><ul class="chooser-list" id="spherer-list"><li class="chooser-list-item"><a href="/mesosphere/dcos">DC/OS</a></li><li class="chooser-list-item"><a href="/dcosdocs/mesosphere/dcos/services">DC/OS Services</a></li></ul></div><div class="chooser" id="ks"><div class="chooser-current"><a class="chooser-title">DKP</a><svg class="chooser-svg" id="kspherer-svg"><path class="pointer" d="m 13,6 -5,5 -5,-5 z" fill="#858585"></path></svg></div><ul class="chooser-list" id="kspherer-list"><li class="chooser-list-item"><a href="/dkp/konvoy">Konvoy</a></li><li class="chooser-list-item"><a href="/dkp/kommander">Kommander</a></li><li class="chooser-list-item"><a href="/dkp/dispatch">Dispatch</a></li><li class="chooser-list-item"><a href="/dkp/kaptain">Kaptain</a></li></ul></div><div class="chooser" id="localizer"><div class="chooser-current"><a class="chooser-title">English</a><svg class="chooser-svg" id="localizer-svg"><path class="pointer" d="m 13,6 -5,5 -5,-5 z" fill="#858585"></path></svg></div><ul class="chooser-list" id="localizer-list"><li class="chooser-list-item"><a href="/dcosdocs/mesosphere/dcos/cn">中文 (简体)</a></li></ul></div><section class="header__search" role="search"><form class="header__search-form" action="/search/"><input class="header__search-input" id="header-search-input" tabindex="1" type="text" name="q" placeholder="Search"><input type="hidden" name="hFR[scope][0]" value="DC/OS 2.2"><label class="header__search-label" for="header-search-input"><i class="header__icon" data-feather="search"></i></label></form></section></header><div class="header-dropdown"><ul class="header-dropdown__list"><li class="header-dropdown__top-item"><div>DKP</div></li><li class="header-dropdown__item"><a href="/dkp/konvoy">Konvoy</a></li><li class="header-dropdown__item"><a href="/dkp/kommander">Kommander</a></li><li class="header-dropdown__item"><a href="/dkp/dispatch">Dispatch</a></li><li class="header-dropdown__item"><a href="/dkp/kaptain">Kaptain</a></li><li class="header-dropdown__top-item"><div>Mesosphere</div></li><li class="header-dropdown__item header-dropdown__item--active"><a href="/mesosphere/dcos">DC/OS</a></li><li class="header-dropdown__item"><a href="/dcosdocs/mesosphere/dcos/services">DC/OS Services</a></li><li class="header-dropdown__item"><a href="https://support.d2iq.com">Support</a></li></ul></div><div class="layout__sidebar layout__drawer"><section class="sidebar"><header class="sidebar__header"><div class="sidebar__dropdown"><ul><li><a href="/dcosdocs/mesosphere/dcos/2.2/security/ent/secrets/use-secrets">Mesosphere DC/OS 2.2.0</a></li><li><a href="/dcosdocs/mesosphere/dcos/2.1/security/ent/secrets/use-secrets">Mesosphere DC/OS 2.1.0</a></li><li><a href="/dcosdocs/mesosphere/dcos/2.0/security/ent/secrets/use-secrets">Mesosphere DC/OS 2.0</a></li><li><a href="/dcosdocs/mesosphere/dcos/1.13/security/ent/secrets/use-secrets">Mesosphere DC/OS 1.13</a></li></ul><div class="toggle"><p><span class="title">DC/OS</span><span class="version"> 2.2</span></p><i data-feather="chevron-down"></i></div></div></header><nav class="sidebar_nav" role="navigation"><ul><li><a class="d0" href="/dcosdocs/mesosphere/dcos/2.2/release-notes/"><i data-feather="chevron-right"></i>Release Notes</a></li><li><a class="d0" href="/dcosdocs/mesosphere/dcos/2.2/overview/"><i data-feather="chevron-right"></i>Overview</a></li><li><a class="d0" href="/dcosdocs/mesosphere/dcos/2.2/installing/"><i data-feather="chevron-right"></i>Installing</a></li><li><a class="d0" href="/dcosdocs/mesosphere/dcos/2.2/gui/"><i data-feather="chevron-right"></i>GUI</a></li><li><a class="d0" href="/dcosdocs/mesosphere/dcos/2.2/cli/"><i data-feather="chevron-right"></i>CLI</a></li><li><a class="d0" href="/dcosdocs/mesosphere/dcos/2.2/administering-clusters/"><i data-feather="chevron-right"></i>Administering Clusters</a></li><li><a class="d0" href="/dcosdocs/mesosphere/dcos/2.2/networking/"><i data-feather="chevron-right"></i>Networking</a></li><li class="active"><a class="d0" href="/dcosdocs/mesosphere/dcos/2.2/security/"><i data-feather="chevron-right"></i>Security</a></li><ul><li class="active"><a class="d1" href="/dcosdocs/mesosphere/dcos/2.2/security/ent/"><i data-feather="chevron-right"></i>DC/OS Enterprise Security</a></li><ul><li><a class="d2" href="/dcosdocs/mesosphere/dcos/2.2/security/ent/users-groups/"><i data-feather="chevron-right"></i>Managing users and groups</a></li><li><a class="d2" href="/dcosdocs/mesosphere/dcos/2.2/security/ent/gui-permissions/"><i data-feather="chevron-right"></i>Granting Access to the UI</a></li><li><a class="d2" href="/dcosdocs/mesosphere/dcos/2.2/security/ent/perms-management/">Permissions Management</a></li><li><a class="d2" href="/dcosdocs/mesosphere/dcos/2.2/security/ent/perms-reference/">Permissions Reference</a></li><li><a class="d2" href="/dcosdocs/mesosphere/dcos/2.2/security/ent/ldap/"><i data-feather="chevron-right"></i>LDAP authentication</a></li><li class="active"><a class="d2" href="/dcosdocs/mesosphere/dcos/2.2/security/ent/secrets/"><i data-feather="chevron-right"></i>Secrets</a></li><ul><li><a class="d3" href="/dcosdocs/mesosphere/dcos/2.2/security/ent/secrets/create-secrets/">Creating secrets</a></li><li class="active active-on"><a class="d3" href="/dcosdocs/mesosphere/dcos/2.2/security/ent/secrets/use-secrets/">Configuring services and pods</a></li><li><a class="d3" href="/dcosdocs/mesosphere/dcos/2.2/security/ent/secrets/seal-store/">Sealing the Secret Store</a></li><li><a class="d3" href="/dcosdocs/mesosphere/dcos/2.2/security/ent/secrets/unseal-store/">Unsealing the Secret Store</a></li><li><a class="d3" href="/dcosdocs/mesosphere/dcos/2.2/security/ent/secrets/secrets-api/">Secrets API</a></li></ul><li><a class="d2" href="/dcosdocs/mesosphere/dcos/2.2/security/ent/sso/"><i data-feather="chevron-right"></i>Identity provider-based authentication</a></li><li><a class="d2" href="/dcosdocs/mesosphere/dcos/2.2/security/ent/service-auth/"><i data-feather="chevron-right"></i>Service Authentication</a></li><li><a class="d2" href="/dcosdocs/mesosphere/dcos/2.2/security/ent/restrict-service-access/">Restricting Access to DC/OS Service Groups</a></li><li><a class="d2" href="/dcosdocs/mesosphere/dcos/2.2/security/ent/hardening/">Hardening</a></li><li><a class="d2" href="/dcosdocs/mesosphere/dcos/2.2/security/ent/iam-api/">Identity and Access Management API</a></li><li><a class="d2" href="/dcosdocs/mesosphere/dcos/2.2/security/ent/tls-ssl/"><i data-feather="chevron-right"></i>Securing Communication with TLS</a></li></ul><li><a class="d1" href="/dcosdocs/mesosphere/dcos/2.2/security/oss/"><i data-feather="chevron-right"></i>DC/OS Open Source Security</a></li></ul><li><a class="d0" href="/dcosdocs/mesosphere/dcos/2.2/storage/"><i data-feather="chevron-right"></i>Storage</a></li><li><a class="d0" href="/dcosdocs/mesosphere/dcos/2.2/metrics/"><i data-feather="chevron-right"></i>Metrics</a></li><li><a class="d0" href="/dcosdocs/mesosphere/dcos/2.2/monitoring/"><i data-feather="chevron-right"></i>Monitoring, Logging, and Debugging</a></li><li><a class="d0" href="/dcosdocs/mesosphere/dcos/2.2/multi-tenancy/"><i data-feather="chevron-right"></i>Multi-Tenancy for DC/OS Clusters</a></li><li><a class="d0" href="/dcosdocs/mesosphere/dcos/2.2/hybrid-cloud/"><i data-feather="chevron-right"></i>Hybrid Cloud</a></li><li><a class="d0" href="/dcosdocs/mesosphere/dcos/2.2/deploying-jobs/"><i data-feather="chevron-right"></i>Deploying Jobs</a></li><li><a class="d0" href="/dcosdocs/mesosphere/dcos/2.2/deploying-services/"><i data-feather="chevron-right"></i>Deploying Services and Pods</a></li><li><a class="d0" href="/dcosdocs/mesosphere/dcos/2.2/tutorials/"><i data-feather="chevron-right"></i>Tutorials</a></li><li><a class="d0" href="/dcosdocs/mesosphere/dcos/2.2/api/"><i data-feather="chevron-right"></i>API Reference</a></li><li><a class="d0" href="/dcosdocs/mesosphere/dcos/2.2/developing-services/"><i data-feather="chevron-right"></i>Developing DC/OS Services</a></li><li><a class="d0" href="/dcosdocs/mesosphere/dcos/2.2/archives/">Access Documentation Archives</a></li></ul></nav><footer class="sidebar__footer"><div class="sidebar__footer-links"><a href="https://d2iq.com/terms/">Terms of Service</a><a href="https://d2iq.com/privacy/">Privacy Policy</a></div><a class="sidebar__footer-copyright" href="https://d2iq.com/">&copy; 2021 D2iQ, Inc. All rights reserved.</a></footer></section></div><div class="layout__content" role="main"><main class="content"><div class="content__container content__container--with-sections"><div class="content__header"><div class="content__header__row"><h1 class="content__header-title">Configuring services and pods</h1><p class="badge badge--content-header badge--enterprise">ENTERPRISE</p></div><h4 class="content__header-description">Configuring services and pods to use secrets</h4><div class="actions"><ul class="actions__list"><li class="actions__item"><button class="actions__link" onclick="javascript:window.print()"><i class="actions__icon" data-feather="printer"></i><span class="actions__text">Print</span></button></li><li class="actions__item"><a class="actions__link" href="https://github.com/mesosphere/dcos-docs-site/tree/main/pages/dcosdocs/mesosphere/dcos/2.2/security/ent/secrets/use-secrets/index.md" target="_blank"><i class="actions__icon" data-feather="github"></i><span class="actions__text">Contribute</span></a></li></ul></div></div><article class="content__article"><!-- The source repository for this topic is https://github.com/dcos/dcos-docs-site -->
<p>Your service definition can reference secrets as environment variables or as a file.</p>
<h2 id="file-based-secrets"><a class="content__anchor" href="#file-based-secrets" aria-hidden="true"><i data-feather="bookmark"></i></a>File-based secrets</h2>
<p>You can reference the secret as a file for increased security from other processes, or if your service needs to read secrets from files mounted in the container. Referencing a file-based secret can be particularly useful for:</p>
<ul>
<li>Kerberos keytabs or other credential files.</li>
<li>SSL certificates.</li>
<li>Configuration files with sensitive data.</li>
</ul>
<p>File-based secrets are available in the sandbox of the task (<code>$MESOS_SANDBOX/&lt;configured-path&gt;</code>).</p>
<h3 id="prerequisites"><a class="content__anchor" href="#prerequisites" aria-hidden="true"><i data-feather="bookmark"></i></a>Prerequisites</h3>
<ul>
<li>
<p>An existing secret. The examples below use a secret called <code>my-secret</code> stored in the <code>developer</code> path. If you complete the steps in <a href="/dcosdocs/mesosphere/dcos/2.2/security/ent/secrets/create-secrets/">Creating secrets</a>, you will meet this prerequisite.</p>
</li>
<li>
<p><a href="/dcosdocs/mesosphere/dcos/2.2/cli/install/">DC/OS CLI installed</a> and the <a href="/dcosdocs/mesosphere/dcos/2.2/cli/enterprise-cli/#ent-cli-install">DC/OS Enterprise CLI installed</a>.</p>
</li>
<li>
<p>You must <a href="/dcosdocs/mesosphere/dcos/2.2/security/ent/tls-ssl/get-cert/">get the root cert</a> before issuing the curl commands in this section.</p>
</li>
<li>
<p>The appropriate permissions for your <a href="/dcosdocs/mesosphere/dcos/2.2/security/ent/#security-modes">security mode</a>.</p>
<table class="table">
  <tr>
    <th>Permission</th>
    <th>Enforced in</th>
  </tr>
  <tr>
    <td><code>dcos:adminrouter:service:marathon full</code></td>
    <td>All security modes</td>
  </tr>
  <tr>
    <td><code>dcos:service:marathon:marathon:services:/[<i>service-group</i> full</code></td>
    <td><code>strict</code> and <code>permissive</code> security modes</td>
  </tr>
</table>
<p>In <code>strict</code> mode, users may also need the following.</p>
<ul>
<li><code>dcos:adminrouter:ops:mesos full</code>: to view <strong>Task</strong> panel information.</li>
<li><code>dcos:adminrouter:ops:slave full</code>: to view the details about the task, including the logs.</li>
</ul>
<p>As long as the path of the secret and the path of the group <a href="/dcosdocs/mesosphere/dcos/2.2/security/ent/#spaces">match up properly</a>, the service will be able to access the secret value.</p>
</li>
</ul>
<p>The procedure differs depending on whether or not you want to make the secret available to a <a href="/dcosdocs/mesosphere/dcos/2.2/deploying-services/pods/">pod</a> or to an individual service.</p>
<ul>
<li><a href="#service">Individual service</a></li>
<li><a href="#pod">Pod</a></li>
</ul>
<h1 id="configuring-a-service-to-use-a-secret"><a class="content__anchor" href="#configuring-a-service-to-use-a-secret" aria-hidden="true"><i data-feather="bookmark"></i></a><a name="service"></a>Configuring a service to use a secret</h1>
<p>The procedure varies by interface. Refer to the section that corresponds to your desired interface.</p>
<ul>
<li>
<p><a href="#deploying-the-service-via-the-web-interface">web interface</a></p>
</li>
<li>
<p><a href="#deploying-the-service-via-marathon-app-definition">Marathon API</a></p>
</li>
</ul>
<h2 id="configuring-a-service-to-use-a-secret-via-the-web-interface"><a class="content__anchor" href="#configuring-a-service-to-use-a-secret-via-the-web-interface" aria-hidden="true"><i data-feather="bookmark"></i></a><a name="deploying-the-service-via-the-web-interface"></a>Configuring a service to use a secret via the web interface</h2>
<ol>
<li>
<p>Log into the web interface as a user with the necessary permissions as discussed in <a href="/dcosdocs/mesosphere/dcos/2.2/security/ent/perms-management/">Permissions Management</a> and <a href="/dcosdocs/mesosphere/dcos/2.2/security/ent/gui-permissions/secrets-tab/">Granting Access to the Secrets Tab</a>.</p>
</li>
<li>
<p>Click the <strong>Services</strong> tab.</p>
</li>
<li>
<p>Click the <strong>+</strong> icon in the top right.</p>
<p><img src="/dcosdocs/mesosphere/dcos/2.2/img/add-service.png" alt="Add a Service"></p>
<p>Figure 1. Running a service</p>
</li>
<li>
<p>Click the <strong>JSON Editor</strong> toggle.</p>
</li>
<li>
<p>Select the contents of the default JSON schema and delete them so that no text is shown in the black box.</p>
</li>
<li>
<p>Copy one of the following simple application definitions and paste it into the black box. This application definition creates a new service inside of the developer group and references a secret stored inside a developer path.</p>
<p>Environment variable-based secret:</p>
<pre><code class="language-json">{
   &quot;id&quot;:&quot;/developer/service&quot;,
   &quot;cmd&quot;:&quot;sleep 100&quot;,
   &quot;env&quot;:{
      &quot;MY_SECRET&quot;:{
         &quot;secret&quot;:&quot;secret0&quot;
      }
   },
   &quot;secrets&quot;:{
      &quot;secret0&quot;:{
         &quot;source&quot;:&quot;developer/my-secret&quot;
      }
   }
}
</code></pre>
<p>In the example above, DC/OS stores the secret under the environment variable <code>&quot;MY_SECRET&quot;</code>. Observe how the <code>&quot;env&quot;</code> and <code>&quot;secrets&quot;</code> objects are used to define environment variable-based secrets.</p>
<p>File-based secret:</p>
<pre><code class="language-json">{
  &quot;id&quot;: &quot;developer/service&quot;,
  &quot;cmd&quot;: &quot;sleep 100&quot;,
  &quot;container&quot;: {
     &quot;type&quot;: &quot;MESOS&quot;,
     &quot;volumes&quot;: [
      {
        &quot;containerPath&quot;: &quot;path&quot;,
        &quot;secret&quot;: &quot;secretpassword&quot;
      }
    ]
  },
  &quot;secrets&quot;: {
    &quot;secretpassword&quot;: {
      &quot;source&quot;: &quot;developer/databasepassword&quot;
    }
  }
}
</code></pre>
<p>In the example above, the secret will have the filename <code>path</code> and will be available in the task’s sandbox (<code>$MESOS_SANDBOX/path</code>).</p>
<p>Because the service and the secret paths match, the service will be able to access the secret. See <a href="/dcosdocs/mesosphere/dcos/2.2/security/ent/#spaces">Spaces</a> for more details about the paths.</p>
</li>
<li>
<p>Click <strong>REVIEW &amp; RUN</strong>.</p>
</li>
<li>
<p>Click <strong>RUN SERVICE</strong>.</p>
</li>
<li>
<p>Click the group name of your service, for example, <strong>developer</strong>.</p>
</li>
<li>
<p>Click the name of your service.</p>
</li>
<li>
<p>Click the name of its task.</p>
</li>
<li>
<p>Scroll through the <strong>Details</strong> tab to locate your <code>DCOS_SECRETS_DIRECTIVE</code> for environmment variable-based secrets.</p>
<p>If you want to test whether file-based secrets are successful, you can add <code>cat path</code> to the application <code>cmd</code> to have the secret printed to the <code>stdout</code> logs.</p>
<p>For example:</p>
<pre><code class="language-json">{
  &quot;id&quot;: &quot;developer/service&quot;,
  &quot;cmd&quot;: &quot;cat path &amp;&amp; sleep 100&quot;,
  &quot;container&quot;: {
    &quot;type&quot;: &quot;MESOS&quot;,
    &quot;volumes&quot;: [
  {
    &quot;containerPath&quot;: &quot;path&quot;,
    &quot;secret&quot;: &quot;secretpassword&quot;
  }
  ]
  },
    &quot;secrets&quot;: {
      &quot;secretpassword&quot;: {
        &quot;source&quot;: &quot;developer/databasepassword&quot;
    }
  }
}
</code></pre>
</li>
</ol>
<h1 id="configuring-a-service-to-use-an-environment-variable-based-secret-via-marathon-app-definition"><a class="content__anchor" href="#configuring-a-service-to-use-an-environment-variable-based-secret-via-marathon-app-definition" aria-hidden="true"><i data-feather="bookmark"></i></a><a name="deploying-the-service-via-marathon-app-definition"></a>Configuring a service to use an environment variable-based secret via Marathon app definition</h1>
<ol>
<li>
<p>Log into the CLI as a user with the necessary permissions via <code>dcos auth login</code>. Refer to <a href="#service">About configuring services and pods to use secrets</a> to discover the required permissions.</p>
</li>
<li>
<p>Within a text editor, create an application definition for your Marathon service. The following application definition creates a new service inside of the developer group and references a secret stored inside a developer path.</p>
<p>Environment variable-based secret:</p>
<pre><code class="language-json">{
   &quot;id&quot;:&quot;/developer/service&quot;,
   &quot;cmd&quot;:&quot;sleep 100&quot;,
   &quot;env&quot;:{
      &quot;MY_SECRET&quot;:{
         &quot;secret&quot;:&quot;secret0&quot;
      }
   },
   &quot;secrets&quot;:{
      &quot;secret0&quot;:{
         &quot;source&quot;:&quot;developer/my-secret&quot;
      }
   }
}
</code></pre>
<p>In the example above, DC/OS stores the secret under the environment variable <code>&quot;MY_SECRET&quot;</code>. Observe how the <code>&quot;env&quot;</code> and <code>&quot;secrets&quot;</code> objects are used to define environment variable-based secrets.</p>
<p>File-based secret:</p>
<pre><code class="language-json">{
  &quot;id&quot;: &quot;developer/service&quot;,
  &quot;cmd&quot;: &quot;sleep 100&quot;,
  &quot;container&quot;: {
     &quot;type&quot;: &quot;MESOS&quot;,
     &quot;volumes&quot;: [
      {
        &quot;containerPath&quot;: &quot;path&quot;,
        &quot;secret&quot;: &quot;secretpassword&quot;
      }
    ]
  },
  &quot;secrets&quot;: {
    &quot;secretpassword&quot;: {
      &quot;source&quot;: &quot;developer/databasepassword&quot;
    }
  }
}
</code></pre>
<p>Because the service group and the secret paths match, the service will be able to access the secret. See <a href="/dcosdocs/mesosphere/dcos/2.2/security/ent/#spaces">Spaces</a> for more details about the paths.</p>
</li>
<li>
<p>Save the file with a descriptive name, such as <code>myservice.json</code>.</p>
</li>
<li>
<p>Add the service to DC/OS via the DC/OS CLI.</p>
<pre><code class="language-bash">dcos marathon app add myservice.json
</code></pre>
<p>Alternatively, use the Marathon API to deploy the app as shown below.</p>
<pre><code class="language-bash">curl -X POST --cacert dcos-ca.crt $(dcos config show core.dcos_url)/service/marathon/v2/apps -d @myservice.json -H &quot;Content-type: application/json&quot; -H &quot;Authorization: token=$(dcos config show core.dcos_acs_token)&quot;
</code></pre>
</li>
<li>
<p>Open the DC/OS web interface.</p>
</li>
<li>
<p>Click the group name of your service, for example, <strong>developer</strong>.</p>
</li>
<li>
<p>Click the name of your service.</p>
</li>
<li>
<p>Click the name of its task.</p>
</li>
<li>
<p>Scroll through the <strong>Details</strong> tab to locate your <code>DCOS_SECRETS_DIRECTIVE</code> for environment variable-based secrets.</p>
<p>If you want to test whether file-based secrets are successful, you can add <code>cat path</code> to the application <code>cmd</code> to have the secret printed to the <code>stdout</code> logs.</p>
<p>For example:</p>
<pre><code class="language-json">{
  &quot;id&quot;: &quot;developer/service&quot;,
  &quot;cmd&quot;: &quot;cat path &amp;&amp; sleep 100&quot;,
  &quot;container&quot;: {
    &quot;type&quot;: &quot;MESOS&quot;,
    &quot;volumes&quot;: [
    {
    &quot;containerPath&quot;: &quot;path&quot;,
    &quot;secret&quot;: &quot;secretpassword&quot;
    }
  ]
  },
    &quot;secrets&quot;: {
      &quot;secretpassword&quot;: {
        &quot;source&quot;: &quot;developer/databasepassword&quot;
    }
  }
}
</code></pre>
</li>
</ol>
<h1 id="configuring-a-pod-to-use-a-secret"><a class="content__anchor" href="#configuring-a-pod-to-use-a-secret" aria-hidden="true"><i data-feather="bookmark"></i></a><a name="pod"></a>Configuring a pod to use a secret</h1>
<ol>
<li>
<p>Log into the CLI as a user with the necessary permissions via <code>dcos auth login</code>. Refer to <a href="#service">About configuring services and pods to use secrets</a> for more information about the permissions.</p>
</li>
<li>
<p>Within a text editor, create an application definition for your pod. You can add the secret using the <code>&quot;environment&quot;</code> and <code>&quot;secrets&quot;</code> objects as shown below. The following simple application defines a new service inside of the developer group and references a secret stored inside a developer path. It stores the secret under the environment variable <code>&quot;MY_SECRET&quot;</code>.</p>
<p>Environment variable-based secret:</p>
<pre><code class="language-json">{
  &quot;id&quot;: &quot;/developer/pod-secret&quot;,
  &quot;environment&quot;: {
    &quot;MY_SECRET&quot;: {
      &quot;secret&quot;: &quot;secret0&quot;
    }
  },
  &quot;secrets&quot;: {
    &quot;secret0&quot;: { &quot;source&quot;: &quot;developer/my-secret&quot;}
  },
  &quot;containers&quot;: [
    {
      &quot;name&quot;: &quot;container-1&quot;,
      &quot;resources&quot;: {
        &quot;cpus&quot;: 0.1,
        &quot;mem&quot;: 128
      },
      &quot;exec&quot;: {
        &quot;command&quot;: {
          &quot;shell&quot;: &quot;sleep 3600&quot;
        }
      }
    }
  ],
  &quot;scaling&quot;: {
    &quot;kind&quot;: &quot;fixed&quot;,
    &quot;instances&quot;: 1
  },
  &quot;networks&quot;: [
    {
      &quot;mode&quot;: &quot;host&quot;
    }
  ]
}
</code></pre>
<p>File-based secret:</p>
<pre><code class="language-json">{
  &quot;id&quot;: &quot;developer/pod-with-secrets&quot;,
  &quot;containers&quot;: [
     {
       &quot;type&quot;: &quot;MESOS&quot;,
       &quot;name&quot;: &quot;container-1&quot;,
       &quot;exec&quot;: {
         &quot;command&quot;: {
           &quot;shell&quot;: &quot;sleep 1&quot;
         }
     },
     &quot;volumeMounts&quot;: [
       {
         &quot;name&quot;: &quot;secretvolume&quot;,
         &quot;mountPath&quot;: &quot;path/to/db/password&quot;
       }
     ]
   }
 ],
 &quot;volumes&quot;: [
   {
     &quot;name&quot;: &quot;secretvolume&quot;,
     &quot;secret&quot;: &quot;secretpassword&quot;
   }
 ],
 &quot;secrets&quot;: {
   &quot;secretpassword&quot;: {
     &quot;source&quot;: &quot;developer/databasepassword&quot;
   }
 }
}
</code></pre>
 <p class="message--note"><strong>NOTE: </strong>Because the service group and the secret paths match, the pod will be able to access the secret. See <a href="/dcosdocs/mesosphere/dcos/2.2/security/ent/#spaces">Namespacing</a> for more details about the paths.</p>
</li>
<li>
<p>Save the file with a descriptive name, such as <code>mypod.json</code>.</p>
</li>
<li>
<p>Use the DC/OS CLI to deploy the pod as shown below.</p>
<pre><code class="language-bash">dcos marathon pod add mypod.json
</code></pre>
</li>
<li>
<p>Open the DC/OS web interface.</p>
</li>
<li>
<p>Click the group name of your service, for example, <strong>developer</strong>.</p>
</li>
<li>
<p>Click the name of your pod.</p>
</li>
<li>
<p>Click to open the <strong>Configuration</strong> tab.</p>
</li>
<li>
<p>Scroll to the <strong>Environment Variables</strong> area to locate your secret <code>MY_SECRET</code>.</p>
</li>
</ol>
<h2 id="limitation"><a class="content__anchor" href="#limitation" aria-hidden="true"><i data-feather="bookmark"></i></a>Limitation</h2>
<p>The file-based secrets work only with the UCR.</p>
</article></div><aside class="content__sections"><div class="content__sections-list-container"><ul class="content__sections-list"><li class="content__sections-item content__sections-item--h2"><a href="#file-based-secrets">File-based secrets</a></li><li class="content__sections-item content__sections-item--h1"><a href="#configuring-a-service-to-use-a-secret">Configuring a service to use a secret</a></li><li class="content__sections-item content__sections-item--h2"><a href="#configuring-a-service-to-use-a-secret-via-the-web-interface">Configuring a service to use a secret via the web interface</a></li><li class="content__sections-item content__sections-item--h1"><a href="#configuring-a-service-to-use-an-environment-variable-based-secret-via-marathon-app-definition">Configuring a service to use an environment variable-based secret via Marathon app definition</a></li><li class="content__sections-item content__sections-item--h1"><a href="#configuring-a-pod-to-use-a-secret">Configuring a pod to use a secret</a></li><li class="content__sections-item content__sections-item--h2"><a href="#limitation">Limitation</a></li></ul></div></aside></main></div></div><script src="/dcosdocs/assets/js/jquery-3.2.1.js"></script><script src="/dcosdocs/assets/js/clipboard.js"></script><script src="/dcosdocs/assets/js/prism.js"></script><script src="/js/main.js"></script></body></html>