<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width" initial-scale="1" user-scalable="no"><title>Installing and Managing DC/OS using Ansible - D2iQ Docs</title><meta name="description" content="Creating and managing your infrastructure and installation using Ansible modules."><link rel="apple-touch-icon" sizes="180x180" href="/assets/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/favicon-16x16.png"><link rel="stylesheet" type="text/css" href="/dcosdocs/css/styles.css"><link rel="search" type="application/opensearchdescription+xml" href="/assets/opensearch.xml" title="Search"><link href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,500,500i,700,700i" rel="stylesheet"><script src="https://unpkg.com/feather-icons/dist/feather.min.js"></script><script>window.analytics||(window.analytics=[]),window.analytics.methods=["identify","track","trackLink","trackForm","trackClick","trackSubmit","page","pageview","ab","alias","ready","group","on","once","off"],window.analytics.factory=function(t){return function(){var a=Array.prototype.slice.call(arguments);return a.unshift(t),window.analytics.push(a),window.analytics}};for(var i=0;i<window.analytics.methods.length;i++){var method=window.analytics.methods[i];window.analytics[method]=window.analytics.factory(method)}window.analytics.load=function(t){var a=document.createElement("script");a.type="text/javascript",a.async=!0,a.src=("https:"===document.location.protocol?"https://":"http://")+"d2dq2ahtl5zl1z.cloudfront.net/analytics.js/v1/"+t+"/analytics.min.js";var n=document.getElementsByTagName("script")[0];n.parentNode.insertBefore(a,n)},window.analytics.SNIPPET_VERSION="2.0.8",
window.analytics.load("7sgtwqvuai");
window.analytics.page();</script><noscript><iframe src="//www.googletagmanager.com/ns.html?id=GTM-PBJ84KX" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript><script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src='//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
})(window,document,'script','dataLayer','GTM-PBJ84KX');</script></head><body><div class="layout"><header class="header"><a class="header__drawer"><i class="header__icon" data-feather="menu"></i></a><a class="header__logo" href="/"><img class="header__logo--mobile" src="/assets/D2iQ_Logotype_Color_Positive_Documentation.svg" alt="D2IQ"><img class="header__logo--desktop" src="/assets/D2iQ_Logotype_Color_Positive_Documentation.svg" alt="D2IQ"></a><div class="header__main"><div class="header__dropdown"><img class="header__dropdown-icon" src="/assets/D2IQ_Logotype_Color_Positive.png" alt="D2iQ"><strong>DC/OS Documentation</strong><i data-feather="chevron-down"></i></div><nav class="header__menu"><ul class="header__menu-list"><li class="header__menu-item"><a href="/mesosphere/dcos">DC/OS</a></li><li class="header__menu-item"><a href="/dcosdocs/mesosphere/dcos/services">Services</a></li><li class="header__menu-item"><a href="https://support.d2iq.com">Support</a></li></ul></nav></div><div class="chooser" id="localizer"><div class="chooser-current"><a class="chooser-title">English</a><svg class="chooser-svg" id="localizer-svg"><path class="pointer" d="m 13,6 -5,5 -5,-5 z" fill="#858585"></path></svg></div><ul class="chooser-list" id="localizer-list"><li class="chooser-list-item"><a href="/dcosdocs/mesosphere/dcos/cn/1.13/installing/production/dcos-ansible">中文 (简体)</a></li></ul></div><section class="header__search" role="search"><form class="header__search-form" action="/search/"><input class="header__search-input" id="header-search-input" tabindex="1" type="text" name="q" placeholder="Search"><input type="hidden" name="hFR[scope][0]" value="DC/OS 1.13"><label class="header__search-label" for="header-search-input"><i class="header__icon" data-feather="search"></i></label></form></section></header><div class="header-dropdown"><ul class="header-dropdown__list"><li class="header-dropdown__top-item"><div>DKP</div></li><li class="header-dropdown__item"><a href="/dkp/konvoy">Konvoy</a></li><li class="header-dropdown__item"><a href="/dkp/kommander">Kommander</a></li><li class="header-dropdown__item"><a href="/dkp/dispatch">Dispatch</a></li><li class="header-dropdown__item"><a href="/dkp/kaptain">Kaptain</a></li><li class="header-dropdown__top-item"><div>Mesosphere</div></li><li class="header-dropdown__item header-dropdown__item--active"><a href="/mesosphere/dcos">DC/OS</a></li><li class="header-dropdown__item"><a href="/dcosdocs/mesosphere/dcos/services">DC/OS Services</a></li><li class="header-dropdown__item"><a href="https://support.d2iq.com">Support</a></li></ul></div><div class="layout__sidebar layout__drawer"><section class="sidebar"><header class="sidebar__header"><div class="sidebar__dropdown"><ul><li><a href="/dcosdocs/mesosphere/dcos/2.2/installing/production/dcos-ansible">Mesosphere DC/OS 2.2.0</a></li><li><a href="/dcosdocs/mesosphere/dcos/2.1/installing/production/dcos-ansible">Mesosphere DC/OS 2.1.0</a></li><li><a href="/dcosdocs/mesosphere/dcos/2.0/installing/production/dcos-ansible">Mesosphere DC/OS 2.0</a></li><li><a href="/dcosdocs/mesosphere/dcos/1.13/installing/production/dcos-ansible">Mesosphere DC/OS 1.13</a></li></ul><div class="toggle"><p><span class="title">DC/OS</span><span class="version"> 1.13</span></p><i data-feather="chevron-down"></i></div></div></header><nav class="sidebar_nav" role="navigation"><ul><li><a class="d0" href="/dcosdocs/mesosphere/dcos/1.13/release-notes/"><i data-feather="chevron-right"></i>Release Notes</a></li><li><a class="d0" href="/dcosdocs/mesosphere/dcos/1.13/overview/"><i data-feather="chevron-right"></i>Overview</a></li><li class="active"><a class="d0" href="/dcosdocs/mesosphere/dcos/1.13/installing/"><i data-feather="chevron-right"></i>Installing</a></li><ul><li><a class="d1" href="/dcosdocs/mesosphere/dcos/1.13/installing/evaluation/"><i data-feather="chevron-right"></i>Cloud Installation</a></li><li class="active"><a class="d1" href="/dcosdocs/mesosphere/dcos/1.13/installing/production/"><i data-feather="chevron-right"></i>On-Prem Installation</a></li><ul><li><a class="d2" href="/dcosdocs/mesosphere/dcos/1.13/installing/production/virt-infra/">Virtual Infrastructure</a></li><li><a class="d2" href="/dcosdocs/mesosphere/dcos/1.13/installing/production/system-requirements/"><i data-feather="chevron-right"></i>System Requirements</a></li><li><a class="d2" href="/dcosdocs/mesosphere/dcos/1.13/installing/production/deploying-dcos/"><i data-feather="chevron-right"></i>Deploying DC/OS</a></li><li><a class="d2" href="/dcosdocs/mesosphere/dcos/1.13/installing/production/advanced-configuration/"><i data-feather="chevron-right"></i>Advanced Configuration</a></li><li class="active active-on"><a class="d2" href="/dcosdocs/mesosphere/dcos/1.13/installing/production/dcos-ansible/"><i data-feather="chevron-right"></i>DC/OS with Ansible</a></li><ul><li><a class="d3" href="/dcosdocs/mesosphere/dcos/1.13/installing/production/dcos-ansible/ansible-quickstart/">Ansible Quickstart</a></li><li><a class="d3" href="/dcosdocs/mesosphere/dcos/1.13/installing/production/dcos-ansible/ansible-faq/">DC/OS Ansible FAQ</a></li></ul><li><a class="d2" href="/dcosdocs/mesosphere/dcos/1.13/installing/production/patching/">Patching</a></li><li><a class="d2" href="/dcosdocs/mesosphere/dcos/1.13/installing/production/upgrading/">Upgrading</a></li><li><a class="d2" href="/dcosdocs/mesosphere/dcos/1.13/installing/production/uninstalling/">Uninstalling</a></li></ul><li><a class="d1" href="/dcosdocs/mesosphere/dcos/1.13/installing/installation-faq/">Frequently Asked Questions</a></li><li><a class="d1" href="/dcosdocs/mesosphere/dcos/1.13/installing/troubleshooting/">Troubleshooting</a></li></ul><li><a class="d0" href="/dcosdocs/mesosphere/dcos/1.13/gui/"><i data-feather="chevron-right"></i>GUI</a></li><li><a class="d0" href="/dcosdocs/mesosphere/dcos/1.13/cli/"><i data-feather="chevron-right"></i>CLI</a></li><li><a class="d0" href="/dcosdocs/mesosphere/dcos/1.13/administering-clusters/"><i data-feather="chevron-right"></i>Administering Clusters</a></li><li><a class="d0" href="/dcosdocs/mesosphere/dcos/1.13/networking/"><i data-feather="chevron-right"></i>Networking</a></li><li><a class="d0" href="/dcosdocs/mesosphere/dcos/1.13/security/"><i data-feather="chevron-right"></i>Security</a></li><li><a class="d0" href="/dcosdocs/mesosphere/dcos/1.13/storage/"><i data-feather="chevron-right"></i>Storage</a></li><li><a class="d0" href="/dcosdocs/mesosphere/dcos/1.13/metrics/"><i data-feather="chevron-right"></i>Metrics</a></li><li><a class="d0" href="/dcosdocs/mesosphere/dcos/1.13/monitoring/"><i data-feather="chevron-right"></i>Monitoring, Logging, and Debugging</a></li><li><a class="d0" href="/dcosdocs/mesosphere/dcos/1.13/hybrid-cloud/"><i data-feather="chevron-right"></i>Hybrid Cloud</a></li><li><a class="d0" href="/dcosdocs/mesosphere/dcos/1.13/deploying-jobs/"><i data-feather="chevron-right"></i>Deploying Jobs</a></li><li><a class="d0" href="/dcosdocs/mesosphere/dcos/1.13/deploying-services/"><i data-feather="chevron-right"></i>Deploying Services and Pods</a></li><li><a class="d0" href="/dcosdocs/mesosphere/dcos/1.13/tutorials/"><i data-feather="chevron-right"></i>Tutorials</a></li><li><a class="d0" href="/dcosdocs/mesosphere/dcos/1.13/api/"><i data-feather="chevron-right"></i>API Reference</a></li><li><a class="d0" href="/dcosdocs/mesosphere/dcos/1.13/developing-services/"><i data-feather="chevron-right"></i>Developing DC/OS Services</a></li></ul></nav><footer class="sidebar__footer"><div class="sidebar__footer-links"><a href="https://d2iq.com/terms/">Terms of Service</a><a href="https://d2iq.com/privacy/">Privacy Policy</a></div><a class="sidebar__footer-copyright" href="https://d2iq.com/">&copy; 2022 D2iQ, Inc. All rights reserved.</a></footer></section></div><div class="layout__content" role="main"><main class="content"><div class="content__container content__container--with-sections"><div class="content__header"><div class="content__header__row"><h1 class="content__header-title">Installing and Managing DC/OS using Ansible</h1></div><h4 class="content__header-description">Creating and managing your infrastructure and installation using Ansible modules.</h4><div class="actions"><ul class="actions__list"><li class="actions__item"><button class="actions__link" onclick="javascript:window.print()"><i class="actions__icon" data-feather="printer"></i><span class="actions__text">Print</span></button></li><li class="actions__item"><a class="actions__link" href="https://github.com/mesosphere/dcos-docs-site/tree/main/pages/dcosdocs/mesosphere/dcos/1.13/installing/production/dcos-ansible/index.md" target="_blank"><i class="actions__icon" data-feather="github"></i><span class="actions__text">Contribute</span></a></li></ul></div></div><article class="content__article"><p>The Mesosphere DC/OS Ansible roles are now a supported life cycle management method for DC/OS alongside the Mesosphere Universal Installer. For users that are already using Ansible to manage their infrastructure and applications, the Ansible roles will be usable with only a few changes to their existing stack, as they have been developed with isolations and strict name spacing in mind. While they have been developed to work with infrastructure provisioned with the Mesosphere Universal Installer, they can be used in combination with any cloud and on-premise setups.</p>
<p>We have broken down the lifecycle management of DC/OS into 4 roles to handle the different management aspects of DC/OS such as cluster prerequisites, bootstrap tasks, master tasks, private agent tasks and public agent tasks. Each role can be read about more below:</p>
<ul>
<li>Prerequisites - This role handles all of the <a href="/dcosdocs/mesosphere/dcos/1.13/installing/production/system-requirements/#software-prerequisites">requirements to run DC/OS</a>.</li>
<li>GPU - This Role is a specialized addition to the Prerequisites role. It detects Nvidia GPUs and tries to install the Drives on CentOS systems.</li>
<li>Bootstrap - The Boostrap role handles all tasks associated with downloading, generating and serving the DC/OS install and upgrade scripts to all nodes in the cluster.</li>
<li>Master - These tasks include downloading install and upgrade files from the Bootstrap node as well as handling some checks to ensure that upgrade has gone accordingly. It will back out upgrades if there problems keeping the cluster from going into an undesired state.</li>
<li>Agents - These task handle all upgrade and installation tasks for ALL agent types.</li>
</ul>
<h2 id="about-the-mesosphere-dcos-ansibles-roles"><a class="content__anchor" href="#about-the-mesosphere-dcos-ansibles-roles" aria-hidden="true"><i data-feather="bookmark"></i></a>About the Mesosphere DC/OS Ansibles roles</h2>
<p>Use the <a href="https://github.com/dcos/dcos-ansible">Mesosphere DC/OS Ansible roles</a> to install, upgrade and configure one or more DC/OS clusters using <a href="https://www.ansible.com/">Ansible</a>. The roles can be used in a both a new or existing Ansible setups and be downloaded from <a href="https://galaxy.ansible.com/dcos/dcos_ansible">the official Ansible Galaxy</a>.</p>
<p class="message--note"><strong>NOTE: </strong>DC/OS Ansible roles are only available for CentOS and RHEL platforms at this time.</p>
<h2 id="creating-test-instances-on-aws-with-terraform"><a class="content__anchor" href="#creating-test-instances-on-aws-with-terraform" aria-hidden="true"><i data-feather="bookmark"></i></a>Creating test instances on AWS with terraform</h2>
<p>If you would like to test out our Ansible solutions using pre-configured instances on AWS and are familiar with terraform, please <a href="https://gist.github.com/geekbass/45eb978fb420ae0da13f00fdfa0cd1c5">download and use this terraform script</a> to deploy a sample infrastructure so that you can deploy DC/OS on it using the ansible script above. The script is not officially supported by Mesosphere and is provided only for testing purposes.</p>
<p>To deploy the infra using the script:</p>
<ol>
<li>Create a new folder</li>
<li>Copy the above script to a file named main.tf</li>
<li>Initialize terraform: terraform init</li>
<li>Deploy the infrastructure using terraform apply</li>
</ol>
<p>Final output should be something like this:</p>
<pre><code class="language-bash">Apply complete! Resources: 32 added, 0 changed, 0 destroyed.

Outputs:

bootstrap_private_ip = 172.12.15.101
bootstraps = 3.87.63.8
cluster-address = dcosansible-660064571.us-east-1.elb.amazonaws.com
masters = 100.27.19.199
54.196.221.181
35.168.16.40
masters_private_ips = 172.12.6.95
172.12.29.65
172.12.42.160
private_agents = 34.207.192.11
3.80.226.211
3.85.31.136
public-agents-loadbalancer = ext-dcosansible-1616099901.us-east-1.elb.amazonaws.com
public_agents = 3.86.34.141
</code></pre>
<p>To learn more about using Terraform as your deployment manager visit the <a href="/dcosdocs/mesosphere/dcos/1.13/installing/evaluation/">Universal Installer page</a>.</p>
<h2 id="using-the-mesosphere-dcos-ansible-roles-in-combination-with-the-mesosphere-universal-installer"><a class="content__anchor" href="#using-the-mesosphere-dcos-ansible-roles-in-combination-with-the-mesosphere-universal-installer" aria-hidden="true"><i data-feather="bookmark"></i></a>Using the Mesosphere DC/OS Ansible roles in combination with the Mesosphere Universal Installer</h2>
<p>Mesosphere supports the use of a combination of the <a href="/dcosdocs/mesosphere/dcos/1.13/installing/evaluation/">Universal Installer</a> for infrastructure, a special <a href="https://github.com/dcos-terraform/terraform-localfile-dcos-ansible-bridge">Terraform-Ansible-Bridge-module</a> and Ansible to manage the life cycle of the DC/OS software.</p>
<pre><code class="language-hcl">module &quot;dcos-ansible-bridge&quot; {
  source  = &quot;dcos-terraform/dcos-ansible-bridge/local_file&quot;
  version = &quot;~&gt; 0.1.0&quot;

  bootstrap_ip         = &quot;${module.dcos-infrastructure.bootstrap.public_ip}&quot;
  master_ips           = [&quot;${module.dcos-infrastructure.masters.public_ips}&quot;]
  private_agent_ips    = [&quot;${module.dcos-infrastructure.private_agents.public_ips}&quot;]
  public_agent_ips     = [&quot;${module.dcos-infrastructure.public_agents.public_ips}&quot;]

  bootstrap_private_ip = &quot;${module.dcos-infrastructure.bootstrap.private_ip}&quot;
  master_private_ips   = [&quot;${module.dcos-infrastructure.masters.private_ips}&quot;]
}

module &quot;dcos-infrastructure&quot; {
  source  = &quot;dcos-terraform/infrastructure/aws&quot;
  version = &quot;~&gt; 0.1.0&quot;

  [...]

}
</code></pre>
<p>This will generate a local <code>hosts</code> file, which is an Ansbile compatible inventory file, that can be used to make Ansible aware of the cluster nodes as they are created by the Universal Installer. It will also generate a Ansbile compatible host vars file <code>dcos.yml</code> that will be populated by the clusters bootstrap and master nodes addresses. These two files can then be used to invoke any Ansible playbook against the cluster, such as <a href="https://github.com/dcos/dcos-ansible/blob/master/dcos.yml">the provided example one</a>, to roll out the roles to their respective nodes.</p>
<h2 id="using-the-mesosphere-dcos-ansible-roles-for-on-premise-setups"><a class="content__anchor" href="#using-the-mesosphere-dcos-ansible-roles-for-on-premise-setups" aria-hidden="true"><i data-feather="bookmark"></i></a>Using the Mesosphere DC/OS Ansible roles for on-premise setups</h2>
<p>Using Ansible to automate DC/OS installation, upgrades and configuration on on-premise setups is supported by Mesosphere. The <a href="https://galaxy.ansible.com/dcos/dcos_ansible">Mesosphere provided Ansible roles</a> will work with any setup that follows the <a href="/dcosdocs/mesosphere/dcos/1.13/installing/production/system-requirements/">Mesosphere DC/OS System Requirements</a> and runs with CentOS/RHEL.</p>
<h2 id="gpu-support"><a class="content__anchor" href="#gpu-support" aria-hidden="true"><i data-feather="bookmark"></i></a>GPU Support</h2>
<p>When using <a href="https://github.com/dcos/dcos-ansible/blob/master/dcos.yml">the provided example playbook</a>, it will automatically detect NVIDIA GPU hardware and try to install the appropriate drivers. This methods tries to work without any restart - the GPU role identifies the currently used kernel and tries to get its headers either from the current base repository or from the Centos vault repositories. This might fail if you have a custom Kernel in use. In that case we kindly ask you to not use this module by simply commenting it out in your Playbook and handling the driver installation by yourself. Once the driver is installed and CUDA Libraries are available the DC/OS agent will automatically offer GPU resources. <em>HINT: make sure to install the drivers before the DC/OS install happens.</em></p>
<div class="grid"><a class="grid__item" href="/dcosdocs/mesosphere/dcos/1.13/installing/production/dcos-ansible/ansible-quickstart"><div class="grid__header__wrapper"><h3 class="grid__header">DC/OS Ansible Quickstart Guide</h3></div><div class="grid__desc__wrapper"><p class="grid__desc">Guided walkthrough of installing DC/OS using Ansible.<span class="grid__desc__ellipsis">&#8230;Read More</span></p></div><div class="grid__link"><i data-feather="arrow-right"></i></div></a><a class="grid__item" href="/dcosdocs/mesosphere/dcos/1.13/installing/production/dcos-ansible/ansible-faq"><div class="grid__header__wrapper"><h3 class="grid__header">DC/OS Ansible FAQs and Troubleshooting</h3></div><div class="grid__desc__wrapper"><p class="grid__desc">Frequently asked questions and common issues when working with Ansible for DC/OS<span class="grid__desc__ellipsis">&#8230;Read More</span></p></div><div class="grid__link"><i data-feather="arrow-right"></i></div></a></div></article></div><aside class="content__sections"><div class="content__sections-list-container"><ul class="content__sections-list"><li class="content__sections-item content__sections-item--h2"><a href="#about-the-mesosphere-dcos-ansibles-roles">About the Mesosphere DC/OS Ansibles roles</a></li><li class="content__sections-item content__sections-item--h2"><a href="#creating-test-instances-on-aws-with-terraform">Creating test instances on AWS with terraform</a></li><li class="content__sections-item content__sections-item--h2"><a href="#using-the-mesosphere-dcos-ansible-roles-in-combination-with-the-mesosphere-universal-installer">Using the Mesosphere DC/OS Ansible roles in combination with the Mesosphere Universal Installer</a></li><li class="content__sections-item content__sections-item--h2"><a href="#using-the-mesosphere-dcos-ansible-roles-for-on-premise-setups">Using the Mesosphere DC/OS Ansible roles for on-premise setups</a></li><li class="content__sections-item content__sections-item--h2"><a href="#gpu-support">GPU Support</a></li></ul></div></aside></main></div></div><script src="/assets/js/jquery-3.2.1.js"></script><script src="/assets/js/clipboard.js"></script><script src="/assets/js/prism.js"></script><script src="/js/main.js"></script></body></html>