<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width" initial-scale="1" user-scalable="no"><title>Log Management with ELK - D2iQ Docs</title><meta name="description" content="Managing system and application logs from cluster nodes"><link rel="apple-touch-icon" sizes="180x180" href="/assets/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/favicon-16x16.png"><link rel="stylesheet" type="text/css" href="/css/styles.css"><link rel="search" type="application/opensearchdescription+xml" href="/assets/opensearch.xml" title="Search"><link href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,500,500i,700,700i" rel="stylesheet"><script src="https://unpkg.com/feather-icons/dist/feather.min.js"></script><script>window.analytics||(window.analytics=[]),window.analytics.methods=["identify","track","trackLink","trackForm","trackClick","trackSubmit","page","pageview","ab","alias","ready","group","on","once","off"],window.analytics.factory=function(t){return function(){var a=Array.prototype.slice.call(arguments);return a.unshift(t),window.analytics.push(a),window.analytics}};for(var i=0;i<window.analytics.methods.length;i++){var method=window.analytics.methods[i];window.analytics[method]=window.analytics.factory(method)}window.analytics.load=function(t){var a=document.createElement("script");a.type="text/javascript",a.async=!0,a.src=("https:"===document.location.protocol?"https://":"http://")+"d2dq2ahtl5zl1z.cloudfront.net/analytics.js/v1/"+t+"/analytics.min.js";var n=document.getElementsByTagName("script")[0];n.parentNode.insertBefore(a,n)},window.analytics.SNIPPET_VERSION="2.0.8",
window.analytics.load("7sgtwqvuai");
window.analytics.page();</script><noscript><iframe src="//www.googletagmanager.com/ns.html?id=GTM-PBJ84KX" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript><script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src='//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
})(window,document,'script','dataLayer','GTM-PBJ84KX');</script></head><body><div class="layout"><header class="header"><a class="header__drawer"><i class="header__icon" data-feather="menu"></i></a><a class="header__logo" href="/"><img class="header__logo--mobile" src="/assets/D2iQ_Logotype_Color_Positive_Documentation.svg" alt="D2IQ"><img class="header__logo--desktop" src="/assets/D2iQ_Logotype_Color_Positive_Documentation.svg" alt="D2IQ"></a><div class="header__main"><div class="header__dropdown"><img class="header__dropdown-icon" src="/assets/D2IQ_Logotype_Color_Positive.png" alt="D2iQ"><strong>DC/OS Documentation</strong><i data-feather="chevron-down"></i></div><nav class="header__menu"><ul class="header__menu-list"><li class="header__menu-item"><a href="/mesosphere/dcos">DC/OS</a></li><li class="header__menu-item"><a href="/dcosdocs/mesosphere/dcos/services">Services</a></li><li class="header__menu-item"><a href="https://support.d2iq.com">Support</a></li></ul></nav></div><div class="chooser" id="localizer"><div class="chooser-current"><a class="chooser-title">English</a><svg class="chooser-svg" id="localizer-svg"><path class="pointer" d="m 13,6 -5,5 -5,-5 z" fill="#858585"></path></svg></div><ul class="chooser-list" id="localizer-list"><li class="chooser-list-item"><a href="/dcosdocs/mesosphere/dcos/cn/2.0/monitoring/logging/aggregating/elk">中文 (简体)</a></li></ul></div><section class="header__search" role="search"><form class="header__search-form" action="/search/"><input class="header__search-input" id="header-search-input" tabindex="1" type="text" name="q" placeholder="Search"><input type="hidden" name="hFR[scope][0]" value="DC/OS 2.0"><label class="header__search-label" for="header-search-input"><i class="header__icon" data-feather="search"></i></label></form></section></header><div class="header-dropdown"><ul class="header-dropdown__list"><li class="header-dropdown__top-item"><div>DKP</div></li><li class="header-dropdown__item"><a href="/dkp/konvoy">Konvoy</a></li><li class="header-dropdown__item"><a href="/dkp/kommander">Kommander</a></li><li class="header-dropdown__item"><a href="/dkp/dispatch">Dispatch</a></li><li class="header-dropdown__item"><a href="/dkp/kaptain">Kaptain</a></li><li class="header-dropdown__top-item"><div>Mesosphere</div></li><li class="header-dropdown__item header-dropdown__item--active"><a href="/mesosphere/dcos">DC/OS</a></li><li class="header-dropdown__item"><a href="/dcosdocs/mesosphere/dcos/services">DC/OS Services</a></li><li class="header-dropdown__item"><a href="https://support.d2iq.com">Support</a></li></ul></div><div class="layout__sidebar layout__drawer"><section class="sidebar"><header class="sidebar__header"><div class="sidebar__dropdown"><ul><li><a href="/dcosdocs/mesosphere/dcos/2.2/monitoring/logging/aggregating/elk">Mesosphere DC/OS 2.2.0</a></li><li><a href="/dcosdocs/mesosphere/dcos/2.1/monitoring/logging/aggregating/elk">Mesosphere DC/OS 2.1.0</a></li><li><a href="/dcosdocs/mesosphere/dcos/2.0/monitoring/logging/aggregating/elk">Mesosphere DC/OS 2.0</a></li><li><a href="/dcosdocs/mesosphere/dcos/1.13/monitoring/logging/aggregating/elk">Mesosphere DC/OS 1.13</a></li></ul><div class="toggle"><p><span class="title">DC/OS</span><span class="version"> 2.0</span></p><i data-feather="chevron-down"></i></div></div></header><nav class="sidebar_nav" role="navigation"><ul><li><a class="d0" href="/dcosdocs/mesosphere/dcos/2.0/release-notes/"><i data-feather="chevron-right"></i>Release Notes</a></li><li><a class="d0" href="/dcosdocs/mesosphere/dcos/2.0/overview/"><i data-feather="chevron-right"></i>Overview</a></li><li><a class="d0" href="/dcosdocs/mesosphere/dcos/2.0/installing/"><i data-feather="chevron-right"></i>Installing</a></li><li><a class="d0" href="/dcosdocs/mesosphere/dcos/2.0/gui/"><i data-feather="chevron-right"></i>GUI</a></li><li><a class="d0" href="/dcosdocs/mesosphere/dcos/2.0/cli/"><i data-feather="chevron-right"></i>CLI</a></li><li><a class="d0" href="/dcosdocs/mesosphere/dcos/2.0/administering-clusters/"><i data-feather="chevron-right"></i>Administering Clusters</a></li><li><a class="d0" href="/dcosdocs/mesosphere/dcos/2.0/networking/"><i data-feather="chevron-right"></i>Networking</a></li><li><a class="d0" href="/dcosdocs/mesosphere/dcos/2.0/security/"><i data-feather="chevron-right"></i>Security</a></li><li><a class="d0" href="/dcosdocs/mesosphere/dcos/2.0/storage/"><i data-feather="chevron-right"></i>Storage</a></li><li><a class="d0" href="/dcosdocs/mesosphere/dcos/2.0/metrics/"><i data-feather="chevron-right"></i>Metrics</a></li><li class="active"><a class="d0" href="/dcosdocs/mesosphere/dcos/2.0/monitoring/"><i data-feather="chevron-right"></i>Monitoring, Logging, and Debugging</a></li><ul><li><a class="d1" href="/dcosdocs/mesosphere/dcos/2.0/monitoring/performance-monitoring/"><i data-feather="chevron-right"></i>Performance Monitoring</a></li><li class="active"><a class="d1" href="/dcosdocs/mesosphere/dcos/2.0/monitoring/logging/"><i data-feather="chevron-right"></i>Logging</a></li><ul><li><a class="d2" href="/dcosdocs/mesosphere/dcos/2.0/monitoring/logging/quickstart/">Quick Start</a></li><li><a class="d2" href="/dcosdocs/mesosphere/dcos/2.0/monitoring/logging/access-component-logs/">Accessing system and component logs</a></li><li><a class="d2" href="/dcosdocs/mesosphere/dcos/2.0/monitoring/logging/configure-task-logs/">Configuring Task Log Output and Retention</a></li><li><a class="d2" href="/dcosdocs/mesosphere/dcos/2.0/monitoring/logging/access-task-logs/">Controlling Access to Task Logs</a></li><li class="active"><a class="d2" href="/dcosdocs/mesosphere/dcos/2.0/monitoring/logging/aggregating/"><i data-feather="chevron-right"></i>Log Aggregation</a></li><ul><li class="active active-on"><a class="d3" href="/dcosdocs/mesosphere/dcos/2.0/monitoring/logging/aggregating/elk/">Log Management with ELK</a></li><li><a class="d3" href="/dcosdocs/mesosphere/dcos/2.0/monitoring/logging/aggregating/filter-elk/">Filtering Logs with ELK</a></li><li><a class="d3" href="/dcosdocs/mesosphere/dcos/2.0/monitoring/logging/aggregating/splunk/">Log Management with Splunk</a></li><li><a class="d3" href="/dcosdocs/mesosphere/dcos/2.0/monitoring/logging/aggregating/filter-splunk/">Filtering Logs with Splunk</a></li></ul><li><a class="d2" href="/dcosdocs/mesosphere/dcos/2.0/monitoring/logging/logging-reference/">Logging Reference</a></li><li><a class="d2" href="/dcosdocs/mesosphere/dcos/2.0/monitoring/logging/logging-api-examples/">Logging API Examples</a></li></ul><li><a class="d1" href="/dcosdocs/mesosphere/dcos/2.0/monitoring/debugging/"><i data-feather="chevron-right"></i>Debugging</a></li></ul><li><a class="d0" href="/dcosdocs/mesosphere/dcos/2.0/multi-tenancy/"><i data-feather="chevron-right"></i>Multi-Tenancy for DC/OS Clusters</a></li><li><a class="d0" href="/dcosdocs/mesosphere/dcos/2.0/hybrid-cloud/"><i data-feather="chevron-right"></i>Hybrid Cloud</a></li><li><a class="d0" href="/dcosdocs/mesosphere/dcos/2.0/deploying-jobs/"><i data-feather="chevron-right"></i>Deploying Jobs</a></li><li><a class="d0" href="/dcosdocs/mesosphere/dcos/2.0/deploying-services/"><i data-feather="chevron-right"></i>Deploying Services and Pods</a></li><li><a class="d0" href="/dcosdocs/mesosphere/dcos/2.0/tutorials/"><i data-feather="chevron-right"></i>Tutorials</a></li><li><a class="d0" href="/dcosdocs/mesosphere/dcos/2.0/api/"><i data-feather="chevron-right"></i>API Reference</a></li><li><a class="d0" href="/dcosdocs/mesosphere/dcos/2.0/developing-services/"><i data-feather="chevron-right"></i>Developing DC/OS Services</a></li></ul></nav><footer class="sidebar__footer"><div class="sidebar__footer-links"><a href="https://d2iq.com/terms/">Terms of Service</a><a href="https://d2iq.com/privacy/">Privacy Policy</a></div><a class="sidebar__footer-copyright" href="https://d2iq.com/">&copy; 2022 D2iQ, Inc. All rights reserved.</a></footer></section></div><div class="layout__content" role="main"><main class="content"><div class="content__container content__container--with-sections"><div class="content__header"><div class="content__header__row"><h1 class="content__header-title">Log Management with ELK</h1></div><h4 class="content__header-description">Managing system and application logs from cluster nodes</h4><div class="actions"><ul class="actions__list"><li class="actions__item"><button class="actions__link" onclick="javascript:window.print()"><i class="actions__icon" data-feather="printer"></i><span class="actions__text">Print</span></button></li><li class="actions__item"><a class="actions__link" href="https://github.com/mesosphere/dcos-docs-site/tree/main/pages/dcosdocs/mesosphere/dcos/2.0/monitoring/logging/aggregating/elk/index.md" target="_blank"><i class="actions__icon" data-feather="github"></i><span class="actions__text">Contribute</span></a></li></ul></div></div><article class="content__article"><p>You can pipe system and application logs from the nodes in a DC/OS cluster to an Elasticsearch server.</p>
<h1 id="what-this-document-does-and-does-not-cover"><a class="content__anchor" href="#what-this-document-does-and-does-not-cover" aria-hidden="true"><i data-feather="bookmark"></i></a>What this document does and does not cover</h1>
<p>This document describes how to send Fluent Bit output from each node to a centralized Elasticsearch instance. This document describes how to directly stream from Fluent Bit into Elasticsearch. Logstash is not used in this architecture. If you are interested in filtering, parsing and understanding the logs with an intermediate Logstash stage, see the Logstash <a href="https://www.elastic.co/guide/en/logstash/current/index.html">documentation</a> and the example in <a href="../filter-elk/">Filtering logs with ELK</a>.</p>
<p>This document does not explain how to set up and configure an Elasticsearch server. This document does not describe how to set up secure TLS communication between the Fluent Bit instances and Elasticsearch. For details on how to achieve this, see the <a href="https://docs.fluentbit.io/manual/output/elasticsearch">Fluent Bit</a> and <a href="https://www.elastic.co/guide/en/elasticsearch/reference/5.0/index.html">Elasticsearch</a> documentation.</p>
<p><strong>Prerequisites</strong></p>
<ul>
<li>An existing Elasticsearch installation that can ingest data for indexing</li>
<li>All DC/OS nodes must be able to connect to your Elasticsearch server on the port used for communication between Elasticsearch and Fluent Bit (9200 by default)</li>
<li>A location on each DC/OS node for your custom Fluent Bit config. This tutorial will use <code>/etc/fluent-bit/</code>.</li>
</ul>
<h2 id="step-1-master-nodes"><a class="content__anchor" href="#step-1-master-nodes" aria-hidden="true"><i data-feather="bookmark"></i></a>Step 1: Master nodes</h2>
<p>For each master node in your DC/OS cluster, create a file <code>/etc/fluent-bit/fluent-bit.conf</code> that includes the default master Fluent Bit config and adds your configuration for the Elasticsearch output plugin. For more information on configuring Fluent Bit to send logs to Elasticsearch, see the <a href="https://docs.fluentbit.io/manual/output/elasticsearch">Fluent Bit documentation</a>.</p>
<pre><code class="language-bash">@INCLUDE /opt/mesosphere/etc/fluent-bit/master.conf
[OUTPUT]
     Name es
     Match *
     Host &lt;Elasticsearch host&gt;
     Port &lt;Elasticsearch port&gt;
</code></pre>
<h2 id="step-2-agent-nodes"><a class="content__anchor" href="#step-2-agent-nodes" aria-hidden="true"><i data-feather="bookmark"></i></a>Step 2: Agent nodes</h2>
<p>For each agent node in your DC/OS cluster, create a file <code>/etc/fluent-bit/fluent-bit.conf</code> that includes the default master Fluent Bit config and adds your configuration for the Elasticsearch output plugin. For more information on configuring Fluent Bit to send logs to Elasticsearch, see the <a href="https://docs.fluentbit.io/manual/output/elasticsearch">Fluent Bit documentation</a>.</p>
<pre><code class="language-bash">@INCLUDE /opt/mesosphere/etc/fluent-bit/agent.conf
[OUTPUT]
     Name es
     Match *
     Host &lt;Elasticsearch host&gt;
     Port &lt;Elasticsearch port&gt;
</code></pre>
<h2 id="step-3-all-nodes"><a class="content__anchor" href="#step-3-all-nodes" aria-hidden="true"><i data-feather="bookmark"></i></a>Step 3: All nodes</h2>
<p>For all nodes in your DC/OS cluster:</p>
<ol>
<li>Create a file <code>/etc/fluent-bit/fluent-bit.env</code> that sets the <code>FLUENT_BIT_CONFIG_FILE</code> environment variable to the location of your Fluent Bit config:</li>
</ol>
<pre><code class="language-bash">FLUENT_BIT_CONFIG_FILE=/etc/fluent-bit/fluent-bit.conf
</code></pre>
<ol start="2">
<li>Create a directory <code>/etc/systemd/system/dcos-fluent-bit.service.d</code>:</li>
</ol>
<pre><code class="language-bash">sudo mkdir -p /etc/systemd/system/dcos-fluent-bit.service.d
</code></pre>
<ol start="3">
<li>Create a file <code>/etc/systemd/system/dcos-fluent-bit.service.d/override.conf</code> that applies your custom config to Fluent Bit:</li>
</ol>
<pre><code class="language-bash">[Service]
EnvironmentFile=/etc/fluent-bit/fluent-bit.env
</code></pre>
<ol start="4">
<li>Reload systemd to update <code>dcos-fluent-bit.service</code>, and restart it:</li>
</ol>
<pre><code class="language-bash">sudo systemctl daemon-reload
sudo systemctl restart dcos-fluent-bit.service
</code></pre>
<h2 id="get-more-details"><a class="content__anchor" href="#get-more-details" aria-hidden="true"><i data-feather="bookmark"></i></a>Get more details</h2>
<p>For details on how to filter your logs with ELK, see <a href="../filter-elk/">Filtering DC/OS logs with ELK</a>.</p>
</article></div><aside class="content__sections"><div class="content__sections-list-container"><ul class="content__sections-list"><li class="content__sections-item content__sections-item--h1"><a href="#what-this-document-does-and-does-not-cover">What this document does and does not cover</a></li><li class="content__sections-item content__sections-item--h2"><a href="#step-1-master-nodes">Step 1: Master nodes</a></li><li class="content__sections-item content__sections-item--h2"><a href="#step-2-agent-nodes">Step 2: Agent nodes</a></li><li class="content__sections-item content__sections-item--h2"><a href="#step-3-all-nodes">Step 3: All nodes</a></li><li class="content__sections-item content__sections-item--h2"><a href="#get-more-details">Get more details</a></li></ul></div></aside></main></div></div><script src="/assets/js/jquery-3.2.1.js"></script><script src="/assets/js/clipboard.js"></script><script src="/assets/js/prism.js"></script><script src="/js/main.js"></script></body></html>