<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width" initial-scale="1" user-scalable="no"><title>DC/OS on AWS using the Universal Installer - D2iQ Docs</title><meta name="description" content="Guide for DC/OS on AWS using the Universal Installer"><link rel="apple-touch-icon" sizes="180x180" href="/dcosdocs/assets/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/dcosdocs/assets/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/dcosdocs/assets/favicon-16x16.png"><link rel="stylesheet" type="text/css" href="/dcosdocs/css/styles.css"><link rel="search" type="application/opensearchdescription+xml" href="/dcosdocs/assets/opensearch.xml" title="Search"><link href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,500,500i,700,700i" rel="stylesheet"><script src="https://unpkg.com/feather-icons/dist/feather.min.js"></script><script>window.analytics||(window.analytics=[]),window.analytics.methods=["identify","track","trackLink","trackForm","trackClick","trackSubmit","page","pageview","ab","alias","ready","group","on","once","off"],window.analytics.factory=function(t){return function(){var a=Array.prototype.slice.call(arguments);return a.unshift(t),window.analytics.push(a),window.analytics}};for(var i=0;i<window.analytics.methods.length;i++){var method=window.analytics.methods[i];window.analytics[method]=window.analytics.factory(method)}window.analytics.load=function(t){var a=document.createElement("script");a.type="text/javascript",a.async=!0,a.src=("https:"===document.location.protocol?"https://":"http://")+"d2dq2ahtl5zl1z.cloudfront.net/analytics.js/v1/"+t+"/analytics.min.js";var n=document.getElementsByTagName("script")[0];n.parentNode.insertBefore(a,n)},window.analytics.SNIPPET_VERSION="2.0.8",
window.analytics.load("7sgtwqvuai");
window.analytics.page();</script><noscript><iframe src="//www.googletagmanager.com/ns.html?id=GTM-PBJ84KX" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript><script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src='//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
})(window,document,'script','dataLayer','GTM-PBJ84KX');</script></head><body><div class="layout"><header class="header"><a class="header__drawer"><i class="header__icon" data-feather="menu"></i></a><a class="header__logo" href="/"><img class="header__logo--mobile" src="/dcosdocs/assets/D2iQ_Logotype_Color_Positive_Documentation.svg" alt="D2IQ"><img class="header__logo--desktop" src="/dcosdocs/assets/D2iQ_Logotype_Color_Positive_Documentation.svg" alt="D2IQ"></a><div class="header__main"><div class="header__dropdown"><img class="header__dropdown-icon" src="/dcosdocs/assets/D2IQ_Logotype_Color_Positive.png" alt="D2iQ"><strong>DC/OS Documentation</strong><i data-feather="chevron-down"></i></div><nav class="header__menu"><ul class="header__menu-list"><li class="header__menu-item"><a href="/mesosphere/dcos">DC/OS</a></li><li class="header__menu-item"><a href="/dcosdocs/mesosphere/dcos/services">Services</a></li><li class="header__menu-item"><a href="https://support.d2iq.com">Support</a></li></ul></nav></div><div class="chooser" id="localizer"><div class="chooser-current"><a class="chooser-title">English</a><svg class="chooser-svg" id="localizer-svg"><path class="pointer" d="m 13,6 -5,5 -5,-5 z" fill="#858585"></path></svg></div><ul class="chooser-list" id="localizer-list"><li class="chooser-list-item"><a href="/dcosdocs/mesosphere/dcos/cn/2.0/installing/evaluation/aws">中文 (简体)</a></li></ul></div><section class="header__search" role="search"><form class="header__search-form" action="/search/"><input class="header__search-input" id="header-search-input" tabindex="1" type="text" name="q" placeholder="Search"><input type="hidden" name="hFR[scope][0]" value="DC/OS 2.0"><label class="header__search-label" for="header-search-input"><i class="header__icon" data-feather="search"></i></label></form></section></header><div class="header-dropdown"><ul class="header-dropdown__list"><li class="header-dropdown__top-item"><div>DKP</div></li><li class="header-dropdown__item"><a href="/dkp/konvoy">Konvoy</a></li><li class="header-dropdown__item"><a href="/dkp/kommander">Kommander</a></li><li class="header-dropdown__item"><a href="/dkp/dispatch">Dispatch</a></li><li class="header-dropdown__item"><a href="/dkp/kaptain">Kaptain</a></li><li class="header-dropdown__top-item"><div>Mesosphere</div></li><li class="header-dropdown__item header-dropdown__item--active"><a href="/mesosphere/dcos">DC/OS</a></li><li class="header-dropdown__item"><a href="/dcosdocs/mesosphere/dcos/services">DC/OS Services</a></li><li class="header-dropdown__item"><a href="https://support.d2iq.com">Support</a></li></ul></div><div class="layout__sidebar layout__drawer"><section class="sidebar"><header class="sidebar__header"><div class="sidebar__dropdown"><ul><li><a href="/dcosdocs/mesosphere/dcos/2.2/installing/evaluation">Mesosphere DC/OS 2.2.0</a></li><li><a href="/dcosdocs/mesosphere/dcos/2.1/installing/evaluation">Mesosphere DC/OS 2.1.0</a></li><li><a href="/dcosdocs/mesosphere/dcos/2.0/installing/evaluation/aws">Mesosphere DC/OS 2.0</a></li><li><a href="/dcosdocs/mesosphere/dcos/1.13/installing/evaluation/aws">Mesosphere DC/OS 1.13</a></li></ul><div class="toggle"><p><span class="title">DC/OS</span><span class="version"> 2.0</span></p><i data-feather="chevron-down"></i></div></div></header><nav class="sidebar_nav" role="navigation"><ul><li><a class="d0" href="/dcosdocs/mesosphere/dcos/2.0/release-notes/"><i data-feather="chevron-right"></i>Release Notes</a></li><li><a class="d0" href="/dcosdocs/mesosphere/dcos/2.0/overview/"><i data-feather="chevron-right"></i>Overview</a></li><li class="active"><a class="d0" href="/dcosdocs/mesosphere/dcos/2.0/installing/"><i data-feather="chevron-right"></i>Installing</a></li><ul><li class="active"><a class="d1" href="/dcosdocs/mesosphere/dcos/2.0/installing/evaluation/"><i data-feather="chevron-right"></i>Cloud Installation</a></li><ul><li class="active active-on"><a class="d2" href="/dcosdocs/mesosphere/dcos/2.0/installing/evaluation/aws/"><i data-feather="chevron-right"></i>AWS</a></li><ul><li><a class="d3" href="/dcosdocs/mesosphere/dcos/2.0/installing/evaluation/aws/aws-remote-region/">AWS Multi-Region Support</a></li><li><a class="d3" href="/dcosdocs/mesosphere/dcos/2.0/installing/evaluation/aws/aws-replaceable-masters/">AWS Replaceable Masters</a></li><li><a class="d3" href="/dcosdocs/mesosphere/dcos/2.0/installing/evaluation/aws/aws-advanced/">Configuration Reference</a></li><li><a class="d3" href="/dcosdocs/mesosphere/dcos/2.0/installing/evaluation/aws/aws-tf-faq/">Universal Installer FAQ</a></li></ul><li><a class="d2" href="/dcosdocs/mesosphere/dcos/2.0/installing/evaluation/azure/"><i data-feather="chevron-right"></i>Azure</a></li><li><a class="d2" href="/dcosdocs/mesosphere/dcos/2.0/installing/evaluation/gcp/"><i data-feather="chevron-right"></i>GCP</a></li><li><a class="d2" href="/dcosdocs/mesosphere/dcos/2.0/installing/evaluation/community-supported-methods/"><i data-feather="chevron-right"></i>Other Installation methods</a></li></ul><li><a class="d1" href="/dcosdocs/mesosphere/dcos/2.0/installing/production/"><i data-feather="chevron-right"></i>On-Prem Installation</a></li><li><a class="d1" href="/dcosdocs/mesosphere/dcos/2.0/installing/installation-faq/">Frequently Asked Questions</a></li><li><a class="d1" href="/dcosdocs/mesosphere/dcos/2.0/installing/troubleshooting/">Troubleshooting</a></li></ul><li><a class="d0" href="/dcosdocs/mesosphere/dcos/2.0/gui/"><i data-feather="chevron-right"></i>GUI</a></li><li><a class="d0" href="/dcosdocs/mesosphere/dcos/2.0/cli/"><i data-feather="chevron-right"></i>CLI</a></li><li><a class="d0" href="/dcosdocs/mesosphere/dcos/2.0/administering-clusters/"><i data-feather="chevron-right"></i>Administering Clusters</a></li><li><a class="d0" href="/dcosdocs/mesosphere/dcos/2.0/networking/"><i data-feather="chevron-right"></i>Networking</a></li><li><a class="d0" href="/dcosdocs/mesosphere/dcos/2.0/security/"><i data-feather="chevron-right"></i>Security</a></li><li><a class="d0" href="/dcosdocs/mesosphere/dcos/2.0/storage/"><i data-feather="chevron-right"></i>Storage</a></li><li><a class="d0" href="/dcosdocs/mesosphere/dcos/2.0/metrics/"><i data-feather="chevron-right"></i>Metrics</a></li><li><a class="d0" href="/dcosdocs/mesosphere/dcos/2.0/monitoring/"><i data-feather="chevron-right"></i>Monitoring, Logging, and Debugging</a></li><li><a class="d0" href="/dcosdocs/mesosphere/dcos/2.0/multi-tenancy/"><i data-feather="chevron-right"></i>Multi-Tenancy for DC/OS Clusters</a></li><li><a class="d0" href="/dcosdocs/mesosphere/dcos/2.0/hybrid-cloud/"><i data-feather="chevron-right"></i>Hybrid Cloud</a></li><li><a class="d0" href="/dcosdocs/mesosphere/dcos/2.0/deploying-jobs/"><i data-feather="chevron-right"></i>Deploying Jobs</a></li><li><a class="d0" href="/dcosdocs/mesosphere/dcos/2.0/deploying-services/"><i data-feather="chevron-right"></i>Deploying Services and Pods</a></li><li><a class="d0" href="/dcosdocs/mesosphere/dcos/2.0/tutorials/"><i data-feather="chevron-right"></i>Tutorials</a></li><li><a class="d0" href="/dcosdocs/mesosphere/dcos/2.0/api/"><i data-feather="chevron-right"></i>API Reference</a></li><li><a class="d0" href="/dcosdocs/mesosphere/dcos/2.0/developing-services/"><i data-feather="chevron-right"></i>Developing DC/OS Services</a></li></ul></nav><footer class="sidebar__footer"><div class="sidebar__footer-links"><a href="https://d2iq.com/terms/">Terms of Service</a><a href="https://d2iq.com/privacy/">Privacy Policy</a></div><a class="sidebar__footer-copyright" href="https://d2iq.com/">&copy; 2022 D2iQ, Inc. All rights reserved.</a></footer></section></div><div class="layout__content" role="main"><main class="content"><div class="content__container content__container--with-sections"><div class="content__header"><div class="content__header__row"><h1 class="content__header-title">DC/OS on AWS using the Universal Installer</h1></div><h4 class="content__header-description">Guide for DC/OS on AWS using the Universal Installer</h4><div class="actions"><ul class="actions__list"><li class="actions__item"><button class="actions__link" onclick="javascript:window.print()"><i class="actions__icon" data-feather="printer"></i><span class="actions__text">Print</span></button></li><li class="actions__item"><a class="actions__link" href="https://github.com/mesosphere/dcos-docs-site/tree/main/pages/dcosdocs/mesosphere/dcos/2.0/installing/evaluation/aws/index.md" target="_blank"><i class="actions__icon" data-feather="github"></i><span class="actions__text">Contribute</span></a></li></ul></div></div><article class="content__article"><p class="message--important"><strong>IMPORTANT:</strong> The Universal Installer has now been upgraded to `0.2`. If you already have a terraform cluster running please see the <a href="#universal-installer-02-update-for-aws">update information</a> at the bottom of this page.</p>
<p>This guide is meant to take an operator through all steps necessary for a successful installation of DC/OS using Terraform. If you are already familiar with the prerequisites, you can jump to <a href="#creating-a-dcos-cluster">creating a DC/OS Cluster</a>.</p>
<h2 id="prerequisites"><a class="content__anchor" href="#prerequisites" aria-hidden="true"><i data-feather="bookmark"></i></a>Prerequisites</h2>
<ul>
<li>Linux, macOS, or Windows</li>
<li>command-line shell terminal such as Bash or PowerShell</li>
<li>verified Amazon Web Services (AWS) account and <a href="https://console.aws.amazon.com/iam/home">AWS IAM</a> user profile with permissions</li>
</ul>
<h1 id="install-terraform"><a class="content__anchor" href="#install-terraform" aria-hidden="true"><i data-feather="bookmark"></i></a>Install Terraform</h1>
<p class="message--important"><strong>IMPORTANT:</strong> Terraform was updated to 0.12.x. The DC/OS Universal Installer currently only supports <b>Terraform 0.11.x</b></p>
<ol>
<li>
<p>Visit the <a href="https://releases.hashicorp.com/terraform/">Terraform releases page</a> for bundled installations and support for Linux, macOS and Windows. Choose the latest 0.11 version.</p>
<p>If you’re on a Mac environment with <a href="https://brew.sh/">Homebrew</a> installed, simply run the following command:</p>
<pre><code class="language-bash">brew unlink terraform || true
brew install tfenv
tfenv install 0.11.14
</code></pre>
<p>Windows users that have <a href="https://chocolatey.org/docs/installation">Chocolatey</a> installed, run:</p>
<pre><code class="language-bash">choco install terraform --version 0.11.14 -y
</code></pre>
</li>
</ol>
<h2 id="ensure-your-cloud-provider-credentials"><a class="content__anchor" href="#ensure-your-cloud-provider-credentials" aria-hidden="true"><i data-feather="bookmark"></i></a>Ensure your cloud provider credentials</h2>
<p>There are many ways of passing in your credentials in order for Terraform to authenticate with your cloud provider. Most likely, you already have your cloud provider credentials loaded through the AWS CLI. Terraform will automatically detect those credentials during initialization for you. See <a href="https://docs.aws.amazon.com/cli/latest/userguide/cli-chap-configure.html">configuring the AWS CLI</a> for more information on setting up credentials and user profile.</p>
<p>Alternatively, you can pass in your <code>access_key</code> and <code>secret_key</code> through the configuration file which you will create. The properties listed here are the three things that Terraform needs on your behalf. See the <a href="https://www.terraform.io/docs/configuration/providers.html">provider configuration reference</a> for more information on how this works under the hood. Also, please keep in mind storing your credentials outside of your version control for security.</p>
<pre><code class="language-hcl">provider &quot;aws&quot; {
    access_key = &quot;foo&quot;
    secret_key = &quot;bar&quot;
    region     = &quot;us-east-1&quot;
}
</code></pre>
<h1 id="set-up-ssh-credentials-for-your-cluster"><a class="content__anchor" href="#set-up-ssh-credentials-for-your-cluster" aria-hidden="true"><i data-feather="bookmark"></i></a>Set up SSH credentials for your cluster</h1>
<p>Terraform will need to send out SSH keys to connect securely to the nodes it creates. If you already have a key-pair available and added to your SSH-agent, you can skip this section.</p>
<ol>
<li>
<p>Not sure if you have a keypair you want to use? List the contents of your ssh directory.</p>
<pre><code class="language-bash">ls ~/.ssh
</code></pre>
</li>
<li>
<p>If you don’t have one you like, start the ssh-keygen program to create a new key pair, following the prompts.</p>
<pre><code class="language-bash">ssh-keygen -t rsa
</code></pre>
</li>
<li>
<p>Add the key to your SSH agent by starting the agent if it isn’t already running and then loading your key:</p>
<pre><code class="language-bash">eval &quot;$(ssh-agent -s)&quot;
</code></pre>
<pre><code class="language-bash">ssh-add ~/.ssh/&lt;your-key-name&gt;
</code></pre>
</li>
</ol>
<h2 id="verify-you-have-a-license-key-for-enterprise-edition"><a class="content__anchor" href="#verify-you-have-a-license-key-for-enterprise-edition" aria-hidden="true"><i data-feather="bookmark"></i></a>Verify you have a license key for Enterprise Edition</h2>
<p>DC/OS Enterprise requires a valid license key provided by Mesosphere that will be passed into the <code>main.tf</code> configuration file as <code>dcos_license_key_contents</code>. If you do not set a password, the default superuser and password will be available for log in:</p>
<p>Username: <code>bootstrapuser</code> <br>
Password: <code>deleteme</code></p>
<p class="message--important"><strong>IMPORTANT: </strong>You should NOT use the default credentials in a production environment. When you create or identify an administrative account for the production environment, you also need to generate a password hash for the account.</p>
<p>To set superuser credentials for the first log in, add the following values into your <code>main.tf</code> along with your license key. The password will need to be hashed to SHA-512.</p>
<pre><code class="language-hcl">dcos_superuser_username      = &quot;superuser-name&quot;
dcos_superuser_password_hash = &quot;${file(&quot;./dcos_superuser_password_hash&quot;)}
</code></pre>
<h1 id="creating-a-dcos-cluster"><a class="content__anchor" href="#creating-a-dcos-cluster" aria-hidden="true"><i data-feather="bookmark"></i></a>Creating a DC/OS Cluster</h1>
<ol>
<li>
<p>Let’s start by creating a local folder and cd’ing into it. This folder will be used as the staging ground for downloading all required Terraform modules and holding the configuration for the cluster you are about to create.</p>
<pre><code class="language-bash">mkdir dcos-demo &amp;&amp; cd dcos-demo
</code></pre>
</li>
<li>
<p>Create a file in that folder called <code>main.tf</code>, which is the configuration file that will be called on each time when terraform runs. The name of this file should always be <code>main.tf</code>. Open the file in the code editor of your choice and paste in the following. Notice the copy icon in the upper right hand corner of the code block to copy the code to your clipboard:</p>
<pre><code class="language-hcl">provider &quot;aws&quot; {
  # Change your default region here
  region = &quot;us-east-1&quot;
}

# Used to determine your public IP for forwarding rules
data &quot;http&quot; &quot;whatismyip&quot; {
  url = &quot;http://whatismyip.akamai.com/&quot;
}

module &quot;dcos&quot; {
  source  = &quot;dcos-terraform/dcos/aws&quot;
  version = &quot;~&gt; 0.2.0&quot;

  providers = {
    aws = &quot;aws&quot;
  }

  cluster_name        = &quot;my-dcos-demo&quot;
  ssh_public_key_file = &quot;&lt;path-to-public-key-file&gt;&quot;
  admin_ips           = [&quot;${data.http.whatismyip.body}/32&quot;]

  num_masters        = 3
  num_private_agents = 2
  num_public_agents  = 1

  dcos_version = &quot;1.13.3&quot;

  # dcos_variant              = &quot;ee&quot;
  # dcos_license_key_contents = &quot;${file(&quot;./license.txt&quot;)}&quot;
  # Make sure to set your credentials if you do not want the default EE
  # dcos_superuser_username      = &quot;superuser-name&quot;
  # dcos_superuser_password_hash = &quot;${file(&quot;./dcos_superuser_password_hash.sha512&quot;)}&quot;
  dcos_variant = &quot;open&quot;

  dcos_instance_os             = &quot;centos_7.5&quot;
  bootstrap_instance_type      = &quot;m5.large&quot;
  masters_instance_type        = &quot;m5.2xlarge&quot;
  private_agents_instance_type = &quot;m5.xlarge&quot;
  public_agents_instance_type  = &quot;m5.xlarge&quot;
}

output &quot;masters-ips&quot; {
  value = &quot;${module.dcos.masters-ips}&quot;
}

output &quot;cluster-address&quot; {
  value = &quot;${module.dcos.masters-loadbalancer}&quot;
}

output &quot;public-agents-loadbalancer&quot; {
  value = &quot;${module.dcos.public-agents-loadbalancer}&quot;
}
</code></pre>
</li>
<li>
<p>There is a main variable that must be set to complete the <code>main.tf</code>:</p>
<ul>
<li><code>ssh_public_key_file = &quot;&lt;path-to-public-key-file&gt;&quot;</code>: the path to the public key for your cluster, following our example it would be:<pre><code class="language-bash">&quot;~/.ssh/aws-key.pub&quot;
</code></pre>
</li>
</ul>
</li>
<li>
<p><code>region</code> is a setting that sets the AWS region that this DC/OS cluster will spin up on.  While this setting is currently set to “us-east-1”, it can be changed to any other region (e.g “us-west-1”, “us-west-2”, “us-east-2”, etc). For a complete list, please refer to the <a href="/dcosdocs/mesosphere/dcos/2.0/installing/evaluation/aws/">configuration reference</a>.</p>
</li>
<li>
<p>The <code>bootstrap_instance_type</code>, <code>masters_instance_type</code>, <code>private_agents_instance_type</code>, and <code>public_agents_instance_type</code> variables control which AWS instance type will be used for each node type.  What instance types are available can vary by region and change over time.  Ensure the instance types you select meet <a href="/dcosdocs/mesosphere/dcos/2.0/installing/production/system-requirements/">DC/OS’ minimum system requirements</a>.</p>
</li>
<li>
<p>Enterprise users, uncomment/comment the section for the <code>dcos_variant</code> to look like this, inserting the location to your license key, and adding superuser credentials if needed. <span class="badge__container badge__container--inline"><span class="badge badge--shortcode badge--small badge--inline badge--enterprise">Enterprise</span></span></p>
<pre><code class="language-hcl">dcos_variant              = &quot;ee&quot;
dcos_license_key_contents = &quot;${file(&quot;./license.txt&quot;)}&quot;
# dcos_variant = &quot;open&quot;
</code></pre>
</li>
<li>
<p>This sample configuration file will get you started on the installation of an open source DC/OS 1.13.3 cluster with the following nodes:</p>
<ul>
<li>3 Master</li>
<li>2 Private Agents</li>
<li>1 Public Agent</li>
</ul>
<p>If you want to change the cluster name or vary the number of masters/agents, feel free to adjust those values now as well. Cluster names must be unique, consist of alphanumeric characters, ‘-’, ‘_’ or ‘.’, start and end with an alphanumeric character, and be no longer than 24 characters. You can find additional <a href="/dcosdocs/mesosphere/dcos/2.0/installing/evaluation/aws/aws-advanced/">input variables and their descriptions here</a>.</p>
<p>There are also simple helpers listed underneath the module which find your public ip and specify that the following output should be printed once cluster creation is complete:</p>
<ul>
<li><code>master-ips</code> A list of Your DC/OS master nodes</li>
<li><code>cluster-address</code> The URL you use to access DC/OS UI after the cluster is setup.</li>
<li><code>public-agent-loadbalancer</code> The URL of your Public routable services.</li>
</ul>
</li>
<li>
<p>Check that you have inserted your cloud provider and public key paths to <code>main.tf</code>, changed or added any other additional variables as wanted, then save and close your file.</p>
</li>
</ol>
<h2 id="initialize-terraform-and-create-a-cluster"><a class="content__anchor" href="#initialize-terraform-and-create-a-cluster" aria-hidden="true"><i data-feather="bookmark"></i></a>Initialize Terraform and create a cluster</h2>
<ol>
<li>
<p>Now the action of actually creating your cluster and installing DC/OS begins. First, initialize the project’s local settings and data.  Make sure you are still working in the same folder where you created your <code>main.tf</code> file, and run the initialization.</p>
<pre><code class="language-bash">terraform init -upgrade
</code></pre>
<pre><code class="language-text">Terraform has been successfully initialized!

You may now begin working with Terraform. Try running &quot;terraform plan&quot; to see
any changes that are required for your infrastructure. All Terraform commands
should now work.

If you ever set or change modules or backend configuration for Terraform,
rerun this command to reinitialize your environment. If you forget, other
commands will detect it and remind you to do so if necessary.
</code></pre>
 <p class="message--note"><strong>Note: </strong>If terraform is not able to connect to your provider, ensure that you are logged in and are exporting your credentials and necessary region information for your cloud provider.</p>
</li>
<li>
<p>After Terraform has been initialized, the next step is to run the execution planner and save the plan to a static file - in this case, <code>plan.out</code>.</p>
<pre><code class="language-bash">terraform plan -out=plan.out
</code></pre>
<p>Writing the execution plan to a file allows us to pass the execution plan to the <code>apply</code> command below as well help us guarantee the accuracy of the plan. Note that this file is ONLY readable by Terraform.</p>
<p>Afterwards, we should see a message like the one below, confirming that we have successfully saved to the <code>plan.out</code> file.  This file should appear in your <code>dcos-demo</code> folder alongside <code>main.tf</code>.</p>
<pre><code class="language-bash">Plan: 74 to add, 3 to change, 0 to destroy.

------------------------------------------------------------------------

This plan was saved to: plan.out

To perform exactly these actions, run the following command to apply:
  terraform apply &quot;plan.out&quot;
</code></pre>
<p>Every time you run <code>terraform plan</code>, the output will always detail the resources your plan will be adding, changing or destroying.  Since we are creating our DC/OS cluster for the very first time, our output tells us that our plan will result in adding 38 pieces of infrastructure/resources.</p>
</li>
<li>
<p>The next step is to get Terraform to build/deploy our plan.  Run the command below.</p>
<pre><code class="language-bash">terraform apply plan.out
</code></pre>
<p>Sit back and enjoy! The infrastructure of your DC/OS cluster is being created while you watch. This may take a few minutes.</p>
<p>Once Terraform has completed applying the plan, you should see output similar to the following:</p>
<pre><code class="language-text">Apply complete! Resources: 74 added, 0 changed, 0 destroyed.

Outputs:

cluster-address = testing-123-958581895.us-east-1.elb.amazonaws.com
masters-ips = [
    3.93.239.91
]
public-agents-loadbalancer = ext-testing-123-40f11d1227e88057.elb.us-east-1.amazonaws.com
</code></pre>
<p>And congratulations - you’re up and running!</p>
</li>
</ol>
<h1 id="logging-in-to-dcos"><a class="content__anchor" href="#logging-in-to-dcos" aria-hidden="true"><i data-feather="bookmark"></i></a>Logging in to DC/OS</h1>
<ol>
<li>To log in and start exploring your cluster, navigate to the <code>cluster-address</code> listed in the output of the CLI. From here you can choose your provider to create the superuser account <span class="badge__container badge__container--inline"><span class="badge badge--shortcode badge--small badge--inline badge--oss">Open Source</span></span>, or log in with your specified Enterprise credentials <span class="badge__container badge__container--inline"><span class="badge badge--shortcode badge--small badge--inline badge--enterprise">Enterprise</span></span>.</li>
</ol>
<p align=center>
<img src="./images/install/dcos-login.png">
</p>
<p align=center>
<img src="./images/install/dcos-ui.png">
</p>
<h1 id="scaling-your-cluster"><a class="content__anchor" href="#scaling-your-cluster" aria-hidden="true"><i data-feather="bookmark"></i></a>Scaling Your Cluster</h1>
<p>Terraform makes it easy to scale your cluster to add additional agents (public or private) once the initial cluster has been created. Simply follow the instructions below.</p>
<ol>
<li>
<p>Increase the value for the <code>num_private_agents</code> and/or <code>num_public_agents</code> in your <code>main.tf</code> file. In this example we are going to scale our cluster from 2 private agents to 3, changing just that line, and saving the file.</p>
<pre><code class="language-bash">num_masters        = &quot;1&quot;
num_private_agents = &quot;3&quot;
num_public_agents  = &quot;1&quot;
</code></pre>
</li>
<li>
<p>Now that we’ve made changes to our <code>main.tf</code>, we need to re-run our new execution plan.</p>
<pre><code class="language-bash">terraform plan -out=plan.out
</code></pre>
<p>Doing this helps us to ensure that our state is stable and to confirm that we will only be creating the resources necessary to scale our Private Agents to the desired number.</p>
 <p align=center>
 <img src="./images/scale/terraform-plan.png" />
 </p>
<p>You should see a message similar to above.  There will be 3 resources added as a result of scaling up our cluster’s Private Agents (1 instance resource &amp; 2 null resources which handle the DC/OS installation &amp; prerequisites behind the scenes).</p>
</li>
<li>
<p>Now that our plan is set, just like before, let’s get Terraform to build/deploy it.</p>
<pre><code class="language-bash">terraform apply plan.out
</code></pre>
 <p align=center>
 <img src="./images/scale/terraform-apply.png" />
 </p>
<p>Once you see an output like the message above, check your DC/OS cluster to ensure the additional agents have been added.</p>
<p>You should see now 4 total nodes connected like below via the DC/OS UI.</p>
 <p align=center>
 <img src="./images/scale/node-count-4.png" />
 </p>
</li>
</ol>
<h1 id="upgrading-your-cluster"><a class="content__anchor" href="#upgrading-your-cluster" aria-hidden="true"><i data-feather="bookmark"></i></a>Upgrading Your Cluster</h1>
<p>Terraform also makes it easy to upgrade our cluster to a newer version of DC/OS. If you are interested in learning more about the upgrade procedure that Terraform performs, please see the official <a href="/dcosdocs/mesosphere/dcos/2.0/installing/production/upgrading/">DC/OS Upgrade documentation</a>.</p>
<ol>
<li>
<p>In order to perform an upgrade, we need to go back to our <code>main.tf</code> and modify the current DC/OS Version (<code>dcos_version</code>) to a newer version, such as <code>1.13.3</code> for this example.</p>
<pre><code class="language-bash">dcos_version = &quot;1.13.3&quot;
</code></pre>
</li>
<li>
<p>We also should make sure having the latest version of the Terraform modules. So we tell Terraform to request those from the registry.</p>
<pre><code class="language-bash">terraform get -update
</code></pre>
</li>
<li>
<p>Re-run the execution plan, terraform will notice the change in version and run accordingly.</p>
<pre><code class="language-bash">terraform plan -out=plan.out
</code></pre>
<p>You should see an output like below, with your <code>main.tf</code> now set for normal operations on a new version of DC/OS.</p>
 <p align=center>
 <img src="./images/upgrade/terraform-plan.png" />
 </p>
</li>
<li>
<p>Apply the plan.</p>
<pre><code class="language-bash">terraform apply plan.out
</code></pre>
<p>Once the apply completes, you can verify that the cluster was upgraded via the DC/OS UI.</p>
 <p align=center>
 <img src="./images/upgrade/cluster-details-open.png" />
 </p>
</li>
</ol>
<h1 id="deleting-your-cluster"><a class="content__anchor" href="#deleting-your-cluster" aria-hidden="true"><i data-feather="bookmark"></i></a>Deleting Your Cluster</h1>
<p>If you want to destroy your cluster, then use the following command and wait for it to complete.</p>
<pre><code class="language-bash">terraform destroy
</code></pre>
<p class="message--important"><strong>Important: </strong>Running this command will cause your entire cluster and all of its associated resources to be destroyed. Only run this command if you are absolutely sure you no longer need access to your cluster.</p>
<p>You will be required to enter <code>yes</code> to verify.</p>
<p align=center>
<img src="./images/destroy/terraform-destory.png" />
</p>
<h2 id="universal-installer-02-update-for-aws"><a class="content__anchor" href="#universal-installer-02-update-for-aws" aria-hidden="true"><i data-feather="bookmark"></i></a>Universal Installer 0.2 update for AWS</h2>
<p>The Universal Installer config module backend has undergone a change and is now running version <code>0.2</code> for Amazon Web Services users. If you are still on <code>0.1</code>, there is no direct upgrade path you will NOT be able to upgrade automatically, as the underlying cluster management has been changed. You will need to spin up a new cluster and transfer your services over.</p>
<p>Updates:</p>
<ul>
<li>Currently, only CentOS or RHEL are the only supported node OS’s.</li>
<li><code>dcos_install_mode</code> has been deprecated and is now automatically calculated.</li>
</ul>
<h4 id="checking-your-version"><a class="content__anchor" href="#checking-your-version" aria-hidden="true"><i data-feather="bookmark"></i></a>Checking your version</h4>
<p>You can check the version of the Universal Installer modules you are running by viewing your <code>main.tf</code>.</p>
<pre><code class="language-hcl">module &quot;dcos&quot; {
    source  = &quot;dcos-terraform/dcos/aws&quot;
    version = &quot;~&gt; 0.2.0&quot;
    # ...
}
</code></pre>
<h4 id="using-install-and-upgrade-modes-for-010-version-users"><a class="content__anchor" href="#using-install-and-upgrade-modes-for-010-version-users" aria-hidden="true"><i data-feather="bookmark"></i></a>Using install and upgrade modes for <code>~&gt; 0.1.0</code> version users</h4>
<p>To use the examples on these pages, make the following changes to your <code>main.tf</code>. The only time you should set the variable to <code>upgrade</code> is when upgrading the DC/OS version. Remember to set it back to install afterwards to ensure normal operations.</p>
<pre><code class="language-hcl">variable &quot;dcos_install_mode&quot; {
  description = &quot;specifies which type of command to execute. Options: install or upgrade&quot;
  default = &quot;install&quot;
}

module &quot;dcos&quot; {
  source  = &quot;dcos-terraform/dcos/aws&quot;
  version = &quot;~&gt; 0.1.0&quot;

  # ...

  # Reads the install mode set above
  dcos_install_mode = &quot;${var.dcos_install_mode}&quot;
}
</code></pre>
<div class="grid"><a class="grid__item" href="/dcosdocs/mesosphere/dcos/2.0/installing/evaluation/aws/aws-remote-region"><div class="grid__header__wrapper"><h3 class="grid__header">Multi-Region DC/OS on AWS using the Universal Installer</h3><div class="grid__label__wrapper"><h6 class="grid__label grid__label--enterprise">ENTERPRISE</h6></div></div><div class="grid__desc__wrapper"><p class="grid__desc">Guide for DC/OS on AWS using the Universal Installer adding a remote region.<span class="grid__desc__ellipsis">&#8230;Read More</span></p></div><div class="grid__link"><i data-feather="arrow-right"></i></div></a><a class="grid__item" href="/dcosdocs/mesosphere/dcos/2.0/installing/evaluation/aws/aws-replaceable-masters"><div class="grid__header__wrapper"><h3 class="grid__header">Replaceable masters on AWS using the Universal Installer</h3></div><div class="grid__desc__wrapper"><p class="grid__desc">Replaceable Masters on AWS using the Universal Installer<span class="grid__desc__ellipsis">&#8230;Read More</span></p></div><div class="grid__link"><i data-feather="arrow-right"></i></div></a><a class="grid__item" href="/dcosdocs/mesosphere/dcos/2.0/installing/evaluation/aws/aws-advanced"><div class="grid__header__wrapper"><h3 class="grid__header">Configuration Reference - AWS</h3></div><div class="grid__desc__wrapper"><p class="grid__desc">Configuring your DC/OS installation on AWS using the Universal Installer<span class="grid__desc__ellipsis">&#8230;Read More</span></p></div><div class="grid__link"><i data-feather="arrow-right"></i></div></a><a class="grid__item" href="/dcosdocs/mesosphere/dcos/2.0/installing/evaluation/aws/aws-tf-faq"><div class="grid__header__wrapper"><h3 class="grid__header">Universal Installer FAQ & Troubleshooting Guide</h3></div><div class="grid__desc__wrapper"><p class="grid__desc">FAQ and Common Issues with Universal Installer<span class="grid__desc__ellipsis">&#8230;Read More</span></p></div><div class="grid__link"><i data-feather="arrow-right"></i></div></a></div></article></div><aside class="content__sections"><div class="content__sections-list-container"><ul class="content__sections-list"><li class="content__sections-item content__sections-item--h2"><a href="#prerequisites">Prerequisites</a></li><li class="content__sections-item content__sections-item--h1"><a href="#install-terraform">Install Terraform</a></li><li class="content__sections-item content__sections-item--h2"><a href="#ensure-your-cloud-provider-credentials">Ensure your cloud provider credentials</a></li><li class="content__sections-item content__sections-item--h1"><a href="#set-up-ssh-credentials-for-your-cluster">Set up SSH credentials for your cluster</a></li><li class="content__sections-item content__sections-item--h2"><a href="#verify-you-have-a-license-key-for-enterprise-edition">Verify you have a license key for Enterprise Edition</a></li><li class="content__sections-item content__sections-item--h1"><a href="#creating-a-dcos-cluster">Creating a DC/OS Cluster</a></li><li class="content__sections-item content__sections-item--h2"><a href="#initialize-terraform-and-create-a-cluster">Initialize Terraform and create a cluster</a></li><li class="content__sections-item content__sections-item--h1"><a href="#logging-in-to-dcos">Logging in to DC/OS</a></li><li class="content__sections-item content__sections-item--h1"><a href="#scaling-your-cluster">Scaling Your Cluster</a></li><li class="content__sections-item content__sections-item--h1"><a href="#upgrading-your-cluster">Upgrading Your Cluster</a></li><li class="content__sections-item content__sections-item--h1"><a href="#deleting-your-cluster">Deleting Your Cluster</a></li><li class="content__sections-item content__sections-item--h2"><a href="#universal-installer-02-update-for-aws">Universal Installer 0.2 update for AWS</a></li></ul></div></aside></main></div></div><script src="/dcosdocs/assets/js/jquery-3.2.1.js"></script><script src="/dcosdocs/assets/js/clipboard.js"></script><script src="/dcosdocs/assets/js/prism.js"></script><script src="/js/main.js"></script></body></html>