<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width" initial-scale="1" user-scalable="no"><title>Using Virtual IP Addresses - D2iQ Docs</title><meta name="description" content="Using virtual IP addresses"><link rel="apple-touch-icon" sizes="180x180" href="/assets/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/favicon-16x16.png"><link rel="stylesheet" type="text/css" href="/dcosdocs/css/styles.css"><link rel="search" type="application/opensearchdescription+xml" href="/assets/opensearch.xml" title="Search"><link href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,500,500i,700,700i" rel="stylesheet"><script src="https://unpkg.com/feather-icons/dist/feather.min.js"></script><script>window.analytics||(window.analytics=[]),window.analytics.methods=["identify","track","trackLink","trackForm","trackClick","trackSubmit","page","pageview","ab","alias","ready","group","on","once","off"],window.analytics.factory=function(t){return function(){var a=Array.prototype.slice.call(arguments);return a.unshift(t),window.analytics.push(a),window.analytics}};for(var i=0;i<window.analytics.methods.length;i++){var method=window.analytics.methods[i];window.analytics[method]=window.analytics.factory(method)}window.analytics.load=function(t){var a=document.createElement("script");a.type="text/javascript",a.async=!0,a.src=("https:"===document.location.protocol?"https://":"http://")+"d2dq2ahtl5zl1z.cloudfront.net/analytics.js/v1/"+t+"/analytics.min.js";var n=document.getElementsByTagName("script")[0];n.parentNode.insertBefore(a,n)},window.analytics.SNIPPET_VERSION="2.0.8",
window.analytics.load("7sgtwqvuai");
window.analytics.page();</script><noscript><iframe src="//www.googletagmanager.com/ns.html?id=GTM-PBJ84KX" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript><script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src='//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
})(window,document,'script','dataLayer','GTM-PBJ84KX');</script></head><body><div class="layout"><header class="header"><a class="header__drawer"><i class="header__icon" data-feather="menu"></i></a><a class="header__logo" href="/"><img class="header__logo--mobile" src="/assets/D2iQ_Logotype_Color_Positive_Documentation.svg" alt="D2IQ"><img class="header__logo--desktop" src="/assets/D2iQ_Logotype_Color_Positive_Documentation.svg" alt="D2IQ"></a><div class="header__main"><div class="header__dropdown"><img class="header__dropdown-icon" src="/assets/D2IQ_Logotype_Color_Positive.png" alt="D2iQ"><strong>DC/OS Documentation</strong><i data-feather="chevron-down"></i></div><nav class="header__menu"><ul class="header__menu-list"><li class="header__menu-item"><a href="/mesosphere/dcos">DC/OS</a></li><li class="header__menu-item"><a href="/dcosdocs/mesosphere/dcos/services">Services</a></li><li class="header__menu-item"><a href="https://support.d2iq.com">Support</a></li></ul></nav></div><div class="chooser" id="localizer"><div class="chooser-current"><a class="chooser-title">English</a><svg class="chooser-svg" id="localizer-svg"><path class="pointer" d="m 13,6 -5,5 -5,-5 z" fill="#858585"></path></svg></div><ul class="chooser-list" id="localizer-list"><li class="chooser-list-item"><a href="/dcosdocs/mesosphere/dcos/cn/2.0/networking/load-balancing-vips/virtual-ip-addresses">中文 (简体)</a></li></ul></div><section class="header__search" role="search"><form class="header__search-form" action="/search/"><input class="header__search-input" id="header-search-input" tabindex="1" type="text" name="q" placeholder="Search"><input type="hidden" name="hFR[scope][0]" value="DC/OS 2.0"><label class="header__search-label" for="header-search-input"><i class="header__icon" data-feather="search"></i></label></form></section></header><div class="header-dropdown"><ul class="header-dropdown__list"><li class="header-dropdown__top-item"><div>DKP</div></li><li class="header-dropdown__item"><a href="/dkp/konvoy">Konvoy</a></li><li class="header-dropdown__item"><a href="/dkp/kommander">Kommander</a></li><li class="header-dropdown__item"><a href="/dkp/dispatch">Dispatch</a></li><li class="header-dropdown__item"><a href="/dkp/kaptain">Kaptain</a></li><li class="header-dropdown__top-item"><div>Mesosphere</div></li><li class="header-dropdown__item header-dropdown__item--active"><a href="/mesosphere/dcos">DC/OS</a></li><li class="header-dropdown__item"><a href="/dcosdocs/mesosphere/dcos/services">DC/OS Services</a></li><li class="header-dropdown__item"><a href="https://support.d2iq.com">Support</a></li></ul></div><div class="layout__sidebar layout__drawer"><section class="sidebar"><header class="sidebar__header"><div class="sidebar__dropdown"><ul><li><a href="/dcosdocs/mesosphere/dcos/2.2/networking/load-balancing-vips/virtual-ip-addresses">Mesosphere DC/OS 2.2.0</a></li><li><a href="/dcosdocs/mesosphere/dcos/2.1/networking/load-balancing-vips/virtual-ip-addresses">Mesosphere DC/OS 2.1.0</a></li><li><a href="/dcosdocs/mesosphere/dcos/2.0/networking/load-balancing-vips/virtual-ip-addresses">Mesosphere DC/OS 2.0</a></li><li><a href="/dcosdocs/mesosphere/dcos/1.13/networking/load-balancing-vips/virtual-ip-addresses">Mesosphere DC/OS 1.13</a></li></ul><div class="toggle"><p><span class="title">DC/OS</span><span class="version"> 2.0</span></p><i data-feather="chevron-down"></i></div></div></header><nav class="sidebar_nav" role="navigation"><ul><li><a class="d0" href="/dcosdocs/mesosphere/dcos/2.0/release-notes/"><i data-feather="chevron-right"></i>Release Notes</a></li><li><a class="d0" href="/dcosdocs/mesosphere/dcos/2.0/overview/"><i data-feather="chevron-right"></i>Overview</a></li><li><a class="d0" href="/dcosdocs/mesosphere/dcos/2.0/installing/"><i data-feather="chevron-right"></i>Installing</a></li><li><a class="d0" href="/dcosdocs/mesosphere/dcos/2.0/gui/"><i data-feather="chevron-right"></i>GUI</a></li><li><a class="d0" href="/dcosdocs/mesosphere/dcos/2.0/cli/"><i data-feather="chevron-right"></i>CLI</a></li><li><a class="d0" href="/dcosdocs/mesosphere/dcos/2.0/administering-clusters/"><i data-feather="chevron-right"></i>Administering Clusters</a></li><li class="active"><a class="d0" href="/dcosdocs/mesosphere/dcos/2.0/networking/"><i data-feather="chevron-right"></i>Networking</a></li><ul><li class="active"><a class="d1" href="/dcosdocs/mesosphere/dcos/2.0/networking/load-balancing-vips/"><i data-feather="chevron-right"></i>Load Balancing and Virtual IPs (VIPs)</a></li><ul><li class="active active-on"><a class="d2" href="/dcosdocs/mesosphere/dcos/2.0/networking/load-balancing-vips/virtual-ip-addresses/">Using Virtual IP Addresses</a></li></ul><li><a class="d1" href="/dcosdocs/mesosphere/dcos/2.0/networking/SDN/"><i data-feather="chevron-right"></i>Software Defined Networks</a></li><li><a class="d1" href="/dcosdocs/mesosphere/dcos/2.0/networking/DNS/"><i data-feather="chevron-right"></i>DNS</a></li></ul><li><a class="d0" href="/dcosdocs/mesosphere/dcos/2.0/security/"><i data-feather="chevron-right"></i>Security</a></li><li><a class="d0" href="/dcosdocs/mesosphere/dcos/2.0/storage/"><i data-feather="chevron-right"></i>Storage</a></li><li><a class="d0" href="/dcosdocs/mesosphere/dcos/2.0/metrics/"><i data-feather="chevron-right"></i>Metrics</a></li><li><a class="d0" href="/dcosdocs/mesosphere/dcos/2.0/monitoring/"><i data-feather="chevron-right"></i>Monitoring, Logging, and Debugging</a></li><li><a class="d0" href="/dcosdocs/mesosphere/dcos/2.0/multi-tenancy/"><i data-feather="chevron-right"></i>Multi-Tenancy for DC/OS Clusters</a></li><li><a class="d0" href="/dcosdocs/mesosphere/dcos/2.0/hybrid-cloud/"><i data-feather="chevron-right"></i>Hybrid Cloud</a></li><li><a class="d0" href="/dcosdocs/mesosphere/dcos/2.0/deploying-jobs/"><i data-feather="chevron-right"></i>Deploying Jobs</a></li><li><a class="d0" href="/dcosdocs/mesosphere/dcos/2.0/deploying-services/"><i data-feather="chevron-right"></i>Deploying Services and Pods</a></li><li><a class="d0" href="/dcosdocs/mesosphere/dcos/2.0/tutorials/"><i data-feather="chevron-right"></i>Tutorials</a></li><li><a class="d0" href="/dcosdocs/mesosphere/dcos/2.0/api/"><i data-feather="chevron-right"></i>API Reference</a></li><li><a class="d0" href="/dcosdocs/mesosphere/dcos/2.0/developing-services/"><i data-feather="chevron-right"></i>Developing DC/OS Services</a></li></ul></nav><footer class="sidebar__footer"><div class="sidebar__footer-links"><a href="https://d2iq.com/terms/">Terms of Service</a><a href="https://d2iq.com/privacy/">Privacy Policy</a></div><a class="sidebar__footer-copyright" href="https://d2iq.com/">&copy; 2022 D2iQ, Inc. All rights reserved.</a></footer></section></div><div class="layout__content" role="main"><main class="content"><div class="content__container content__container--with-sections"><div class="content__header"><div class="content__header__row"><h1 class="content__header-title">Using Virtual IP Addresses</h1></div><h4 class="content__header-description">Using virtual IP addresses</h4><div class="actions"><ul class="actions__list"><li class="actions__item"><button class="actions__link" onclick="javascript:window.print()"><i class="actions__icon" data-feather="printer"></i><span class="actions__text">Print</span></button></li><li class="actions__item"><a class="actions__link" href="https://github.com/mesosphere/dcos-docs-site/tree/main/pages/dcosdocs/mesosphere/dcos/2.0/networking/load-balancing-vips/virtual-ip-addresses/index.md" target="_blank"><i class="actions__icon" data-feather="github"></i><span class="actions__text">Contribute</span></a></li></ul></div></div><article class="content__article"><p>DC/OS can map traffic from a single Virtual IP (VIP) to multiple IP addresses and ports. DC/OS VIPs are <strong>name-based</strong>, which means clients connect with a service address instead of an IP address.</p>
<p>DC/OS automatically generates name-based VIPs that do not collide with IP VIPs, so you do not have to worry about collisions. This feature allows name-based VIPs to be created automatically when the service is installed.</p>
<p>A named VIP contains these components:</p>
<ul>
<li>Private virtual IP address</li>
<li>Port (a port on which the service is available)</li>
<li>Service name</li>
</ul>
<p>You can assign a VIP to your application from the DC/OS GUI. The values you enter when you deploy a new service are translated into these Marathon application definition entries:</p>
<ul>
<li><code>portDefininitions</code> if not using Docker containers</li>
<li><code>portMappings</code> if using Docker containers</li>
</ul>
<p>VIPs follow this naming convention:</p>
<pre><code class="language-bash">&lt;service-name&gt;.marathon.l4lb.thisdcos.directory:&lt;port&gt;
</code></pre>
<h3 id="prerequisite"><a class="content__anchor" href="#prerequisite" aria-hidden="true"><i data-feather="bookmark"></i></a>Prerequisite</h3>
<ul>
<li>A pool of VIP addresses that are unique to your application.</li>
</ul>
<h2 id="creating-a-vip"><a class="content__anchor" href="#creating-a-vip" aria-hidden="true"><i data-feather="bookmark"></i></a>Creating a VIP</h2>
<ol>
<li>
<p>From the DC/OS <a href="/dcosdocs/mesosphere/dcos/2.0/gui/">GUI</a>, choose the <strong>Services</strong> tab, then <strong>RUN A SERVICE</strong>.</p>
</li>
<li>
<p>Choose a container configuration from the screen.</p>
<p><img src="/dcosdocs/mesosphere/dcos/2.0/img/GUI-Services-Networking-Container-Config-Menu.png" alt="Configuration menu"></p>
<p>Figure 1 - Container configuration menu</p>
<p>The configuration menu will appear.     The configuration menu will appear. The image below shows the screen with the JSON Editor activated; you can turn the editor off with the toggle.</p>
<p><img src="/dcosdocs/mesosphere/dcos/2.0/img/vip-service-definition.png" alt="VIP service definition"></p>
<p>Figure 2 - VIP service definition screen</p>
</li>
<li>
<p>From the <strong>Networking</strong> tab, select  <strong>NETWORK TYPE</strong> &gt; <strong>Virtual Network: dcos</strong>.
<img src="/dcosdocs/mesosphere/dcos/2.0/img/GUI-Services-Container-Config-Menu.png" alt="Networking config page"></p>
<p>Figure 3 - Networking Configuration screen</p>
</li>
<li>
<p>Under <strong>Service Endpoints</strong>, expand <strong>ADD SERVICE ENDPOINT</strong> and provide responses for:</p>
<ul>
<li><strong>CONTAINER PORT</strong></li>
<li><strong>SERVICE ENDPOINT NAME</strong></li>
<li><strong>PORT MAPPING</strong></li>
<li><strong>ENABLE LOAD BALANCED SERVICE ADDRESS</strong></li>
</ul>
<p>As you fill in these fields, the service addresses that Marathon sets up will appear at the bottom of the screen. You can assign multiple VIPs to your app by clicking <strong>ADD SERVICE ENDPOINT</strong>.</p>
</li>
<li>
<p>Choose <strong>REVIEW &amp; RUN</strong> and <strong>RUN SERVICE</strong>.</p>
</li>
</ol>
<p>You can click on the <strong>Networking</strong> tab to view networking details for your service.</p>
<p><img src="/dcosdocs/mesosphere/dcos/2.0/img/GUI-Networking-Networks_View-1_12.png" alt="Networking"></p>
<p>Figure 3 - Networking details</p>
<p>For more information on port configuration, see the <a href="/dcosdocs/mesosphere/dcos/2.0/deploying-services/service-ports/">Marathon ports documentation</a>.</p>
<h2 id="using-vips-with-dcos-services"><a class="content__anchor" href="#using-vips-with-dcos-services" aria-hidden="true"><i data-feather="bookmark"></i></a>Using VIPs with DC/OS Services</h2>
<p>Some DC/OS services, for example <a href="/dcosdocs/mesosphere/dcos/services/kafka/latest/">Kafka</a>, automatically create VIPs when you install them. The naming convention is: <code>broker.&lt;service.name&gt;.l4lb.thisdcos.directory:9092</code>.</p>
<p>Follow these steps to view the VIP for Kafka.</p>
<h3 id="via-the-gui"><a class="content__anchor" href="#via-the-gui" aria-hidden="true"><i data-feather="bookmark"></i></a>Via the GUI</h3>
<ol>
<li>
<p>Click <strong>Networking</strong> &gt; <strong>Networks</strong> and select <strong>dcos</strong>.</p>
</li>
<li>
<p>Select your task to view details.</p>
<p><img src="/dcosdocs/mesosphere/dcos/2.0/img/GUI-Networking-Service-Addresses-Detail.png" alt="Service details"></p>
<p>Figure 5 - VIP service details</p>
</li>
</ol>
<h3 id="via-the-cli"><a class="content__anchor" href="#via-the-cli" aria-hidden="true"><i data-feather="bookmark"></i></a>Via the CLI</h3>
<p><strong>Prerequisite:</strong> The Kafka service and CLI must be <a href="/dcosdocs/mesosphere/dcos/services/kafka/latest/">installed</a>.</p>
<ol>
<li>
<p>Run this command:</p>
<pre><code class="language-bash">dcos kafka endpoints broker
</code></pre>
<p>The output should resemble:</p>
<pre><code class="language-json">{
  &quot;address&quot;: [
    &quot;10.0.2.199:9918&quot;
  ],
  &quot;zookeeper&quot;: &quot;master.mesos:2181/dcos-service-kafka&quot;,
  &quot;dns&quot;: [
    &quot;broker-0.kafka.mesos:9918&quot;
  ],
  &quot;vip&quot;: &quot;broker.kafka.l4lb.thisdcos.directory:9092&quot;
}
</code></pre>
</li>
</ol>
<p>You can use this VIP to address any one of the Kafka brokers in the cluster.</p>
<h2 id="faqs"><a class="content__anchor" href="#faqs" aria-hidden="true"><i data-feather="bookmark"></i></a>FAQs</h2>
<h3 id="connections-seem-to-close-at-random-times"><a class="content__anchor" href="#connections-seem-to-close-at-random-times" aria-hidden="true"><i data-feather="bookmark"></i></a>Connections seem to close at random times</h3>
<p>This behavior is often experienced with applications that have long lived connections, such as databases (for example, PostgreSQL). To fix, try turning on keepalives. The keepalive can be an application specific mechanism like a heartbeat, or something in the protocol like a TCP keepalive. A keepalive is required because a load balancer cannot differentiate between idle or dead connections as no packets are sent in either case. The default timeout depends on the kernel configuration, but is usually 5 minutes.</p>
</article></div><aside class="content__sections"><div class="content__sections-list-container"><ul class="content__sections-list"><li class="content__sections-item content__sections-item--h2"><a href="#creating-a-vip">Creating a VIP</a></li><li class="content__sections-item content__sections-item--h2"><a href="#using-vips-with-dcos-services">Using VIPs with DC/OS Services</a></li><li class="content__sections-item content__sections-item--h2"><a href="#faqs">FAQs</a></li></ul></div></aside></main></div></div><script src="/assets/js/jquery-3.2.1.js"></script><script src="/assets/js/clipboard.js"></script><script src="/assets/js/prism.js"></script><script src="/js/main.js"></script></body></html>